<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Evolu√ß√£o - Yellup</title>
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#1a1a6e">
  <link rel="icon" type="image/x-icon" href="/icons/favicon.ico">
  <link rel="apple-touch-icon" href="/icons/apple-icon-180.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --bg-dark: #0a0e13;
      --bg-card: #131920;
      --bg-elevated: #1a2230;
      --accent-primary: #ff9f43;
      --accent-secondary: #ffc048;
      --accent-glow: rgba(255, 159, 67, 0.25);
      --live-red: #ff4757;
      --win-green: #2ed573;
      --text-primary: #f1f2f6;
      --text-secondary: #a4b0be;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      font-family: 'Poppins', sans-serif;
      background: var(--bg-dark);
      background-image: 
        radial-gradient(ellipse at top, rgba(255, 159, 67, 0.03) 0%, transparent 50%),
        radial-gradient(ellipse at bottom, rgba(26, 34, 48, 0.5) 0%, transparent 50%);
      background-attachment: fixed;
      color: var(--text-primary);
      min-height: 100vh;
      padding-bottom: 100px;
    }

    .header {
      background: rgba(10, 14, 19, 0.95);
      backdrop-filter: blur(20px);
      padding: 12px 16px;
      position: sticky;
      top: 0;
      z-index: 100;
      border-bottom: 1px solid rgba(255, 159, 67, 0.1);
    }
    .header-content { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
    .logo img { height: 36px; filter: drop-shadow(0 2px 8px rgba(255, 181, 71, 0.3)); }
    .btn-back {
      padding: 8px 16px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px; color: #e7eef7; cursor: pointer; font-family: 'Poppins', sans-serif;
      font-size: 0.85em; text-decoration: none; display: flex; align-items: center; gap: 6px; transition: all 0.3s;
    }
    .btn-back:hover { background: rgba(255, 255, 255, 0.2); }

    .container { max-width: 600px; margin: 0 auto; padding: 30px 20px; }

    /* HERO NIVEL */
    .level-hero {
      text-align: center;
      padding: 30px 20px;
      margin-bottom: 24px;
      background: linear-gradient(145deg, var(--bg-card), var(--bg-elevated));
      border: 1px solid rgba(255, 159, 67, 0.15);
      border-radius: 20px;
      position: relative;
      overflow: hidden;
    }
    .level-hero::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary), var(--accent-primary));
      background-size: 200% 100%;
      animation: shimmerBar 3s linear infinite;
    }
    @keyframes shimmerBar {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    .level-emoji { font-size: 4em; margin-bottom: 8px; display: inline-block; animation: levelFloat 3s ease-in-out infinite; }
    @keyframes levelFloat {
      0%, 100% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-8px) scale(1.05); }
    }
    .level-name { font-size: 1.8em; font-weight: 800; margin-bottom: 4px; }
    .level-xp { font-size: 1em; color: var(--accent-secondary); font-weight: 600; }

    /* BARRA DE PROGRESSO */
    .progress-section { margin-bottom: 24px; }
    .progress-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 10px;
    }
    .progress-label { font-size: 0.85em; color: var(--text-secondary); }
    .progress-numbers { font-size: 0.85em; font-weight: 700; color: var(--accent-secondary); }
    .progress-bar-outer {
      width: 100%; height: 16px; background: rgba(0,0,0,0.4);
      border-radius: 10px; overflow: hidden; position: relative;
      border: 1px solid rgba(255,255,255,0.05);
    }
    .progress-bar-inner {
      height: 100%; border-radius: 10px;
      transition: width 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      position: relative;
      width: 0%;
    }
    .progress-bar-inner::after {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shimmerBar 2s linear infinite;
    }
    .progress-percent {
      text-align: center; margin-top: 8px;
      font-size: 0.8em; color: var(--text-secondary);
    }

    /* PR√ìXIMO N√çVEL */
    .next-level-card {
      display: flex; align-items: center; gap: 16px;
      padding: 16px 20px;
      background: linear-gradient(135deg, rgba(255, 159, 67, 0.08), rgba(255, 192, 72, 0.04));
      border: 1px solid rgba(255, 159, 67, 0.15);
      border-radius: 16px; margin-bottom: 24px;
    }
    .next-level-icon { font-size: 2.5em; }
    .next-level-info { flex: 1; }
    .next-level-title { font-size: 0.85em; color: var(--text-secondary); }
    .next-level-name { font-size: 1.1em; font-weight: 700; }
    .next-level-xp { font-size: 0.8em; color: var(--accent-secondary); font-weight: 600; }

    /* TIMELINE DE N√çVEIS */
    .levels-timeline {
      margin-bottom: 24px;
    }
    .timeline-title {
      font-size: 1.1em; font-weight: 700;
      margin-bottom: 16px; display: flex; align-items: center; gap: 8px;
    }
    .timeline-item {
      display: flex; align-items: center; gap: 14px;
      padding: 14px 16px; margin-bottom: 8px;
      border-radius: 14px; position: relative;
      transition: all 0.3s;
    }
    .timeline-item.current {
      background: linear-gradient(135deg, rgba(255, 159, 67, 0.12), rgba(255, 192, 72, 0.06));
      border: 1px solid rgba(255, 159, 67, 0.3);
    }
    .timeline-item.achieved {
      background: rgba(46, 213, 115, 0.06);
      border: 1px solid rgba(46, 213, 115, 0.15);
    }
    .timeline-item.locked {
      opacity: 0.45;
      background: var(--bg-card);
      border: 1px solid rgba(255,255,255,0.05);
    }
    .timeline-emoji { font-size: 1.8em; }
    .timeline-info { flex: 1; }
    .timeline-name { font-weight: 700; font-size: 0.95em; }
    .timeline-xp { font-size: 0.75em; color: var(--text-secondary); }
    .timeline-check { font-size: 1.2em; }

    /* STATS GRID */
    .stats-section { margin-bottom: 24px; }
    .stats-title {
      font-size: 1.1em; font-weight: 700;
      margin-bottom: 16px; display: flex; align-items: center; gap: 8px;
    }
    .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
    .stat-card {
      background: linear-gradient(145deg, var(--bg-card), var(--bg-elevated));
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: 16px; padding: 18px 16px; text-align: center;
      transition: all 0.3s;
    }
    .stat-card:hover {
      border-color: rgba(255, 159, 67, 0.2);
      transform: translateY(-2px);
    }
    .stat-icon { font-size: 1.6em; margin-bottom: 6px; }
    .stat-value { font-size: 1.5em; font-weight: 800; color: var(--accent-secondary); line-height: 1.2; }
    .stat-label { font-size: 0.7em; color: var(--text-secondary); margin-top: 4px; }

    /* DICAS */
    .tips-card {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(59, 130, 246, 0.05));
      border: 1px solid rgba(59, 130, 246, 0.2);
      border-radius: 16px; padding: 20px;
    }
    .tips-title { font-weight: 700; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
    .tip-item {
      display: flex; align-items: flex-start; gap: 10px;
      padding: 10px 0; font-size: 0.85em; color: var(--text-secondary); line-height: 1.5;
    }
    .tip-icon { font-size: 1.2em; flex-shrink: 0; margin-top: 2px; }

    /* BOTTOM NAV */
    .bottom-nav {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: rgba(14, 20, 27, 0.98); backdrop-filter: blur(20px);
      padding: 10px 20px; border-top: 1px solid rgba(255, 255, 255, 0.1); z-index: 99;
    }
    .nav-content { max-width: 600px; margin: 0 auto; display: flex; justify-content: space-around; }
    .nav-item {
      display: flex; flex-direction: column; align-items: center; gap: 5px;
      color: #a9b5c6; text-decoration: none; font-size: 0.75em;
      transition: all 0.3s; padding: 5px 10px;
    }
    .nav-item:hover, .nav-item.active { color: #ffb547; }
    .nav-icon { font-size: 1.5em; }

    @media (max-width: 400px) {
      .stats-grid { grid-template-columns: repeat(2, 1fr); gap: 8px; }
      .level-emoji { font-size: 3em; }
      .level-name { font-size: 1.4em; }
    }
  </style>
</head>
<body>

  <div class="header">
    <div class="header-content">
      <div class="logo">
        <img src="/icons/logo-branca-amarela.png" alt="Yellup" onerror="this.outerHTML='<span style=\'font-size:1.4em;font-weight:800;color:#ffb547\'>YELLUP</span>'">
      </div>
      <a href="painel.html" class="btn-back">‚Üê Voltar</a>
    </div>
  </div>

  <div class="container">

    <!-- HERO N√çVEL ATUAL -->
    <div class="level-hero">
      <div class="level-emoji" id="levelEmoji">üÜï</div>
      <div class="level-name" id="levelName">Carregando...</div>
      <div class="level-xp" id="levelXP">0 XP</div>
    </div>

    <!-- BARRA DE PROGRESSO -->
    <div class="progress-section">
      <div class="progress-header">
        <span class="progress-label" id="progressLabel">Progresso</span>
        <span class="progress-numbers" id="progressNumbers">0 / 0 XP</span>
      </div>
      <div class="progress-bar-outer">
        <div class="progress-bar-inner" id="progressBar" style="width:0%"></div>
      </div>
      <div class="progress-percent" id="progressPercent">0% para o pr√≥ximo n√≠vel</div>
    </div>

    <!-- PR√ìXIMO N√çVEL -->
    <div class="next-level-card" id="nextLevelCard">
      <div class="next-level-icon" id="nextLevelIcon">ü•â</div>
      <div class="next-level-info">
        <div class="next-level-title">Pr√≥ximo n√≠vel</div>
        <div class="next-level-name" id="nextLevelName">Bronze</div>
        <div class="next-level-xp" id="nextLevelXP">Faltam 100 XP</div>
      </div>
    </div>

    <!-- TIMELINE DE N√çVEIS -->
    <div class="levels-timeline">
      <div class="timeline-title">üó∫Ô∏è Jornada de N√≠veis</div>
      <div id="timelineContainer"></div>
    </div>

    <!-- ESTAT√çSTICAS -->
    <div class="stats-section">
      <div class="stats-title">üìä Suas Estat√≠sticas</div>
      <div class="stats-grid">
        <div class="stat-card"><div class="stat-icon">üéÆ</div><div class="stat-value" id="statJogos">0</div><div class="stat-label">Jogos</div></div>
        <div class="stat-card"><div class="stat-icon">üèÜ</div><div class="stat-value" id="statVitorias">0</div><div class="stat-label">Vit√≥rias</div></div>
        <div class="stat-card"><div class="stat-icon">üî•</div><div class="stat-value" id="statStreak">0</div><div class="stat-label">Maior Streak</div></div>
        <div class="stat-card"><div class="stat-icon">üí∞</div><div class="stat-value" id="statCreditos">0</div><div class="stat-label">Cr√©ditos</div></div>
      </div>
    </div>

    <!-- DICAS -->
    <div class="tips-card">
      <div class="tips-title">üí° Como ganhar XP</div>
      <div class="tip-item"><span class="tip-icon">üéÆ</span><span>Participe de jogos ao vivo e responda perguntas</span></div>
      <div class="tip-item"><span class="tip-icon">‚öîÔ∏è</span><span>Ganhe embates PvP contra outros jogadores</span></div>
      <div class="tip-item"><span class="tip-icon">üèÖ</span><span>Complete torneios e fique no top do ranking</span></div>
      <div class="tip-item"><span class="tip-icon">üéØ</span><span>Complete miss√µes di√°rias para XP extra</span></div>
      <div class="tip-item"><span class="tip-icon">üéÅ</span><span>Abra o ba√∫ di√°rio e mantenha sua sequ√™ncia</span></div>
    </div>
  </div>

  <!-- BOTTOM NAV -->
  <nav class="bottom-nav">
    <div class="nav-content">
      <a href="painel.html" class="nav-item"><span class="nav-icon">üè†</span>In√≠cio</a>
      <a href="ranking-geral.html" class="nav-item"><span class="nav-icon">üèÜ</span>Ranking</a>
      <a href="indicacoes.html" class="nav-item"><span class="nav-icon">üîó</span>Indicar</a>
      <a href="editar-perfil.html" class="nav-item"><span class="nav-icon">üë§</span>Perfil</a>
    </div>
  </nav>

  <!-- FIREBASE -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC5ZrkEy7KuCFJOtPvI7-P-JcA0MF4im5c",
      authDomain: "painel-yellup.firebaseapp.com",
      projectId: "painel-yellup",
      storageBucket: "painel-yellup.appspot.com",
      messagingSenderId: "608347210297",
      appId: "1:608347210297:web:75092713724e617c7203e8",
      measurementId: "G-SYZ16X31KQ"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    const LEVELS = [
      { nome: 'Iniciante', emoji: 'üÜï', color: '#a4b0be', threshold: 0 },
      { nome: 'Bronze', emoji: 'ü•â', color: '#cd7f32', threshold: 100 },
      { nome: 'Prata', emoji: 'ü•à', color: '#c0c0c0', threshold: 500 },
      { nome: 'Ouro', emoji: 'ü•á', color: '#ffd700', threshold: 1500 },
      { nome: 'Diamante', emoji: 'üíé', color: '#00bcd4', threshold: 3000 },
      { nome: 'Mestre', emoji: 'üíú', color: '#9b59b6', threshold: 5000 }
    ];

    function getLevel(xp) {
      for (let i = LEVELS.length - 1; i >= 0; i--) {
        if (xp >= LEVELS[i].threshold) return { ...LEVELS[i], index: i };
      }
      return { ...LEVELS[0], index: 0 };
    }

    function getNextLevel(xp) {
      for (const l of LEVELS) {
        if (xp < l.threshold) return l;
      }
      return null; // Already max
    }

    auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL)
      .then(() => console.log('Persist√™ncia OK'))
      .catch(e => console.error('Persist√™ncia erro:', e));

    auth.onAuthStateChanged(async user => {
      if (!user) { window.location.href = 'index.html'; return; }

      try {
        const doc = await db.collection('usuarios').doc(user.uid).get();
        if (!doc.exists) return;
        const data = doc.data();
        const xp = data.xp || data.pontuacao || 0;
        renderEvolucao(xp, data);
      } catch (e) {
        console.error('Erro:', e);
      }
    });

    function renderEvolucao(xp, userData) {
      const level = getLevel(xp);
      const nextLevel = getNextLevel(xp);

      // Hero
      document.getElementById('levelEmoji').textContent = level.emoji;
      document.getElementById('levelName').textContent = level.nome;
      document.getElementById('levelName').style.color = level.color;
      document.getElementById('levelXP').textContent = `${xp.toLocaleString()} XP`;

      // Progress bar
      if (nextLevel) {
        const xpInLevel = xp - level.threshold;
        const xpNeeded = nextLevel.threshold - level.threshold;
        const percent = Math.min(100, Math.round((xpInLevel / xpNeeded) * 100));
        const faltam = nextLevel.threshold - xp;

        document.getElementById('progressLabel').textContent = `${level.nome} ‚Üí ${nextLevel.nome}`;
        document.getElementById('progressNumbers').textContent = `${xp.toLocaleString()} / ${nextLevel.threshold.toLocaleString()} XP`;
        document.getElementById('progressPercent').textContent = `${percent}% ‚Äî faltam ${faltam.toLocaleString()} XP`;

        const bar = document.getElementById('progressBar');
        bar.style.background = `linear-gradient(90deg, ${level.color}, ${nextLevel.color})`;
        setTimeout(() => { bar.style.width = percent + '%'; }, 300);

        // Next level card
        document.getElementById('nextLevelIcon').textContent = nextLevel.emoji;
        document.getElementById('nextLevelName').textContent = nextLevel.nome;
        document.getElementById('nextLevelXP').textContent = `Faltam ${faltam.toLocaleString()} XP`;
      } else {
        // Max level
        document.getElementById('progressLabel').textContent = 'N√≠vel M√°ximo!';
        document.getElementById('progressNumbers').textContent = `${xp.toLocaleString()} XP`;
        document.getElementById('progressPercent').textContent = 'üèÜ Voc√™ alcan√ßou o topo!';
        const bar = document.getElementById('progressBar');
        bar.style.background = `linear-gradient(90deg, ${level.color}, #ff9f43)`;
        setTimeout(() => { bar.style.width = '100%'; }, 300);
        document.getElementById('nextLevelCard').style.display = 'none';
      }

      // Timeline
      const container = document.getElementById('timelineContainer');
      container.innerHTML = LEVELS.map((l, i) => {
        let cls = 'locked';
        let check = 'üîí';
        if (xp >= l.threshold && (i === LEVELS.length - 1 || xp < LEVELS[i + 1].threshold)) {
          cls = 'current';
          check = 'üìç';
        } else if (xp >= l.threshold) {
          cls = 'achieved';
          check = '‚úÖ';
        }
        return `<div class="timeline-item ${cls}">
          <div class="timeline-emoji">${l.emoji}</div>
          <div class="timeline-info">
            <div class="timeline-name" style="color:${cls !== 'locked' ? l.color : ''}">${l.nome}</div>
            <div class="timeline-xp">${l.threshold === 0 ? 'In√≠cio' : l.threshold.toLocaleString() + ' XP'}</div>
          </div>
          <div class="timeline-check">${check}</div>
        </div>`;
      }).join('');

      // Stats
      document.getElementById('statJogos').textContent = (userData.jogosParticipados || userData.totalJogos || 0).toLocaleString();
      document.getElementById('statVitorias').textContent = (userData.vitorias || 0).toLocaleString();
      document.getElementById('statStreak').textContent = (userData.maiorStreak || userData.streakMaximo || 0).toLocaleString();
      document.getElementById('statCreditos').textContent = (userData.creditos || 0).toLocaleString();
    }
  </script>
</body>
</html>
