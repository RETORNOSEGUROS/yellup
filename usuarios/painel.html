<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Painel - Yellup</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #0e141b 0%, #1a2332 100%);
      color: #e7eef7;
      min-height: 100vh;
      padding-bottom: 100px;
    }

    /* ==================== HEADER ==================== */
    .header {
      background: rgba(14, 20, 27, 0.95);
      backdrop-filter: blur(20px);
      padding: 15px 20px;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 1.8em;
      font-weight: 800;
      background: linear-gradient(135deg, #ffb547 0%, #ff8c42 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .user-menu {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .user-avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background: linear-gradient(135deg, #ffb547 0%, #ff8c42 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 1.2em;
      color: #0e141b;
    }

    .user-name {
      font-weight: 600;
    }

    .btn-logout {
      padding: 8px 16px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      color: #e7eef7;
      cursor: pointer;
      font-family: 'Poppins', sans-serif;
      transition: all 0.3s ease;
    }

    .btn-logout:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    /* ==================== CONTAINER ==================== */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 30px 20px;
    }

    /* ==================== PERFIL DO USU√ÅRIO ==================== */
    .user-profile {
      background: linear-gradient(135deg, rgba(30, 41, 54, 0.9) 0%, rgba(24, 34, 46, 0.9) 100%);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    }

    .profile-header {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 25px;
    }

    .profile-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(135deg, #ffb547 0%, #ff8c42 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2em;
      font-weight: 800;
      color: #0e141b;
    }

    .profile-info h2 {
      font-size: 1.5em;
      margin-bottom: 5px;
    }

    .level-badge {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.85em;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .profile-team {
      color: #a9b5c6;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .user-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
    }

    .stat-card {
      background: rgba(0, 0, 0, 0.3);
      padding: 15px;
      border-radius: 12px;
      text-align: center;
    }

    .stat-value {
      font-size: 1.8em;
      font-weight: 800;
      color: #ffb547;
    }

    .stat-label {
      font-size: 0.85em;
      color: #a9b5c6;
    }

    /* ==================== SE√á√ÉO DE JOGOS ==================== */
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .section-title {
      font-size: 1.4em;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-count {
      font-size: 0.9em;
      color: #a9b5c6;
    }

    .games-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    /* ==================== CARD DO JOGO ==================== */
    .game-card {
      background: linear-gradient(135deg, rgba(30, 41, 54, 0.9) 0%, rgba(24, 34, 46, 0.9) 100%);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 20px;
      transition: all 0.3s ease;
    }

    .game-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
      border-color: rgba(255, 181, 71, 0.3);
    }

    .game-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
    }

    .game-teams {
      flex: 1;
    }

    .team-name {
      font-weight: 600;
      font-size: 1.1em;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* Camiseta mini */
    .jersey-mini {
      width: 24px;
      height: 28px;
      display: inline-block;
      vertical-align: middle;
    }

    .vs {
      color: #a9b5c6;
      font-size: 0.85em;
      margin: 5px 0;
    }

    .game-status {
      padding: 6px 15px;
      border-radius: 50px;
      font-size: 0.75em;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .status-live {
      background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
      animation: pulse-live 2s ease-in-out infinite;
      box-shadow: 0 0 20px rgba(231, 76, 60, 0.6);
    }

    @keyframes pulse-live {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.8; transform: scale(1.05); }
    }

    .status-scheduled {
      background: linear-gradient(135deg, #2f6fed 0%, #1a4eb8 100%);
    }

    .status-finished {
      background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
    }

    .game-info {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      padding: 10px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
    }

    .info-item {
      text-align: center;
    }

    .info-label {
      font-size: 0.75em;
      color: #a9b5c6;
      margin-bottom: 3px;
    }

    .info-value {
      font-weight: 600;
      color: #e7eef7;
    }

    /* TORCIDA */
    .torcida {
      margin-bottom: 15px;
    }

    .torcida-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 0.85em;
    }

    .torcida-bar {
      height: 8px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 50px;
      overflow: hidden;
      display: flex;
    }

    .torcida-fill-a {
      background: linear-gradient(90deg, #2ecc71 0%, #27ae60 100%);
      transition: width 0.5s ease;
    }

    .torcida-fill-b {
      background: linear-gradient(90deg, #e74c3c 0%, #c0392b 100%);
      transition: width 0.5s ease;
    }

    /* BADGE DE TIME ESCOLHIDO */
    .team-badge {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 8px 15px;
      background: linear-gradient(135deg, rgba(46, 204, 113, 0.2), rgba(39, 174, 96, 0.2));
      border: 2px solid #2ecc71;
      border-radius: 50px;
      font-size: 0.85em;
      font-weight: 600;
      color: #2ecc71;
      margin-bottom: 15px;
    }

    /* BOT√ïES DE A√á√ÉO */
    .game-actions {
      display: flex;
      gap: 10px;
    }

    .btn-action {
      flex: 1;
      padding: 14px;
      border-radius: 12px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Poppins', sans-serif;
      font-size: 0.95em;
    }

    .btn-primary {
      background: linear-gradient(135deg, #ffb547 0%, #ff8c42 100%);
      color: #0e141b;
      box-shadow: 0 4px 15px rgba(255, 181, 71, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 181, 71, 0.5);
    }

    .btn-secondary {
      background: linear-gradient(135deg, #2f6fed 0%, #1a4eb8 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(47, 111, 237, 0.3);
    }

    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(47, 111, 237, 0.5);
    }

    /* ==================== MODAL DE ESCOLHA ==================== */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(5px);
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal-content {
      background: linear-gradient(135deg, #1e2936 0%, #18222e 100%);
      border-radius: 20px;
      padding: 30px;
      max-width: 500px;
      width: 90%;
      border: 1px solid rgba(255, 255, 255, 0.1);
      animation: modalSlideIn 0.3s ease;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-50px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .modal-header {
      text-align: center;
      margin-bottom: 25px;
    }

    .modal-header h2 {
      font-size: 1.5em;
      margin-bottom: 10px;
    }

    .modal-header p {
      color: #a9b5c6;
    }

    .team-options {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
    }

    .team-option {
      flex: 1;
      padding: 20px;
      background: rgba(0, 0, 0, 0.3);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }

    .team-option:hover {
      border-color: #ffb547;
      background: rgba(255, 181, 71, 0.1);
    }

    .team-option .jersey-modal {
      width: 60px;
      height: 70px;
      margin: 0 auto 15px;
    }

    .team-option .team-name-modal {
      font-weight: 600;
      font-size: 1.1em;
    }

    .modal-warning {
      text-align: center;
      padding: 15px;
      background: rgba(231, 76, 60, 0.1);
      border: 1px solid rgba(231, 76, 60, 0.3);
      border-radius: 10px;
      margin-bottom: 20px;
      color: #e74c3c;
      font-size: 0.9em;
    }

    .modal-actions {
      display: flex;
      justify-content: center;
    }

    .btn-cancel {
      padding: 12px 30px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      color: #a9b5c6;
      cursor: pointer;
      font-family: 'Poppins', sans-serif;
      transition: all 0.3s ease;
    }

    .btn-cancel:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    /* EMPTY STATE */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #a9b5c6;
    }

    .empty-icon {
      font-size: 4em;
      margin-bottom: 20px;
    }

    /* TOAST */
    .toast {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 15px 30px;
      border-radius: 50px;
      font-weight: 600;
      z-index: 2000;
      opacity: 0;
      transition: all 0.3s ease;
    }

    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    /* BOTTOM NAV */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(14, 20, 27, 0.98);
      backdrop-filter: blur(20px);
      padding: 10px 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      z-index: 99;
    }

    .nav-content {
      max-width: 600px;
      margin: 0 auto;
      display: flex;
      justify-content: space-around;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
      color: #a9b5c6;
      text-decoration: none;
      font-size: 0.75em;
      transition: all 0.3s ease;
      padding: 5px 10px;
    }

    .nav-item:hover, .nav-item.active {
      color: #ffb547;
    }

    .nav-icon {
      font-size: 1.5em;
    }

    /* RESPONSIVO */
    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        gap: 15px;
      }

      .games-grid {
        grid-template-columns: 1fr;
      }

      .team-options {
        flex-direction: column;
      }

      .user-stats {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header class="header">
    <div class="header-content">
      <div class="logo">‚öΩ Yellup</div>
      <div class="user-menu">
        <a href="notificacoes.html" class="btn-notif" id="btnNotif" style="
          position: relative;
          padding: 8px;
          margin-right: 10px;
          font-size: 1.3em;
          text-decoration: none;
        ">
          üîî
          <span id="notifBadge" style="
            position: absolute;
            top: 0;
            right: 0;
            background: #ef4444;
            color: #fff;
            font-size: 0.5em;
            padding: 2px 5px;
            border-radius: 10px;
            display: none;
          ">0</span>
        </a>
        <div class="user-avatar" id="userAvatar">U</div>
        <span class="user-name" id="userName">Usu√°rio</span>
        <button class="btn-logout" onclick="logout()">Sair</button>
      </div>
    </div>
  </header>

  <!-- CONTAINER PRINCIPAL -->
  <div class="container">
    
    <!-- PERFIL DO USU√ÅRIO -->
    <div class="user-profile">
      <div class="profile-header">
        <div class="profile-avatar" id="profileAvatar">U</div>
        <div class="profile-info">
          <h2 id="profileName">Usu√°rio</h2>
          <div id="profileLevel"></div>
          <div class="profile-team">
            <span id="profileTeamJersey"></span>
            <span id="profileTeam">Carregando...</span>
          </div>
        </div>
      </div>
      <div id="levelProgress" style="margin-bottom: 20px;"></div>
      <div class="user-stats">
        <div class="stat-card">
          <div class="stat-value" id="statCredits">0</div>
          <div class="stat-label">üíé Cr√©ditos</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="statXP">0</div>
          <div class="stat-label">‚≠ê XP</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="statGames">0</div>
          <div class="stat-label">üéÆ Jogos</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="statFree">5</div>
          <div class="stat-label">üéÅ Gr√°tis</div>
        </div>
      </div>
    </div>

    <!-- JOGOS AO VIVO -->
    <section id="sectionLive">
      <div class="section-header">
        <h2 class="section-title">üî¥ Jogos ao Vivo</h2>
        <span class="section-count" id="countLive">0 jogos</span>
      </div>
      <div class="games-grid" id="gamesLive">
        <div class="empty-state">
          <div class="empty-icon">‚öΩ</div>
          <p>Carregando jogos...</p>
        </div>
      </div>
    </section>

    <!-- MODOS DE JOGO -->
    <section id="sectionModes">
      <div class="section-header">
        <h2 class="section-title">üéÆ Outros Modos</h2>
      </div>
      <div class="modes-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 30px;">
        <a href="teste-ligas.html" class="mode-card" style="
          background: linear-gradient(135deg, rgba(147, 51, 234, 0.2), rgba(79, 70, 229, 0.1));
          border: 2px solid rgba(147, 51, 234, 0.4);
          border-radius: 16px;
          padding: 20px;
          text-align: center;
          text-decoration: none;
          color: #e7eef7;
          transition: all 0.3s ease;
        ">
          <div style="font-size: 2.5em; margin-bottom: 10px;">üèÜ</div>
          <div style="font-weight: 700; margin-bottom: 5px;">Teste de Ligas</div>
          <div style="font-size: 0.8em; color: #a9b5c6;">Treine sem gastar cr√©ditos!</div>
        </a>
        <a href="embates-pvp.html" class="mode-card" style="
          background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(220, 38, 38, 0.1));
          border: 2px solid rgba(239, 68, 68, 0.4);
          border-radius: 16px;
          padding: 20px;
          text-align: center;
          text-decoration: none;
          color: #e7eef7;
          transition: all 0.3s ease;
        ">
          <div style="font-size: 2.5em; margin-bottom: 10px;">‚öîÔ∏è</div>
          <div style="font-weight: 700; margin-bottom: 5px;">Embates PvP</div>
          <div style="font-size: 0.8em; color: #a9b5c6;">Desafie seus amigos!</div>
        </a>
        <a href="torneios.html" class="mode-card" style="
          background: linear-gradient(135deg, rgba(255, 181, 71, 0.2), rgba(255, 140, 66, 0.1));
          border: 2px solid rgba(255, 181, 71, 0.4);
          border-radius: 16px;
          padding: 20px;
          text-align: center;
          text-decoration: none;
          color: #e7eef7;
          transition: all 0.3s ease;
        ">
          <div style="font-size: 2.5em; margin-bottom: 10px;">üèÖ</div>
          <div style="font-weight: 700; margin-bottom: 5px;">Torneios</div>
          <div style="font-size: 0.8em; color: #a9b5c6;">Ganhe pr√™mios incr√≠veis!</div>
        </a>
        <a href="ranking-geral.html" class="mode-card" style="
          background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(5, 150, 105, 0.1));
          border: 2px solid rgba(16, 185, 129, 0.4);
          border-radius: 16px;
          padding: 20px;
          text-align: center;
          text-decoration: none;
          color: #e7eef7;
          transition: all 0.3s ease;
        ">
          <div style="font-size: 2.5em; margin-bottom: 10px;">üìä</div>
          <div style="font-weight: 700; margin-bottom: 5px;">Ranking</div>
          <div style="font-size: 0.8em; color: #a9b5c6;">Veja sua posi√ß√£o!</div>
        </a>
      </div>
    </section>

    <!-- JOGOS AGENDADOS -->
    <section id="sectionScheduled">
      <div class="section-header">
        <h2 class="section-title">üìÖ Pr√≥ximos Jogos</h2>
        <span class="section-count" id="countScheduled">0 jogos</span>
      </div>
      <div class="games-grid" id="gamesScheduled">
        <div class="empty-state">
          <div class="empty-icon">üìÖ</div>
          <p>Carregando jogos...</p>
        </div>
      </div>
    </section>

    <!-- JOGOS ENCERRADOS -->
    <section id="sectionFinished">
      <div class="section-header">
        <h2 class="section-title">‚úÖ Jogos Encerrados</h2>
        <span class="section-count" id="countFinished">0 jogos</span>
      </div>
      <div class="games-grid" id="gamesFinished">
        <div class="empty-state">
          <div class="empty-icon">‚úÖ</div>
          <p>Carregando jogos...</p>
        </div>
      </div>
    </section>

  </div>

  <!-- MODAL DE ESCOLHA DE TIME -->
  <div class="modal-overlay" id="modalEscolha">
    <div class="modal-content">
      <div class="modal-header">
        <h2>‚öΩ Escolha seu Time</h2>
        <p>Para qual time voc√™ vai torcer nesta partida?</p>
      </div>
      
      <div class="team-options">
        <div class="team-option" id="optionTeamA" onclick="confirmarEscolha('A')">
          <div class="jersey-modal" id="jerseyModalA"></div>
          <div class="team-name-modal" id="teamNameModalA">Time A</div>
        </div>
        <div class="team-option" id="optionTeamB" onclick="confirmarEscolha('B')">
          <div class="jersey-modal" id="jerseyModalB"></div>
          <div class="team-name-modal" id="teamNameModalB">Time B</div>
        </div>
      </div>

      <div class="modal-warning">
        ‚ö†Ô∏è Aten√ß√£o: Voc√™ n√£o poder√° mudar de time ap√≥s a escolha!
      </div>

      <div class="modal-actions">
        <button class="btn-cancel" onclick="fecharModal()">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- BOTTOM NAV -->
  <nav class="bottom-nav">
    <div class="nav-content">
      <a href="painel.html" class="nav-item active">
        <span class="nav-icon">üè†</span>
        <span>In√≠cio</span>
      </a>
      <a href="ranking-geral.html" class="nav-item">
        <span class="nav-icon">üèÜ</span>
        <span>Ranking</span>
      </a>
      <a href="indicacoes.html" class="nav-item">
        <span class="nav-icon">üîó</span>
        <span>Indicar</span>
      </a>
      <a href="editar-perfil.html" class="nav-item">
        <span class="nav-icon">üë§</span>
        <span>Perfil</span>
      </a>
    </div>
  </nav>

  <!-- TOAST -->
  <div class="toast" id="toast"></div>

  <!-- FIREBASE -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  
  <script>
    // ===================================
    // üî• CONFIGURA√á√ÉO FIREBASE
    // ===================================
    const firebaseConfig = {
      apiKey: "AIzaSyC5ZrkEy7KuCFJOtPvI7-P-JcA0MF4im5c",
      authDomain: "painel-yellup.firebaseapp.com",
      projectId: "painel-yellup",
      storageBucket: "painel-yellup.appspot.com",
      messagingSenderId: "608347210297",
      appId: "1:608347210297:web:75092713724e617c7203e8",
      measurementId: "G-SYZ16X31KQ"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // ===================================
    // üì¶ VARI√ÅVEIS GLOBAIS
    // ===================================
    let currentUserId = null;
    let currentUserData = null;
    let jogoAtual = null;  // Jogo sendo selecionado no modal

    // ===================================
    // üéñÔ∏è SISTEMA DE N√çVEIS
    // ===================================
    const NIVEIS = [
      { nome: 'Bronze', minXP: 0, classe: 'level-bronze', emoji: 'ü•â', cor: '#CD7F32' },
      { nome: 'Prata', minXP: 500, classe: 'level-prata', emoji: 'ü•à', cor: '#C0C0C0' },
      { nome: 'Ouro', minXP: 2000, classe: 'level-ouro', emoji: 'ü•á', cor: '#FFD700' },
      { nome: 'Diamante', minXP: 5000, classe: 'level-diamante', emoji: 'üíé', cor: '#B9F2FF' },
      { nome: 'Mestre', minXP: 10000, classe: 'level-mestre', emoji: 'üëë', cor: '#9B59B6' }
    ];

    function calcularNivel(xp) {
      let nivel = NIVEIS[0];
      for (const n of NIVEIS) {
        if (xp >= n.minXP) nivel = n;
      }
      return nivel;
    }

    function calcularProximoNivel(xp) {
      for (const n of NIVEIS) {
        if (xp < n.minXP) return n;
      }
      return null; // J√° √© mestre
    }

    function calcularProgressoNivel(xp) {
      const nivelAtual = calcularNivel(xp);
      const proximoNivel = calcularProximoNivel(xp);
      
      if (!proximoNivel) return 100; // Mestre
      
      const xpNoNivelAtual = xp - nivelAtual.minXP;
      const xpParaProximo = proximoNivel.minXP - nivelAtual.minXP;
      
      return Math.round((xpNoNivelAtual / xpParaProximo) * 100);
    }

    // ===================================
    // üëï FUN√á√ÉO PARA GERAR CAMISETA SVG
    // ===================================
    function gerarCamisetaSVG(corPrimaria, corSecundaria, corTerciaria) {
      corPrimaria = corPrimaria || '#28a745';
      corSecundaria = corSecundaria || '#ffffff';
      corTerciaria = corTerciaria || corPrimaria;
      
      return `
        <svg viewBox="0 0 100 120" xmlns="http://www.w3.org/2000/svg">
          <path d="M25,35 L25,110 L75,110 L75,35 L60,35 L60,25 C60,20 55,15 50,15 C45,15 40,20 40,25 L40,35 Z" 
                fill="${corPrimaria}" stroke="${corSecundaria}" stroke-width="2"/>
          <path d="M25,35 L5,50 L5,70 L25,60 Z" 
                fill="${corPrimaria}" stroke="${corSecundaria}" stroke-width="2"/>
          <path d="M75,35 L95,50 L95,70 L75,60 Z" 
                fill="${corPrimaria}" stroke="${corSecundaria}" stroke-width="2"/>
          <path d="M5,50 L15,55 L15,65 L5,70 Z" fill="${corTerciaria}"/>
          <path d="M95,50 L85,55 L85,65 L95,70 Z" fill="${corTerciaria}"/>
          <ellipse cx="50" cy="22" rx="12" ry="8" fill="${corSecundaria}"/>
          <ellipse cx="50" cy="22" rx="8" ry="5" fill="${corPrimaria}"/>
        </svg>
      `;
    }

    // ===================================
    // üí¨ TOAST
    // ===================================
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // ===================================
    // üîê AUTENTICA√á√ÉO
    // ===================================
    auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL)
      .then(() => console.log("‚úÖ Persist√™ncia configurada"))
      .catch((error) => console.error("‚ùå Erro:", error));

    auth.onAuthStateChanged(async (user) => {
      console.log("üîç Verificando autentica√ß√£o...");
      
      if (!user) {
        console.log("‚ùå Usu√°rio n√£o autenticado");
        window.location.href = 'index.html';
        return;
      }

      console.log("‚úÖ Usu√°rio autenticado:", user.uid);
      currentUserId = user.uid;

      try {
        // Carregar dados do usu√°rio
        const userDoc = await db.collection('usuarios').doc(currentUserId).get();
        
        if (!userDoc.exists) {
          console.error("‚ùå Usu√°rio n√£o encontrado no banco!");
          showToast('‚ùå Erro: Usu√°rio n√£o encontrado');
          return;
        }

        currentUserData = userDoc.data();
        console.log("‚úÖ Dados do usu√°rio:", currentUserData);

        // Atualizar interface
        await atualizarPerfil();
        await carregarJogos();

      } catch (error) {
        console.error("‚ùå Erro:", error);
        showToast('‚ùå Erro ao carregar dados');
      }
    });

    // ===================================
    // üë§ ATUALIZAR PERFIL
    // ===================================
    async function atualizarPerfil() {
      const nome = currentUserData.usuarioUnico || currentUserData.usuario || currentUserData.nome || 'Usu√°rio';
      const inicial = nome.charAt(0).toUpperCase();
      const xp = currentUserData.xp || 0;

      document.getElementById('userName').textContent = nome;
      document.getElementById('userAvatar').textContent = inicial;
      document.getElementById('profileName').textContent = nome;
      document.getElementById('profileAvatar').textContent = inicial;

      // Calcular n√≠vel
      const nivel = calcularNivel(xp);
      const proximoNivel = calcularProximoNivel(xp);
      const progresso = calcularProgressoNivel(xp);

      // Atualizar badge de n√≠vel
      const nivelBadge = document.getElementById('profileLevel');
      if (nivelBadge) {
        nivelBadge.innerHTML = `
          <span class="level-badge" style="background: ${nivel.cor}20; color: ${nivel.cor}; border: 1px solid ${nivel.cor}50;">
            ${nivel.emoji} ${nivel.nome}
          </span>
        `;
      }

      // Barra de progresso do n√≠vel
      const progressBar = document.getElementById('levelProgress');
      if (progressBar && proximoNivel) {
        progressBar.innerHTML = `
          <div style="font-size: 0.8em; color: #a9b5c6; margin-bottom: 5px;">
            ${xp} / ${proximoNivel.minXP} XP para ${proximoNivel.emoji} ${proximoNivel.nome}
          </div>
          <div style="height: 6px; background: rgba(0,0,0,0.3); border-radius: 3px; overflow: hidden;">
            <div style="width: ${progresso}%; height: 100%; background: linear-gradient(90deg, ${nivel.cor}, ${proximoNivel.cor}); border-radius: 3px;"></div>
          </div>
        `;
      } else if (progressBar) {
        progressBar.innerHTML = `
          <div style="font-size: 0.8em; color: #9B59B6;">
            üëë N√≠vel m√°ximo atingido!
          </div>
        `;
      }

      // Estat√≠sticas
      document.getElementById('statCredits').textContent = currentUserData.creditos || 0;
      document.getElementById('statXP').textContent = xp;
      
      const jogosParticipados = currentUserData.torcidas ? Object.keys(currentUserData.torcidas).length : 0;
      document.getElementById('statGames').textContent = jogosParticipados;

      const jogadasGratis = 5 - (currentUserData.jogadasGratis?.usadas || 0);
      document.getElementById('statFree').textContent = Math.max(0, jogadasGratis);

      // Time do cora√ß√£o
      if (currentUserData.timeId) {
        try {
          const timeDoc = await db.collection('times').doc(currentUserData.timeId).get();
          if (timeDoc.exists) {
            const time = timeDoc.data();
            document.getElementById('profileTeam').textContent = `‚ù§Ô∏è ${time.nome}`;
            document.getElementById('profileTeamJersey').innerHTML = gerarCamisetaSVG(
              time.primaria, time.secundaria, time.terciaria
            ).replace('viewBox="0 0 100 120"', 'viewBox="0 0 100 120" width="30" height="35"');
          }
        } catch (e) {
          console.error("Erro ao buscar time:", e);
        }
      }
    }

    // ===================================
    // üéÆ CARREGAR JOGOS
    // ===================================
    async function carregarJogos() {
      try {
        console.log("üéÆ Carregando jogos...");

        const jogosSnap = await db.collection('jogos').orderBy('dataInicio', 'desc').get();
        
        const jogosLive = [];
        const jogosScheduled = [];
        const jogosFinished = [];
        const now = new Date();

        for (const doc of jogosSnap.docs) {
          const jogo = { id: doc.id, ...doc.data() };
          
          // Determinar status
          const inicio = jogo.dataInicio?.toDate ? jogo.dataInicio.toDate() : new Date(jogo.dataInicio);
          const fim = jogo.dataFim?.toDate ? jogo.dataFim.toDate() : null;

          if (jogo.status === 'finalizado' || (fim && fim < now)) {
            jogo.statusCalc = 'ENCERRADO';
            jogosFinished.push(jogo);
          } else if (jogo.status === 'ao_vivo' || (inicio <= now && (!fim || fim > now))) {
            jogo.statusCalc = 'LIVE';
            jogosLive.push(jogo);
          } else {
            jogo.statusCalc = 'AGENDADO';
            jogosScheduled.push(jogo);
          }
        }

        console.log(`üìä Live: ${jogosLive.length}, Agendados: ${jogosScheduled.length}, Encerrados: ${jogosFinished.length}`);

        // Renderizar
        await renderizarJogos('gamesLive', jogosLive, 'countLive');
        await renderizarJogos('gamesScheduled', jogosScheduled, 'countScheduled');
        await renderizarJogos('gamesFinished', jogosFinished, 'countFinished');

      } catch (error) {
        console.error("‚ùå Erro ao carregar jogos:", error);
        showToast('‚ùå Erro ao carregar jogos');
      }
    }

    // ===================================
    // üìã RENDERIZAR JOGOS
    // ===================================
    async function renderizarJogos(containerId, jogos, countId) {
      const container = document.getElementById(containerId);
      const count = document.getElementById(countId);

      if (jogos.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">‚öΩ</div>
            <p>Nenhum jogo encontrado</p>
          </div>
        `;
        count.textContent = '0 jogos';
        return;
      }

      count.textContent = `${jogos.length} ${jogos.length === 1 ? 'jogo' : 'jogos'}`;

      // Processar jogos com informa√ß√µes dos times
      const jogosProcessados = await Promise.all(jogos.map(async jogo => {
        // Buscar dados dos times
        let timeCasaData = { nome: 'Time A', primaria: '#28a745', secundaria: '#fff', terciaria: '#28a745' };
        let timeForaData = { nome: 'Time B', primaria: '#dc3545', secundaria: '#fff', terciaria: '#dc3545' };

        try {
          if (jogo.timeCasaId) {
            const casaDoc = await db.collection('times').doc(jogo.timeCasaId).get();
            if (casaDoc.exists) timeCasaData = casaDoc.data();
          }
          if (jogo.timeForaId) {
            const foraDoc = await db.collection('times').doc(jogo.timeForaId).get();
            if (foraDoc.exists) timeForaData = foraDoc.data();
          }
        } catch (e) {
          console.error("Erro ao buscar times:", e);
        }

        // ‚úÖ VERIFICAR SE USU√ÅRIO J√Å ESCOLHEU TIME (do documento do usu√°rio)
        const torcidaEscolhida = currentUserData.torcidas?.[jogo.id];
        let nomeTimeTorcido = null;

        if (torcidaEscolhida) {
          // Encontrar qual time foi escolhido
          if (torcidaEscolhida === jogo.timeCasaId) {
            nomeTimeTorcido = timeCasaData.nome;
          } else if (torcidaEscolhida === jogo.timeForaId) {
            nomeTimeTorcido = timeForaData.nome;
          }
        }

        return {
          ...jogo,
          timeCasaData,
          timeForaData,
          torcidaEscolhida,
          nomeTimeTorcido
        };
      }));

      // Gerar HTML
      container.innerHTML = jogosProcessados.map(jogo => {
        const statusClass = jogo.statusCalc === 'LIVE' ? 'status-live' : 
                           jogo.statusCalc === 'AGENDADO' ? 'status-scheduled' : 'status-finished';
        
        const dataInicio = jogo.dataInicio?.toDate ? jogo.dataInicio.toDate() : new Date(jogo.dataInicio);

        // Contagem de torcida
        const torcidaCasa = jogo.torcidaCasaCount || 0;
        const torcidaFora = jogo.torcidaForaCount || 0;
        const totalTorcida = torcidaCasa + torcidaFora || 1;
        const percCasa = Math.round((torcidaCasa / totalTorcida) * 100);
        const percFora = 100 - percCasa;

        // Badge se j√° escolheu time
        let teamBadge = '';
        if (jogo.nomeTimeTorcido) {
          teamBadge = `<div class="team-badge">‚úÖ Torcendo: ${jogo.nomeTimeTorcido}</div>`;
        }

        // Bot√£o de a√ß√£o
        let actionButton = '';
        if (jogo.torcidaEscolhida) {
          // J√° escolheu - pode entrar
          actionButton = `
            <button class="btn-action btn-primary" onclick="entrarNoJogo('${jogo.id}')">
              ${jogo.statusCalc === 'LIVE' ? 'üî¥ Jogar Agora' : 'üìä Ver Jogo'}
            </button>
          `;
        } else if (jogo.statusCalc !== 'ENCERRADO') {
          // Ainda n√£o escolheu - mostra bot√£o para escolher
          actionButton = `
            <button class="btn-action btn-secondary" onclick="abrirModalEscolha('${jogo.id}')">
              ‚öΩ Escolher Time
            </button>
          `;
        } else {
          // Jogo encerrado e n√£o participou
          actionButton = `
            <button class="btn-action" style="background: #555; cursor: not-allowed;" disabled>
              N√£o participou
            </button>
          `;
        }

        // Gerar mini camisetas
        const jerseyCasa = gerarCamisetaSVG(
          jogo.timeCasaData.primaria, 
          jogo.timeCasaData.secundaria, 
          jogo.timeCasaData.terciaria
        ).replace('viewBox="0 0 100 120"', 'viewBox="0 0 100 120" class="jersey-mini"');

        const jerseyFora = gerarCamisetaSVG(
          jogo.timeForaData.primaria, 
          jogo.timeForaData.secundaria, 
          jogo.timeForaData.terciaria
        ).replace('viewBox="0 0 100 120"', 'viewBox="0 0 100 120" class="jersey-mini"');

        return `
          <div class="game-card">
            <div class="game-header">
              <div class="game-teams">
                <div class="team-name">
                  ${jerseyCasa}
                  ${jogo.timeCasaData.nome}
                </div>
                <div class="vs">vs</div>
                <div class="team-name">
                  ${jerseyFora}
                  ${jogo.timeForaData.nome}
                </div>
              </div>
              <div class="game-status ${statusClass}">${jogo.statusCalc}</div>
            </div>

            <div class="game-info">
              <div class="info-item">
                <div class="info-label">üìÖ Data</div>
                <div class="info-value">${dataInicio.toLocaleDateString('pt-BR')}</div>
              </div>
              <div class="info-item">
                <div class="info-label">‚è∞ Hora</div>
                <div class="info-value">${dataInicio.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}</div>
              </div>
              <div class="info-item">
                <div class="info-label">üí∞ Entrada</div>
                <div class="info-value">${jogo.valorEntrada || 0} cr√©d</div>
              </div>
            </div>

            ${teamBadge}

            <div class="torcida">
              <div class="torcida-header">
                <span>${torcidaCasa} (${percCasa}%)</span>
                <span>${torcidaFora} (${percFora}%)</span>
              </div>
              <div class="torcida-bar">
                <div class="torcida-fill-a" style="width: ${percCasa}%; background: ${jogo.timeCasaData.primaria}"></div>
                <div class="torcida-fill-b" style="width: ${percFora}%; background: ${jogo.timeForaData.primaria}"></div>
              </div>
            </div>

            <div class="game-actions">
              ${actionButton}
            </div>
          </div>
        `;
      }).join('');
    }

    // ===================================
    // ‚öΩ MODAL DE ESCOLHA DE TIME
    // ===================================
    async function abrirModalEscolha(jogoId) {
      console.log("üéØ Abrindo modal para jogo:", jogoId);

      try {
        // Buscar dados do jogo
        const jogoDoc = await db.collection('jogos').doc(jogoId).get();
        if (!jogoDoc.exists) {
          showToast('‚ùå Jogo n√£o encontrado');
          return;
        }

        const jogo = { id: jogoId, ...jogoDoc.data() };

        // Buscar dados dos times
        let timeCasaData = { nome: 'Time A', primaria: '#28a745', secundaria: '#fff', terciaria: '#28a745' };
        let timeForaData = { nome: 'Time B', primaria: '#dc3545', secundaria: '#fff', terciaria: '#dc3545' };

        if (jogo.timeCasaId) {
          const casaDoc = await db.collection('times').doc(jogo.timeCasaId).get();
          if (casaDoc.exists) timeCasaData = { id: jogo.timeCasaId, ...casaDoc.data() };
        }
        if (jogo.timeForaId) {
          const foraDoc = await db.collection('times').doc(jogo.timeForaId).get();
          if (foraDoc.exists) timeForaData = { id: jogo.timeForaId, ...foraDoc.data() };
        }

        // Salvar jogo atual para usar na confirma√ß√£o
        jogoAtual = {
          id: jogoId,
          timeCasaId: jogo.timeCasaId,
          timeForaId: jogo.timeForaId,
          timeCasaData,
          timeForaData
        };

        // Atualizar modal
        document.getElementById('teamNameModalA').textContent = timeCasaData.nome;
        document.getElementById('teamNameModalB').textContent = timeForaData.nome;

        document.getElementById('jerseyModalA').innerHTML = gerarCamisetaSVG(
          timeCasaData.primaria, timeCasaData.secundaria, timeCasaData.terciaria
        );
        document.getElementById('jerseyModalB').innerHTML = gerarCamisetaSVG(
          timeForaData.primaria, timeForaData.secundaria, timeForaData.terciaria
        );

        // Aplicar cores de borda
        document.getElementById('optionTeamA').style.borderColor = timeCasaData.primaria;
        document.getElementById('optionTeamB').style.borderColor = timeForaData.primaria;

        // Mostrar modal
        document.getElementById('modalEscolha').classList.add('active');

      } catch (error) {
        console.error("‚ùå Erro ao abrir modal:", error);
        showToast('‚ùå Erro ao carregar times');
      }
    }

    function fecharModal() {
      document.getElementById('modalEscolha').classList.remove('active');
      jogoAtual = null;
    }

    // ===================================
    // ‚úÖ CONFIRMAR ESCOLHA DE TIME
    // ===================================
    async function confirmarEscolha(lado) {
      if (!jogoAtual) {
        showToast('‚ùå Erro: Jogo n√£o selecionado');
        return;
      }

      const timeEscolhidoId = lado === 'A' ? jogoAtual.timeCasaId : jogoAtual.timeForaId;
      const timeEscolhidoNome = lado === 'A' ? jogoAtual.timeCasaData.nome : jogoAtual.timeForaData.nome;

      console.log("‚úÖ Confirmando escolha:");
      console.log("   Jogo:", jogoAtual.id);
      console.log("   Time ID:", timeEscolhidoId);
      console.log("   Time Nome:", timeEscolhidoNome);

      // Confirmar
      if (!confirm(`Voc√™ quer torcer para ${timeEscolhidoNome}?\n\n‚ö†Ô∏è Esta escolha n√£o pode ser alterada!`)) {
        return;
      }

      try {
        showToast('üíæ Salvando...');

        // 1. Atualizar documento do usu√°rio com o timeId real
        await db.collection('usuarios').doc(currentUserId).update({
          [`torcidas.${jogoAtual.id}`]: timeEscolhidoId
        });

        // 2. Atualizar contador do jogo
        const campoContador = lado === 'A' ? 'torcidaCasaCount' : 'torcidaForaCount';
        await db.collection('jogos').doc(jogoAtual.id).update({
          [campoContador]: firebase.firestore.FieldValue.increment(1)
        });

        // 3. Atualizar dados locais
        if (!currentUserData.torcidas) currentUserData.torcidas = {};
        currentUserData.torcidas[jogoAtual.id] = timeEscolhidoId;

        console.log("‚úÖ Escolha salva com sucesso!");
        showToast(`‚úÖ Voc√™ est√° torcendo para ${timeEscolhidoNome}!`);

        // Fechar modal
        fecharModal();

        // Recarregar jogos
        await carregarJogos();

        // Redirecionar para o jogo ap√≥s 1 segundo
        setTimeout(() => {
          entrarNoJogo(jogoAtual.id);
        }, 1000);

      } catch (error) {
        console.error("‚ùå Erro ao salvar:", error);
        showToast('‚ùå Erro ao salvar escolha. Tente novamente!');
      }
    }

    // ===================================
    // üéÆ ENTRAR NO JOGO
    // ===================================
    function entrarNoJogo(jogoId) {
      window.location.href = `painel-jogo.html?jogoId=${jogoId}`;
    }

    // ===================================
    // üö™ LOGOUT
    // ===================================
    function logout() {
      if (confirm('Deseja realmente sair?')) {
        auth.signOut().then(() => {
          window.location.href = 'index.html';
        });
      }
    }

    // Fechar modal ao clicar fora
    document.getElementById('modalEscolha').addEventListener('click', function(e) {
      if (e.target === this) {
        fecharModal();
      }
    });

    console.log("‚úÖ Yellup Painel v5.0 - Com Modal de Escolha e Camisetas!");
  </script>

</body>
</html>
