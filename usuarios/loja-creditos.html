<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Loja de Cr√©ditos - Yellup</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #0e141b 0%, #1a2332 100%);
      color: #e7eef7;
      min-height: 100vh;
      padding-bottom: 100px;
    }

    /* Header */
    .header {
      background: rgba(14, 20, 27, 0.95);
      backdrop-filter: blur(20px);
      padding: 15px 20px;
      position: sticky;
      top: 0;
      z-index: 100;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .header-content {
      max-width: 600px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .btn-back {
      padding: 10px 20px;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: 10px;
      color: #fff;
      cursor: pointer;
      font-family: 'Poppins', sans-serif;
      transition: all 0.3s ease;
    }

    .btn-back:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .logo {
      font-size: 1.5em;
      font-weight: 800;
      background: linear-gradient(135deg, #ffb547 0%, #ff8c42 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Container */
    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Page Title */
    .page-title {
      text-align: center;
      margin-bottom: 25px;
    }

    .page-title h1 {
      font-size: 1.8em;
      margin-bottom: 5px;
    }

    .page-title p {
      color: #a9b5c6;
    }

    /* Saldo Atual */
    .balance-card {
      background: linear-gradient(135deg, rgba(255, 181, 71, 0.2) 0%, rgba(255, 140, 66, 0.1) 100%);
      border: 2px solid rgba(255, 181, 71, 0.5);
      border-radius: 20px;
      padding: 25px;
      text-align: center;
      margin-bottom: 30px;
    }

    .balance-label {
      font-size: 0.9em;
      color: #a9b5c6;
      margin-bottom: 5px;
    }

    .balance-value {
      font-size: 3em;
      font-weight: 800;
      color: #ffb547;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .balance-emoji {
      font-size: 0.8em;
    }

    /* Pacotes */
    .section-title {
      font-size: 1.2em;
      font-weight: 700;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .packages-grid {
      display: grid;
      gap: 15px;
      margin-bottom: 30px;
    }

    .package-card {
      background: linear-gradient(135deg, rgba(30, 41, 54, 0.9) 0%, rgba(24, 34, 46, 0.9) 100%);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 20px;
      display: flex;
      align-items: center;
      gap: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .package-card:hover {
      border-color: rgba(255, 181, 71, 0.5);
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    .package-card.popular {
      border-color: rgba(255, 181, 71, 0.6);
    }

    .package-card.popular::before {
      content: '‚≠ê MAIS POPULAR';
      position: absolute;
      top: 0;
      right: 0;
      background: linear-gradient(135deg, #ffb547, #ff8c42);
      color: #0e141b;
      font-size: 0.65em;
      font-weight: 700;
      padding: 5px 12px;
      border-radius: 0 14px 0 10px;
    }

    .package-card.best::before {
      content: 'üî• MELHOR VALOR';
      position: absolute;
      top: 0;
      right: 0;
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: #fff;
      font-size: 0.65em;
      font-weight: 700;
      padding: 5px 12px;
      border-radius: 0 14px 0 10px;
    }

    .package-icon {
      width: 60px;
      height: 60px;
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8em;
      background: linear-gradient(135deg, rgba(255, 181, 71, 0.2), rgba(255, 140, 66, 0.1));
      flex-shrink: 0;
    }

    .package-info {
      flex: 1;
    }

    .package-credits {
      font-size: 1.3em;
      font-weight: 700;
      margin-bottom: 3px;
    }

    .package-bonus {
      font-size: 0.8em;
      color: #10b981;
    }

    .package-price {
      text-align: right;
    }

    .package-value {
      font-size: 1.4em;
      font-weight: 800;
      color: #ffb547;
    }

    .package-per-credit {
      font-size: 0.75em;
      color: #a9b5c6;
    }

    /* Promo√ß√µes */
    .promo-card {
      background: linear-gradient(135deg, rgba(147, 51, 234, 0.2), rgba(79, 70, 229, 0.1));
      border: 2px solid rgba(147, 51, 234, 0.5);
      border-radius: 16px;
      padding: 20px;
      text-align: center;
      margin-bottom: 30px;
    }

    .promo-title {
      font-size: 1.2em;
      font-weight: 700;
      color: #a78bfa;
      margin-bottom: 10px;
    }

    .promo-desc {
      color: #a9b5c6;
      margin-bottom: 15px;
    }

    .promo-code {
      display: inline-block;
      background: rgba(0, 0, 0, 0.3);
      padding: 10px 20px;
      border-radius: 10px;
      font-family: monospace;
      font-size: 1.2em;
      color: #fff;
      letter-spacing: 2px;
    }

    /* Como funciona */
    .info-card {
      background: linear-gradient(135deg, rgba(30, 41, 54, 0.9) 0%, rgba(24, 34, 46, 0.9) 100%);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .info-item {
      display: flex;
      gap: 15px;
      padding: 12px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .info-item:last-child {
      border-bottom: none;
    }

    .info-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255, 181, 71, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2em;
      flex-shrink: 0;
    }

    .info-text {
      flex: 1;
    }

    .info-text strong {
      display: block;
      margin-bottom: 3px;
    }

    .info-text span {
      font-size: 0.85em;
      color: #a9b5c6;
    }

    /* Formas de pagamento */
    .payment-methods {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
      margin-top: 15px;
    }

    .payment-method {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 15px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
      font-size: 0.85em;
      color: #a9b5c6;
    }

    /* Modal Compra */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal-content {
      background: linear-gradient(135deg, #1e2936 0%, #18222e 100%);
      border-radius: 20px;
      width: 100%;
      max-width: 400px;
      overflow: hidden;
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .modal-header {
      padding: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-weight: 700;
      font-size: 1.2em;
    }

    .modal-close {
      background: none;
      border: none;
      color: #a9b5c6;
      font-size: 1.5em;
      cursor: pointer;
    }

    .modal-body {
      padding: 25px;
    }

    .modal-package {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 15px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 12px;
      margin-bottom: 20px;
    }

    .modal-package-icon {
      font-size: 2em;
    }

    .modal-package-info h3 {
      font-weight: 700;
      margin-bottom: 3px;
    }

    .modal-package-info p {
      color: #ffb547;
      font-weight: 600;
    }

    .payment-options {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 20px;
    }

    .payment-option {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 15px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .payment-option:hover {
      border-color: rgba(255, 181, 71, 0.5);
    }

    .payment-option.selected {
      border-color: #ffb547;
      background: rgba(255, 181, 71, 0.1);
    }

    .payment-option input {
      display: none;
    }

    .payment-radio {
      width: 20px;
      height: 20px;
      border: 2px solid #a9b5c6;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .payment-option.selected .payment-radio {
      border-color: #ffb547;
    }

    .payment-option.selected .payment-radio::after {
      content: '';
      width: 10px;
      height: 10px;
      background: #ffb547;
      border-radius: 50%;
    }

    .payment-icon {
      font-size: 1.5em;
    }

    .payment-name {
      flex: 1;
      font-weight: 600;
    }

    .btn-pay {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #10b981, #059669);
      border: none;
      border-radius: 12px;
      color: #fff;
      font-size: 1.1em;
      font-weight: 700;
      cursor: pointer;
      font-family: 'Poppins', sans-serif;
      transition: all 0.3s ease;
    }

    .btn-pay:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
    }

    .btn-pay:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .secure-badge {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-top: 15px;
      font-size: 0.85em;
      color: #a9b5c6;
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 15px 30px;
      border-radius: 50px;
      font-weight: 600;
      z-index: 2000;
      opacity: 0;
      transition: all 0.3s ease;
    }

    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    /* Bottom Nav */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(14, 20, 27, 0.98);
      backdrop-filter: blur(20px);
      padding: 10px 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      z-index: 99;
    }

    .nav-content {
      max-width: 600px;
      margin: 0 auto;
      display: flex;
      justify-content: space-around;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
      color: #a9b5c6;
      text-decoration: none;
      font-size: 0.75em;
      transition: all 0.3s ease;
    }

    .nav-item:hover, .nav-item.active {
      color: #ffb547;
    }

    .nav-icon {
      font-size: 1.5em;
    }

    /* Loading */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      flex-direction: column;
    }

    .loading-overlay.active {
      display: flex;
    }

    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(255, 181, 71, 0.2);
      border-top-color: #ffb547;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 15px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <button class="btn-back" onclick="window.location.href='painel.html'">‚Üê Voltar</button>
      <div class="logo">‚öΩ Yellup</div>
      <div style="width: 80px;"></div>
    </div>
  </header>

  <!-- Container -->
  <div class="container">
    
    <div class="page-title">
      <h1>üíé Loja de Cr√©ditos</h1>
      <p>Compre cr√©ditos para jogar mais!</p>
    </div>

    <!-- Saldo Atual -->
    <div class="balance-card">
      <div class="balance-label">Seu saldo atual</div>
      <div class="balance-value">
        <span class="balance-emoji">üíé</span>
        <span id="currentBalance">0</span>
      </div>
    </div>

    <!-- Pacotes -->
    <div class="section-title">üì¶ Pacotes de Cr√©ditos</div>
    
    <div class="packages-grid">
      
      <div class="package-card" onclick="selecionarPacote(1)">
        <div class="package-icon">üíé</div>
        <div class="package-info">
          <div class="package-credits">10 Cr√©ditos</div>
          <div class="package-bonus"></div>
        </div>
        <div class="package-price">
          <div class="package-value">R$ 4,90</div>
          <div class="package-per-credit">R$ 0,49/cr√©dito</div>
        </div>
      </div>

      <div class="package-card" onclick="selecionarPacote(2)">
        <div class="package-icon">üíéüíé</div>
        <div class="package-info">
          <div class="package-credits">30 Cr√©ditos</div>
          <div class="package-bonus">+5 b√¥nus</div>
        </div>
        <div class="package-price">
          <div class="package-value">R$ 12,90</div>
          <div class="package-per-credit">R$ 0,37/cr√©dito</div>
        </div>
      </div>

      <div class="package-card popular" onclick="selecionarPacote(3)">
        <div class="package-icon">üíéüíéüíé</div>
        <div class="package-info">
          <div class="package-credits">60 Cr√©ditos</div>
          <div class="package-bonus">+15 b√¥nus</div>
        </div>
        <div class="package-price">
          <div class="package-value">R$ 24,90</div>
          <div class="package-per-credit">R$ 0,33/cr√©dito</div>
        </div>
      </div>

      <div class="package-card best" onclick="selecionarPacote(4)">
        <div class="package-icon">üëë</div>
        <div class="package-info">
          <div class="package-credits">150 Cr√©ditos</div>
          <div class="package-bonus">+50 b√¥nus</div>
        </div>
        <div class="package-price">
          <div class="package-value">R$ 49,90</div>
          <div class="package-per-credit">R$ 0,25/cr√©dito</div>
        </div>
      </div>

    </div>

    <!-- Promo√ß√£o -->
    <div class="promo-card">
      <div class="promo-title">üéÅ Cupom de Desconto</div>
      <div class="promo-desc">Use um cupom e ganhe cr√©ditos extras!</div>
      <div style="display: flex; gap: 10px; max-width: 300px; margin: 0 auto;">
        <input type="text" class="form-input" id="couponInput" placeholder="Digite o cupom" style="
          padding: 12px;
          background: rgba(0,0,0,0.3);
          border: 2px solid rgba(255,255,255,0.1);
          border-radius: 10px;
          color: #fff;
          flex: 1;
          font-family: 'Poppins', sans-serif;
        ">
        <button onclick="aplicarCupom()" style="
          padding: 12px 20px;
          background: linear-gradient(135deg, #a78bfa, #8b5cf6);
          border: none;
          border-radius: 10px;
          color: #fff;
          font-weight: 600;
          cursor: pointer;
          font-family: 'Poppins', sans-serif;
        ">Aplicar</button>
      </div>
    </div>

    <!-- Como funciona -->
    <div class="info-card">
      <div class="section-title">‚ùì Como funciona</div>
      
      <div class="info-item">
        <div class="info-icon">1Ô∏è‚É£</div>
        <div class="info-text">
          <strong>Escolha um pacote</strong>
          <span>Quanto maior o pacote, mais b√¥nus voc√™ ganha!</span>
        </div>
      </div>

      <div class="info-item">
        <div class="info-icon">2Ô∏è‚É£</div>
        <div class="info-text">
          <strong>Pague com seguran√ßa</strong>
          <span>PIX, cart√£o de cr√©dito ou boleto</span>
        </div>
      </div>

      <div class="info-item">
        <div class="info-icon">3Ô∏è‚É£</div>
        <div class="info-text">
          <strong>Receba instantaneamente</strong>
          <span>Cr√©ditos liberados na hora ap√≥s confirma√ß√£o</span>
        </div>
      </div>

      <div class="payment-methods">
        <div class="payment-method">
          <span>üè¶</span> PIX
        </div>
        <div class="payment-method">
          <span>üí≥</span> Cart√£o
        </div>
        <div class="payment-method">
          <span>üìÑ</span> Boleto
        </div>
      </div>
    </div>

    <!-- Hist√≥rico -->
    <div class="info-card">
      <div class="section-title">üìú √öltimas Compras</div>
      <div id="purchaseHistory">
        <p style="text-align: center; color: #a9b5c6; padding: 20px;">
          Voc√™ ainda n√£o fez nenhuma compra
        </p>
      </div>
    </div>

  </div>

  <!-- Modal Compra -->
  <div class="modal-overlay" id="modalCompra">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">üí≥ Finalizar Compra</div>
        <button class="modal-close" onclick="fecharModal()">√ó</button>
      </div>
      <div class="modal-body">
        <div class="modal-package" id="modalPackage">
          <div class="modal-package-icon">üíé</div>
          <div class="modal-package-info">
            <h3>60 Cr√©ditos + 15 b√¥nus</h3>
            <p>R$ 24,90</p>
          </div>
        </div>

        <div class="section-title" style="margin-bottom: 15px;">Forma de Pagamento</div>
        
        <div class="payment-options">
          <label class="payment-option selected" onclick="selecionarPagamento(this, 'pix')">
            <input type="radio" name="payment" value="pix" checked>
            <div class="payment-radio"></div>
            <div class="payment-icon">üè¶</div>
            <div class="payment-name">PIX</div>
            <div style="color: #10b981; font-size: 0.8em;">Instant√¢neo</div>
          </label>

          <label class="payment-option" onclick="selecionarPagamento(this, 'card')">
            <input type="radio" name="payment" value="card">
            <div class="payment-radio"></div>
            <div class="payment-icon">üí≥</div>
            <div class="payment-name">Cart√£o de Cr√©dito</div>
            <div style="color: #a9b5c6; font-size: 0.8em;">At√© 3x sem juros</div>
          </label>

          <label class="payment-option" onclick="selecionarPagamento(this, 'boleto')">
            <input type="radio" name="payment" value="boleto">
            <div class="payment-radio"></div>
            <div class="payment-icon">üìÑ</div>
            <div class="payment-name">Boleto Banc√°rio</div>
            <div style="color: #a9b5c6; font-size: 0.8em;">At√© 3 dias √∫teis</div>
          </label>
        </div>

        <button class="btn-pay" id="btnPay" onclick="processarPagamento()">
          üîí Pagar R$ <span id="payValue">24,90</span>
        </button>

        <div class="secure-badge">
          <span>üîê</span> Pagamento 100% seguro
        </div>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <p>Processando pagamento...</p>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <!-- Bottom Nav -->
  <nav class="bottom-nav">
    <div class="nav-content">
      <a href="painel.html" class="nav-item">
        <span class="nav-icon">üè†</span>
        <span>In√≠cio</span>
      </a>
      <a href="ranking-geral.html" class="nav-item">
        <span class="nav-icon">üèÜ</span>
        <span>Ranking</span>
      </a>
      <a href="indicacoes.html" class="nav-item">
        <span class="nav-icon">üîó</span>
        <span>Indicar</span>
      </a>
      <a href="editar-perfil.html" class="nav-item">
        <span class="nav-icon">üë§</span>
        <span>Perfil</span>
      </a>
    </div>
  </nav>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    // ===================================
    // üî• CONFIGURA√á√ÉO FIREBASE
    // ===================================
    const firebaseConfig = {
      apiKey: "AIzaSyC5ZrkEy7KuCFJOtPvI7-P-JcA0MF4im5c",
      authDomain: "painel-yellup.firebaseapp.com",
      projectId: "painel-yellup",
      storageBucket: "painel-yellup.appspot.com",
      messagingSenderId: "608347210297",
      appId: "1:608347210297:web:75092713724e617c7203e8"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // ===================================
    // üì¶ PACOTES
    // ===================================
    const PACOTES = [
      { id: 1, creditos: 10, bonus: 0, preco: 4.90, icon: 'üíé' },
      { id: 2, creditos: 30, bonus: 5, preco: 12.90, icon: 'üíéüíé' },
      { id: 3, creditos: 60, bonus: 15, preco: 24.90, icon: 'üíéüíéüíé' },
      { id: 4, creditos: 150, bonus: 50, preco: 49.90, icon: 'üëë' }
    ];

    // ===================================
    // üì¶ VARI√ÅVEIS
    // ===================================
    let currentUserId = null;
    let currentUserData = null;
    let pacoteSelecionado = null;
    let metodoPagamento = 'pix';
    let cupomAplicado = null;

    // ===================================
    // üí¨ TOAST
    // ===================================
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // ===================================
    // üîê AUTENTICA√á√ÉO
    // ===================================
    auth.onAuthStateChanged(async (user) => {
      if (!user) {
        window.location.href = 'index.html';
        return;
      }

      currentUserId = user.uid;

      try {
        const userDoc = await db.collection('usuarios').doc(currentUserId).get();
        if (userDoc.exists) {
          currentUserData = userDoc.data();
          document.getElementById('currentBalance').textContent = currentUserData.creditos || 0;
          carregarHistorico();
        }
      } catch (error) {
        console.error("Erro:", error);
      }
    });

    // ===================================
    // üì¶ SELECIONAR PACOTE
    // ===================================
    function selecionarPacote(pacoteId) {
      pacoteSelecionado = PACOTES.find(p => p.id === pacoteId);
      
      if (!pacoteSelecionado) return;

      const total = pacoteSelecionado.creditos + pacoteSelecionado.bonus;
      const bonusText = pacoteSelecionado.bonus > 0 ? ` + ${pacoteSelecionado.bonus} b√¥nus` : '';

      document.getElementById('modalPackage').innerHTML = `
        <div class="modal-package-icon">${pacoteSelecionado.icon}</div>
        <div class="modal-package-info">
          <h3>${pacoteSelecionado.creditos} Cr√©ditos${bonusText}</h3>
          <p>R$ ${pacoteSelecionado.preco.toFixed(2).replace('.', ',')}</p>
        </div>
      `;

      document.getElementById('payValue').textContent = pacoteSelecionado.preco.toFixed(2).replace('.', ',');
      document.getElementById('modalCompra').classList.add('active');
    }

    // ===================================
    // üí≥ SELECIONAR PAGAMENTO
    // ===================================
    function selecionarPagamento(element, metodo) {
      document.querySelectorAll('.payment-option').forEach(opt => opt.classList.remove('selected'));
      element.classList.add('selected');
      metodoPagamento = metodo;
    }

    // ===================================
    // üéÅ APLICAR CUPOM
    // ===================================
    function aplicarCupom() {
      const cupom = document.getElementById('couponInput').value.trim().toUpperCase();
      
      // Cupons v√°lidos (voc√™ pode gerenciar isso no Firebase depois)
      const CUPONS = {
        'YELLUP10': { bonus: 10, descricao: '+10 cr√©ditos' },
        'BEMVINDO': { bonus: 5, descricao: '+5 cr√©ditos' },
        'VIP50': { bonus: 50, descricao: '+50 cr√©ditos' }
      };

      if (CUPONS[cupom]) {
        cupomAplicado = CUPONS[cupom];
        showToast(`‚úÖ Cupom aplicado! ${cupomAplicado.descricao}`);
        document.getElementById('couponInput').disabled = true;
      } else if (cupom) {
        showToast('‚ùå Cupom inv√°lido');
      }
    }

    // ===================================
    // üí∞ PROCESSAR PAGAMENTO
    // ===================================
    async function processarPagamento() {
      if (!pacoteSelecionado) return;

      const loading = document.getElementById('loadingOverlay');
      loading.classList.add('active');

      try {
        // Simular processamento (aqui voc√™ integraria com Mercado Pago/PagSeguro)
        await new Promise(resolve => setTimeout(resolve, 2000));

        // Calcular cr√©ditos totais
        let creditosTotal = pacoteSelecionado.creditos + pacoteSelecionado.bonus;
        if (cupomAplicado) {
          creditosTotal += cupomAplicado.bonus;
        }

        // Adicionar cr√©ditos ao usu√°rio
        await db.collection('usuarios').doc(currentUserId).update({
          creditos: firebase.firestore.FieldValue.increment(creditosTotal)
        });

        // Registrar compra
        await db.collection('compras').add({
          usuarioId: currentUserId,
          pacoteId: pacoteSelecionado.id,
          creditos: creditosTotal,
          valor: pacoteSelecionado.preco,
          metodoPagamento: metodoPagamento,
          cupom: cupomAplicado ? cupomAplicado : null,
          status: 'aprovado',
          data: firebase.firestore.FieldValue.serverTimestamp()
        });

        loading.classList.remove('active');
        fecharModal();

        // Atualizar saldo na tela
        const novoSaldo = (currentUserData.creditos || 0) + creditosTotal;
        document.getElementById('currentBalance').textContent = novoSaldo;
        currentUserData.creditos = novoSaldo;

        showToast(`üéâ +${creditosTotal} cr√©ditos adicionados!`);
        carregarHistorico();

        // Resetar cupom
        cupomAplicado = null;
        document.getElementById('couponInput').value = '';
        document.getElementById('couponInput').disabled = false;

      } catch (error) {
        console.error("Erro:", error);
        loading.classList.remove('active');
        showToast('‚ùå Erro ao processar pagamento');
      }
    }

    // ===================================
    // üìú CARREGAR HIST√ìRICO
    // ===================================
    async function carregarHistorico() {
      try {
        const snapshot = await db.collection('compras')
          .where('usuarioId', '==', currentUserId)
          .orderBy('data', 'desc')
          .limit(5)
          .get();

        const container = document.getElementById('purchaseHistory');

        if (snapshot.empty) {
          container.innerHTML = `
            <p style="text-align: center; color: #a9b5c6; padding: 20px;">
              Voc√™ ainda n√£o fez nenhuma compra
            </p>
          `;
          return;
        }

        let html = '';
        snapshot.forEach(doc => {
          const compra = doc.data();
          const data = compra.data?.toDate ? compra.data.toDate().toLocaleDateString('pt-BR') : 'Pendente';
          
          html += `
            <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">
              <div>
                <div style="font-weight: 600;">üíé ${compra.creditos} cr√©ditos</div>
                <div style="font-size: 0.8em; color: #a9b5c6;">${data}</div>
              </div>
              <div style="text-align: right;">
                <div style="color: #10b981;">R$ ${compra.valor.toFixed(2).replace('.', ',')}</div>
                <div style="font-size: 0.75em; color: #a9b5c6;">${compra.status === 'aprovado' ? '‚úÖ Aprovado' : '‚è≥ Pendente'}</div>
              </div>
            </div>
          `;
        });

        container.innerHTML = html;

      } catch (error) {
        console.error("Erro ao carregar hist√≥rico:", error);
      }
    }

    // ===================================
    // üì± MODAL
    // ===================================
    function fecharModal() {
      document.getElementById('modalCompra').classList.remove('active');
      pacoteSelecionado = null;
    }

    // Fechar modal ao clicar fora
    document.getElementById('modalCompra').addEventListener('click', (e) => {
      if (e.target.id === 'modalCompra') fecharModal();
    });

    console.log("‚úÖ Loja de Cr√©ditos v1.0");
  </script>

</body>
</html>
