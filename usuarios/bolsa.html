<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>√çndice dos Times - Yellup</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg-primary: #0e141b;
      --bg-secondary: #1a2332;
      --bg-card: #232d3f;
      --text-primary: #e7eef7;
      --text-secondary: #a9b5c6;
      --accent: #ffb547;
      --accent-dark: #ff8c42;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --info: #3b82f6;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
      color: var(--text-primary);
      min-height: 100vh;
      padding-bottom: 100px;
    }

    /* Header */
    .header {
      background: rgba(14, 20, 27, 0.95);
      backdrop-filter: blur(20px);
      padding: 15px 20px;
      position: sticky;
      top: 0;
      z-index: 100;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .btn-back {
      padding: 10px 20px;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: 10px;
      color: #fff;
      cursor: pointer;
      font-family: 'Poppins', sans-serif;
      text-decoration: none;
      transition: all 0.3s ease;
    }

    .btn-back:hover { background: rgba(255, 255, 255, 0.2); }

    .logo {
      font-size: 1.5em;
      font-weight: 800;
    }

    .logo-yellup {
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .logo-stock { color: var(--success); font-size: 0.8em; }

    .user-credits {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      background: rgba(255, 181, 71, 0.1);
      border: 1px solid rgba(255, 181, 71, 0.3);
      border-radius: 10px;
    }

    .credits-value { font-weight: 700; color: var(--accent); }

    /* Container */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Stats Bar */
    .stats-bar {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }

    .stat-card {
      background: linear-gradient(135deg, var(--bg-card) 0%, rgba(35, 45, 63, 0.8) 100%);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 20px;
      text-align: center;
    }

    .stat-value {
      font-size: 1.6em;
      font-weight: 800;
      color: var(--accent);
    }

    .stat-value.green { color: var(--success); }
    .stat-value.red { color: var(--danger); }

    .stat-label {
      font-size: 0.8em;
      color: var(--text-secondary);
      margin-top: 5px;
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      overflow-x: auto;
      padding-bottom: 5px;
    }

    .tab-btn {
      padding: 12px 24px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      color: var(--text-secondary);
      cursor: pointer;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      font-size: 0.9em;
      transition: all 0.3s ease;
      white-space: nowrap;
    }

    .tab-btn:hover { border-color: rgba(255, 181, 71, 0.5); }

    .tab-btn.active {
      border-color: var(--accent);
      background: rgba(255, 181, 71, 0.1);
      color: var(--accent);
    }

    /* Search */
    .search-box {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .search-input {
      flex: 1;
      padding: 14px 20px;
      background: rgba(0, 0, 0, 0.3);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      color: #fff;
      font-size: 1em;
      font-family: 'Poppins', sans-serif;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--accent);
    }

    /* Table */
    .table-container {
      background: linear-gradient(135deg, var(--bg-card) 0%, rgba(35, 45, 63, 0.8) 100%);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      overflow: hidden;
    }

    .stock-table {
      width: 100%;
      border-collapse: collapse;
    }

    .stock-table th {
      background: rgba(255, 181, 71, 0.1);
      padding: 15px 10px;
      text-align: left;
      font-weight: 600;
      color: var(--accent);
      font-size: 0.8em;
      text-transform: uppercase;
    }

    .stock-table th.sortable {
      cursor: pointer;
      user-select: none;
      transition: background 0.2s;
    }

    .stock-table th.sortable:hover {
      background: rgba(255, 181, 71, 0.2);
    }

    .stock-table th.sortable .sort-icon {
      font-size: 0.75em;
      opacity: 0.5;
      margin-left: 4px;
    }

    .stock-table th.sortable.active .sort-icon {
      opacity: 1;
      color: #10b981;
    }

    .stock-table td {
      padding: 12px 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      font-size: 0.9em;
    }

    .stock-table tr:hover {
      background: rgba(255, 255, 255, 0.03);
      cursor: pointer;
    }

    /* Team cell */
    .team-cell {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .team-jersey { width: 35px; height: 40px; flex-shrink: 0; }
    .team-jersey svg { width: 100%; height: 100%; }

    .team-name { font-weight: 600; }
    .team-country { font-size: 0.75em; color: var(--text-secondary); }

    /* Price cells */
    .price-algo { font-weight: 700; color: var(--info); }
    .price-market { font-weight: 600; }

    /* Variation */
    .variation { font-weight: 600; display: flex; align-items: center; gap: 3px; }
    .variation.positive { color: var(--success); }
    .variation.negative { color: var(--danger); }
    .variation.neutral { color: var(--text-secondary); }

    /* Dividend */
    .dividend { color: var(--success); font-weight: 600; }

    /* Actions */
    .actions-cell { display: flex; gap: 6px; }

    .btn-buy, .btn-sell {
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      font-size: 0.8em;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-buy {
      background: linear-gradient(135deg, var(--success), #059669);
      color: white;
    }

    .btn-sell {
      background: linear-gradient(135deg, var(--danger), #dc2626);
      color: white;
    }

    .btn-buy:hover, .btn-sell:hover { transform: scale(1.05); }

    /* Portfolio Grid */
    .section-title {
      font-size: 1.2em;
      font-weight: 700;
      margin: 30px 0 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .portfolio-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 15px;
    }

    .portfolio-card {
      background: linear-gradient(135deg, var(--bg-card) 0%, rgba(35, 45, 63, 0.8) 100%);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 20px;
      transition: all 0.3s ease;
    }

    .portfolio-card:hover {
      border-color: rgba(255, 181, 71, 0.4);
      transform: translateY(-3px);
    }

    .portfolio-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
    }

    .portfolio-team {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .shares-count {
      font-size: 1.5em;
      font-weight: 800;
      color: var(--accent);
    }

    .shares-label {
      font-size: 0.7em;
      color: var(--text-secondary);
    }

    .portfolio-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      padding-top: 15px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .portfolio-stat { text-align: center; }
    .portfolio-stat-value { font-weight: 700; }
    .portfolio-stat-label { font-size: 0.7em; color: var(--text-secondary); }

    /* Orders */
    .orders-list { display: flex; flex-direction: column; gap: 10px; }

    .order-card {
      background: linear-gradient(135deg, var(--bg-card) 0%, rgba(35, 45, 63, 0.8) 100%);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .order-card.venda { border-left: 4px solid var(--danger); }
    .order-card.compra { border-left: 4px solid var(--success); }

    .order-type {
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 0.7em;
      font-weight: 700;
      text-transform: uppercase;
    }

    .order-type.venda { background: rgba(239, 68, 68, 0.2); color: var(--danger); }
    .order-type.compra { background: rgba(16, 185, 129, 0.2); color: var(--success); }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
    }

    .empty-icon { font-size: 4em; margin-bottom: 15px; }
    .empty-title { font-size: 1.2em; font-weight: 600; color: var(--text-primary); margin-bottom: 10px; }

    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(5px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }

    .modal-overlay.active { display: flex; }

    .modal {
      background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      padding: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title { font-size: 1.2em; font-weight: 700; }

    .modal-close {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 1.5em;
      cursor: pointer;
    }

    .modal-body { padding: 20px; }

    /* Modal Team Info */
    .modal-team-info {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 15px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 12px;
      margin-bottom: 20px;
    }

    .modal-team-info .team-jersey { width: 50px; height: 55px; }
    .modal-team-info .team-jersey svg { width: 100%; height: 100%; }

    /* Price Comparison Box */
    .price-comparison {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 20px;
    }

    .price-row {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .price-row:last-child { border-bottom: none; }

    .price-label { color: var(--text-secondary); font-size: 0.9em; }
    .price-value { font-weight: 700; }
    .price-value.algo { color: var(--info); }
    .price-value.market { color: var(--accent); }

    /* Deal Indicator */
    .deal-indicator {
      text-align: center;
      padding: 12px;
      border-radius: 10px;
      margin-bottom: 20px;
      font-weight: 600;
    }

    .deal-indicator.good {
      background: rgba(16, 185, 129, 0.15);
      border: 1px solid rgba(16, 185, 129, 0.3);
      color: var(--success);
    }

    .deal-indicator.neutral {
      background: rgba(245, 158, 11, 0.15);
      border: 1px solid rgba(245, 158, 11, 0.3);
      color: var(--warning);
    }

    .deal-indicator.expensive {
      background: rgba(239, 68, 68, 0.15);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: var(--danger);
    }

    /* Form */
    .form-group { margin-bottom: 20px; }
    .form-label { display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-secondary); }

    .form-input {
      width: 100%;
      padding: 14px 16px;
      background: rgba(0, 0, 0, 0.3);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      color: #fff;
      font-size: 1em;
      font-family: 'Poppins', sans-serif;
    }

    .form-input:focus { outline: none; border-color: var(--accent); }

    /* Order Summary */
    .order-summary {
      background: rgba(255, 181, 71, 0.1);
      border: 1px solid rgba(255, 181, 71, 0.3);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 20px;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
    }

    .summary-row.total {
      border-top: 1px solid rgba(255, 181, 71, 0.3);
      margin-top: 10px;
      padding-top: 15px;
      font-weight: 700;
      font-size: 1.1em;
    }

    .summary-value { color: var(--accent); }

    /* Modal Actions */
    .modal-actions { display: flex; gap: 10px; }

    .btn-confirm {
      flex: 1;
      padding: 14px;
      border: none;
      border-radius: 12px;
      font-family: 'Poppins', sans-serif;
      font-weight: 700;
      font-size: 1em;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-confirm.buy { background: linear-gradient(135deg, var(--success), #059669); color: white; }
    .btn-confirm.sell { background: linear-gradient(135deg, var(--danger), #dc2626); color: white; }
    .btn-confirm:hover { transform: translateY(-2px); }

    .btn-cancel {
      flex: 1;
      padding: 14px;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: 12px;
      color: var(--text-secondary);
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      cursor: pointer;
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--bg-card);
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 15px 30px;
      border-radius: 12px;
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 2000;
    }

    .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }

    /* Loading */
    .loading { display: flex; justify-content: center; padding: 40px; }

    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(255, 181, 71, 0.2);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    /* Bot√£o Cancelar Ordem */
    .btn-cancel-order {
      padding: 8px 16px;
      background: rgba(239, 68, 68, 0.15);
      border: 1px solid rgba(239, 68, 68, 0.4);
      border-radius: 8px;
      color: #ef4444;
      font-weight: 600;
      font-size: 0.8em;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Poppins', sans-serif;
    }
    .btn-cancel-order:hover {
      background: rgba(239, 68, 68, 0.25);
      border-color: #ef4444;
    }

    /* Bot√£o desabilitado */
    .btn-buy:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      background: #6b7280;
    }
    .btn-buy:disabled:hover {
      background: #6b7280;
      transform: none;
    }

    /* Filters */
    .filters-bar {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }

    .filter-toggle {
      display: flex;
      border-radius: 10px;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .filter-toggle button {
      padding: 8px 16px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      font-family: 'Poppins', sans-serif;
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .filter-toggle button.active {
      background: var(--accent);
      color: #111;
      font-weight: 600;
    }

    .filter-select {
      padding: 8px 12px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.1);
      background: #1a1a2e;
      color: #ffffff;
      color-scheme: dark;
      font-family: 'Poppins', sans-serif;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      min-width: 160px;
    }

    .filter-select option {
      background-color: #1a1a2e !important;
      color: #ffffff !important;
      font-weight: 500;
      padding: 8px;
      font-size: 0.9rem;
    }

    .filter-select option:checked {
      background-color: #f59e0b !important;
      color: #000 !important;
    }

    .filter-select:focus {
      outline: none;
      border-color: var(--accent);
    }

    .filter-count {
      font-size: 0.8rem;
      color: var(--text-secondary);
      margin-left: auto;
    }

    /* Ranking Podium */
    .podium-container {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      gap: 10px;
      margin-bottom: 25px;
      padding: 0 20px;
    }

    .podium-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      flex: 1;
      max-width: 180px;
    }

    .podium-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .podium-name {
      font-weight: 600;
      font-size: 0.85rem;
      margin-bottom: 2px;
      max-width: 140px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .podium-value {
      font-size: 0.8rem;
      color: var(--success);
      font-weight: 600;
    }

    .podium-bar {
      width: 100%;
      border-radius: 10px 10px 0 0;
      margin-top: 8px;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      padding-bottom: 8px;
    }

    .podium-item:nth-child(1) .podium-bar { background: linear-gradient(to top, #c0c0c0, #e8e8e8); height: 80px; }
    .podium-item:nth-child(2) .podium-bar { background: linear-gradient(to top, #ffd700, #ffec80); height: 100px; }
    .podium-item:nth-child(3) .podium-bar { background: linear-gradient(to top, #cd7f32, #e8a860); height: 60px; }

    .podium-medal { font-size: 1.5rem; }

    /* Responsive */
    @media (max-width: 768px) {
      .stock-table th:nth-child(4),
      .stock-table td:nth-child(4),
      .stock-table th:nth-child(5),
      .stock-table td:nth-child(5) {
        display: none;
      }
    }
  </style>
</head>

<body>
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <div class="header-left">
        <a href="painel.html" class="btn-back">‚Üê Voltar</a>
        <div class="logo">
          <span class="logo-yellup">Yellup</span>
          <span class="logo-stock">√çNDICE</span>
        </div>
      </div>
      <div class="user-credits">
        <span>üí∞</span>
        <span class="credits-value" id="userCredits">0</span>
        <span>cr√©ditos</span>
      </div>
    </div>
  </header>

  <!-- Container -->
  <div class="container">
    <!-- Stats -->
    <div class="stats-bar">
      <div class="stat-card">
        <div class="stat-value" id="totalTimes">0</div>
        <div class="stat-label">Times Listados</div>
      </div>
      <div class="stat-card">
        <div class="stat-value green" id="maiorAlta">-</div>
        <div class="stat-label">üìà Maior Alta</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" style="color: var(--danger);" id="maiorQueda">-</div>
        <div class="stat-label">üìâ Maior Queda</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="minhasCotas">0</div>
        <div class="stat-label">Minhas Participa√ß√µes</div>
      </div>
      <div class="stat-card">
        <div class="stat-value green" id="totalSocios">0</div>
        <div class="stat-label">S√≥cios-Torcedores</div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab-btn active" onclick="showTab('mercado')">üìä √çndice</button>
      <button class="tab-btn" onclick="showTab('carteira')">üèüÔ∏è Minhas Participa√ß√µes</button>
      <button class="tab-btn" onclick="showTab('historico')">üìú Hist√≥rico</button>
      <button class="tab-btn" onclick="showTab('ranking')">üèÜ Ranking</button>
    </div>

    <!-- Tab: Mercado -->
    <div id="tab-mercado" class="tab-content">
      <div class="search-box">
        <input type="text" class="search-input" id="searchInput" placeholder="üîç Buscar time..." oninput="filterTimes()">
      </div>
      <div class="filters-bar">
        <div class="filter-toggle" id="tipoToggle">
          <button class="active" onclick="filtrarTipo('todos')">Todos</button>
          <button onclick="filtrarTipo('clube')">üèüÔ∏è Clubes</button>
          <button onclick="filtrarTipo('selecao')">üè≥Ô∏è Sele√ß√µes</button>
        </div>
        <select class="filter-select" id="paisFilter" onchange="filtrarPais()">
          <option value="">üåç Todos os pa√≠ses</option>
        </select>
        <span class="filter-count" id="filterCount"></span>
      </div>

      <div class="table-container">
        <table class="stock-table">
          <thead>
            <tr>
              <th class="sortable" onclick="ordenarTabela('nome')" title="Clique para ordenar">Time <span id="sort-icon-nome" class="sort-icon">‚áÖ</span></th>
              <th class="sortable" onclick="ordenarTabela('preco')" title="Clique para ordenar">√çndice <span id="sort-icon-preco" class="sort-icon">‚áÖ</span></th>
              <th class="sortable" onclick="ordenarTabela('variacao')" title="Clique para ordenar">Varia√ß√£o <span id="sort-icon-variacao" class="sort-icon">‚áÖ</span></th>
              <th class="sortable" onclick="ordenarTabela('disponiveis')" title="Clique para ordenar">Dispon√≠veis <span id="sort-icon-disponiveis" class="sort-icon">‚áÖ</span></th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="stockTableBody">
            <tr><td colspan="5"><div class="loading"><div class="spinner"></div></div></td></tr>
          </tbody>
        </table>
        <div id="expandirContainer" style="display: none; text-align: center; padding: 15px;">
          <button id="btnExpandir" onclick="expandirTabela()" style="padding: 10px 25px; background: linear-gradient(135deg, #f59e0b, #d97706); border: none; border-radius: 10px; color: #111; font-weight: 600; cursor: pointer; font-family: 'Poppins', sans-serif; font-size: 0.9rem;">
            üìã Ver todos os times (<span id="totalRestantes">0</span> restantes)
          </button>
        </div>
      </div>
    </div>

    <!-- Tab: Carteira -->
    <div id="tab-carteira" class="tab-content" style="display: none;">
      <h3 class="section-title">üèüÔ∏è Minhas Participa√ß√µes</h3>
      <div class="search-box">
        <input type="text" class="search-input" id="carteiraSearchInput" placeholder="üîç Buscar time..." oninput="filterCarteira()">
      </div>
      <div class="portfolio-grid" id="portfolioGrid">
        <div class="empty-state">
          <div class="empty-icon">üì≠</div>
          <div class="empty-title">Nenhuma participa√ß√£o ainda</div>
          <p>Adquira participa√ß√µes de times e torne-se s√≥cio-torcedor!</p>
        </div>
      </div>
    </div>

    <!-- Tab: Hist√≥rico -->
    <div id="tab-historico" class="tab-content" style="display: none;">
      <h3 class="section-title">üìú Hist√≥rico de Aquisi√ß√µes</h3>
      <div class="orders-list" id="historicoList">
        <div class="empty-state">
          <div class="empty-icon">üìú</div>
          <div class="empty-title">Nenhuma transa√ß√£o ainda</div>
        </div>
      </div>
    </div>

    <!-- Tab: Ranking -->
    <div id="tab-ranking" class="tab-content" style="display: none;">
      <h3 class="section-title">üèÜ Ranking de S√≥cios-Torcedores</h3>
      
      <!-- Podium top 3 -->
      <div id="podiumContainer" class="podium-container" style="display: none;">
        <div class="podium-item" id="podium2"></div>
        <div class="podium-item" id="podium1"></div>
        <div class="podium-item" id="podium3"></div>
      </div>

      <!-- Stats resumo -->
      <div class="stats-grid" style="margin-bottom: 20px;">
        <div class="stat-card">
          <div class="stat-icon">üë•</div>
          <div class="stat-content">
            <span class="stat-value" id="totalInvestidores">0</span>
            <span class="stat-label">S√≥cios-Torcedores</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üé´</div>
          <div class="stat-content">
            <span class="stat-value" id="totalCotasNegociadas">0</span>
            <span class="stat-label">Participa√ß√µes Adquiridas</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üíé</div>
          <div class="stat-content">
            <span class="stat-value" id="maiorPatrimonio">0</span>
            <span class="stat-label">Maior Colecionador</span>
          </div>
        </div>
      </div>

      <!-- Ordena√ß√£o -->
      <div class="filters-bar" style="margin-bottom: 10px;">
        <div class="filter-toggle" id="rankingSortToggle">
          <button class="active" onclick="ordenarRanking('patrimonio')">üèüÔ∏è Participa√ß√µes</button>
          <button onclick="ordenarRanking('cotas')">üé´ Quantidade</button>
          <button onclick="ordenarRanking('times')">‚öΩ Times</button>
          <button onclick="ordenarRanking('diversificacao')">üìä Diversifica√ß√£o</button>
        </div>
      </div>

      <div class="table-container">
        <table class="stock-table">
          <thead>
            <tr>
              <th>üèÖ</th>
              <th>S√≥cio-Torcedor</th>
              <th>Participa√ß√µes</th>
              <th>Times</th>
              <th>Total Est.</th>
            </tr>
          </thead>
          <tbody id="rankingTableBody">
            <tr><td colspan="5"><div class="loading"><div class="spinner"></div></div></td></tr>
          </tbody>
        </table>
        <div id="rankingExpandir" style="display: none; text-align: center; padding: 15px;">
          <button onclick="expandirRanking()" style="padding: 10px 25px; background: linear-gradient(135deg, #f59e0b, #d97706); border: none; border-radius: 10px; color: #111; font-weight: 600; cursor: pointer; font-family: 'Poppins', sans-serif; font-size: 0.9rem;">
            üìã Ver mais s√≥cios-torcedores (<span id="rankingRestantes">0</span> restantes)
          </button>
        </div>
      </div>
    </div>


  </div>

  <!-- Modal Comprar Participa√ß√£o -->
  <div class="modal-overlay" id="modalComprar">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">üèüÔ∏è Adquirir Participa√ß√£o</h2>
        <button class="modal-close" onclick="fecharModal('modalComprar')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="modal-team-info">
          <div class="team-jersey" id="modalComprarJersey"></div>
          <div>
            <h3 id="modalComprarTime">Time</h3>
            <span style="color: var(--text-secondary);" id="modalComprarPais">Pa√≠s</span>
          </div>
        </div>

        <!-- Info do √çndice -->
        <div class="price-comparison">
          <div class="price-row">
            <span class="price-label">üìä Valor do √çndice</span>
            <span class="price-value algo" id="modalPrecoAlgo">500 cr</span>
          </div>
          <div class="price-row">
            <span class="price-label">üìà Varia√ß√£o</span>
            <span class="price-value" id="modalVariacao">0%</span>
          </div>
          <div class="price-row">
            <span class="price-label">üé´ Dispon√≠veis</span>
            <span class="price-value" style="color: var(--success);" id="cotasDisponiveis">0 de 100</span>
          </div>
          <div class="price-row">
            <span class="price-label">üèüÔ∏è Suas participa√ß√µes</span>
            <span class="price-value" style="color: var(--accent);" id="modalMinhasParticipacoes">0</span>
          </div>
        </div>

        <div style="background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.3);border-radius:10px;padding:10px 14px;margin:12px 0;font-size:0.8em;color:var(--success);">
          ‚öΩ S√≥cios-torcedores ganham cr√©ditos toda vez que o time joga na plataforma!
        </div>

        <div class="form-group">
          <label class="form-label">Quantidade de participa√ß√µes</label>
          <input type="number" class="form-input" id="inputQtdCompra" min="1" value="1" oninput="calcularTotalCompra()">
        </div>

        <div class="order-summary">
          <div class="summary-row">
            <span>Quantidade</span>
            <span class="summary-value" id="summaryQtdCompra">1 participa√ß√£o</span>
          </div>
          <div class="summary-row">
            <span>Valor por participa√ß√£o</span>
            <span class="summary-value" id="summaryPrecoCompra">500 cr</span>
          </div>
          <div class="summary-row total">
            <span>Total</span>
            <span class="summary-value" id="summaryTotalCompra">500 cr</span>
          </div>
        </div>

        <div class="modal-actions">
          <button class="btn-cancel" onclick="fecharModal('modalComprar')">Cancelar</button>
          <button class="btn-confirm buy" onclick="confirmarCompra()">‚úÖ Adquirir Participa√ß√£o</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal S√≥cios do Time -->
  <div class="modal-overlay" id="modalSocios">
    <div class="modal" style="max-width: 550px;">
      <div class="modal-header">
        <h2 class="modal-title">üèüÔ∏è S√≥cios-Torcedores ‚Äî <span id="sociosTimeNome">Time</span></h2>
        <button class="modal-close" onclick="fecharModal('modalSocios')">&times;</button>
      </div>
      <div class="modal-body">
        <!-- Jersey + Stats -->
        <div style="display:flex;align-items:center;gap:15px;margin-bottom:18px;">
          <div class="team-jersey" id="sociosJersey"></div>
          <div style="flex:1;">
            <div style="display:flex;gap:12px;flex-wrap:wrap;">
              <div style="background:var(--bg-secondary);border-radius:10px;padding:8px 14px;text-align:center;">
                <div style="font-size:1.3em;font-weight:700;color:var(--accent);" id="sociosAdquiridas">0</div>
                <div style="font-size:0.65em;color:var(--text-secondary);">Adquiridas</div>
              </div>
              <div style="background:var(--bg-secondary);border-radius:10px;padding:8px 14px;text-align:center;">
                <div style="font-size:1.3em;font-weight:700;color:var(--success);" id="sociosDisponiveis">0</div>
                <div style="font-size:0.65em;color:var(--text-secondary);">Dispon√≠veis</div>
              </div>
              <div style="background:var(--bg-secondary);border-radius:10px;padding:8px 14px;text-align:center;">
                <div style="font-size:1.3em;font-weight:700;color:var(--info);" id="sociosTotal">100</div>
                <div style="font-size:0.65em;color:var(--text-secondary);">Total</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Progress bar -->
        <div style="margin-bottom:18px;">
          <div style="display:flex;justify-content:space-between;font-size:0.75em;color:var(--text-secondary);margin-bottom:4px;">
            <span>Participa√ß√µes adquiridas</span>
            <span id="sociosPctText">0%</span>
          </div>
          <div style="background:var(--bg-primary);border-radius:8px;height:10px;overflow:hidden;">
            <div id="sociosBar" style="height:100%;border-radius:8px;background:linear-gradient(90deg,var(--accent),var(--accent-dark));width:0%;transition:width 0.5s;"></div>
          </div>
        </div>

        <!-- Lista de s√≥cios -->
        <div style="font-size:0.8em;font-weight:600;color:var(--text-secondary);margin-bottom:8px;">üë• Quadro de S√≥cios</div>
        <div id="sociosLista" style="max-height:320px;overflow-y:auto;display:flex;flex-direction:column;gap:8px;">
          <div style="text-align:center;padding:20px;color:var(--text-secondary);">Nenhum s√≥cio-torcedor ainda</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-functions-compat.js"></script>

  <script>
    // ==================== CONFIG ====================
    const firebaseConfig = {
      apiKey: "AIzaSyC5ZrkEy7KuCFJOtPvI7-P-JcA0MF4im5c",
      authDomain: "painel-yellup.firebaseapp.com",
      projectId: "painel-yellup",
      storageBucket: "painel-yellup.firebasestorage.app",
      messagingSenderId: "608347210297",
      appId: "1:608347210297:web:75092713724e617c7203e8"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const functions = firebase.functions(); // Mantido para admin

    // ==================== CONSTANTES ====================
    const DONO_INICIAL_ID = 'GfpBgfT9e8g5GaTQruvX6YcwtE23';
    const COTAS_POR_TIME = 100;   // 100 participa√ß√µes por time
    const PRECO_INICIAL = 500.00; // Valor inicial do √≠ndice

    // Pesos de valoriza√ß√£o/desvaloriza√ß√£o
    const CONFIG_VALORIZACAO = {
      porJogo: 0.25,             // +0.25% por jogo participado
      porTorcedor: 0.05,         // +0.05% por torcedor
      porVitoriaTorcida: 0.5,    // +0.5% maior torcida
      porPonto: 0.005,           // +0.005% por ponto
      porVitoriaPontuacao: 0.9,  // +0.9% maior pontua√ß√£o
      maxVariacao: 12,           // ¬±12% m√°ximo
      
      porDerrotaTorcida: 0.3,    // -0.3% menor torcida
      porDerrotaPontuacao: 0.5,  // -0.5% menor pontua√ß√£o
      
      pesoAjusteMercado: 0.5,    // 50% da diferen√ßa
      maxAjusteMercado: 5        // ¬±5% m√°ximo ajuste mercado
    };

    // ==================== VARI√ÅVEIS GLOBAIS ====================
    let currentUser = null;
    let currentUserData = null;
    let allTimes = [];
    let metricas = {};      // M√©tricas por time (√≠ndice)
    let minhasCotas = {};   // Minhas participa√ß√µes

    let modalTimeAtual = null;

    // ==================== AUTH ====================
    auth.onAuthStateChanged(async (user) => {
      if (user) {
        currentUser = user;
        await carregarDadosUsuario();
        await carregarBolsa();
      } else {
        window.location.href = 'index.html';
      }
    });

    async function carregarDadosUsuario() {
      const doc = await db.collection('usuarios').doc(currentUser.uid).get();
      if (doc.exists) {
        currentUserData = doc.data();
        document.getElementById('userCredits').textContent = (currentUserData.creditos || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2});
      }
    }

    // ==================== CARREGAR BOLSA ====================
    async function carregarBolsa() {
      try {
        // Carregar times
        const timesSnap = await db.collection('times').orderBy('nome').get();
        allTimes = [];
        timesSnap.forEach(doc => allTimes.push({ id: doc.id, ...doc.data() }));
        document.getElementById('totalTimes').textContent = allTimes.length;

        // Carregar m√©tricas (√≠ndice)
        await carregarMetricas();

        // Carregar minhas participa√ß√µes
        await carregarMinhasCotas();

        // Carregar TODAS as participa√ß√µes (para S√≥cios e stats)
        await carregarTodasCotas();

        // Calcular stats
        calcularStats();

        // Renderizar
        popularPaises();
        renderizarTabelaMercado();

      } catch (error) {
        console.error('Erro ao carregar √≠ndice:', error);
        showToast('‚ùå Erro ao carregar dados');
      }
    }

    async function carregarMetricas() {
      const metricasSnap = await db.collection('bolsa_metricas_time').get();
      metricas = {};
      metricasSnap.forEach(doc => {
        metricas[doc.id] = doc.data();
      });

      // Para times sem m√©tricas, usar valores iniciais
      allTimes.forEach(time => {
        if (!metricas[time.id]) {
          metricas[time.id] = {
            precoAlgoritmo: PRECO_INICIAL,
            precoMercado: PRECO_INICIAL,
            mediaDividendos: 0,
            totalJogos: 0,
            totalTorcedores: 0,
            variacaoDia: 0
          };
        }
      });
    }

    async function carregarMinhasCotas() {
      const cotasSnap = await db.collection('bolsa_cotas')
        .where('userId', '==', currentUser.uid)
        .get();

      minhasCotas = {};
      let totalCotas = 0;

      cotasSnap.forEach(doc => {
        const data = doc.data();
        minhasCotas[data.timeId] = { id: doc.id, ...data };
        totalCotas += data.quantidade;
      });

      document.getElementById('minhasCotas').textContent = totalCotas.toLocaleString('pt-BR');
    }

    // Carregar TODAS as cotas para stats e modal S√≥cios
    let todasCotas = {}; // { timeId: [ {userId, quantidade, ...} ] }
    async function carregarTodasCotas() {
      try {
        const cotasSnap = await db.collection('bolsa_cotas').get();
        todasCotas = {};
        let totalSocios = new Set();
        cotasSnap.forEach(doc => {
          const data = doc.data();
          if (data.quantidade > 0) {
            if (!todasCotas[data.timeId]) todasCotas[data.timeId] = [];
            todasCotas[data.timeId].push({ docId: doc.id, ...data });
            totalSocios.add(data.userId);
          }
        });
        document.getElementById('totalSocios').textContent = totalSocios.size;
      } catch(e) {
        console.error('Erro carregarTodasCotas:', e);
      }
    }

    function calcularStats() {
      let maiorAlta = { nome: '-', valor: -Infinity };
      let maiorQueda = { nome: '-', valor: Infinity };
      allTimes.forEach(t => {
        const m = metricas[t.id];
        if (m && m.variacaoDia !== undefined) {
          if (m.variacaoDia > maiorAlta.valor) maiorAlta = { nome: t.nome, valor: m.variacaoDia };
          if (m.variacaoDia < maiorQueda.valor) maiorQueda = { nome: t.nome, valor: m.variacaoDia };
        }
      });
      document.getElementById('maiorAlta').textContent = maiorAlta.valor > -Infinity ? '+' + maiorAlta.valor.toFixed(1) + '%' : '-';
      document.getElementById('maiorAlta').title = maiorAlta.nome;
      document.getElementById('maiorQueda').textContent = maiorQueda.valor < Infinity ? maiorQueda.valor.toFixed(1) + '%' : '-';
      document.getElementById('maiorQueda').title = maiorQueda.nome;
    }

    // ==================== RENDERIZAR ====================
    // ==================== ORDENA√á√ÉO, FILTROS E PAGINA√á√ÉO ====================
    let sortColumn = 'variacao';
    let sortDirection = 'desc';
    let tabelaExpandida = false;
    let filtroTipo = 'todos';
    let filtroPais = '';
    const LIMITE_INICIAL = 30;

    function filtrarTipo(tipo) {
      filtroTipo = tipo;
      document.querySelectorAll('#tipoToggle button').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      tabelaExpandida = false;
      popularPaises(); // atualizar pa√≠ses dispon√≠veis
      renderizarTabelaMercado();
    }

    function filtrarPais() {
      filtroPais = document.getElementById('paisFilter').value;
      tabelaExpandida = false;
      renderizarTabelaMercado();
    }

    function popularPaises() {
      const select = document.getElementById('paisFilter');
      const paisAtual = select.value;
      
      // Pegar pa√≠ses dos times vis√≠veis pelo filtro de tipo
      const timesFiltrados = filtroTipo === 'todos' ? allTimes : allTimes.filter(t => t.tipo === filtroTipo);
      const paisesSet = new Map();
      timesFiltrados.forEach(t => {
        if (t.pais) paisesSet.set(t.pais, (paisesSet.get(t.pais) || 0) + 1);
      });
      
      const paisesOrdenados = [...paisesSet.entries()].sort((a, b) => b[1] - a[1]);
      
      let html = '<option value="" style="color:#fff;">üåç Todos os pa√≠ses</option>';
      paisesOrdenados.forEach(([pais, count]) => {
        html += `<option value="${pais}" style="color:#fff;" ${pais === paisAtual ? 'selected' : ''}>${pais} (${count})</option>`;
      });
      select.innerHTML = html;
    }

    function ordenarTabela(coluna) {
      if (sortColumn === coluna) {
        sortDirection = sortDirection === 'desc' ? 'asc' : 'desc';
      } else {
        sortColumn = coluna;
        sortDirection = (coluna === 'nome') ? 'asc' : 'desc';
      }
      renderizarTabelaMercado();
    }

    function expandirTabela() {
      tabelaExpandida = true;
      renderizarTabelaMercado();
    }

    function renderizarTabelaMercado() {
      const tbody = document.getElementById('stockTableBody');
      
      if (allTimes.length === 0) {
        tbody.innerHTML = `<tr><td colspan="5"><div class="empty-state"><div class="empty-icon">üì≠</div><div class="empty-title">Nenhum time encontrado</div></div></td></tr>`;
        document.getElementById('expandirContainer').style.display = 'none';
        return;
      }

      // Aplicar filtros de tipo e pa√≠s
      let timesFiltrados = allTimes;
      if (filtroTipo !== 'todos') {
        timesFiltrados = timesFiltrados.filter(t => t.tipo === filtroTipo);
      }
      if (filtroPais) {
        timesFiltrados = timesFiltrados.filter(t => t.pais === filtroPais);
      }

      if (timesFiltrados.length === 0) {
        tbody.innerHTML = `<tr><td colspan="5"><div class="empty-state"><div class="empty-icon">üîç</div><div class="empty-title">Nenhum time encontrado com esses filtros</div></div></td></tr>`;
        document.getElementById('expandirContainer').style.display = 'none';
        document.getElementById('filterCount').textContent = '0 times';
        return;
      }

      // Preparar dados com m√©tricas
      let timesComDados = timesFiltrados.map(time => {
        const m = metricas[time.id] || {};
        const indice = m.precoAlgoritmo || PRECO_INICIAL;
        const variacao = m.variacaoDia || 0;

        // Calcular participa√ß√µes adquiridas
        const cotasTime = todasCotas[time.id] || [];
        const totalAdquiridas = cotasTime.reduce((sum, c) => sum + c.quantidade, 0);
        const disponiveis = COTAS_POR_TIME - totalAdquiridas;

        const minhaCota = minhasCotas[time.id];
        const minhasQtd = minhaCota ? minhaCota.quantidade : 0;

        return {
          time, indice, variacao, disponiveis, totalAdquiridas, minhasQtd,
          temVariacao: variacao !== 0
        };
      });

      // Ordenar
      timesComDados.sort((a, b) => {
        if (sortColumn !== 'nome') {
          if (a.temVariacao && !b.temVariacao) return -1;
          if (!a.temVariacao && b.temVariacao) return 1;
        }

        let valA, valB;
        switch (sortColumn) {
          case 'nome':
            valA = a.time.nome.toLowerCase();
            valB = b.time.nome.toLowerCase();
            return sortDirection === 'asc' ? valA.localeCompare(valB) : valB.localeCompare(valA);
          case 'preco':
            valA = a.indice; valB = b.indice; break;
          case 'variacao':
            valA = Math.abs(a.variacao); valB = Math.abs(b.variacao); break;
          case 'disponiveis':
            valA = a.disponiveis; valB = b.disponiveis; break;
          default:
            valA = Math.abs(a.variacao); valB = Math.abs(b.variacao);
        }
        return sortDirection === 'desc' ? valB - valA : valA - valB;
      });

      // Pagina√ß√£o
      const totalTimes = timesComDados.length;
      const timesExibir = (tabelaExpandida || buscaAtiva) ? timesComDados : timesComDados.slice(0, LIMITE_INICIAL);
      const restantes = totalTimes - LIMITE_INICIAL;

      // Atualizar √≠cones de ordena√ß√£o
      document.querySelectorAll('.stock-table th.sortable').forEach(th => th.classList.remove('active'));
      const activeIcon = document.getElementById(`sort-icon-${sortColumn}`);
      if (activeIcon) {
        activeIcon.parentElement.classList.add('active');
        activeIcon.textContent = sortDirection === 'asc' ? '‚ñ≤' : '‚ñº';
      }
      document.querySelectorAll('.sort-icon').forEach(icon => {
        if (icon.id !== `sort-icon-${sortColumn}`) icon.textContent = '‚áÖ';
      });

      let html = '';

      timesExibir.forEach(item => {
        const { time, indice, variacao, disponiveis, totalAdquiridas, minhasQtd } = item;

        const varClass = variacao > 0 ? 'positive' : variacao < 0 ? 'negative' : 'neutral';
        const varIcon = variacao > 0 ? '‚ñ≤' : variacao < 0 ? '‚ñº' : '‚óè';

        // Dispon√≠veis text
        const pctAdquirido = Math.round(totalAdquiridas / COTAS_POR_TIME * 100);
        let textoDisp = disponiveis > 0 ? `${disponiveis} de ${COTAS_POR_TIME}` : 'Esgotado!';
        let corDisp = disponiveis > 50 ? 'var(--success)' : disponiveis > 0 ? 'var(--warning)' : 'var(--danger)';

        // Badge minhas participa√ß√µes
        const meuBadge = minhasQtd > 0 ? `<span style="font-size:0.7em;background:var(--accent);color:#111;padding:1px 5px;border-radius:4px;margin-left:4px;">${minhasQtd}%</span>` : '';

        html += `
          <tr data-time="${time.nome.toLowerCase()}">
            <td>
              <div class="team-cell">
                <div class="team-jersey">${gerarCamisetaSVG(time.primaria, time.secundaria, time.terciaria)}</div>
                <div>
                  <div class="team-name">${time.nome}${meuBadge}</div>
                  <div class="team-country">${time.pais || ''}</div>
                </div>
              </div>
            </td>
            <td class="price-market">${Math.round(indice).toLocaleString('pt-BR')} cr</td>
            <td><span class="variation ${varClass}">${varIcon} ${variacao >= 0 ? '+' : ''}${variacao.toFixed(2)}%</span></td>
            <td style="color:${corDisp};font-weight:600;cursor:pointer;" onclick="abrirSocios('${time.id}')" title="Ver s√≥cios-torcedores">
              ${textoDisp} üë•
            </td>
            <td>
              <div class="actions-cell">
                <button class="btn-buy" onclick="abrirModalCompra('${time.id}')" ${disponiveis <= 0 ? 'disabled title="Todas as participa√ß√µes foram adquiridas"' : ''}>Adquirir</button>
                <button class="btn-sell" onclick="abrirSocios('${time.id}')" style="background:var(--info);">üë• S√≥cios</button>
              </div>
            </td>
          </tr>
        `;
      });

      tbody.innerHTML = html;

      // Mostrar/esconder bot√£o de expandir
      const expandirContainer = document.getElementById('expandirContainer');
      if (!tabelaExpandida && !buscaAtiva && restantes > 0) {
        document.getElementById('totalRestantes').textContent = restantes;
        expandirContainer.style.display = 'block';
      } else {
        expandirContainer.style.display = 'none';
      }

      document.getElementById('filterCount').textContent = `${totalTimes} time${totalTimes !== 1 ? 's' : ''}`;
    }

    // ==================== FILTRAR ====================
    let buscaAtiva = false;
    function filterTimes() {
      const search = document.getElementById('searchInput').value.toLowerCase();
      const novaAtiva = search.length > 0;
      if (novaAtiva !== buscaAtiva) {
        buscaAtiva = novaAtiva;
        renderizarTabelaMercado();
      }
      document.querySelectorAll('#stockTableBody tr').forEach(row => {
        const timeNome = row.getAttribute('data-time') || '';
        row.style.display = timeNome.includes(search) ? '' : 'none';
      });
    }

    function filterCarteira() {
      const search = document.getElementById('carteiraSearchInput').value.toLowerCase();
      document.querySelectorAll('#portfolioGrid .portfolio-card').forEach(card => {
        const timeNome = card.getAttribute('data-time') || '';
        card.style.display = timeNome.includes(search) ? '' : 'none';
      });
    }

    // ==================== TABS ====================
    function showTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none');
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      document.getElementById(`tab-${tabName}`).style.display = 'block';
      event.target.classList.add('active');

      if (tabName === 'carteira') renderizarCarteira();
      else if (tabName === 'historico') renderizarHistorico();
      else if (tabName === 'ranking') carregarRanking();
    }

    function renderizarCarteira() {
      const grid = document.getElementById('portfolioGrid');
      const cotasArray = Object.entries(minhasCotas);
      
      if (cotasArray.length === 0) {
        grid.innerHTML = `<div class="empty-state"><div class="empty-icon">üì≠</div><div class="empty-title">Nenhuma participa√ß√£o ainda</div><p>Adquira participa√ß√µes e torne-se s√≥cio-torcedor!</p></div>`;
        return;
      }

      let html = '';
      cotasArray.forEach(([timeId, cota]) => {
        const time = allTimes.find(t => t.id === timeId) || {};
        const m = metricas[timeId] || {};
        const indice = m.precoAlgoritmo || PRECO_INICIAL;
        const pct = cota.quantidade; // cada participa√ß√£o = 1%

        html += `
          <div class="portfolio-card" data-time="${(time.nome || '').toLowerCase()}">
            <div class="portfolio-header">
              <div class="portfolio-team">
                <div class="team-jersey" style="width: 35px; height: 40px;">${gerarCamisetaSVG(time.primaria, time.secundaria, time.terciaria)}</div>
                <span style="font-weight: 600;">${time.nome || 'Time'}</span>
              </div>
              <div style="text-align: right;">
                <div class="shares-count">${cota.quantidade}</div>
                <div class="shares-label">participa√ß√µes (${pct}%)</div>
              </div>
            </div>
            <div class="portfolio-stats">
              <div class="portfolio-stat">
                <div class="portfolio-stat-value">${Math.round(indice).toLocaleString('pt-BR')} cr</div>
                <div class="portfolio-stat-label">√çndice atual</div>
              </div>
              <div class="portfolio-stat">
                <div class="portfolio-stat-value" style="color:var(--accent);">${pct}%</div>
                <div class="portfolio-stat-label">Sua fatia</div>
              </div>
            </div>
            <div style="margin-top:8px;">
              <button class="btn-buy" style="width:100%;padding:6px;font-size:0.8em;" onclick="abrirSocios('${timeId}')">üë• Ver S√≥cios</button>
            </div>
          </div>
        `;
      });

      grid.innerHTML = html;
    }

    async function renderizarHistorico() {
      const list = document.getElementById('historicoList');
      list.innerHTML = '<div style="text-align: center; padding: 20px;"><div class="spinner"></div> Carregando...</div>';
      
      try {
        const compras = await db.collection('bolsa_transacoes').where('compradorId', '==', currentUser.uid).limit(50).get();

        const transacoes = [];
        compras.forEach(doc => transacoes.push({ ...doc.data(), tipo: 'aquisicao' }));
        transacoes.sort((a, b) => (b.dataTransacao?.toMillis() || 0) - (a.dataTransacao?.toMillis() || 0));

        if (transacoes.length === 0) {
          list.innerHTML = `<div class="empty-state"><div class="empty-icon">üìú</div><div class="empty-title">Nenhuma aquisi√ß√£o ainda</div></div>`;
          return;
        }

        let html = '';
        transacoes.slice(0, 50).forEach(t => {
          const data = t.dataTransacao?.toDate().toLocaleString('pt-BR') || '';
          html += `
            <div class="order-card compra">
              <div style="display: flex; align-items: center; gap: 15px;">
                <span class="order-type compra">üèüÔ∏è</span>
                <div>
                  <h4>${t.timeNome}</h4>
                  <span style="font-size: 0.8em; color: var(--text-secondary);">${data}</span>
                </div>
              </div>
              <div style="text-align: right;">
                <div style="font-weight: 700;">${t.quantidade} participa√ß√£o${t.quantidade > 1 ? '√µes' : ''}</div>
                <div style="font-size: 0.85em; color: var(--accent);">${Math.round(t.valorTotal).toLocaleString('pt-BR')} cr</div>
              </div>
            </div>
          `;
        });

        list.innerHTML = html;
      } catch (error) {
        console.error('Erro ao carregar hist√≥rico:', error);
        list.innerHTML = `<div class="empty-state"><div class="empty-icon">‚ùå</div><div class="empty-title">Erro ao carregar</div></div>`;
      }
    }

    // ==================== MODAL COMPRAR (DIRETO) ====================
    function abrirModalCompra(timeId) {
      const minhaCota = minhasCotas[timeId];
      const cotasTime = todasCotas[timeId] || [];
      const totalAdquiridas = cotasTime.reduce((sum, c) => sum + c.quantidade, 0);
      const disponiveis = COTAS_POR_TIME - totalAdquiridas;
      const minhasQtd = minhaCota ? minhaCota.quantidade : 0;

      if (disponiveis <= 0) {
        showToast('‚ùå Todas as participa√ß√µes deste time j√° foram adquiridas!');
        return;
      }

      const time = allTimes.find(t => t.id === timeId);
      if (!time) return;

      modalTimeAtual = time;
      const m = metricas[timeId] || {};
      const indice = m.precoAlgoritmo || PRECO_INICIAL;
      const variacao = m.variacaoDia || 0;

      document.getElementById('modalComprarTime').textContent = time.nome;
      document.getElementById('modalComprarPais').textContent = time.pais || '';
      document.getElementById('modalPrecoAlgo').textContent = Math.round(indice).toLocaleString('pt-BR') + ' cr';
      document.getElementById('modalVariacao').textContent = (variacao >= 0 ? '+' : '') + variacao.toFixed(2) + '%';
      document.getElementById('modalVariacao').style.color = variacao > 0 ? 'var(--success)' : variacao < 0 ? 'var(--danger)' : 'var(--text-secondary)';
      document.getElementById('cotasDisponiveis').textContent = disponiveis + ' de ' + COTAS_POR_TIME;
      document.getElementById('modalMinhasParticipacoes').textContent = minhasQtd;
      document.getElementById('inputQtdCompra').value = 1;
      document.getElementById('inputQtdCompra').max = disponiveis;
      document.getElementById('modalComprarJersey').innerHTML = gerarCamisetaSVG(time.primaria, time.secundaria, time.terciaria);

      calcularTotalCompra();
      document.getElementById('modalComprar').classList.add('active');
    }

    function calcularTotalCompra() {
      const qtd = parseInt(document.getElementById('inputQtdCompra').value) || 0;
      const m = metricas[modalTimeAtual?.id] || {};
      const indice = m.precoAlgoritmo || PRECO_INICIAL;
      const total = Math.round(qtd * indice);

      document.getElementById('summaryQtdCompra').textContent = qtd + ' participa√ß√£o' + (qtd > 1 ? '√µes' : '');
      document.getElementById('summaryPrecoCompra').textContent = Math.round(indice).toLocaleString('pt-BR') + ' cr';
      document.getElementById('summaryTotalCompra').textContent = total.toLocaleString('pt-BR') + ' cr';
    }

    async function confirmarCompra() {
      if (!modalTimeAtual) return;

      const qtd = parseInt(document.getElementById('inputQtdCompra').value) || 0;
      if (qtd <= 0) return showToast('‚ùå Quantidade inv√°lida');

      const m = metricas[modalTimeAtual.id] || {};
      const indice = m.precoAlgoritmo || PRECO_INICIAL;
      const total = Math.round(qtd * indice);

      // Verificar cr√©ditos
      if ((currentUserData.creditos || 0) < total) {
        return showToast('‚ùå Cr√©ditos insuficientes! Voc√™ tem ' + Math.floor(currentUserData.creditos || 0) + ' cr');
      }

      // Verificar disponibilidade
      const cotasTime = todasCotas[modalTimeAtual.id] || [];
      const totalAdquiridas = cotasTime.reduce((sum, c) => sum + c.quantidade, 0);
      const disponiveis = COTAS_POR_TIME - totalAdquiridas;
      if (qtd > disponiveis) {
        return showToast('‚ùå Apenas ' + disponiveis + ' participa√ß√µes dispon√≠veis');
      }

      if (!confirm(`üèüÔ∏è CONFIRMAR AQUISI√á√ÉO?\n\n` +
        `Time: ${modalTimeAtual.nome}\n` +
        `Participa√ß√µes: ${qtd} (${qtd}% do time)\n` +
        `Valor do √çndice: ${Math.round(indice)} cr cada\n` +
        `Total: ${total.toLocaleString('pt-BR')} cr\n\n` +
        `Como s√≥cio-torcedor, voc√™ ganhar√° cr√©ditos toda vez que o time jogar!`)) {
        return;
      }

      const btn = document.querySelector('#modalComprar .btn-confirm');
      if (btn) { btn.disabled = true; btn.textContent = '‚è≥ Processando...'; }

      try {
        const batch = db.batch();

        // 1. Debitar cr√©ditos do comprador
        batch.update(db.collection('usuarios').doc(currentUser.uid), {
          creditos: firebase.firestore.FieldValue.increment(-total)
        });

        // 2. Registrar/atualizar participa√ß√£o
        const minhaCota = minhasCotas[modalTimeAtual.id];
        if (minhaCota) {
          batch.update(db.collection('bolsa_cotas').doc(minhaCota.id), {
            quantidade: firebase.firestore.FieldValue.increment(qtd),
            dataAtualizacao: firebase.firestore.FieldValue.serverTimestamp()
          });
        } else {
          const novaCota = db.collection('bolsa_cotas').doc();
          batch.set(novaCota, {
            userId: currentUser.uid,
            usuarioNome: currentUserData.usuarioUnico || currentUserData.nome || 'An√¥nimo',
            avatarUrl: currentUserData.fotoPerfilURL || currentUserData.avatarUrl || null,
            timeId: modalTimeAtual.id,
            timeNome: modalTimeAtual.nome,
            quantidade: qtd,
            dataCriacao: firebase.firestore.FieldValue.serverTimestamp(),
            dataAtualizacao: firebase.firestore.FieldValue.serverTimestamp()
          });
        }

        // 3. Registrar transa√ß√£o
        const transRef = db.collection('bolsa_transacoes').doc();
        batch.set(transRef, {
          tipo: 'aquisicao',
          compradorId: currentUser.uid,
          compradorNome: currentUserData.usuarioUnico || currentUserData.nome,
          timeId: modalTimeAtual.id,
          timeNome: modalTimeAtual.nome,
          quantidade: qtd,
          precoUnitario: Math.round(indice),
          valorTotal: total,
          dataTransacao: firebase.firestore.FieldValue.serverTimestamp()
        });

        // 4. Registrar no extrato
        const extratoRef = db.collection('usuarios').doc(currentUser.uid).collection('extrato').doc();
        batch.set(extratoRef, {
          tipo: 'saida',
          valor: total,
          descricao: `üèüÔ∏è Participa√ß√£o: ${qtd}x ${modalTimeAtual.nome} (${Math.round(indice)} cr cada)`,
          data: firebase.firestore.FieldValue.serverTimestamp()
        });

        await batch.commit();

        showToast(`‚úÖ Parab√©ns! Voc√™ √© s√≥cio-torcedor do ${modalTimeAtual.nome}! (${qtd} participa√ß√£o${qtd > 1 ? '√µes' : ''})`);
        fecharModal('modalComprar');
        await carregarDadosUsuario();
        await carregarMinhasCotas();
        await carregarTodasCotas();
        calcularStats();
        renderizarTabelaMercado();

      } catch (error) {
        console.error('Erro ao adquirir participa√ß√£o:', error);
        showToast('‚ùå Erro ao processar. Tente novamente.');
      } finally {
        if (btn) { btn.disabled = false; btn.textContent = '‚úÖ Adquirir Participa√ß√£o'; }
      }
    }

    // ==================== MODAL S√ìCIOS ====================
    async function abrirSocios(timeId) {
      const time = allTimes.find(t => t.id === timeId);
      if (!time) return;

      document.getElementById('sociosTimeNome').textContent = time.nome;
      document.getElementById('sociosJersey').innerHTML = gerarCamisetaSVG(time.primaria, time.secundaria, time.terciaria);

      const cotasTime = todasCotas[timeId] || [];
      const totalAdquiridas = cotasTime.reduce((sum, c) => sum + c.quantidade, 0);
      const disponiveis = COTAS_POR_TIME - totalAdquiridas;
      const pct = Math.round(totalAdquiridas / COTAS_POR_TIME * 100);

      document.getElementById('sociosAdquiridas').textContent = totalAdquiridas;
      document.getElementById('sociosDisponiveis').textContent = disponiveis;
      document.getElementById('sociosTotal').textContent = COTAS_POR_TIME;
      document.getElementById('sociosPctText').textContent = pct + '%';
      document.getElementById('sociosBar').style.width = pct + '%';

      // Carregar nomes/avatares dos s√≥cios
      const lista = document.getElementById('sociosLista');
      if (cotasTime.length === 0) {
        lista.innerHTML = '<div style="text-align:center;padding:25px;color:var(--text-secondary);"><div style="font-size:2em;margin-bottom:8px;">üèüÔ∏è</div>Nenhum s√≥cio-torcedor ainda.<br>Seja o primeiro!</div>';
      } else {
        // Ordenar por quantidade (maior primeiro)
        const sociosOrdenados = [...cotasTime].sort((a, b) => b.quantidade - a.quantidade);
        
        // Buscar avatares se n√£o tiver
        let userDocs = {};
        try {
          const uids = [...new Set(sociosOrdenados.map(s => s.userId))];
          const chunks = [];
          for (let i = 0; i < uids.length; i += 10) chunks.push(uids.slice(i, i + 10));
          for (const chunk of chunks) {
            const snap = await db.collection('usuarios').where(firebase.firestore.FieldPath.documentId(), 'in', chunk).get();
            snap.forEach(d => { userDocs[d.id] = d.data(); });
          }
        } catch(e) { console.warn('Erro ao buscar avatares:', e); }

        let html = '';
        sociosOrdenados.forEach((socio, idx) => {
          const ud = userDocs[socio.userId] || {};
          const avatar = ud.fotoPerfilURL || ud.avatarUrl || socio.avatarUrl || null;
          const nome = ud.usuarioUnico || ud.nome || socio.usuarioNome || 'An√¥nimo';
          const pctSocio = socio.quantidade; // cada participa√ß√£o = 1%
          const isMe = socio.userId === currentUser?.uid;

          const avatarHtml = avatar 
            ? `<img src="${avatar}" style="width:36px;height:36px;border-radius:50%;object-fit:cover;border:2px solid ${isMe ? 'var(--accent)' : 'var(--bg-secondary)'};">`
            : `<div style="width:36px;height:36px;border-radius:50%;background:${time.primaria || '#333'};display:flex;align-items:center;justify-content:center;font-weight:700;font-size:0.9em;color:#fff;border:2px solid ${isMe ? 'var(--accent)' : 'var(--bg-secondary)'};">${nome.charAt(0).toUpperCase()}</div>`;

          const medals = ['ü•á','ü•à','ü•â'];
          const medal = idx < 3 ? medals[idx] : `<span style="color:var(--text-secondary);font-size:0.8em;">#${idx+1}</span>`;

          html += `
            <div style="display:flex;align-items:center;gap:10px;padding:8px 10px;background:${isMe ? 'rgba(255,181,71,0.1)' : 'var(--bg-secondary)'};border-radius:10px;${isMe ? 'border:1px solid var(--accent);' : ''}">
              <span style="min-width:24px;text-align:center;">${medal}</span>
              ${avatarHtml}
              <div style="flex:1;min-width:0;">
                <div style="font-weight:${isMe ? '700' : '500'};font-size:0.85em;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;${isMe ? 'color:var(--accent);' : ''}">${nome}${isMe ? ' (voc√™)' : ''}</div>
                <div style="font-size:0.7em;color:var(--text-secondary);">${socio.quantidade} participa√ß√£o${socio.quantidade > 1 ? '√µes' : ''}</div>
              </div>
              <div style="text-align:right;">
                <div style="font-weight:700;font-size:1.1em;color:var(--accent);">${pctSocio}%</div>
                <div style="font-size:0.65em;color:var(--text-secondary);">do time</div>
              </div>
            </div>
          `;
        });
        lista.innerHTML = html;
      }

      document.getElementById('modalSocios').classList.add('active');
    }

    // ==================== UTILS ====================
    function fecharModal(id) {
      document.getElementById(id).classList.remove('active');
      modalTimeAtual = null;
    }

    // ==================== CAMISETA SVG ====================
    function gerarCamisetaSVG(corPrimaria, corSecundaria, corTerciaria) {
      corPrimaria = corPrimaria || '#28a745';
      corSecundaria = corSecundaria || '#ffffff';
      corTerciaria = corTerciaria || corPrimaria;
      
      const uid = Math.random().toString(36).substr(2, 6);
      return `
        <svg viewBox="0 0 100 120" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="shine_${uid}" x1="0.2" y1="0" x2="0.8" y2="1">
              <stop offset="0%" stop-color="rgba(255,255,255,0.28)"/>
              <stop offset="45%" stop-color="rgba(255,255,255,0.03)"/>
              <stop offset="100%" stop-color="rgba(0,0,0,0.08)"/>
            </linearGradient>
            <linearGradient id="sleeve_${uid}" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="${corPrimaria}"/>
              <stop offset="100%" stop-color="${corTerciaria}"/>
            </linearGradient>
            <filter id="shadow_${uid}">
              <feDropShadow dx="1" dy="2" stdDeviation="2" flood-opacity="0.35"/>
            </filter>
          </defs>
          
          <g filter="url(#shadow_${uid})">
            <path d="M28,32 
                     Q28,28 32,28 L40,28 Q45,28 47,24 Q50,20 53,24 Q55,28 60,28 L68,28 
                     Q72,28 72,32 
                     L74,105 Q74,112 68,112 L32,112 Q28,112 26,105 Z" 
                  fill="${corPrimaria}"/>
            
            <path d="M28,32 L10,46 Q6,49 7,54 L10,68 Q11,72 15,70 L26,58 Z" 
                  fill="url(#sleeve_${uid})"/>
            
            <path d="M72,32 L90,46 Q94,49 93,54 L90,68 Q89,72 85,70 L74,58 Z" 
                  fill="url(#sleeve_${uid})"/>
            
            <path d="M26,40 L28,105" stroke="${corSecundaria}" stroke-width="3" opacity="0.5" stroke-linecap="round"/>
            <path d="M74,40 L72,105" stroke="${corSecundaria}" stroke-width="3" opacity="0.5" stroke-linecap="round"/>
            
            <path d="M38,50 L62,90" stroke="${corTerciaria}" stroke-width="8" opacity="0.12" stroke-linecap="round"/>
            
            <path d="M28,32 
                     Q28,28 32,28 L40,28 Q45,28 47,24 Q50,20 53,24 Q55,28 60,28 L68,28 
                     Q72,28 72,32 
                     L74,105 Q74,112 68,112 L32,112 Q28,112 26,105 Z" 
                  fill="url(#shine_${uid})"/>
            
            <path d="M43,26 L50,32 L57,26" fill="none" stroke="${corSecundaria}" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
            
            <path d="M28,107 Q28,112 32,112 L68,112 Q72,112 72,107" 
                  fill="${corSecundaria}" opacity="0.3"/>
            
            <path d="M10,65 Q11,70 15,68" stroke="${corTerciaria}" stroke-width="2.5" opacity="0.5" fill="none" stroke-linecap="round"/>
            <path d="M90,65 Q89,70 85,68" stroke="${corTerciaria}" stroke-width="2.5" opacity="0.5" fill="none" stroke-linecap="round"/>
          </g>
        </svg>
      `;
    }

    function showToast(msg) {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // ==================== RANKING ====================
    let rankingData = [];
    let rankingSort = 'patrimonio';
    let rankingExpandido = false;
    const RANKING_LIMITE = 20;

    function ordenarRanking(criterio) {
      rankingSort = criterio;
      document.querySelectorAll('#rankingSortToggle button').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      renderizarRanking();
    }

    function expandirRanking() {
      rankingExpandido = true;
      renderizarRanking();
    }

    async function carregarRanking() {
      const tbody = document.getElementById('rankingTableBody');
      tbody.innerHTML = '<tr><td colspan="5"><div class="loading"><div class="spinner"></div></div></td></tr>';
      document.getElementById('podiumContainer').style.display = 'none';

      try {
        const cotasSnap = await db.collection('bolsa_cotas').get();
        
        const investidores = {};
        cotasSnap.forEach(doc => {
          const cota = doc.data();
          if (cota.userId === DONO_INICIAL_ID) return;
          
          if (!investidores[cota.userId]) {
            investidores[cota.userId] = {
              nome: cota.usuarioNome || 'An√¥nimo',
              cotas: 0,
              times: new Set(),
              patrimonio: 0
            };
          }
          
          investidores[cota.userId].cotas += cota.quantidade;
          investidores[cota.userId].times.add(cota.timeId);
          
          const precoTime = metricas[cota.timeId]?.precoAlgoritmo || PRECO_INICIAL;
          investidores[cota.userId].patrimonio += cota.quantidade * precoTime;
        });

        rankingData = Object.entries(investidores)
          .map(([id, data]) => ({ id, ...data, times: data.times.size }));

        // Estat√≠sticas
        document.getElementById('totalInvestidores').textContent = rankingData.length;
        document.getElementById('totalCotasNegociadas').textContent = rankingData.reduce((sum, i) => sum + i.cotas, 0).toLocaleString('pt-BR');
        
        const topPat = [...rankingData].sort((a, b) => b.patrimonio - a.patrimonio);
        document.getElementById('maiorPatrimonio').textContent = topPat.length > 0 ? topPat[0].patrimonio.toLocaleString('pt-BR') + ' cr' : '0 cr';

        rankingExpandido = false;
        renderizarRanking();
      } catch (error) {
        console.error('Erro ao carregar ranking:', error);
        tbody.innerHTML = '<tr><td colspan="5"><div class="empty-state"><div class="empty-icon">‚ùå</div><div class="empty-title">Erro ao carregar</div></div></td></tr>';
      }
    }

    function renderizarRanking() {
      const tbody = document.getElementById('rankingTableBody');

      if (rankingData.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5"><div class="empty-state"><div class="empty-icon">üèÜ</div><div class="empty-title">Nenhum s√≥cio-torcedor ainda</div></div></td></tr>';
        document.getElementById('podiumContainer').style.display = 'none';
        document.getElementById('rankingExpandir').style.display = 'none';
        return;
      }

      // Ordenar conforme crit√©rio
      const ranking = [...rankingData].sort((a, b) => {
        switch (rankingSort) {
          case 'cotas': return b.cotas - a.cotas;
          case 'times': return b.times - a.times;
          case 'diversificacao':
            const divA = a.times > 0 ? a.patrimonio / a.times : 0;
            const divB = b.times > 0 ? b.patrimonio / b.times : 0;
            return b.times - a.times || divB - divA;
          default: return b.patrimonio - a.patrimonio;
        }
      });

      // Podium (top 3) ‚Äî s√≥ mostra se tiver 3+ investidores e ordenando por patrim√¥nio
      const podium = document.getElementById('podiumContainer');
      if (ranking.length >= 3 && rankingSort === 'patrimonio') {
        podium.style.display = 'flex';
        const cores = ['#C0C0C0', '#FFD700', '#CD7F32'];
        const medalhas = ['ü•à', 'ü•á', 'ü•â'];
        const indices = [1, 0, 2]; // prata, ouro, bronze (ordem visual)
        
        indices.forEach((idx, pos) => {
          const inv = ranking[idx];
          const isMe = inv.id === currentUser?.uid;
          document.getElementById(`podium${idx + 1}`).innerHTML = `
            <div class="podium-avatar" style="background: ${cores[idx]}; color: #111;">${inv.nome.charAt(0).toUpperCase()}</div>
            <div class="podium-name" ${isMe ? 'style="color: var(--accent);"' : ''}>${isMe ? '‚≠ê ' : ''}${inv.nome}</div>
            <div class="podium-value">${inv.patrimonio.toLocaleString('pt-BR')} cr</div>
            <div class="podium-bar"><span class="podium-medal">${medalhas[idx]}</span></div>
          `;
        });
      } else {
        podium.style.display = 'none';
      }

      // Pagina√ß√£o
      const total = ranking.length;
      const exibir = rankingExpandido ? ranking : ranking.slice(0, RANKING_LIMITE);
      const restantes = total - RANKING_LIMITE;

      let html = '';
      exibir.forEach((inv, idx) => {
        const medalha = idx === 0 ? 'ü•á' : idx === 1 ? 'ü•à' : idx === 2 ? 'ü•â' : `${idx + 1}¬∫`;
        const isMe = inv.id === currentUser?.uid;
        
        // Valor principal baseado no crit√©rio
        let valorPrincipal;
        switch (rankingSort) {
          case 'cotas': valorPrincipal = inv.cotas.toLocaleString('pt-BR'); break;
          case 'times': valorPrincipal = inv.times; break;
          case 'diversificacao': valorPrincipal = inv.times; break;
          default: valorPrincipal = inv.patrimonio.toLocaleString('pt-BR') + ' cr';
        }
        
        html += `
          <tr style="${isMe ? 'background: rgba(255,181,71,0.1);' : ''}">
            <td style="font-size: 1.1em; font-weight: 700; width: 50px;">${medalha}</td>
            <td>
              <div style="display: flex; align-items: center; gap: 8px;">
                ${isMe ? '<span style="background: var(--accent); color: #000; padding: 2px 6px; border-radius: 4px; font-size: 0.7em; font-weight: 700;">VOC√ä</span>' : ''}
                ${inv.nome}
              </div>
            </td>
            <td style="font-weight: 600;">${inv.cotas.toLocaleString('pt-BR')}</td>
            <td>${inv.times}</td>
            <td style="color: var(--success); font-weight: 700;">${inv.patrimonio.toLocaleString('pt-BR')} cr</td>
          </tr>
        `;
      });

      tbody.innerHTML = html;

      // Expandir
      const expandir = document.getElementById('rankingExpandir');
      if (!rankingExpandido && restantes > 0) {
        document.getElementById('rankingRestantes').textContent = restantes;
        expandir.style.display = 'block';
      } else {
        expandir.style.display = 'none';
      }
    }

    // ==================== ADMIN ====================
    function logAdmin(msg, tipo = 'info') {
      const log = document.getElementById('adminLog');
      if (!log) { console.log(`[BOLSA ${tipo}] ${msg}`); return; }
      log.style.display = 'block';
      const cores = { info: '#3b82f6', success: '#10b981', error: '#ef4444', warn: '#f59e0b' };
      log.innerHTML += `<div style="color: ${cores[tipo]};">[${new Date().toLocaleTimeString()}] ${msg}</div>`;
      log.scrollTop = log.scrollHeight;
    }

    async function inicializarMetricas() {
      if (!confirm('Isso vai criar/atualizar m√©tricas de TODOS os times com pre√ßo 500 cr. Continuar?')) return;
      
      logAdmin('Iniciando cria√ß√£o de m√©tricas...', 'info');
      let criados = 0, erros = 0;

      for (const time of allTimes) {
        try {
          await db.collection('bolsa_metricas_time').doc(time.id).set({
            timeId: time.id,
            timeNome: time.nome,
            precoAlgoritmo: 500,
            precoMercado: 500,
            variacaoDia: 0,
            mediaDividendos: 0,
            volumeDia: 0,
            ultimaAtualizacao: firebase.firestore.FieldValue.serverTimestamp()
          }, { merge: true });
          criados++;
        } catch (e) {
          erros++;
          logAdmin(`Erro em ${time.nome}: ${e.message}`, 'error');
        }
      }

      logAdmin(`‚úÖ M√©tricas criadas: ${criados} times, ${erros} erros`, criados === allTimes.length ? 'success' : 'warn');
      showToast(`‚úÖ M√©tricas criadas para ${criados} times!`);
      await carregarMetricas();
      renderizarTabelaMercado();
    }

    async function inicializarCotasDono() {
      if (!confirm('Isso vai criar 1000 cotas de cada time para o dono inicial. Continuar?')) return;
      
      logAdmin('Criando cotas do dono inicial...', 'info');
      let criados = 0, erros = 0;

      for (const time of allTimes) {
        try {
          // Verificar se j√° existe
          const existente = await db.collection('bolsa_cotas')
            .where('timeId', '==', time.id)
            .where('userId', '==', DONO_INICIAL_ID)
            .get();
          
          if (existente.empty) {
            await db.collection('bolsa_cotas').add({
              timeId: time.id,
              timeNome: time.nome,
              userId: DONO_INICIAL_ID,
              usuarioNome: 'Dono Inicial',
              quantidade: 1000,
              precoMedioAquisicao: 500,
              dataAquisicao: firebase.firestore.FieldValue.serverTimestamp()
            });
            criados++;
          } else {
            // Atualizar para 1000
            await existente.docs[0].ref.update({ quantidade: 1000 });
            criados++;
          }
        } catch (e) {
          erros++;
          logAdmin(`Erro em ${time.nome}: ${e.message}`, 'error');
        }
      }

      logAdmin(`‚úÖ Cotas criadas: ${criados} times, ${erros} erros`, criados === allTimes.length ? 'success' : 'warn');
      showToast(`‚úÖ Cotas do dono inicial criadas para ${criados} times!`);
    }

    async function limparColecao(colecao) {
      if (!confirm(`ATEN√á√ÉO: Isso vai APAGAR TODOS os documentos de "${colecao}"! Confirma?`)) return;
      
      logAdmin(`Limpando ${colecao}...`, 'warn');
      
      try {
        const snap = await db.collection(colecao).get();
        const batch = db.batch();
        let count = 0;
        
        snap.forEach(doc => {
          batch.delete(doc.ref);
          count++;
          if (count % 500 === 0) {
            // Firestore tem limite de 500 ops por batch
            batch.commit();
          }
        });
        
        await batch.commit();
        logAdmin(`‚úÖ ${colecao} limpo: ${count} documentos removidos`, 'success');
        showToast(`‚úÖ ${count} documentos removidos de ${colecao}`);
        
        // Recarregar dados
        if (colecao === 'bolsa_cotas') {
          await carregarMinhasCotas();
          await carregarTodasCotas();
        }
        renderizarTabelaMercado();
        
      } catch (e) {
        logAdmin(`‚ùå Erro: ${e.message}`, 'error');
        showToast('‚ùå Erro ao limpar cole√ß√£o');
      }
    }

    async function resetCompleto() {
      if (!confirm('‚ö†Ô∏è RESET TOTAL: Isso vai:\n1. Apagar TODAS as ordens\n2. Apagar TODAS as transa√ß√µes\n3. Apagar TODAS as cotas\n4. Recriar m√©tricas com 500 cr\n5. Recriar cotas do dono inicial\n\nTEM CERTEZA?')) return;
      if (!confirm('√öLTIMA CHANCE: Realmente quer apagar tudo?')) return;
      
      logAdmin('üî• INICIANDO RESET COMPLETO...', 'error');
      
      try {
        // 1. Limpar ordens
        logAdmin('Limpando ordens...', 'info');
        const ordensSnap = await db.collection('bolsa_ordens').get();
        for (const doc of ordensSnap.docs) await doc.ref.delete();
        logAdmin(`‚úÖ ${ordensSnap.size} ordens removidas`, 'success');
        
        // 2. Limpar transa√ß√µes
        logAdmin('Limpando transa√ß√µes...', 'info');
        const transSnap = await db.collection('bolsa_transacoes').get();
        for (const doc of transSnap.docs) await doc.ref.delete();
        logAdmin(`‚úÖ ${transSnap.size} transa√ß√µes removidas`, 'success');
        
        // 3. Limpar cotas
        logAdmin('Limpando cotas...', 'info');
        const cotasSnap = await db.collection('bolsa_cotas').get();
        for (const doc of cotasSnap.docs) await doc.ref.delete();
        logAdmin(`‚úÖ ${cotasSnap.size} cotas removidas`, 'success');
        
        // 4. Recriar m√©tricas
        logAdmin('Recriando m√©tricas...', 'info');
        for (const time of allTimes) {
          await db.collection('bolsa_metricas_time').doc(time.id).set({
            timeId: time.id,
            timeNome: time.nome,
            precoAlgoritmo: 500,
            precoMercado: 500,
            variacaoDia: 0,
            mediaDividendos: 0,
            volumeDia: 0,
            ultimaAtualizacao: firebase.firestore.FieldValue.serverTimestamp()
          });
        }
        logAdmin(`‚úÖ M√©tricas criadas para ${allTimes.length} times`, 'success');
        
        // 5. Recriar cotas do dono
        logAdmin('Recriando cotas do dono inicial...', 'info');
        for (const time of allTimes) {
          await db.collection('bolsa_cotas').add({
            timeId: time.id,
            timeNome: time.nome,
            userId: DONO_INICIAL_ID,
            usuarioNome: 'Dono Inicial',
            quantidade: 1000,
            precoMedioAquisicao: 500,
            dataAquisicao: firebase.firestore.FieldValue.serverTimestamp()
          });
        }
        logAdmin(`‚úÖ Cotas criadas para ${allTimes.length} times`, 'success');
        
        logAdmin('üéâ RESET COMPLETO FINALIZADO!', 'success');
        showToast('‚úÖ Reset completo! Sistema reiniciado com pre√ßo 500 cr');
        
        // Recarregar tudo
        await carregarMetricas();
        await carregarMinhasCotas();
        await carregarTodasCotas();
        calcularStats();
        renderizarTabelaMercado();
        
      } catch (e) {
        logAdmin(`‚ùå ERRO NO RESET: ${e.message}`, 'error');
        showToast('‚ùå Erro no reset completo');
      }
    }

    // ==================== PROCESSAR JOGOS PARA BOLSA ====================
    async function processarJogosParaBolsa() {
      logAdmin('üéÆ Buscando jogos finalizados para processar...', 'info');
      
      try {
        // Buscar s√≥ jogos finalizados (n√£o TODOS)
        const jogosSnap = await db.collection('jogos')
          .where('status', '==', 'finalizado')
          .get();
        
        const jogosParaProcessar = [];
        
        jogosSnap.forEach(doc => {
          const jogo = { id: doc.id, ...doc.data() };
          if (!jogo.bolsaProcessado) {
            jogosParaProcessar.push(jogo);
          }
        });

        if (jogosParaProcessar.length === 0) {
          logAdmin('‚úÖ Todos os jogos j√° foram processados', 'info');
          showToast('‚úÖ Nenhum jogo novo para processar');
          return;
        }

        logAdmin(`üìä ${jogosParaProcessar.length} jogos para processar...`, 'info');

        let processados = 0;
        let erros = 0;

        for (const jogo of jogosParaProcessar) {
          try {
            await processarJogoIndividual(jogo);
            processados++;
          } catch (e) {
            erros++;
            logAdmin(`‚ùå Erro no jogo ${jogo.id}: ${e.message}`, 'error');
          }
        }

        logAdmin(`‚úÖ Processamento conclu√≠do: ${processados} jogos, ${erros} erros`, processados > 0 ? 'success' : 'warn');
        showToast(`‚úÖ ${processados} jogos processados!`);

        // Recarregar m√©tricas
        await carregarMetricas();
        renderizarTabelaMercado();

      } catch (error) {
        console.error('Erro ao processar jogos:', error);
        logAdmin(`‚ùå Erro geral: ${error.message}`, 'error');
        showToast('‚ùå Erro ao processar jogos');
      }
    }

    async function processarJogoIndividual(jogo) {
      const timeCasaId = jogo.timeCasaId;
      const timeForaId = jogo.timeForaId;
      
      if (!timeCasaId || !timeForaId) {
        logAdmin(`‚ö†Ô∏è Jogo ${jogo.id} sem times definidos, pulando...`, 'warn');
        return;
      }

      // Buscar nomes dos times
      const timeCasa = allTimes.find(t => t.id === timeCasaId);
      const timeFora = allTimes.find(t => t.id === timeForaId);
      
      logAdmin(`üéØ Processando: ${timeCasa?.nome || timeCasaId} vs ${timeFora?.nome || timeForaId}`, 'info');

      // ‚úÖ NOVO: Buscar dados de distribui√ß√£o de cotistas do painel-jogo
      let distribuicaoCotistas = null;
      let dividendosCasa = 0;
      let dividendosFora = 0;
      
      try {
        const distDoc = await db.collection('distribuicao_cotistas_jogo').doc(jogo.id).get();
        if (distDoc.exists) {
          distribuicaoCotistas = distDoc.data();
          dividendosCasa = distribuicaoCotistas.creditosCasa || 0;
          dividendosFora = distribuicaoCotistas.creditosFora || 0;
          logAdmin(`  üí∞ Dividendos encontrados: Casa ${dividendosCasa} cr | Fora ${dividendosFora} cr`, 'info');
        }
      } catch (e) {
        console.log('Sem dados de distribui√ß√£o para este jogo:', e);
      }

      // Dados de torcida
      const torcidaCasa = jogo.torcidaCasaCount || 0;
      const torcidaFora = jogo.torcidaForaCount || 0;
      const totalTorcida = torcidaCasa + torcidaFora;

      // Dados de pontua√ß√£o - PRIORIZAR dados do jogo, sen√£o da distribui√ß√£o
      const pontosCasa = jogo.pontosCasa || jogo.creditosCasa || distribuicaoCotistas?.pontosCasa || 0;
      const pontosFora = jogo.pontosFora || jogo.creditosFora || distribuicaoCotistas?.pontosFora || 0;

      // Calcular varia√ß√µes
      let variacaoCasa = 0;
      let variacaoFora = 0;

      // 1. B√¥nus por participa√ß√£o no jogo (+0.5% cada)
      variacaoCasa += CONFIG_VALORIZACAO.porJogo;
      variacaoFora += CONFIG_VALORIZACAO.porJogo;
      logAdmin(`  +${CONFIG_VALORIZACAO.porJogo}% participa√ß√£o para ambos`, 'info');

      // 2. Varia√ß√£o por torcida
      if (totalTorcida > 0) {
        // B√¥nus por torcedor
        variacaoCasa += torcidaCasa * CONFIG_VALORIZACAO.porTorcedor;
        variacaoFora += torcidaFora * CONFIG_VALORIZACAO.porTorcedor;

        if (torcidaCasa > torcidaFora) {
          // Time Casa ganhou na torcida
          variacaoCasa += CONFIG_VALORIZACAO.porVitoriaTorcida;
          variacaoFora -= CONFIG_VALORIZACAO.porDerrotaTorcida;
          logAdmin(`  üèÜ Torcida: ${timeCasa?.nome} venceu (${torcidaCasa} vs ${torcidaFora})`, 'success');
        } else if (torcidaFora > torcidaCasa) {
          // Time Fora ganhou na torcida
          variacaoFora += CONFIG_VALORIZACAO.porVitoriaTorcida;
          variacaoCasa -= CONFIG_VALORIZACAO.porDerrotaTorcida;
          logAdmin(`  üèÜ Torcida: ${timeFora?.nome} venceu (${torcidaFora} vs ${torcidaCasa})`, 'success');
        } else {
          logAdmin(`  ü§ù Torcida empatada (${torcidaCasa} vs ${torcidaFora})`, 'info');
        }
      }

      // 3. Varia√ß√£o por pontua√ß√£o/cr√©ditos
      if (pontosCasa > 0 || pontosFora > 0) {
        // B√¥nus por ponto
        variacaoCasa += pontosCasa * CONFIG_VALORIZACAO.porPonto;
        variacaoFora += pontosFora * CONFIG_VALORIZACAO.porPonto;

        if (pontosCasa > pontosFora) {
          variacaoCasa += CONFIG_VALORIZACAO.porVitoriaPontuacao;
          variacaoFora -= CONFIG_VALORIZACAO.porDerrotaPontuacao;
          logAdmin(`  üéØ Pontua√ß√£o: ${timeCasa?.nome} venceu (${pontosCasa} vs ${pontosFora})`, 'success');
        } else if (pontosFora > pontosCasa) {
          variacaoFora += CONFIG_VALORIZACAO.porVitoriaPontuacao;
          variacaoCasa -= CONFIG_VALORIZACAO.porDerrotaPontuacao;
          logAdmin(`  üéØ Pontua√ß√£o: ${timeFora?.nome} venceu (${pontosFora} vs ${pontosCasa})`, 'success');
        }
      }

      // Limitar varia√ß√£o m√°xima
      variacaoCasa = Math.max(-CONFIG_VALORIZACAO.maxVariacao, Math.min(CONFIG_VALORIZACAO.maxVariacao, variacaoCasa));
      variacaoFora = Math.max(-CONFIG_VALORIZACAO.maxVariacao, Math.min(CONFIG_VALORIZACAO.maxVariacao, variacaoFora));

      // Atualizar m√©tricas dos times
      const batch = db.batch();

      // Time Casa
      const metricaCasa = metricas[timeCasaId] || { precoAlgoritmo: PRECO_INICIAL, variacaoDia: 0, mediaDividendos: 0, totalJogos: 0 };
      const novoPrecoAlgoCasa = metricaCasa.precoAlgoritmo * (1 + variacaoCasa / 100);
      const novaVariacaoCasa = (metricaCasa.variacaoDia || 0) + variacaoCasa;
      
      // ‚úÖ NOVO: Calcular m√©dia de dividendos
      const totalJogosCasa = (metricaCasa.totalJogos || 0) + 1;
      const novaMediaDivCasa = ((metricaCasa.mediaDividendos || 0) * (metricaCasa.totalJogos || 0) + dividendosCasa) / totalJogosCasa;

      batch.set(db.collection('bolsa_metricas_time').doc(timeCasaId), {
        timeId: timeCasaId,
        timeNome: timeCasa?.nome || '',
        precoAlgoritmo: Math.round(novoPrecoAlgoCasa * 100) / 100,
        precoMercado: metricaCasa.precoMercado || PRECO_INICIAL,
        variacaoDia: Math.round(novaVariacaoCasa * 100) / 100,
        mediaDividendos: Math.round(novaMediaDivCasa * 1000) / 1000,  // ‚úÖ NOVO
        totalJogos: totalJogosCasa,
        totalTorcedores: (metricaCasa.totalTorcedores || 0) + torcidaCasa,
        ultimaAtualizacao: firebase.firestore.FieldValue.serverTimestamp()
      }, { merge: true });

      // Time Fora
      const metricaFora = metricas[timeForaId] || { precoAlgoritmo: PRECO_INICIAL, variacaoDia: 0, mediaDividendos: 0, totalJogos: 0 };
      const novoPrecoAlgoFora = metricaFora.precoAlgoritmo * (1 + variacaoFora / 100);
      const novaVariacaoFora = (metricaFora.variacaoDia || 0) + variacaoFora;
      
      // ‚úÖ NOVO: Calcular m√©dia de dividendos
      const totalJogosFora = (metricaFora.totalJogos || 0) + 1;
      const novaMediaDivFora = ((metricaFora.mediaDividendos || 0) * (metricaFora.totalJogos || 0) + dividendosFora) / totalJogosFora;

      batch.set(db.collection('bolsa_metricas_time').doc(timeForaId), {
        timeId: timeForaId,
        timeNome: timeFora?.nome || '',
        precoAlgoritmo: Math.round(novoPrecoAlgoFora * 100) / 100,
        precoMercado: metricaFora.precoMercado || PRECO_INICIAL,
        variacaoDia: Math.round(novaVariacaoFora * 100) / 100,
        mediaDividendos: Math.round(novaMediaDivFora * 1000) / 1000,  // ‚úÖ NOVO
        totalJogos: totalJogosFora,
        totalTorcedores: (metricaFora.totalTorcedores || 0) + torcidaFora,
        ultimaAtualizacao: firebase.firestore.FieldValue.serverTimestamp()
      }, { merge: true });

      // Marcar jogo como processado
      batch.update(db.collection('jogos').doc(jogo.id), {
        bolsaProcessado: true,
        bolsaProcessadoEm: firebase.firestore.FieldValue.serverTimestamp()
      });

      await batch.commit();

      logAdmin(`  üìà ${timeCasa?.nome}: ${variacaoCasa >= 0 ? '+' : ''}${variacaoCasa.toFixed(2)}% ‚Üí ${novoPrecoAlgoCasa.toFixed(2)} cr | Div: ${novaMediaDivCasa.toFixed(3)} cr`, variacaoCasa >= 0 ? 'success' : 'warn');
      logAdmin(`  üìà ${timeFora?.nome}: ${variacaoFora >= 0 ? '+' : ''}${variacaoFora.toFixed(2)}% ‚Üí ${novoPrecoAlgoFora.toFixed(2)} cr | Div: ${novaMediaDivFora.toFixed(3)} cr`, variacaoFora >= 0 ? 'success' : 'warn');
    }

    // Resetar varia√ß√£o di√°ria (rodar uma vez por dia)
    async function resetarVariacaoDiaria() {
      if (!confirm('Isso vai zerar a varia√ß√£o do dia de TODOS os times. Continuar?')) return;
      
      logAdmin('üîÑ Resetando varia√ß√£o di√°ria...', 'info');
      
      try {
        const batch = db.batch();
        
        for (const time of allTimes) {
          if (metricas[time.id]) {
            batch.update(db.collection('bolsa_metricas_time').doc(time.id), {
              variacaoDia: 0,
              ultimoResetDia: firebase.firestore.FieldValue.serverTimestamp()
            });
          }
        }

        await batch.commit();
        logAdmin(`‚úÖ Varia√ß√£o zerada para ${allTimes.length} times`, 'success');
        showToast('‚úÖ Varia√ß√£o di√°ria resetada!');
        
        await carregarMetricas();
        renderizarTabelaMercado();
      } catch (e) {
        logAdmin(`‚ùå Erro: ${e.message}`, 'error');
        showToast('‚ùå Erro ao resetar varia√ß√£o');
      }
    }

    // Reprocessar todos os jogos (cuidado!)
    async function reprocessarTodosJogos() {
      if (!confirm('‚ö†Ô∏è Isso vai REPROCESSAR todos os jogos.\n\nOs pre√ßos v√£o mudar novamente!\n\nTem certeza?')) return;
      if (!confirm('√öLTIMA CHANCE: Realmente quer reprocessar?')) return;
      
      logAdmin('üîÑ Removendo flag de processamento...', 'warn');
      
      try {
        const jogosSnap = await db.collection('jogos')
          .where('bolsaProcessado', '==', true)
          .get();
        
        if (jogosSnap.empty) {
          logAdmin('Nenhum jogo para reprocessar', 'info');
          return;
        }

        const batch = db.batch();
        jogosSnap.forEach(doc => {
          batch.update(doc.ref, { bolsaProcessado: false });
        });
        
        await batch.commit();
        logAdmin(`‚úÖ ${jogosSnap.size} jogos prontos para reprocessamento`, 'success');
        
        // Agora processar
        await processarJogosParaBolsa();
      } catch (e) {
        logAdmin(`‚ùå Erro: ${e.message}`, 'error');
      }
    }

    // Verificar se √© admin e mostrar √°rea
    function verificarAdmin() {
      if (currentUserData?.isAdmin || currentUser?.email === 'admin@yellup.com') {
        document.getElementById('adminArea').style.display = 'block';
      }
    }

    // Chamar ap√≥s carregar dados
    const originalCarregarBolsa = carregarBolsa;
    carregarBolsa = async function() {
      await originalCarregarBolsa();
      verificarAdmin();
    };

    // Fechar modal ao clicar fora
    document.querySelectorAll('.modal-overlay').forEach(modal => {
      modal.addEventListener('click', e => {
        if (e.target === modal) fecharModal(modal.id);
      });
    });
  </script>

  <!-- √Årea Admin (s√≥ aparece para admins) -->
  <div id="adminArea" style="display: none; max-width: 1200px; margin: 40px auto; padding: 20px;">
    <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 16px; padding: 20px;">
      <h3 style="color: #ef4444; margin-bottom: 15px;">üîß Painel Admin - √çndice dos Times</h3>
      
      <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px;">
        <button onclick="processarJogosParaBolsa()" style="padding: 12px 20px; background: linear-gradient(135deg, #10b981, #059669); border: none; border-radius: 10px; color: white; font-weight: 600; cursor: pointer; font-family: 'Poppins', sans-serif;">
          üéÆ Processar Jogos Encerrados
        </button>
        
        <button onclick="resetarVariacaoDiaria()" style="padding: 12px 20px; background: linear-gradient(135deg, #3b82f6, #1d4ed8); border: none; border-radius: 10px; color: white; font-weight: 600; cursor: pointer; font-family: 'Poppins', sans-serif;">
          üîÑ Resetar Varia√ß√£o Di√°ria
        </button>
        
        <button onclick="inicializarMetricas()" style="padding: 12px 20px; background: linear-gradient(135deg, #f59e0b, #d97706); border: none; border-radius: 10px; color: white; font-weight: 600; cursor: pointer; font-family: 'Poppins', sans-serif;">
          üìä Inicializar M√©tricas (500cr)
        </button>
        
        <button onclick="inicializarCotasDono()" style="padding: 12px 20px; background: linear-gradient(135deg, #8b5cf6, #7c3aed); border: none; border-radius: 10px; color: white; font-weight: 600; cursor: pointer; font-family: 'Poppins', sans-serif;">
          üíº Criar Cotas Dono Inicial
        </button>
        
        <button onclick="reprocessarTodosJogos()" style="padding: 12px 20px; background: linear-gradient(135deg, #ef4444, #dc2626); border: none; border-radius: 10px; color: white; font-weight: 600; cursor: pointer; font-family: 'Poppins', sans-serif;">
          ‚ö†Ô∏è Reprocessar Todos Jogos
        </button>
        
        <button onclick="resetCompleto()" style="padding: 12px 20px; background: #1a1a1a; border: 2px solid #ef4444; border-radius: 10px; color: #ef4444; font-weight: 600; cursor: pointer; font-family: 'Poppins', sans-serif;">
          üî• RESET COMPLETO
        </button>
      </div>
      
      <div id="adminLog" style="background: #0a0a0a; border-radius: 10px; padding: 15px; max-height: 300px; overflow-y: auto; font-family: monospace; font-size: 0.85em; display: none;">
        <!-- Log aparece aqui -->
      </div>
    </div>
  </div>
</body>
</html>
