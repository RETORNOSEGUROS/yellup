<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rankings - Yellup</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #0e141b 0%, #1a2332 100%);
      color: #e7eef7;
      min-height: 100vh;
      padding-bottom: 100px;
    }

    /* Header */
    .header {
      background: rgba(14, 20, 27, 0.95);
      backdrop-filter: blur(20px);
      padding: 15px 20px;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .header-content {
      max-width: 800px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .btn-back {
      padding: 10px 20px;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: 10px;
      color: #fff;
      cursor: pointer;
      font-family: 'Poppins', sans-serif;
      transition: all 0.3s ease;
    }

    .btn-back:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .logo {
      font-size: 1.5em;
      font-weight: 800;
      background: linear-gradient(135deg, #ffb547 0%, #ff8c42 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Container */
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }

    /* T√≠tulo da p√°gina */
    .page-title {
      text-align: center;
      margin-bottom: 25px;
    }

    .page-title h1 {
      font-size: 1.8em;
      margin-bottom: 5px;
    }

    .page-title p {
      color: #a9b5c6;
    }

    /* Filtros */
    .filters {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .filter-btn {
      padding: 12px 24px;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 50px;
      color: #a9b5c6;
      cursor: pointer;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .filter-btn:hover {
      border-color: rgba(255, 181, 71, 0.5);
      color: #ffb547;
    }

    .filter-btn.active {
      background: linear-gradient(135deg, #ffb547 0%, #ff8c42 100%);
      border-color: transparent;
      color: #0e141b;
    }

    /* Filtro de Time */
    .team-filter {
      width: 100%;
      margin-bottom: 20px;
      display: none;
    }

    .team-filter.active {
      display: block;
    }

    .team-select {
      width: 100%;
      padding: 14px 16px;
      background: rgba(0, 0, 0, 0.3);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      color: #fff;
      font-size: 1em;
      font-family: 'Poppins', sans-serif;
      cursor: pointer;
    }

    .team-select:focus {
      outline: none;
      border-color: #ffb547;
    }

    /* Card de posi√ß√£o do usu√°rio */
    .my-position-card {
      background: linear-gradient(135deg, rgba(255, 181, 71, 0.2) 0%, rgba(255, 140, 66, 0.1) 100%);
      border: 2px solid rgba(255, 181, 71, 0.5);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 25px;
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .my-position-rank {
      font-size: 2.5em;
      font-weight: 800;
      color: #ffb547;
      min-width: 80px;
      text-align: center;
    }

    .my-position-info {
      flex: 1;
    }

    .my-position-name {
      font-weight: 700;
      font-size: 1.2em;
      margin-bottom: 5px;
    }

    .my-position-stats {
      display: flex;
      gap: 20px;
      color: #a9b5c6;
      font-size: 0.9em;
    }

    .my-position-level {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Ranking List */
    .ranking-card {
      background: linear-gradient(135deg, rgba(30, 41, 54, 0.9) 0%, rgba(24, 34, 46, 0.9) 100%);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      overflow: hidden;
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    }

    .ranking-header {
      padding: 15px 20px;
      background: rgba(0, 0, 0, 0.2);
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .ranking-title {
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .ranking-period {
      font-size: 0.85em;
      color: #a9b5c6;
    }

    .ranking-list {
      list-style: none;
    }

    .ranking-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 15px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      transition: all 0.3s ease;
    }

    .ranking-item:last-child {
      border-bottom: none;
    }

    .ranking-item:hover {
      background: rgba(255, 255, 255, 0.03);
    }

    .ranking-item.highlight {
      background: rgba(255, 181, 71, 0.1);
    }

    .ranking-item.top-1 {
      background: linear-gradient(90deg, rgba(255, 215, 0, 0.15) 0%, transparent 100%);
    }

    .ranking-item.top-2 {
      background: linear-gradient(90deg, rgba(192, 192, 192, 0.1) 0%, transparent 100%);
    }

    .ranking-item.top-3 {
      background: linear-gradient(90deg, rgba(205, 127, 50, 0.1) 0%, transparent 100%);
    }

    .rank-position {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 1.1em;
      background: rgba(255, 255, 255, 0.1);
      flex-shrink: 0;
    }

    .rank-position.gold {
      background: linear-gradient(135deg, #FFD700, #FFA500);
      color: #000;
    }

    .rank-position.silver {
      background: linear-gradient(135deg, #C0C0C0, #A8A8A8);
      color: #000;
    }

    .rank-position.bronze {
      background: linear-gradient(135deg, #CD7F32, #8B4513);
      color: #fff;
    }

    .rank-avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1.1em;
      flex-shrink: 0;
    }

    .rank-info {
      flex: 1;
      min-width: 0;
    }

    .rank-name {
      font-weight: 600;
      margin-bottom: 3px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .rank-team {
      font-size: 0.8em;
      color: #a9b5c6;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .rank-level {
      font-size: 0.75em;
      padding: 3px 8px;
      border-radius: 10px;
      font-weight: 600;
    }

    .level-bronze { background: rgba(205, 127, 50, 0.2); color: #CD7F32; }
    .level-prata { background: rgba(192, 192, 192, 0.2); color: #C0C0C0; }
    .level-ouro { background: rgba(255, 215, 0, 0.2); color: #FFD700; }
    .level-diamante { background: rgba(185, 242, 255, 0.2); color: #B9F2FF; }
    .level-mestre { background: rgba(138, 43, 226, 0.2); color: #9B59B6; }

    .rank-stats {
      text-align: right;
    }

    .rank-xp {
      font-weight: 700;
      font-size: 1.1em;
      color: #ffb547;
    }

    .rank-games {
      font-size: 0.8em;
      color: #a9b5c6;
    }

    /* P√≥dio */
    .podium {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      gap: 10px;
      margin-bottom: 30px;
      padding: 20px;
    }

    .podium-item {
      text-align: center;
      transition: transform 0.3s ease;
    }

    .podium-item:hover {
      transform: translateY(-5px);
    }

    .podium-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1.3em;
      margin: 0 auto 10px;
      border: 3px solid;
    }

    .podium-1 .podium-avatar {
      width: 80px;
      height: 80px;
      font-size: 1.6em;
      border-color: #FFD700;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
    }

    .podium-2 .podium-avatar {
      border-color: #C0C0C0;
    }

    .podium-3 .podium-avatar {
      border-color: #CD7F32;
    }

    .podium-name {
      font-weight: 600;
      font-size: 0.9em;
      margin-bottom: 5px;
    }

    .podium-xp {
      color: #ffb547;
      font-weight: 700;
    }

    .podium-base {
      width: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 1.5em;
      border-radius: 8px 8px 0 0;
      margin-top: 10px;
    }

    .podium-1 .podium-base {
      height: 100px;
      background: linear-gradient(180deg, #FFD700, #FFA500);
      color: #000;
      width: 100px;
    }

    .podium-2 .podium-base {
      height: 70px;
      background: linear-gradient(180deg, #C0C0C0, #A8A8A8);
      color: #000;
    }

    .podium-3 .podium-base {
      height: 50px;
      background: linear-gradient(180deg, #CD7F32, #8B4513);
      color: #fff;
    }

    /* Empty state */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #a9b5c6;
    }

    .empty-icon {
      font-size: 4em;
      margin-bottom: 20px;
    }

    /* Loading */
    .loading {
      text-align: center;
      padding: 40px;
      color: #a9b5c6;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(255, 181, 71, 0.3);
      border-top-color: #ffb547;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 15px 30px;
      border-radius: 50px;
      font-weight: 600;
      z-index: 2000;
      opacity: 0;
      transition: all 0.3s ease;
    }

    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    /* Bottom Nav */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(14, 20, 27, 0.98);
      backdrop-filter: blur(20px);
      padding: 10px 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      z-index: 99;
    }

    .nav-content {
      max-width: 600px;
      margin: 0 auto;
      display: flex;
      justify-content: space-around;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
      color: #a9b5c6;
      text-decoration: none;
      font-size: 0.75em;
      transition: all 0.3s ease;
    }

    .nav-item:hover, .nav-item.active {
      color: #ffb547;
    }

    .nav-icon {
      font-size: 1.5em;
    }

    @media (max-width: 600px) {
      .podium {
        gap: 5px;
      }

      .podium-base {
        width: 60px !important;
      }

      .podium-1 .podium-base {
        width: 70px !important;
      }

      .my-position-card {
        flex-direction: column;
        text-align: center;
      }

      .my-position-stats {
        justify-content: center;
      }
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <button class="btn-back" onclick="window.location.href='painel.html'">‚Üê Voltar</button>
      <div class="logo">‚öΩ Yellup</div>
      <div style="width: 80px;"></div>
    </div>
  </header>

  <!-- Container -->
  <div class="container">
    
    <div class="page-title">
      <h1>üèÜ Rankings</h1>
      <p>Os melhores jogadores do Yellup</p>
    </div>

    <!-- Filtros -->
    <div class="filters">
      <button class="filter-btn active" data-filter="geral" onclick="trocarFiltro('geral')">
        üåç Geral
      </button>
      <button class="filter-btn" data-filter="mensal" onclick="trocarFiltro('mensal')">
        üìÖ Mensal
      </button>
      <button class="filter-btn" data-filter="semanal" onclick="trocarFiltro('semanal')">
        üìÜ Semanal
      </button>
      <button class="filter-btn" data-filter="clube" onclick="trocarFiltro('clube')">
        ‚öΩ Por Clube
      </button>
    </div>

    <!-- Filtro de Time -->
    <div class="team-filter" id="teamFilter">
      <select class="team-select" id="teamSelect" onchange="carregarRankingPorClube()">
        <option value="">Selecione um time...</option>
      </select>
    </div>

    <!-- Minha posi√ß√£o -->
    <div class="my-position-card" id="myPositionCard" style="display: none;">
      <div class="my-position-rank" id="myRank">-</div>
      <div class="my-position-info">
        <div class="my-position-name" id="myName">Carregando...</div>
        <div class="my-position-stats">
          <span id="myXP">0 XP</span>
          <span>‚Ä¢</span>
          <div class="my-position-level">
            <span id="myLevelBadge" class="rank-level level-bronze">Bronze</span>
          </div>
        </div>
      </div>
    </div>

    <!-- P√≥dio -->
    <div class="podium" id="podium" style="display: none;">
      <div class="podium-item podium-2" id="podium2">
        <div class="podium-avatar" style="background: #C0C0C0;">2</div>
        <div class="podium-name">-</div>
        <div class="podium-xp">0 XP</div>
        <div class="podium-base">ü•à</div>
      </div>
      <div class="podium-item podium-1" id="podium1">
        <div class="podium-avatar" style="background: #FFD700;">1</div>
        <div class="podium-name">-</div>
        <div class="podium-xp">0 XP</div>
        <div class="podium-base">ü•á</div>
      </div>
      <div class="podium-item podium-3" id="podium3">
        <div class="podium-avatar" style="background: #CD7F32;">3</div>
        <div class="podium-name">-</div>
        <div class="podium-xp">0 XP</div>
        <div class="podium-base">ü•â</div>
      </div>
    </div>

    <!-- Ranking Card -->
    <div class="ranking-card">
      <div class="ranking-header">
        <div class="ranking-title">
          <span>üìä</span>
          <span id="rankingTitleText">Top 50 - Geral</span>
        </div>
        <div class="ranking-period" id="rankingPeriod">Todos os tempos</div>
      </div>
      
      <ul class="ranking-list" id="rankingList">
        <div class="loading">
          <div class="loading-spinner"></div>
          <p>Carregando ranking...</p>
        </div>
      </ul>
    </div>

  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <!-- Bottom Nav -->
  <nav class="bottom-nav">
    <div class="nav-content">
      <a href="painel.html" class="nav-item">
        <span class="nav-icon">üè†</span>
        <span>In√≠cio</span>
      </a>
      <a href="ranking-geral.html" class="nav-item active">
        <span class="nav-icon">üèÜ</span>
        <span>Ranking</span>
      </a>
      <a href="indicacoes.html" class="nav-item">
        <span class="nav-icon">üîó</span>
        <span>Indicar</span>
      </a>
      <a href="editar-perfil.html" class="nav-item">
        <span class="nav-icon">üë§</span>
        <span>Perfil</span>
      </a>
    </div>
  </nav>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    // ===================================
    // üî• CONFIGURA√á√ÉO FIREBASE
    // ===================================
    const firebaseConfig = {
      apiKey: "AIzaSyC5ZrkEy7KuCFJOtPvI7-P-JcA0MF4im5c",
      authDomain: "painel-yellup.firebaseapp.com",
      projectId: "painel-yellup",
      storageBucket: "painel-yellup.appspot.com",
      messagingSenderId: "608347210297",
      appId: "1:608347210297:web:75092713724e617c7203e8"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // ===================================
    // üì¶ VARI√ÅVEIS
    // ===================================
    let currentUserId = null;
    let currentUserData = null;
    let filtroAtual = 'geral';
    let timesCache = {};

    // ===================================
    // üéñÔ∏è SISTEMA DE N√çVEIS
    // ===================================
    const NIVEIS = [
      { nome: 'Bronze', minXP: 0, classe: 'level-bronze', emoji: 'ü•â' },
      { nome: 'Prata', minXP: 500, classe: 'level-prata', emoji: 'ü•à' },
      { nome: 'Ouro', minXP: 2000, classe: 'level-ouro', emoji: 'ü•á' },
      { nome: 'Diamante', minXP: 5000, classe: 'level-diamante', emoji: 'üíé' },
      { nome: 'Mestre', minXP: 10000, classe: 'level-mestre', emoji: 'üëë' }
    ];

    function calcularNivel(xp) {
      let nivel = NIVEIS[0];
      for (const n of NIVEIS) {
        if (xp >= n.minXP) nivel = n;
      }
      return nivel;
    }

    // ===================================
    // üí¨ TOAST
    // ===================================
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // ===================================
    // üîê AUTENTICA√á√ÉO
    // ===================================
    auth.onAuthStateChanged(async (user) => {
      if (!user) {
        window.location.href = 'index.html';
        return;
      }

      currentUserId = user.uid;

      try {
        const userDoc = await db.collection('usuarios').doc(currentUserId).get();
        if (userDoc.exists) {
          currentUserData = userDoc.data();
        }

        await carregarTimes();
        await carregarRanking();

      } catch (error) {
        console.error("Erro:", error);
        showToast('‚ùå Erro ao carregar dados');
      }
    });

    // ===================================
    // ‚öΩ CARREGAR TIMES
    // ===================================
    async function carregarTimes() {
      try {
        const snapshot = await db.collection('times').orderBy('nome').get();
        const select = document.getElementById('teamSelect');
        
        snapshot.forEach(doc => {
          const time = doc.data();
          timesCache[doc.id] = time;
          select.innerHTML += `<option value="${doc.id}">${time.nome}</option>`;
        });
      } catch (error) {
        console.error("Erro ao carregar times:", error);
      }
    }

    // ===================================
    // üîÑ TROCAR FILTRO
    // ===================================
    function trocarFiltro(filtro) {
      filtroAtual = filtro;

      // Atualizar bot√µes
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.filter === filtro) {
          btn.classList.add('active');
        }
      });

      // Mostrar/ocultar filtro de time
      const teamFilter = document.getElementById('teamFilter');
      if (filtro === 'clube') {
        teamFilter.classList.add('active');
      } else {
        teamFilter.classList.remove('active');
        carregarRanking();
      }
    }

    // ===================================
    // üìä CARREGAR RANKING
    // ===================================
    async function carregarRanking() {
      const lista = document.getElementById('rankingList');
      const titleText = document.getElementById('rankingTitleText');
      const periodText = document.getElementById('rankingPeriod');

      lista.innerHTML = `
        <div class="loading">
          <div class="loading-spinner"></div>
          <p>Carregando ranking...</p>
        </div>
      `;

      try {
        let query = db.collection('usuarios').orderBy('xp', 'desc').limit(50);
        
        // Definir per√≠odo
        let dataInicio = null;
        const agora = new Date();

        if (filtroAtual === 'mensal') {
          dataInicio = new Date(agora.getFullYear(), agora.getMonth(), 1);
          titleText.textContent = 'Top 50 - Mensal';
          periodText.textContent = agora.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
        } else if (filtroAtual === 'semanal') {
          const dia = agora.getDay();
          dataInicio = new Date(agora);
          dataInicio.setDate(agora.getDate() - dia);
          dataInicio.setHours(0, 0, 0, 0);
          titleText.textContent = 'Top 50 - Semanal';
          periodText.textContent = 'Esta semana';
        } else {
          titleText.textContent = 'Top 50 - Geral';
          periodText.textContent = 'Todos os tempos';
        }

        // Para ranking mensal/semanal, precisar√≠amos de um campo separado
        // Por enquanto, usamos XP total
        const snapshot = await query.get();

        if (snapshot.empty) {
          lista.innerHTML = `
            <div class="empty-state">
              <div class="empty-icon">üèÜ</div>
              <p>Nenhum jogador encontrado</p>
            </div>
          `;
          return;
        }

        const usuarios = [];
        snapshot.forEach(doc => {
          usuarios.push({ id: doc.id, ...doc.data() });
        });

        renderizarRanking(usuarios);

      } catch (error) {
        console.error("Erro ao carregar ranking:", error);
        lista.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">‚ö†Ô∏è</div>
            <p>Erro ao carregar ranking</p>
          </div>
        `;
      }
    }

    // ===================================
    // ‚öΩ CARREGAR RANKING POR CLUBE
    // ===================================
    async function carregarRankingPorClube() {
      const timeId = document.getElementById('teamSelect').value;
      if (!timeId) return;

      const lista = document.getElementById('rankingList');
      const titleText = document.getElementById('rankingTitleText');
      const periodText = document.getElementById('rankingPeriod');

      const time = timesCache[timeId];
      titleText.textContent = `Top 50 - ${time?.nome || 'Clube'}`;
      periodText.textContent = 'Torcedores deste time';

      lista.innerHTML = `
        <div class="loading">
          <div class="loading-spinner"></div>
          <p>Carregando ranking...</p>
        </div>
      `;

      try {
        const snapshot = await db.collection('usuarios')
          .where('timeId', '==', timeId)
          .orderBy('xp', 'desc')
          .limit(50)
          .get();

        if (snapshot.empty) {
          lista.innerHTML = `
            <div class="empty-state">
              <div class="empty-icon">‚öΩ</div>
              <p>Nenhum torcedor encontrado para este time</p>
            </div>
          `;
          document.getElementById('podium').style.display = 'none';
          document.getElementById('myPositionCard').style.display = 'none';
          return;
        }

        const usuarios = [];
        snapshot.forEach(doc => {
          usuarios.push({ id: doc.id, ...doc.data() });
        });

        renderizarRanking(usuarios);

      } catch (error) {
        console.error("Erro:", error);
        lista.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">‚ö†Ô∏è</div>
            <p>Erro ao carregar ranking</p>
          </div>
        `;
      }
    }

    // ===================================
    // üé® RENDERIZAR RANKING
    // ===================================
    function renderizarRanking(usuarios) {
      const lista = document.getElementById('rankingList');
      const podium = document.getElementById('podium');
      const myCard = document.getElementById('myPositionCard');

      // Encontrar minha posi√ß√£o
      const minhaPosicao = usuarios.findIndex(u => u.id === currentUserId) + 1;

      // Atualizar minha posi√ß√£o
      if (minhaPosicao > 0) {
        myCard.style.display = 'flex';
        document.getElementById('myRank').textContent = `${minhaPosicao}¬∫`;
        document.getElementById('myName').textContent = currentUserData?.usuarioUnico || 'Voc√™';
        document.getElementById('myXP').textContent = `${currentUserData?.xp || 0} XP`;
        
        const meuNivel = calcularNivel(currentUserData?.xp || 0);
        const badge = document.getElementById('myLevelBadge');
        badge.className = `rank-level ${meuNivel.classe}`;
        badge.textContent = `${meuNivel.emoji} ${meuNivel.nome}`;
      } else {
        myCard.style.display = 'none';
      }

      // Renderizar p√≥dio
      if (usuarios.length >= 3) {
        podium.style.display = 'flex';
        
        for (let i = 1; i <= 3; i++) {
          const user = usuarios[i - 1];
          const nome = user.usuarioUnico || user.usuario || user.nome || 'An√¥nimo';
          const inicial = nome.charAt(0).toUpperCase();
          const xp = user.xp || 0;
          
          const podiumItem = document.getElementById(`podium${i}`);
          const avatar = podiumItem.querySelector('.podium-avatar');
          const nameEl = podiumItem.querySelector('.podium-name');
          const xpEl = podiumItem.querySelector('.podium-xp');

          avatar.textContent = inicial;
          nameEl.textContent = nome;
          xpEl.textContent = `${xp} XP`;
        }
      } else {
        podium.style.display = 'none';
      }

      // Renderizar lista (a partir do 4¬∫ lugar)
      const listaHTML = usuarios.slice(3).map((user, index) => {
        const posicao = index + 4;
        const nome = user.usuarioUnico || user.usuario || user.nome || 'An√¥nimo';
        const inicial = nome.charAt(0).toUpperCase();
        const xp = user.xp || 0;
        const nivel = calcularNivel(xp);
        const time = timesCache[user.timeId];
        const isMe = user.id === currentUserId;

        // Cor do avatar baseada no n√≠vel
        const avatarColors = {
          'level-bronze': '#CD7F32',
          'level-prata': '#C0C0C0',
          'level-ouro': '#FFD700',
          'level-diamante': '#B9F2FF',
          'level-mestre': '#9B59B6'
        };

        return `
          <li class="ranking-item ${isMe ? 'highlight' : ''}">
            <div class="rank-position">${posicao}</div>
            <div class="rank-avatar" style="background: ${avatarColors[nivel.classe] || '#666'}">${inicial}</div>
            <div class="rank-info">
              <div class="rank-name">
                ${nome}
                <span class="rank-level ${nivel.classe}">${nivel.emoji}</span>
              </div>
              <div class="rank-team">${time?.nome || 'Sem time'}</div>
            </div>
            <div class="rank-stats">
              <div class="rank-xp">${xp} XP</div>
            </div>
          </li>
        `;
      }).join('');

      // Se tiver menos de 4 usu√°rios, mostrar todos na lista
      if (usuarios.length < 4) {
        lista.innerHTML = usuarios.map((user, index) => {
          const posicao = index + 1;
          const nome = user.usuarioUnico || user.usuario || user.nome || 'An√¥nimo';
          const inicial = nome.charAt(0).toUpperCase();
          const xp = user.xp || 0;
          const nivel = calcularNivel(xp);
          const time = timesCache[user.timeId];
          const isMe = user.id === currentUserId;

          const posClass = posicao === 1 ? 'gold' : posicao === 2 ? 'silver' : posicao === 3 ? 'bronze' : '';
          const rowClass = posicao <= 3 ? `top-${posicao}` : '';

          return `
            <li class="ranking-item ${rowClass} ${isMe ? 'highlight' : ''}">
              <div class="rank-position ${posClass}">${posicao}</div>
              <div class="rank-avatar" style="background: linear-gradient(135deg, #ffb547, #ff8c42)">${inicial}</div>
              <div class="rank-info">
                <div class="rank-name">
                  ${nome}
                  <span class="rank-level ${nivel.classe}">${nivel.emoji}</span>
                </div>
                <div class="rank-team">${time?.nome || 'Sem time'}</div>
              </div>
              <div class="rank-stats">
                <div class="rank-xp">${xp} XP</div>
              </div>
            </li>
          `;
        }).join('');
      } else {
        lista.innerHTML = listaHTML || `
          <div class="empty-state">
            <div class="empty-icon">üìä</div>
            <p>Apenas 3 jogadores no ranking</p>
          </div>
        `;
      }
    }

    console.log("‚úÖ P√°gina de Rankings v1.0");
  </script>

</body>
</html>
