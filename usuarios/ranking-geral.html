<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rankings - Yellup</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #0e141b 0%, #1a2332 100%);
      color: #e7eef7;
      min-height: 100vh;
      padding-bottom: 100px;
    }

    /* Header */
    .header {
      background: rgba(14, 20, 27, 0.95);
      backdrop-filter: blur(20px);
      padding: 15px 20px;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .header-content {
      max-width: 800px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .btn-back {
      padding: 10px 20px;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: 10px;
      color: #fff;
      cursor: pointer;
      font-family: 'Poppins', sans-serif;
      transition: all 0.3s ease;
    }

    .btn-back:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .logo {
      font-size: 1.5em;
      font-weight: 800;
      background: linear-gradient(135deg, #ffb547 0%, #ff8c42 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Container */
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }

    /* T√≠tulo da p√°gina */
    .page-title {
      text-align: center;
      margin-bottom: 25px;
    }

    .page-title h1 {
      font-size: 1.8em;
      margin-bottom: 5px;
    }

    .page-title p {
      color: #a9b5c6;
    }

    /* Tabs de Categorias */
    .category-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 15px;
      overflow-x: auto;
      padding-bottom: 5px;
      -webkit-overflow-scrolling: touch;
    }

    .category-tabs::-webkit-scrollbar {
      display: none;
    }

    .category-tab {
      padding: 12px 18px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      color: #a9b5c6;
      cursor: pointer;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      font-size: 0.85em;
      white-space: nowrap;
      transition: all 0.3s ease;
    }

    .category-tab:hover {
      border-color: rgba(255, 181, 71, 0.5);
      color: #ffb547;
    }

    .category-tab.active {
      background: linear-gradient(135deg, #ffb547 0%, #ff8c42 100%);
      border-color: transparent;
      color: #0e141b;
    }

    /* Filtros */
    .filters {
      display: flex;
      gap: 8px;
      margin-bottom: 15px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .filter-btn {
      padding: 10px 16px;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 50px;
      color: #a9b5c6;
      cursor: pointer;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      font-size: 0.8em;
      transition: all 0.3s ease;
    }

    .filter-btn:hover {
      border-color: rgba(255, 181, 71, 0.5);
      color: #ffb547;
    }

    .filter-btn.active {
      background: rgba(255, 181, 71, 0.2);
      border-color: #ffb547;
      color: #ffb547;
    }

    /* Filtro de Datas */
    .date-filter {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 20px;
      display: none;
    }

    .date-filter.active {
      display: block;
    }

    .date-filter-title {
      font-size: 0.9em;
      color: #a9b5c6;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .date-inputs {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .date-input-group {
      flex: 1;
      min-width: 130px;
    }

    .date-input-group label {
      display: block;
      font-size: 0.75em;
      color: #6b7280;
      margin-bottom: 5px;
    }

    .date-input-group input {
      width: 100%;
      padding: 10px 12px;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      color: #fff;
      font-family: 'Poppins', sans-serif;
      font-size: 0.9em;
    }

    .date-input-group input:focus {
      outline: none;
      border-color: #ffb547;
    }

    .btn-apply-date {
      padding: 10px 20px;
      background: linear-gradient(135deg, #ffb547 0%, #ff8c42 100%);
      border: none;
      border-radius: 8px;
      color: #0e141b;
      font-family: 'Poppins', sans-serif;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 20px;
    }

    .btn-apply-date:hover {
      transform: scale(1.02);
    }

    .btn-apply-date:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Atalhos de data */
    .date-shortcuts {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }

    .date-shortcut {
      padding: 6px 12px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      color: #a9b5c6;
      font-size: 0.75em;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .date-shortcut:hover {
      background: rgba(255, 181, 71, 0.2);
      border-color: #ffb547;
      color: #ffb547;
    }

    /* Filtro de Time */
    .team-filter {
      width: 100%;
      margin-bottom: 20px;
      display: none;
    }

    .team-filter.active {
      display: block;
    }

    .team-select {
      width: 100%;
      padding: 14px 16px;
      background: rgba(0, 0, 0, 0.3);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      color: #fff;
      font-size: 1em;
      font-family: 'Poppins', sans-serif;
      cursor: pointer;
    }

    .team-select:focus {
      outline: none;
      border-color: #ffb547;
    }

    /* Card de posi√ß√£o do usu√°rio */
    .my-position-card {
      background: linear-gradient(135deg, rgba(255, 181, 71, 0.2) 0%, rgba(255, 140, 66, 0.1) 100%);
      border: 2px solid rgba(255, 181, 71, 0.5);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 25px;
      display: none;
    }

    .my-position-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 15px;
    }

    .my-position-rank {
      font-size: 2.2em;
      font-weight: 800;
      color: #ffb547;
      min-width: 70px;
      text-align: center;
    }

    .my-position-info {
      flex: 1;
    }

    .my-position-name {
      font-weight: 700;
      font-size: 1.1em;
      margin-bottom: 3px;
    }

    .my-position-stats {
      display: flex;
      gap: 15px;
      color: #a9b5c6;
      font-size: 0.85em;
      flex-wrap: wrap;
      align-items: center;
    }

    .my-stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      padding-top: 15px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .my-stat-item {
      text-align: center;
    }

    .my-stat-value {
      font-size: 1.3em;
      font-weight: 800;
      color: #ffb547;
    }

    .my-stat-label {
      font-size: 0.7em;
      color: #a9b5c6;
      text-transform: uppercase;
    }

    /* Ranking Card */
    .ranking-card {
      background: linear-gradient(135deg, rgba(30, 41, 54, 0.9) 0%, rgba(24, 34, 46, 0.9) 100%);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      overflow: hidden;
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    }

    .ranking-header {
      padding: 15px 20px;
      background: rgba(0, 0, 0, 0.2);
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .ranking-title {
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .ranking-period {
      font-size: 0.85em;
      color: #a9b5c6;
    }

    .ranking-list {
      list-style: none;
    }

    .ranking-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      transition: all 0.3s ease;
    }

    .ranking-item:last-child {
      border-bottom: none;
    }

    .ranking-item:hover {
      background: rgba(255, 255, 255, 0.03);
    }

    .ranking-item.highlight {
      background: rgba(255, 181, 71, 0.1);
    }

    .ranking-item.top-1 {
      background: linear-gradient(90deg, rgba(255, 215, 0, 0.15) 0%, transparent 100%);
    }

    .ranking-item.top-2 {
      background: linear-gradient(90deg, rgba(192, 192, 192, 0.1) 0%, transparent 100%);
    }

    .ranking-item.top-3 {
      background: linear-gradient(90deg, rgba(205, 127, 50, 0.1) 0%, transparent 100%);
    }

    .rank-position {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 1em;
      background: rgba(255, 255, 255, 0.1);
      flex-shrink: 0;
    }

    .rank-position.gold {
      background: linear-gradient(135deg, #FFD700, #FFA500);
      color: #000;
    }

    .rank-position.silver {
      background: linear-gradient(135deg, #C0C0C0, #A8A8A8);
      color: #000;
    }

    .rank-position.bronze {
      background: linear-gradient(135deg, #CD7F32, #8B4513);
      color: #fff;
    }

    .rank-avatar {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1em;
      flex-shrink: 0;
    }

    .rank-info {
      flex: 1;
      min-width: 0;
    }

    .rank-name {
      font-weight: 600;
      margin-bottom: 2px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.95em;
    }

    .rank-team {
      font-size: 0.75em;
      color: #a9b5c6;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .rank-details {
      font-size: 0.7em;
      color: #6b7280;
      display: flex;
      gap: 8px;
    }

    .rank-level {
      font-size: 0.7em;
      padding: 2px 6px;
      border-radius: 8px;
      font-weight: 600;
    }

    .level-bronze { background: rgba(205, 127, 50, 0.2); color: #CD7F32; }
    .level-prata { background: rgba(192, 192, 192, 0.2); color: #C0C0C0; }
    .level-ouro { background: rgba(255, 215, 0, 0.2); color: #FFD700; }
    .level-diamante { background: rgba(185, 242, 255, 0.2); color: #B9F2FF; }
    .level-mestre { background: rgba(138, 43, 226, 0.2); color: #9B59B6; }

    .rank-stats {
      text-align: right;
      min-width: 80px;
    }

    .rank-xp {
      font-weight: 700;
      font-size: 1em;
      color: #ffb547;
    }

    .rank-secondary {
      font-size: 0.7em;
      color: #a9b5c6;
    }

    /* P√≥dio */
    .podium {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      gap: 10px;
      margin-bottom: 30px;
      padding: 20px;
    }

    .podium-item {
      text-align: center;
      transition: transform 0.3s ease;
    }

    .podium-item:hover {
      transform: translateY(-5px);
    }

    .podium-avatar {
      width: 55px;
      height: 55px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1.2em;
      margin: 0 auto 8px;
      border: 3px solid;
    }

    .podium-1 .podium-avatar {
      width: 70px;
      height: 70px;
      font-size: 1.4em;
      border-color: #FFD700;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
    }

    .podium-2 .podium-avatar {
      border-color: #C0C0C0;
    }

    .podium-3 .podium-avatar {
      border-color: #CD7F32;
    }

    .podium-name {
      font-weight: 600;
      font-size: 0.85em;
      margin-bottom: 3px;
      max-width: 80px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .podium-xp {
      color: #ffb547;
      font-weight: 700;
      font-size: 0.9em;
    }

    .podium-base {
      width: 70px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 1.3em;
      border-radius: 8px 8px 0 0;
      margin-top: 8px;
    }

    .podium-1 .podium-base {
      height: 90px;
      background: linear-gradient(180deg, #FFD700, #FFA500);
      color: #000;
      width: 85px;
    }

    .podium-2 .podium-base {
      height: 65px;
      background: linear-gradient(180deg, #C0C0C0, #A8A8A8);
      color: #000;
    }

    .podium-3 .podium-base {
      height: 45px;
      background: linear-gradient(180deg, #CD7F32, #8B4513);
      color: #fff;
    }

    /* Ranking de Times */
    .team-ranking-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 16px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .team-ranking-item:last-child {
      border-bottom: none;
    }

    .team-badge {
      width: 50px;
      height: 50px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5em;
      background: rgba(255, 255, 255, 0.1);
    }

    .team-info {
      flex: 1;
    }

    .team-name {
      font-weight: 700;
      font-size: 1em;
      margin-bottom: 3px;
    }

    .team-stats-row {
      font-size: 0.8em;
      color: #a9b5c6;
      display: flex;
      gap: 15px;
    }

    .team-stat {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .team-main-stat {
      text-align: right;
    }

    .team-main-value {
      font-weight: 800;
      font-size: 1.2em;
      color: #ffb547;
    }

    .team-main-label {
      font-size: 0.7em;
      color: #6b7280;
    }

    /* Empty state */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #a9b5c6;
    }

    .empty-icon {
      font-size: 4em;
      margin-bottom: 20px;
    }

    /* Loading */
    .loading {
      text-align: center;
      padding: 40px;
      color: #a9b5c6;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(255, 181, 71, 0.3);
      border-top-color: #ffb547;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 15px 30px;
      border-radius: 50px;
      font-weight: 600;
      z-index: 2000;
      opacity: 0;
      transition: all 0.3s ease;
    }

    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    /* Info Banner */
    .info-banner {
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 12px;
      padding: 12px 16px;
      margin-bottom: 20px;
      display: none;
      align-items: center;
      gap: 10px;
      font-size: 0.85em;
    }

    .info-banner.active {
      display: flex;
    }

    .info-banner-icon {
      font-size: 1.2em;
    }

    .info-banner-text {
      color: #a9b5c6;
    }

    /* Bottom Nav */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(14, 20, 27, 0.98);
      backdrop-filter: blur(20px);
      padding: 10px 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      z-index: 99;
    }

    .nav-content {
      max-width: 600px;
      margin: 0 auto;
      display: flex;
      justify-content: space-around;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
      color: #a9b5c6;
      text-decoration: none;
      font-size: 0.75em;
      transition: all 0.3s ease;
    }

    .nav-item:hover, .nav-item.active {
      color: #ffb547;
    }

    .nav-icon {
      font-size: 1.5em;
    }

    @media (max-width: 600px) {
      .podium {
        gap: 5px;
      }

      .podium-base {
        width: 55px !important;
      }

      .podium-1 .podium-base {
        width: 65px !important;
      }

      .my-stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .date-inputs {
        flex-direction: column;
      }

      .date-input-group {
        width: 100%;
      }
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <button class="btn-back" onclick="window.location.href='painel.html'">‚Üê Voltar</button>
      <div class="logo">‚öΩ Yellup</div>
      <div style="width: 80px;"></div>
    </div>
  </header>

  <!-- Container -->
  <div class="container">
    
    <div class="page-title">
      <h1>üèÜ Rankings</h1>
      <p>Os melhores jogadores do Yellup</p>
    </div>

    <!-- Tabs de Categoria -->
    <div class="category-tabs">
      <button class="category-tab active" data-category="xp" onclick="trocarCategoria('xp')">‚≠ê XP</button>
      <button class="category-tab" data-category="creditos" onclick="trocarCategoria('creditos')">üí∞ Cr√©ditos</button>
      <button class="category-tab" data-category="times" onclick="trocarCategoria('times')">‚öΩ Times</button>
    </div>

    <!-- Filtros XP -->
    <div class="filters" id="xpFilters">
      <button class="filter-btn active" data-filter="geral" onclick="trocarFiltroXP('geral')">üåç Geral</button>
      <button class="filter-btn" data-filter="periodo" onclick="trocarFiltroXP('periodo')">üìÖ Por Per√≠odo</button>
      <button class="filter-btn" data-filter="clube" onclick="trocarFiltroXP('clube')">üèüÔ∏è Por Clube</button>
    </div>

    <!-- Filtros Cr√©ditos -->
    <div class="filters" id="creditosFilters" style="display: none;">
      <button class="filter-btn active" data-filter="saldo" onclick="trocarFiltroCreditos('saldo')">üíé Saldo Atual</button>
      <button class="filter-btn" data-filter="ganhos" onclick="trocarFiltroCreditos('ganhos')">üìà Mais Ganhos</button>
    </div>

    <!-- Filtros Times -->
    <div class="filters" id="timesFilters" style="display: none;">
      <button class="filter-btn active" data-filter="torcedores" onclick="trocarFiltroTimes('torcedores')">üë• Mais Torcedores</button>
      <button class="filter-btn" data-filter="xpTotal" onclick="trocarFiltroTimes('xpTotal')">‚≠ê Mais XP</button>
      <button class="filter-btn" data-filter="ativos" onclick="trocarFiltroTimes('ativos')">üéÆ Mais Ativos</button>
    </div>

    <!-- Filtro de Per√≠odo -->
    <div class="date-filter" id="dateFilter">
      <div class="date-filter-title">üìÖ Selecione o per√≠odo</div>
      
      <div class="date-shortcuts">
        <button class="date-shortcut" onclick="aplicarAtalhoData('hoje')">Hoje</button>
        <button class="date-shortcut" onclick="aplicarAtalhoData('semana')">Esta Semana</button>
        <button class="date-shortcut" onclick="aplicarAtalhoData('mes')">Este M√™s</button>
        <button class="date-shortcut" onclick="aplicarAtalhoData('mesPassado')">M√™s Passado</button>
        <button class="date-shortcut" onclick="aplicarAtalhoData('ano')">Este Ano</button>
      </div>
      
      <div class="date-inputs">
        <div class="date-input-group">
          <label>Data In√≠cio</label>
          <input type="date" id="dataInicio" onchange="validarDatas()">
        </div>
        <div class="date-input-group">
          <label>Data Fim</label>
          <input type="date" id="dataFim" onchange="validarDatas()">
        </div>
      </div>
      
      <button class="btn-apply-date" id="btnAplicarData" onclick="aplicarFiltroPeriodo()" disabled>
        üîç Buscar Ranking do Per√≠odo
      </button>
    </div>

    <!-- Filtro de Time -->
    <div class="team-filter" id="teamFilter">
      <select class="team-select" id="teamSelect" onchange="carregarRankingPorClube()">
        <option value="">Selecione um time...</option>
      </select>
    </div>

    <!-- Info Banner -->
    <div class="info-banner" id="infoBanner">
      <span class="info-banner-icon">‚ÑπÔ∏è</span>
      <span class="info-banner-text" id="infoBannerText"></span>
    </div>

    <!-- Minha posi√ß√£o -->
    <div class="my-position-card" id="myPositionCard">
      <div class="my-position-header">
        <div class="my-position-rank" id="myRank">-</div>
        <div class="my-position-info">
          <div class="my-position-name" id="myName">Carregando...</div>
          <div class="my-position-stats">
            <span id="myMainStat">0 XP</span>
            <span>‚Ä¢</span>
            <span id="myLevelBadge" class="rank-level level-bronze">ü•â Bronze</span>
          </div>
        </div>
      </div>
      <div class="my-stats-grid">
        <div class="my-stat-item">
          <div class="my-stat-value" id="myStat1">0</div>
          <div class="my-stat-label" id="myStat1Label">XP Total</div>
        </div>
        <div class="my-stat-item">
          <div class="my-stat-value" id="myStat2">0</div>
          <div class="my-stat-label" id="myStat2Label">Cr√©ditos</div>
        </div>
        <div class="my-stat-item">
          <div class="my-stat-value" id="myStat3">0</div>
          <div class="my-stat-label" id="myStat3Label">Partidas</div>
        </div>
        <div class="my-stat-item">
          <div class="my-stat-value" id="myStat4">0</div>
          <div class="my-stat-label" id="myStat4Label">Vit√≥rias PVP</div>
        </div>
      </div>
    </div>

    <!-- P√≥dio -->
    <div class="podium" id="podium" style="display: none;">
      <div class="podium-item podium-2" id="podium2">
        <div class="podium-avatar" style="background: #C0C0C0;">2</div>
        <div class="podium-name">-</div>
        <div class="podium-xp">0</div>
        <div class="podium-base">ü•à</div>
      </div>
      <div class="podium-item podium-1" id="podium1">
        <div class="podium-avatar" style="background: #FFD700;">1</div>
        <div class="podium-name">-</div>
        <div class="podium-xp">0</div>
        <div class="podium-base">ü•á</div>
      </div>
      <div class="podium-item podium-3" id="podium3">
        <div class="podium-avatar" style="background: #CD7F32;">3</div>
        <div class="podium-name">-</div>
        <div class="podium-xp">0</div>
        <div class="podium-base">ü•â</div>
      </div>
    </div>

    <!-- Ranking Card -->
    <div class="ranking-card">
      <div class="ranking-header">
        <div class="ranking-title">
          <span>üìä</span>
          <span id="rankingTitleText">Top 50 - XP Geral</span>
        </div>
        <div class="ranking-period" id="rankingPeriod">Todos os tempos</div>
      </div>
      <ul class="ranking-list" id="rankingList">
        <div class="loading">
          <div class="loading-spinner"></div>
          <p>Carregando ranking...</p>
        </div>
      </ul>
    </div>

  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <!-- Bottom Nav -->
  <nav class="bottom-nav">
    <div class="nav-content">
      <a href="painel.html" class="nav-item"><span class="nav-icon">üè†</span><span>In√≠cio</span></a>
      <a href="ranking-geral.html" class="nav-item active"><span class="nav-icon">üèÜ</span><span>Ranking</span></a>
      <a href="indicacoes.html" class="nav-item"><span class="nav-icon">üîó</span><span>Indicar</span></a>
      <a href="editar-perfil.html" class="nav-item"><span class="nav-icon">üë§</span><span>Perfil</span></a>
    </div>
  </nav>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    // ===================================
    // üî• CONFIGURA√á√ÉO FIREBASE
    // ===================================
    const firebaseConfig = {
      apiKey: "AIzaSyC5ZrkEy7KuCFJOtPvI7-P-JcA0MF4im5c",
      authDomain: "painel-yellup.firebaseapp.com",
      projectId: "painel-yellup",
      storageBucket: "painel-yellup.appspot.com",
      messagingSenderId: "608347210297",
      appId: "1:608347210297:web:75092713724e617c7203e8"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // ===================================
    // üì¶ VARI√ÅVEIS GLOBAIS
    // ===================================
    let currentUserId = null;
    let currentUserData = null;
    let categoriaAtual = 'xp';
    let filtroXPAtual = 'geral';
    let filtroCreditosAtual = 'saldo';
    let filtroTimesAtual = 'torcedores';
    let timesCache = {};
    let usuariosCache = [];

    // ===================================
    // üéñÔ∏è SISTEMA DE N√çVEIS
    // ===================================
    const NIVEIS = [
      { nome: 'Bronze', minXP: 0, classe: 'level-bronze', emoji: 'ü•â' },
      { nome: 'Prata', minXP: 500, classe: 'level-prata', emoji: 'ü•à' },
      { nome: 'Ouro', minXP: 2000, classe: 'level-ouro', emoji: 'ü•á' },
      { nome: 'Diamante', minXP: 5000, classe: 'level-diamante', emoji: 'üíé' },
      { nome: 'Mestre', minXP: 10000, classe: 'level-mestre', emoji: 'üëë' }
    ];

    function calcularNivel(xp) {
      let nivel = NIVEIS[0];
      for (const n of NIVEIS) {
        if (xp >= n.minXP) nivel = n;
      }
      return nivel;
    }

    function formatarNumero(num) {
      if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
      if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
      return num.toString();
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // ===================================
    // üîê AUTENTICA√á√ÉO
    // ===================================
    auth.onAuthStateChanged(async (user) => {
      if (!user) {
        window.location.href = 'index.html';
        return;
      }

      currentUserId = user.uid;

      try {
        const userDoc = await db.collection('usuarios').doc(currentUserId).get();
        if (userDoc.exists) {
          currentUserData = userDoc.data();
        }

        await carregarTimes();
        await carregarTodosUsuarios();
        await carregarRanking();

      } catch (error) {
        console.error("Erro:", error);
        showToast('‚ùå Erro ao carregar dados');
      }
    });

    // ===================================
    // ‚öΩ CARREGAR TIMES
    // ===================================
    async function carregarTimes() {
      try {
        const snapshot = await db.collection('times').orderBy('nome').get();
        const select = document.getElementById('teamSelect');
        
        snapshot.forEach(doc => {
          const time = doc.data();
          timesCache[doc.id] = time;
          select.innerHTML += `<option value="${doc.id}">${time.nome}</option>`;
        });
      } catch (error) {
        console.error("Erro ao carregar times:", error);
      }
    }

    // ===================================
    // üë• CARREGAR TODOS USU√ÅRIOS (CACHE)
    // ===================================
    async function carregarTodosUsuarios() {
      try {
        const snapshot = await db.collection('usuarios').get();
        usuariosCache = [];
        snapshot.forEach(doc => {
          usuariosCache.push({ id: doc.id, ...doc.data() });
        });
        console.log(`‚úÖ ${usuariosCache.length} usu√°rios carregados em cache`);
      } catch (error) {
        console.error("Erro ao carregar usu√°rios:", error);
      }
    }

    // ===================================
    // üîÑ TROCAR CATEGORIA
    // ===================================
    function trocarCategoria(categoria) {
      categoriaAtual = categoria;

      // Atualizar tabs
      document.querySelectorAll('.category-tab').forEach(tab => {
        tab.classList.toggle('active', tab.dataset.category === categoria);
      });

      // Mostrar/ocultar filtros
      document.getElementById('xpFilters').style.display = categoria === 'xp' ? 'flex' : 'none';
      document.getElementById('creditosFilters').style.display = categoria === 'creditos' ? 'flex' : 'none';
      document.getElementById('timesFilters').style.display = categoria === 'times' ? 'flex' : 'none';
      
      document.getElementById('dateFilter').classList.remove('active');
      document.getElementById('teamFilter').classList.remove('active');
      document.getElementById('infoBanner').classList.remove('active');

      carregarRanking();
    }

    // ===================================
    // üîÑ TROCAR FILTRO XP
    // ===================================
    function trocarFiltroXP(filtro) {
      filtroXPAtual = filtro;

      document.querySelectorAll('#xpFilters .filter-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.filter === filtro);
      });

      document.getElementById('dateFilter').classList.toggle('active', filtro === 'periodo');
      document.getElementById('teamFilter').classList.toggle('active', filtro === 'clube');

      if (filtro === 'geral') {
        carregarRanking();
      }
    }

    // ===================================
    // üîÑ TROCAR FILTRO CR√âDITOS
    // ===================================
    function trocarFiltroCreditos(filtro) {
      filtroCreditosAtual = filtro;

      document.querySelectorAll('#creditosFilters .filter-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.filter === filtro);
      });

      carregarRanking();
    }

    // ===================================
    // üîÑ TROCAR FILTRO TIMES
    // ===================================
    function trocarFiltroTimes(filtro) {
      filtroTimesAtual = filtro;

      document.querySelectorAll('#timesFilters .filter-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.filter === filtro);
      });

      carregarRanking();
    }

    // ===================================
    // üìÖ ATALHOS DE DATA
    // ===================================
    function aplicarAtalhoData(tipo) {
      const hoje = new Date();
      let inicio, fim;

      switch(tipo) {
        case 'hoje':
          inicio = new Date(hoje.getFullYear(), hoje.getMonth(), hoje.getDate());
          fim = new Date(hoje.getFullYear(), hoje.getMonth(), hoje.getDate(), 23, 59, 59);
          break;
        case 'semana':
          const diaSemana = hoje.getDay();
          inicio = new Date(hoje);
          inicio.setDate(hoje.getDate() - diaSemana);
          inicio.setHours(0, 0, 0, 0);
          fim = hoje;
          break;
        case 'mes':
          inicio = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
          fim = hoje;
          break;
        case 'mesPassado':
          inicio = new Date(hoje.getFullYear(), hoje.getMonth() - 1, 1);
          fim = new Date(hoje.getFullYear(), hoje.getMonth(), 0, 23, 59, 59);
          break;
        case 'ano':
          inicio = new Date(hoje.getFullYear(), 0, 1);
          fim = hoje;
          break;
      }

      document.getElementById('dataInicio').value = inicio.toISOString().split('T')[0];
      document.getElementById('dataFim').value = fim.toISOString().split('T')[0];
      validarDatas();
    }

    function validarDatas() {
      const inicio = document.getElementById('dataInicio').value;
      const fim = document.getElementById('dataFim').value;
      const btn = document.getElementById('btnAplicarData');
      
      btn.disabled = !(inicio && fim && new Date(inicio) <= new Date(fim));
    }

    // ===================================
    // üìÖ APLICAR FILTRO DE PER√çODO
    // ===================================
    async function aplicarFiltroPeriodo() {
      const dataInicio = new Date(document.getElementById('dataInicio').value);
      dataInicio.setHours(0, 0, 0, 0);
      
      const dataFim = new Date(document.getElementById('dataFim').value);
      dataFim.setHours(23, 59, 59, 999);

      const lista = document.getElementById('rankingList');
      const titleText = document.getElementById('rankingTitleText');
      const periodText = document.getElementById('rankingPeriod');
      const infoBanner = document.getElementById('infoBanner');

      titleText.textContent = 'Top 50 - XP por Per√≠odo';
      periodText.textContent = `${dataInicio.toLocaleDateString('pt-BR')} a ${dataFim.toLocaleDateString('pt-BR')}`;
      
      infoBanner.classList.add('active');
      document.getElementById('infoBannerText').textContent = `Buscando pontos ganhos em embates...`;

      lista.innerHTML = `
        <div class="loading">
          <div class="loading-spinner"></div>
          <p>Calculando ranking do per√≠odo...</p>
        </div>
      `;

      try {
        // Agregar pontos por usu√°rio
        const pontosPorUsuario = {};
        
        // Buscar embates finalizados no per√≠odo
        const embatesSnap = await db.collection('embates')
          .where('status', '==', 'finalizado')
          .where('dataFinalizacao', '>=', dataInicio)
          .where('dataFinalizacao', '<=', dataFim)
          .get();

        console.log(`üìÖ Encontrados ${embatesSnap.size} embates no per√≠odo`);

        // Buscar participa√ß√µes de cada embate
        for (const embateDoc of embatesSnap.docs) {
          const participacoesSnap = await db.collection('embates').doc(embateDoc.id)
            .collection('participacoes').get();
          
          participacoesSnap.forEach(partDoc => {
            const part = partDoc.data();
            const odId = partDoc.id;
            const pontos = part.pontos || 0;
            
            if (!pontosPorUsuario[odId]) {
              pontosPorUsuario[odId] = {
                pontos: 0,
                embates: 0,
                vitorias: 0
              };
            }
            pontosPorUsuario[odId].pontos += pontos;
            pontosPorUsuario[odId].embates++;
          });
          
          // Contar vit√≥ria
          const embateData = embateDoc.data();
          if (embateData.resultado?.vencedorId) {
            if (pontosPorUsuario[embateData.resultado.vencedorId]) {
              pontosPorUsuario[embateData.resultado.vencedorId].vitorias++;
            }
          }
        }

        // Criar array ordenado
        let ranking = Object.entries(pontosPorUsuario)
          .map(([id, dados]) => {
            const usuario = usuariosCache.find(u => u.id === id);
            return {
              id,
              xpPeriodo: dados.pontos,
              embatesPeriodo: dados.embates,
              vitoriasPeriodo: dados.vitorias,
              ...(usuario || {})
            };
          })
          .filter(u => u.usuarioUnico) // Filtrar usu√°rios v√°lidos
          .sort((a, b) => b.xpPeriodo - a.xpPeriodo)
          .slice(0, 50);

        if (ranking.length === 0) {
          lista.innerHTML = `
            <div class="empty-state">
              <div class="empty-icon">üìÖ</div>
              <p>Nenhum embate finalizado neste per√≠odo</p>
              <small style="color: #6b7280;">Tente selecionar um per√≠odo diferente</small>
            </div>
          `;
          document.getElementById('podium').style.display = 'none';
          document.getElementById('myPositionCard').style.display = 'none';
          infoBanner.classList.remove('active');
          return;
        }

        document.getElementById('infoBannerText').textContent = `${embatesSnap.size} embates ‚Ä¢ ${ranking.length} jogadores no per√≠odo`;
        renderizarRankingPeriodo(ranking);

      } catch (error) {
        console.error("Erro ao buscar ranking por per√≠odo:", error);
        lista.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">‚ö†Ô∏è</div>
            <p>Erro ao calcular ranking</p>
            <small style="color: #6b7280;">${error.message}</small>
          </div>
        `;
        infoBanner.classList.remove('active');
      }
    }

    // ===================================
    // üé® RENDERIZAR RANKING POR PER√çODO
    // ===================================
    function renderizarRankingPeriodo(usuarios) {
      const lista = document.getElementById('rankingList');
      const podium = document.getElementById('podium');
      const myCard = document.getElementById('myPositionCard');

      // Encontrar minha posi√ß√£o
      const minhaPosicao = usuarios.findIndex(u => u.id === currentUserId) + 1;
      const meusDados = usuarios.find(u => u.id === currentUserId);
      
      // Atualizar meu card com dados DO PER√çODO
      if (meusDados) {
        myCard.style.display = 'block';
        document.getElementById('myRank').textContent = `${minhaPosicao}¬∫`;
        document.getElementById('myName').textContent = meusDados.usuarioUnico || 'Voc√™';
        document.getElementById('myMainStat').textContent = `${formatarNumero(meusDados.xpPeriodo)} pts no per√≠odo`;
        
        const nivel = calcularNivel(meusDados.xp || 0);
        const badge = document.getElementById('myLevelBadge');
        badge.className = `rank-level ${nivel.classe}`;
        badge.textContent = `${nivel.emoji} ${nivel.nome}`;

        document.getElementById('myStat1').textContent = formatarNumero(meusDados.xpPeriodo);
        document.getElementById('myStat1Label').textContent = 'Pts Per√≠odo';
        document.getElementById('myStat2').textContent = meusDados.embatesPeriodo || 0;
        document.getElementById('myStat2Label').textContent = 'Embates';
        document.getElementById('myStat3').textContent = meusDados.vitoriasPeriodo || 0;
        document.getElementById('myStat3Label').textContent = 'Vit√≥rias';
        document.getElementById('myStat4').textContent = formatarNumero(meusDados.xp || 0);
        document.getElementById('myStat4Label').textContent = 'XP Total';
      } else if (currentUserData) {
        myCard.style.display = 'block';
        document.getElementById('myRank').textContent = '-';
        document.getElementById('myName').textContent = currentUserData.usuarioUnico || 'Voc√™';
        document.getElementById('myMainStat').textContent = '0 pts no per√≠odo';
        
        document.getElementById('myStat1').textContent = '0';
        document.getElementById('myStat1Label').textContent = 'Pts Per√≠odo';
        document.getElementById('myStat2').textContent = '0';
        document.getElementById('myStat2Label').textContent = 'Embates';
        document.getElementById('myStat3').textContent = '0';
        document.getElementById('myStat3Label').textContent = 'Vit√≥rias';
        document.getElementById('myStat4').textContent = formatarNumero(currentUserData.xp || 0);
        document.getElementById('myStat4Label').textContent = 'XP Total';
      } else {
        myCard.style.display = 'none';
      }

      // P√≥dio com dados do PER√çODO
      if (usuarios.length >= 3) {
        podium.style.display = 'flex';
        for (let i = 1; i <= 3; i++) {
          const user = usuarios[i - 1];
          const nome = user.usuarioUnico || 'An√¥nimo';
          
          const podiumItem = document.getElementById(`podium${i}`);
          podiumItem.querySelector('.podium-avatar').textContent = nome.charAt(0).toUpperCase();
          podiumItem.querySelector('.podium-name').textContent = nome;
          podiumItem.querySelector('.podium-xp').textContent = `${formatarNumero(user.xpPeriodo)} pts`;
        }
      } else {
        podium.style.display = 'none';
      }

      // Lista
      const listaRender = usuarios.length >= 4 ? usuarios.slice(3) : usuarios;
      
      if (listaRender.length === 0) {
        lista.innerHTML = '';
        return;
      }

      const cores = {
        'level-bronze': 'linear-gradient(135deg, #CD7F32, #8B4513)',
        'level-prata': 'linear-gradient(135deg, #C0C0C0, #A8A8A8)',
        'level-ouro': 'linear-gradient(135deg, #FFD700, #FFA500)',
        'level-diamante': 'linear-gradient(135deg, #B9F2FF, #87CEEB)',
        'level-mestre': 'linear-gradient(135deg, #9B59B6, #8E44AD)'
      };

      lista.innerHTML = listaRender.map((user, index) => {
        const posicao = usuarios.length >= 4 ? index + 4 : index + 1;
        const nome = user.usuarioUnico || 'An√¥nimo';
        const nivel = calcularNivel(user.xp || 0);
        const time = timesCache[user.timeId];
        const isMe = user.id === currentUserId;
        const posClass = posicao === 1 ? 'gold' : posicao === 2 ? 'silver' : posicao === 3 ? 'bronze' : '';
        const rowClass = posicao <= 3 ? `top-${posicao}` : '';

        return `
          <li class="ranking-item ${rowClass} ${isMe ? 'highlight' : ''}">
            <div class="rank-position ${posClass}">${posicao}</div>
            <div class="rank-avatar" style="background: ${cores[nivel.classe] || 'linear-gradient(135deg, #666, #444)'}">${nome.charAt(0).toUpperCase()}</div>
            <div class="rank-info">
              <div class="rank-name">${nome}<span class="rank-level ${nivel.classe}">${nivel.emoji}</span></div>
              <div class="rank-team">${time?.nome || 'Sem time'}</div>
              <div class="rank-details">
                <span>‚öîÔ∏è ${user.embatesPeriodo || 0} embates</span>
                <span>üèÜ ${user.vitoriasPeriodo || 0} vit√≥rias</span>
              </div>
            </div>
            <div class="rank-stats">
              <div class="rank-xp">${formatarNumero(user.xpPeriodo)}</div>
              <div class="rank-secondary">pts per√≠odo</div>
            </div>
          </li>
        `;
      }).join('');
    }

    // ===================================
    // üìä CARREGAR RANKING PRINCIPAL
    // ===================================
    async function carregarRanking() {
      if (categoriaAtual === 'xp') {
        if (filtroXPAtual === 'geral') {
          await carregarRankingXPGeral();
        }
        // periodo e clube s√£o tratados por fun√ß√µes espec√≠ficas
      } else if (categoriaAtual === 'creditos') {
        await carregarRankingCreditos();
      } else if (categoriaAtual === 'times') {
        await carregarRankingTimes();
      }
    }

    // ===================================
    // ‚≠ê RANKING XP GERAL
    // ===================================
    async function carregarRankingXPGeral() {
      const lista = document.getElementById('rankingList');
      const titleText = document.getElementById('rankingTitleText');
      const periodText = document.getElementById('rankingPeriod');

      titleText.textContent = 'Top 50 - XP Geral';
      periodText.textContent = 'Todos os tempos';
      document.getElementById('infoBanner').classList.remove('active');

      lista.innerHTML = `
        <div class="loading">
          <div class="loading-spinner"></div>
          <p>Carregando ranking...</p>
        </div>
      `;

      try {
        // Usar cache e ordenar
        let ranking = [...usuariosCache]
          .sort((a, b) => (b.xp || 0) - (a.xp || 0))
          .slice(0, 50)
          .map(u => ({ ...u, xpExibir: u.xp || 0 }));

        if (ranking.length === 0) {
          lista.innerHTML = `
            <div class="empty-state">
              <div class="empty-icon">üèÜ</div>
              <p>Nenhum jogador encontrado</p>
            </div>
          `;
          return;
        }

        renderizarRankingXP(ranking, 'xpExibir');

      } catch (error) {
        console.error("Erro:", error);
        lista.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">‚ö†Ô∏è</div>
            <p>Erro ao carregar ranking</p>
          </div>
        `;
      }
    }

    // ===================================
    // üèüÔ∏è RANKING POR CLUBE
    // ===================================
    async function carregarRankingPorClube() {
      const timeId = document.getElementById('teamSelect').value;
      if (!timeId) return;

      const lista = document.getElementById('rankingList');
      const titleText = document.getElementById('rankingTitleText');
      const periodText = document.getElementById('rankingPeriod');

      const time = timesCache[timeId];
      titleText.textContent = `Top 50 - ${time?.nome || 'Clube'}`;
      periodText.textContent = 'Torcedores deste time';

      lista.innerHTML = `
        <div class="loading">
          <div class="loading-spinner"></div>
          <p>Carregando ranking...</p>
        </div>
      `;

      try {
        // Filtrar do cache
        let ranking = usuariosCache
          .filter(u => u.timeId === timeId)
          .sort((a, b) => (b.xp || 0) - (a.xp || 0))
          .slice(0, 50)
          .map(u => ({ ...u, xpExibir: u.xp || 0 }));

        if (ranking.length === 0) {
          lista.innerHTML = `
            <div class="empty-state">
              <div class="empty-icon">‚öΩ</div>
              <p>Nenhum torcedor encontrado para este time</p>
            </div>
          `;
          document.getElementById('podium').style.display = 'none';
          document.getElementById('myPositionCard').style.display = 'none';
          return;
        }

        renderizarRankingXP(ranking, 'xpExibir');

      } catch (error) {
        console.error("Erro:", error);
        lista.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">‚ö†Ô∏è</div>
            <p>Erro ao carregar ranking</p>
          </div>
        `;
      }
    }

    // ===================================
    // üí∞ RANKING DE CR√âDITOS
    // ===================================
    async function carregarRankingCreditos() {
      const lista = document.getElementById('rankingList');
      const titleText = document.getElementById('rankingTitleText');
      const periodText = document.getElementById('rankingPeriod');

      let campo = 'creditos';
      let label = 'Saldo Atual';

      if (filtroCreditosAtual === 'ganhos') {
        campo = 'pvp.creditosGanhos';
        label = 'Cr√©ditos Ganhos';
      }

      titleText.textContent = `Top 50 - ${label}`;
      periodText.textContent = filtroCreditosAtual === 'saldo' ? 'Quem tem mais cr√©ditos' : 'Quem mais ganhou em embates';

      lista.innerHTML = `
        <div class="loading">
          <div class="loading-spinner"></div>
          <p>Carregando ranking...</p>
        </div>
      `;

      try {
        let ranking = [...usuariosCache];

        if (filtroCreditosAtual === 'saldo') {
          ranking = ranking
            .sort((a, b) => (b.creditos || 0) - (a.creditos || 0))
            .slice(0, 50)
            .map(u => ({ ...u, valorExibir: u.creditos || 0 }));
        } else {
          ranking = ranking
            .sort((a, b) => (b.pvp?.creditosGanhos || 0) - (a.pvp?.creditosGanhos || 0))
            .slice(0, 50)
            .map(u => ({ ...u, valorExibir: u.pvp?.creditosGanhos || 0 }));
        }

        if (ranking.length === 0 || ranking[0].valorExibir === 0) {
          lista.innerHTML = `
            <div class="empty-state">
              <div class="empty-icon">üí∞</div>
              <p>Nenhum jogador com cr√©ditos encontrado</p>
            </div>
          `;
          document.getElementById('podium').style.display = 'none';
          document.getElementById('myPositionCard').style.display = 'none';
          return;
        }

        renderizarRankingCreditos(ranking);

      } catch (error) {
        console.error("Erro:", error);
        lista.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">‚ö†Ô∏è</div>
            <p>Erro ao carregar ranking</p>
          </div>
        `;
      }
    }

    // ===================================
    // ‚öΩ RANKING DE TIMES
    // ===================================
    async function carregarRankingTimes() {
      const lista = document.getElementById('rankingList');
      const titleText = document.getElementById('rankingTitleText');
      const periodText = document.getElementById('rankingPeriod');

      let label = 'Mais Torcedores';
      let periodo = 'Times com mais usu√°rios cadastrados';

      if (filtroTimesAtual === 'xpTotal') {
        label = 'Mais XP';
        periodo = 'Times com mais XP acumulado';
      } else if (filtroTimesAtual === 'ativos') {
        label = 'Mais Ativos';
        periodo = 'Times com mais jogadores ativos';
      }

      titleText.textContent = `Ranking de Times - ${label}`;
      periodText.textContent = periodo;
      
      document.getElementById('podium').style.display = 'none';
      document.getElementById('myPositionCard').style.display = 'none';

      lista.innerHTML = `
        <div class="loading">
          <div class="loading-spinner"></div>
          <p>Calculando ranking de times...</p>
        </div>
      `;

      try {
        // Agregar dados por time
        const timesData = {};

        usuariosCache.forEach(u => {
          const timeId = u.timeId;
          if (!timeId || !timesCache[timeId]) return;

          if (!timesData[timeId]) {
            timesData[timeId] = {
              timeId,
              nome: timesCache[timeId]?.nome || 'Desconhecido',
              totalTorcedores: 0,
              xpTotal: 0,
              ativos: 0, // usu√°rios com XP > 0
              creditosTotal: 0,
              vitoriasPVP: 0
            };
          }

          timesData[timeId].totalTorcedores++;
          timesData[timeId].xpTotal += u.xp || 0;
          timesData[timeId].creditosTotal += u.creditos || 0;
          timesData[timeId].vitoriasPVP += u.pvp?.vitorias || 0;
          
          if ((u.xp || 0) > 0 || (u.totalPartidas || 0) > 0) {
            timesData[timeId].ativos++;
          }
        });

        let ranking = Object.values(timesData);

        // Ordenar baseado no filtro
        if (filtroTimesAtual === 'torcedores') {
          ranking.sort((a, b) => b.totalTorcedores - a.totalTorcedores);
        } else if (filtroTimesAtual === 'xpTotal') {
          ranking.sort((a, b) => b.xpTotal - a.xpTotal);
        } else if (filtroTimesAtual === 'ativos') {
          ranking.sort((a, b) => b.ativos - a.ativos);
        }

        ranking = ranking.slice(0, 30);

        if (ranking.length === 0) {
          lista.innerHTML = `
            <div class="empty-state">
              <div class="empty-icon">‚öΩ</div>
              <p>Nenhum time encontrado</p>
            </div>
          `;
          return;
        }

        renderizarRankingTimes(ranking);

      } catch (error) {
        console.error("Erro:", error);
        lista.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">‚ö†Ô∏è</div>
            <p>Erro ao carregar ranking de times</p>
          </div>
        `;
      }
    }

    // ===================================
    // üé® RENDERIZAR RANKING XP
    // ===================================
    function renderizarRankingXP(usuarios, campoValor) {
      const lista = document.getElementById('rankingList');
      const podium = document.getElementById('podium');
      const myCard = document.getElementById('myPositionCard');

      // Encontrar minha posi√ß√£o
      let minhaPosicao = usuarios.findIndex(u => u.id === currentUserId) + 1;
      
      // Atualizar meu card
      if (currentUserData) {
        myCard.style.display = 'block';
        
        if (minhaPosicao > 0) {
          document.getElementById('myRank').textContent = `${minhaPosicao}¬∫`;
        } else {
          // Estimar posi√ß√£o
          const meuValor = currentUserData[campoValor] || currentUserData.xp || 0;
          const maiores = usuarios.filter(u => (u[campoValor] || 0) > meuValor).length;
          document.getElementById('myRank').textContent = `~${maiores + 1}¬∫`;
        }
        
        document.getElementById('myName').textContent = currentUserData.usuarioUnico || 'Voc√™';
        document.getElementById('myMainStat').textContent = `${formatarNumero(currentUserData.xp || 0)} XP`;
        
        const nivel = calcularNivel(currentUserData.xp || 0);
        const badge = document.getElementById('myLevelBadge');
        badge.className = `rank-level ${nivel.classe}`;
        badge.textContent = `${nivel.emoji} ${nivel.nome}`;

        document.getElementById('myStat1').textContent = formatarNumero(currentUserData.xp || 0);
        document.getElementById('myStat1Label').textContent = 'XP Total';
        document.getElementById('myStat2').textContent = formatarNumero(currentUserData.creditos || 0);
        document.getElementById('myStat2Label').textContent = 'Cr√©ditos';
        document.getElementById('myStat3').textContent = currentUserData.totalPartidas || 0;
        document.getElementById('myStat3Label').textContent = 'Partidas';
        document.getElementById('myStat4').textContent = currentUserData.pvp?.vitorias || 0;
        document.getElementById('myStat4Label').textContent = 'Vit√≥rias PVP';
      } else {
        myCard.style.display = 'none';
      }

      // P√≥dio
      if (usuarios.length >= 3) {
        podium.style.display = 'flex';
        for (let i = 1; i <= 3; i++) {
          const user = usuarios[i - 1];
          const nome = user.usuarioUnico || user.usuario || 'An√¥nimo';
          const valor = user[campoValor] || 0;
          
          const podiumItem = document.getElementById(`podium${i}`);
          podiumItem.querySelector('.podium-avatar').textContent = nome.charAt(0).toUpperCase();
          podiumItem.querySelector('.podium-name').textContent = nome;
          podiumItem.querySelector('.podium-xp').textContent = `${formatarNumero(valor)} XP`;
        }
      } else {
        podium.style.display = 'none';
      }

      // Lista
      const listaRender = usuarios.length >= 4 ? usuarios.slice(3) : usuarios;
      
      if (listaRender.length === 0) {
        lista.innerHTML = '';
        return;
      }

      const cores = {
        'level-bronze': 'linear-gradient(135deg, #CD7F32, #8B4513)',
        'level-prata': 'linear-gradient(135deg, #C0C0C0, #A8A8A8)',
        'level-ouro': 'linear-gradient(135deg, #FFD700, #FFA500)',
        'level-diamante': 'linear-gradient(135deg, #B9F2FF, #87CEEB)',
        'level-mestre': 'linear-gradient(135deg, #9B59B6, #8E44AD)'
      };

      lista.innerHTML = listaRender.map((user, index) => {
        const posicao = usuarios.length >= 4 ? index + 4 : index + 1;
        const nome = user.usuarioUnico || user.usuario || 'An√¥nimo';
        const valor = user[campoValor] || 0;
        const nivel = calcularNivel(user.xp || 0);
        const time = timesCache[user.timeId];
        const isMe = user.id === currentUserId;
        const posClass = posicao === 1 ? 'gold' : posicao === 2 ? 'silver' : posicao === 3 ? 'bronze' : '';
        const rowClass = posicao <= 3 ? `top-${posicao}` : '';

        return `
          <li class="ranking-item ${rowClass} ${isMe ? 'highlight' : ''}">
            <div class="rank-position ${posClass}">${posicao}</div>
            <div class="rank-avatar" style="background: ${cores[nivel.classe] || 'linear-gradient(135deg, #666, #444)'}">${nome.charAt(0).toUpperCase()}</div>
            <div class="rank-info">
              <div class="rank-name">${nome}<span class="rank-level ${nivel.classe}">${nivel.emoji}</span></div>
              <div class="rank-team">${time?.nome || 'Sem time'}</div>
              <div class="rank-details"><span>üìä ${user.totalPartidas || 0} jogos</span></div>
            </div>
            <div class="rank-stats">
              <div class="rank-xp">${formatarNumero(valor)}</div>
              <div class="rank-secondary">XP</div>
            </div>
          </li>
        `;
      }).join('');
    }

    // ===================================
    // üé® RENDERIZAR RANKING CR√âDITOS
    // ===================================
    function renderizarRankingCreditos(usuarios) {
      const lista = document.getElementById('rankingList');
      const podium = document.getElementById('podium');
      const myCard = document.getElementById('myPositionCard');

      const minhaPosicao = usuarios.findIndex(u => u.id === currentUserId) + 1;

      // Meu card
      if (currentUserData) {
        myCard.style.display = 'block';
        document.getElementById('myRank').textContent = minhaPosicao > 0 ? `${minhaPosicao}¬∫` : '>50¬∫';
        document.getElementById('myName').textContent = currentUserData.usuarioUnico || 'Voc√™';
        
        const meuValor = filtroCreditosAtual === 'saldo' 
          ? (currentUserData.creditos || 0)
          : (currentUserData.pvp?.creditosGanhos || 0);
        document.getElementById('myMainStat').textContent = `${formatarNumero(meuValor)} üíé`;

        const nivel = calcularNivel(currentUserData.xp || 0);
        const badge = document.getElementById('myLevelBadge');
        badge.className = `rank-level ${nivel.classe}`;
        badge.textContent = `${nivel.emoji} ${nivel.nome}`;

        document.getElementById('myStat1').textContent = formatarNumero(currentUserData.creditos || 0);
        document.getElementById('myStat1Label').textContent = 'Saldo';
        document.getElementById('myStat2').textContent = formatarNumero(currentUserData.pvp?.creditosGanhos || 0);
        document.getElementById('myStat2Label').textContent = 'Ganhos PVP';
        document.getElementById('myStat3').textContent = currentUserData.pvp?.vitorias || 0;
        document.getElementById('myStat3Label').textContent = 'Vit√≥rias';
        document.getElementById('myStat4').textContent = currentUserData.pvp?.totalEmbates || 0;
        document.getElementById('myStat4Label').textContent = 'Embates';
      }

      // P√≥dio
      if (usuarios.length >= 3) {
        podium.style.display = 'flex';
        for (let i = 1; i <= 3; i++) {
          const user = usuarios[i - 1];
          const nome = user.usuarioUnico || 'An√¥nimo';
          
          const podiumItem = document.getElementById(`podium${i}`);
          podiumItem.querySelector('.podium-avatar').textContent = nome.charAt(0).toUpperCase();
          podiumItem.querySelector('.podium-name').textContent = nome;
          podiumItem.querySelector('.podium-xp').textContent = `${formatarNumero(user.valorExibir)} üíé`;
        }
      } else {
        podium.style.display = 'none';
      }

      // Lista
      const listaRender = usuarios.length >= 4 ? usuarios.slice(3) : usuarios;

      const cores = {
        'level-bronze': 'linear-gradient(135deg, #CD7F32, #8B4513)',
        'level-prata': 'linear-gradient(135deg, #C0C0C0, #A8A8A8)',
        'level-ouro': 'linear-gradient(135deg, #FFD700, #FFA500)',
        'level-diamante': 'linear-gradient(135deg, #B9F2FF, #87CEEB)',
        'level-mestre': 'linear-gradient(135deg, #9B59B6, #8E44AD)'
      };

      lista.innerHTML = listaRender.map((user, index) => {
        const posicao = usuarios.length >= 4 ? index + 4 : index + 1;
        const nome = user.usuarioUnico || 'An√¥nimo';
        const nivel = calcularNivel(user.xp || 0);
        const time = timesCache[user.timeId];
        const isMe = user.id === currentUserId;
        const posClass = posicao === 1 ? 'gold' : posicao === 2 ? 'silver' : posicao === 3 ? 'bronze' : '';

        return `
          <li class="ranking-item ${isMe ? 'highlight' : ''}">
            <div class="rank-position ${posClass}">${posicao}</div>
            <div class="rank-avatar" style="background: ${cores[nivel.classe] || 'linear-gradient(135deg, #666, #444)'}">${nome.charAt(0).toUpperCase()}</div>
            <div class="rank-info">
              <div class="rank-name">${nome}<span class="rank-level ${nivel.classe}">${nivel.emoji}</span></div>
              <div class="rank-team">${time?.nome || 'Sem time'}</div>
              <div class="rank-details"><span>‚öîÔ∏è ${user.pvp?.totalEmbates || 0} embates</span></div>
            </div>
            <div class="rank-stats">
              <div class="rank-xp">${formatarNumero(user.valorExibir)}</div>
              <div class="rank-secondary">üíé</div>
            </div>
          </li>
        `;
      }).join('');
    }

    // ===================================
    // üé® RENDERIZAR RANKING TIMES
    // ===================================
    function renderizarRankingTimes(times) {
      const lista = document.getElementById('rankingList');

      lista.innerHTML = times.map((time, index) => {
        const posicao = index + 1;
        const posClass = posicao === 1 ? 'gold' : posicao === 2 ? 'silver' : posicao === 3 ? 'bronze' : '';
        const rowClass = posicao <= 3 ? `top-${posicao}` : '';

        let mainValue, mainLabel;
        if (filtroTimesAtual === 'torcedores') {
          mainValue = time.totalTorcedores;
          mainLabel = 'Torcedores';
        } else if (filtroTimesAtual === 'xpTotal') {
          mainValue = formatarNumero(time.xpTotal);
          mainLabel = 'XP Total';
        } else {
          mainValue = time.ativos;
          mainLabel = 'Ativos';
        }

        return `
          <li class="team-ranking-item ${rowClass}">
            <div class="rank-position ${posClass}">${posicao}</div>
            <div class="team-badge">‚öΩ</div>
            <div class="team-info">
              <div class="team-name">${time.nome}</div>
              <div class="team-stats-row">
                <span class="team-stat">üë• ${time.totalTorcedores}</span>
                <span class="team-stat">‚≠ê ${formatarNumero(time.xpTotal)} XP</span>
                <span class="team-stat">üéÆ ${time.ativos} ativos</span>
              </div>
            </div>
            <div class="team-main-stat">
              <div class="team-main-value">${mainValue}</div>
              <div class="team-main-label">${mainLabel}</div>
            </div>
          </li>
        `;
      }).join('');
    }

    console.log("‚úÖ Rankings v3.0 - Filtro por per√≠odo + Ranking de Times");
  </script>

</body>
</html>
