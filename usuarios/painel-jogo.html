<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Jogo ao Vivo - Yellup</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --cor-timeA: #28a745;
      --cor-timeB: #dc3545;
      --bg-primary: #0a0e27;
      --bg-secondary: #1a1f3a;
      --bg-card: #252b48;
      --text-primary: #ffffff;
      --text-secondary: #a8b3cf;
      --accent: #ffb547;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Anima√ß√£o de fundo */
    body::before {
      content: '';
      position: fixed;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: 
        radial-gradient(circle at 20% 50%, rgba(40, 167, 69, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(220, 53, 69, 0.1) 0%, transparent 50%);
      animation: rotateBg 20s linear infinite;
      z-index: 0;
    }

    @keyframes rotateBg {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    /* Loading Screen */
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(255, 181, 71, 0.2);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-text {
      margin-top: 20px;
      font-size: 1.2em;
      color: var(--text-secondary);
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      position: relative;
      z-index: 1;
      display: none;
    }

    .container.loaded {
      display: block;
      animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* Header */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .btn-back {
      padding: 12px 24px;
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      color: white;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      cursor: pointer;
      font-family: 'Poppins', sans-serif;
    }

    .btn-back:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateX(-5px);
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 12px 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      backdrop-filter: blur(10px);
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent), #ff8c42);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 18px;
    }

    /* ==================== CAMISETA SVG ==================== */
    .team-jersey {
      width: 60px;
      height: 70px;
      margin: 0 auto 10px;
    }

    .team-jersey-small {
      width: 30px;
      height: 35px;
      display: inline-block;
      vertical-align: middle;
      margin-right: 8px;
    }

    /* Match Header */
    .match-header {
      background: linear-gradient(135deg, var(--bg-card) 0%, rgba(37, 43, 72, 0.8) 100%);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: slideDown 0.6s ease-out;
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .match-title {
      text-align: center;
      font-size: 1.8em;
      font-weight: 800;
      margin-bottom: 20px;
      background: linear-gradient(135deg, #fff, var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .match-info {
      display: flex;
      justify-content: center;
      gap: 30px;
      flex-wrap: wrap;
      color: var(--text-secondary);
      font-size: 0.95em;
    }

    /* Teams Section */
    .teams-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }

    .team-card {
      background: linear-gradient(135deg, var(--bg-card) 0%, rgba(37, 43, 72, 0.8) 100%);
      border-radius: 20px;
      padding: 25px;
      text-align: center;
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .team-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
    }

    .team-card.my-team {
      border: 2px solid var(--accent);
      box-shadow: 0 0 20px rgba(255, 181, 71, 0.3);
    }

    .team-name {
      font-size: 1.3em;
      font-weight: 700;
      padding: 12px;
      border-radius: 12px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .team-stats {
      display: flex;
      justify-content: space-around;
    }

    .stat {
      text-align: center;
    }

    .stat-value {
      display: block;
      font-size: 1.8em;
      font-weight: 800;
      color: var(--accent);
    }

    .stat-label {
      font-size: 0.85em;
      color: var(--text-secondary);
    }

    /* ==================== BARRAS DE FOR√áA ==================== */
    .force-bars-container {
      background: linear-gradient(135deg, var(--bg-card) 0%, rgba(37, 43, 72, 0.8) 100%);
      border-radius: 20px;
      padding: 25px;
      margin-bottom: 30px;
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .force-bar-section {
      margin-bottom: 20px;
    }

    .force-bar-section:last-child {
      margin-bottom: 0;
    }

    .force-bar-title {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      font-size: 0.9em;
    }

    .force-bar-title .team-label {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .force-bar-wrapper {
      height: 30px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 15px;
      overflow: hidden;
      display: flex;
      position: relative;
    }

    .force-bar {
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.85em;
      transition: width 0.5s ease;
      min-width: 50px;
    }

    .force-bar.team-a {
      background: linear-gradient(90deg, var(--cor-timeA), var(--cor-timeA-dark, var(--cor-timeA)));
    }

    .force-bar.team-b {
      background: linear-gradient(90deg, var(--cor-timeB-dark, var(--cor-timeB)), var(--cor-timeB));
    }

    /* Progress Container (barras antigas - mantido para compatibilidade) */
    .progress-container {
      background: linear-gradient(135deg, var(--bg-card) 0%, rgba(37, 43, 72, 0.8) 100%);
      border-radius: 20px;
      padding: 25px;
      margin-bottom: 30px;
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: none; /* Substitu√≠do pelas novas barras */
    }

    /* Answer Section */
    .answer-section {
      background: linear-gradient(135deg, var(--bg-card) 0%, rgba(37, 43, 72, 0.8) 100%);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .credits-display {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }

    .credit-badge {
      padding: 12px 20px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.95em;
    }

    .credit-badge.free {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1));
      border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .credit-badge.paid {
      background: linear-gradient(135deg, rgba(255, 181, 71, 0.2), rgba(255, 181, 71, 0.1));
      border: 1px solid rgba(255, 181, 71, 0.3);
    }

    .btn-answer {
      width: 100%;
      padding: 20px;
      font-size: 1.3em;
      font-weight: 700;
      border: none;
      border-radius: 15px;
      background: linear-gradient(135deg, var(--accent), #ff8c42);
      color: var(--bg-primary);
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Poppins', sans-serif;
      box-shadow: 0 10px 30px rgba(255, 181, 71, 0.3);
    }

    .btn-answer:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 15px 40px rgba(255, 181, 71, 0.4);
    }

    .btn-answer:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    /* ==================== TIMER DA PERGUNTA ==================== */
    .question-timer {
      text-align: center;
      margin-bottom: 20px;
    }

    .timer-circle {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--bg-card), var(--bg-secondary));
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto;
      position: relative;
      border: 4px solid var(--accent);
    }

    .timer-circle.warning {
      border-color: var(--warning);
      animation: pulse 0.5s infinite;
    }

    .timer-circle.danger {
      border-color: var(--danger);
      animation: pulse 0.3s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .timer-value {
      font-size: 2em;
      font-weight: 800;
      color: var(--accent);
    }

    .timer-circle.warning .timer-value {
      color: var(--warning);
    }

    .timer-circle.danger .timer-value {
      color: var(--danger);
    }

    .timer-label {
      margin-top: 10px;
      font-size: 0.9em;
      color: var(--text-secondary);
    }

    /* Question Container */
    .question-container {
      display: none;
      margin-top: 25px;
      animation: fadeIn 0.4s ease;
    }

    .question-text {
      font-size: 1.2em;
      font-weight: 600;
      text-align: center;
      padding: 20px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 15px;
      margin-bottom: 20px;
      line-height: 1.5;
    }

    .question-points {
      text-align: center;
      margin-bottom: 15px;
      color: var(--accent);
      font-weight: 600;
    }

    .options-container {
      display: grid;
      gap: 12px;
    }

    .option-btn {
      padding: 18px 25px;
      font-size: 1em;
      font-weight: 500;
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.05);
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: left;
      font-family: 'Poppins', sans-serif;
    }

    .option-btn:hover:not(:disabled) {
      border-color: var(--accent);
      background: rgba(255, 181, 71, 0.1);
      transform: translateX(5px);
    }

    .option-btn:disabled {
      cursor: not-allowed;
    }

    .option-btn.correct {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.3), rgba(16, 185, 129, 0.1));
      border-color: var(--success);
      animation: correctPulse 0.5s ease;
    }

    .option-btn.wrong {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.3), rgba(239, 68, 68, 0.1));
      border-color: var(--danger);
      animation: wrongShake 0.5s ease;
    }

    @keyframes correctPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }

    @keyframes wrongShake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }

    .result-message {
      display: none;
      text-align: center;
      padding: 20px;
      border-radius: 12px;
      margin-top: 20px;
      font-weight: 600;
      font-size: 1.1em;
    }

    .result-message.success {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1));
      border: 1px solid rgba(16, 185, 129, 0.3);
      color: var(--success);
    }

    .result-message.error {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1));
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: var(--danger);
    }

    .result-message.timeout {
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(245, 158, 11, 0.1));
      border: 1px solid rgba(245, 158, 11, 0.3);
      color: var(--warning);
    }

    /* Chat and Ranking Grid */
    .chat-ranking-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 30px;
      margin-bottom: 30px;
    }

    @media (min-width: 992px) {
      .chat-ranking-grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    .chat-section {
      background: linear-gradient(135deg, var(--bg-card) 0%, rgba(37, 43, 72, 0.8) 100%);
      border-radius: 20px;
      padding: 25px;
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .chat-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .chat-tab {
      flex: 1;
      padding: 12px;
      text-align: center;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.05);
      font-weight: 600;
    }

    .chat-tab:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .chat-tab.active {
      background: linear-gradient(135deg, var(--accent), #ff8c42);
      color: var(--bg-primary);
    }

    .chat-content {
      display: none;
    }

    .chat-content.active {
      display: block;
    }

    .chat-messages {
      height: 300px;
      overflow-y: auto;
      padding: 15px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 12px;
      margin-bottom: 15px;
    }

    .chat-messages::-webkit-scrollbar {
      width: 6px;
    }

    .chat-messages::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
    }

    .chat-messages::-webkit-scrollbar-thumb {
      background: var(--accent);
      border-radius: 3px;
    }

    .chat-message {
      display: flex;
      gap: 12px;
      margin-bottom: 15px;
      padding: 10px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      animation: fadeIn 0.3s ease;
    }

    .chat-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
    }

    .chat-content-msg {
      flex: 1;
    }

    .chat-author {
      font-weight: 600;
      color: var(--accent);
      font-size: 0.9em;
      margin-bottom: 4px;
    }

    .chat-text {
      color: var(--text-primary);
      font-size: 0.95em;
      line-height: 1.4;
    }

    .chat-input-container {
      display: flex;
      gap: 10px;
    }

    .chat-input {
      flex: 1;
      padding: 12px 15px;
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      background: rgba(0, 0, 0, 0.2);
      color: white;
      font-size: 0.95em;
      font-family: 'Poppins', sans-serif;
    }

    .chat-input:focus {
      outline: none;
      border-color: var(--accent);
    }

    .chat-send-btn {
      padding: 12px 20px;
      background: linear-gradient(135deg, var(--accent), #ff8c42);
      border: none;
      border-radius: 10px;
      color: var(--bg-primary);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Poppins', sans-serif;
    }

    .chat-send-btn:hover {
      transform: scale(1.05);
    }

    /* Ranking Section */
    .ranking-section {
      background: linear-gradient(135deg, var(--bg-card) 0%, rgba(37, 43, 72, 0.8) 100%);
      border-radius: 20px;
      padding: 25px;
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .ranking-title {
      text-align: center;
      font-size: 1.3em;
      margin-bottom: 20px;
      color: var(--accent);
    }

    .ranking-list {
      list-style: none;
    }

    .ranking-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 12px 15px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      margin-bottom: 10px;
      transition: all 0.3s ease;
    }

    .ranking-item:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateX(5px);
    }

    .ranking-item:first-child {
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.1));
      border: 1px solid rgba(255, 215, 0, 0.3);
    }

    .ranking-position {
      font-size: 1.3em;
      font-weight: 800;
      min-width: 40px;
      text-align: center;
    }

    .ranking-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
    }

    .ranking-name {
      flex: 1;
      font-weight: 500;
    }

    .ranking-points {
      font-weight: 700;
      color: var(--accent);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .teams-section {
        grid-template-columns: 1fr;
      }

      .match-title {
        font-size: 1.4em;
      }

      .team-jersey {
        width: 50px;
        height: 58px;
      }

      .chat-ranking-grid {
        grid-template-columns: 1fr;
      }

      .chat-content {
        max-height: 350px;
      }
    }
  </style>
</head>
<body>

  <!-- Loading Screen -->
  <div class="loading-screen" id="loadingScreen">
    <div class="loading-spinner"></div>
    <p class="loading-text">Carregando jogo...</p>
  </div>

  <div class="container" id="mainContainer">
    
    <!-- Header -->
    <div class="header">
      <button class="btn-back" onclick="voltarPainel()">
        ‚Üê Voltar
      </button>
      <div class="user-info">
        <div class="user-avatar" id="userAvatar">U</div>
        <div>
          <strong id="userName">Usu√°rio</strong>
          <div style="font-size: 0.85em; color: var(--text-secondary);" id="userLevel">Level 1</div>
        </div>
      </div>
    </div>

    <!-- Match Header -->
    <div class="match-header">
      <h1 class="match-title" id="matchTitle">Time A vs Time B</h1>
      <div class="match-info">
        <span>üèÜ <span id="matchLeague">Liga</span></span>
        <span>üìÖ <span id="matchDate">Data</span></span>
        <span>‚è±Ô∏è <span class="timer" id="timer">00:00</span></span>
      </div>
    </div>

    <!-- Teams -->
    <div class="teams-section">
      <div class="team-card" id="teamACard">
        <div id="jerseyA" class="team-jersey"></div>
        <div class="team-name" id="teamAName">
          Time A
        </div>
        <div class="team-stats">
          <div class="stat">
            <span class="stat-value" id="teamATorcida">0</span>
            <span class="stat-label">Torcedores</span>
          </div>
          <div class="stat">
            <span class="stat-value" id="teamAPontos">0</span>
            <span class="stat-label">Pontos</span>
          </div>
        </div>
      </div>

      <div class="team-card" id="teamBCard">
        <div id="jerseyB" class="team-jersey"></div>
        <div class="team-name" id="teamBName">
          Time B
        </div>
        <div class="team-stats">
          <div class="stat">
            <span class="stat-value" id="teamBTorcida">0</span>
            <span class="stat-label">Torcedores</span>
          </div>
          <div class="stat">
            <span class="stat-value" id="teamBPontos">0</span>
            <span class="stat-label">Pontos</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Barras de For√ßa -->
    <div class="force-bars-container">
      <!-- Barra de Torcida -->
      <div class="force-bar-section">
        <div class="force-bar-title">
          <div class="team-label">
            <span id="forceTeamAName">Time A</span>
          </div>
          <span>üë• FOR√áA DA TORCIDA</span>
          <div class="team-label">
            <span id="forceTeamBName">Time B</span>
          </div>
        </div>
        <div class="force-bar-wrapper">
          <div class="force-bar team-a" id="forceTorcidaA" style="width: 50%;">
            <span id="forceTorcidaAPerc">50%</span>
          </div>
          <div class="force-bar team-b" id="forceTorcidaB" style="width: 50%;">
            <span id="forceTorcidaBPerc">50%</span>
          </div>
        </div>
      </div>

      <!-- Barra de Pontua√ß√£o -->
      <div class="force-bar-section">
        <div class="force-bar-title">
          <div class="team-label">
            <span id="pointsTeamAValue">0 pts</span>
          </div>
          <span>üèÜ PONTUA√á√ÉO</span>
          <div class="team-label">
            <span id="pointsTeamBValue">0 pts</span>
          </div>
        </div>
        <div class="force-bar-wrapper">
          <div class="force-bar team-a" id="forcePontosA" style="width: 50%;">
            <span id="forcePontosAPerc">50%</span>
          </div>
          <div class="force-bar team-b" id="forcePontosB" style="width: 50%;">
            <span id="forcePontosBPerc">50%</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Answer Section -->
    <div class="answer-section">
      <div class="credits-display">
        <div class="credit-badge free">
          <span>üéÅ Jogadas Gr√°tis:</span>
          <strong id="freeCredits">5/5</strong>
        </div>
        <div class="credit-badge paid">
          <span>üíé Cr√©ditos Pagos:</span>
          <strong id="paidCredits">0</strong>
        </div>
      </div>

      <button class="btn-answer" id="btnAnswer" onclick="getQuestion()">
        üéØ Responder Pergunta
      </button>

      <div class="question-container" id="questionContainer">
        <!-- Timer da Pergunta -->
        <div class="question-timer">
          <div class="timer-circle" id="questionTimerCircle">
            <span class="timer-value" id="questionTimerValue">10</span>
          </div>
          <p class="timer-label">segundos para responder</p>
        </div>

        <div class="question-points" id="questionPoints">Vale 10 pontos</div>
        <div class="question-text" id="questionText"></div>
        <div class="options-container" id="optionsContainer"></div>
        <div class="result-message" id="resultMessage"></div>
      </div>
    </div>

    <!-- Chat and Ranking -->
    <div class="chat-ranking-grid">
      
      <div class="chat-section">
        <div class="chat-tabs">
          <div class="chat-tab active" onclick="switchChat('team')">
            üíö Chat da Torcida
          </div>
          <div class="chat-tab" onclick="switchChat('general')">
            üí¨ Chat Geral
          </div>
        </div>

        <div class="chat-content active" id="teamChatContent">
          <div class="chat-messages" id="teamChat">
            <!-- Mensagens da torcida -->
          </div>
          <div class="chat-input-container">
            <input 
              type="text" 
              class="chat-input" 
              id="teamChatInput" 
              placeholder="Mensagem para sua torcida..."
              maxlength="200"
            />
            <button class="chat-send-btn" onclick="sendMessage('team')">
              Enviar
            </button>
          </div>
        </div>

        <div class="chat-content" id="generalChatContent">
          <div class="chat-messages" id="generalChat">
            <!-- Mensagens gerais -->
          </div>
          <div class="chat-input-container">
            <input 
              type="text" 
              class="chat-input" 
              id="generalChatInput" 
              placeholder="Mensagem para todos..."
              maxlength="200"
            />
            <button class="chat-send-btn" onclick="sendMessage('general')">
              Enviar
            </button>
          </div>
        </div>
      </div>

      <!-- Ranking Section dentro do grid -->
      <div class="ranking-section">
        <h3 class="ranking-title">üèÜ Top 10 da Torcida</h3>
        <ul class="ranking-list" id="rankingList">
          <!-- Ranking ser√° inserido aqui -->
        </ul>
      </div>

    </div>

  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  
  <script>
    // ===================================
    // üî• CONFIGURA√á√ÉO FIREBASE
    // ===================================
    const firebaseConfig = {
      apiKey: "AIzaSyC5ZrkEy7KuCFJOtPvI7-P-JcA0MF4im5c",
      authDomain: "painel-yellup.firebaseapp.com",
      projectId: "painel-yellup",
      storageBucket: "painel-yellup.appspot.com",
      messagingSenderId: "608347210297",
      appId: "1:608347210297:web:75092713724e617c7203e8",
      measurementId: "G-SYZ16X31KQ"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // ===================================
    // üì¶ VARI√ÅVEIS GLOBAIS
    // ===================================
    let uid = null;
    let jogoId = null;
    let timeTorcida = null;          // ID do time que o usu√°rio est√° torcendo
    let timeCasaId = null;           // ID do time da casa
    let timeForaId = null;           // ID do time visitante
    let timeCasaData = null;         // Dados do time da casa
    let timeForaData = null;         // Dados do time visitante
    let currentQuestion = null;
    let perguntasRespondidas = [];
    let todasPerguntasRespondidas = false;
    let questionTimer = null;        // Timer da pergunta
    let questionTimeLeft = 10;       // 10 segundos por pergunta

    // ===================================
    // üëï FUN√á√ÉO PARA GERAR CAMISETA SVG
    // ===================================
    function gerarCamisetaSVG(corPrimaria, corSecundaria, corTerciaria) {
      return `
        <svg viewBox="0 0 100 120" xmlns="http://www.w3.org/2000/svg">
          <!-- Corpo da camiseta -->
          <path d="M25,35 L25,110 L75,110 L75,35 L60,35 L60,25 C60,20 55,15 50,15 C45,15 40,20 40,25 L40,35 Z" 
                fill="${corPrimaria}" stroke="${corSecundaria}" stroke-width="2"/>
          
          <!-- Manga esquerda -->
          <path d="M25,35 L5,50 L5,70 L25,60 Z" 
                fill="${corPrimaria}" stroke="${corSecundaria}" stroke-width="2"/>
          
          <!-- Manga direita -->
          <path d="M75,35 L95,50 L95,70 L75,60 Z" 
                fill="${corPrimaria}" stroke="${corSecundaria}" stroke-width="2"/>
          
          <!-- Detalhe manga esquerda -->
          <path d="M5,50 L15,55 L15,65 L5,70 Z" fill="${corTerciaria}"/>
          
          <!-- Detalhe manga direita -->
          <path d="M95,50 L85,55 L85,65 L95,70 Z" fill="${corTerciaria}"/>
          
          <!-- Gola -->
          <ellipse cx="50" cy="22" rx="12" ry="8" fill="${corSecundaria}"/>
          <ellipse cx="50" cy="22" rx="8" ry="5" fill="${corPrimaria}"/>
        </svg>
      `;
    }

    // ===================================
    // üîê VERIFICA√á√ÉO DE AUTENTICA√á√ÉO
    // ===================================
    auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL)
      .then(() => console.log("‚úÖ Persist√™ncia configurada"))
      .catch((error) => console.error("‚ùå Erro persist√™ncia:", error));

    auth.onAuthStateChanged(async (user) => {
      console.log("üîç Verificando autentica√ß√£o...");
      
      if (!user) {
        console.log("‚ùå Usu√°rio n√£o autenticado");
        setTimeout(() => window.location.href = "index.html", 500);
        return;
      }
      
      console.log("‚úÖ Usu√°rio autenticado:", user.uid);
      uid = user.uid;
      
      const params = new URLSearchParams(window.location.search);
      jogoId = params.get("jogoId");
      
      if (!jogoId) {
        alert("ID do jogo n√£o encontrado!");
        window.location.href = "painel.html";
        return;
      }

      console.log("üéÆ Carregando jogo:", jogoId);

      try {
        await loadGameData();      // Primeiro carrega dados do jogo (times)
        await loadUserData();      // Depois carrega dados do usu√°rio
        await updateStats();       // Atualiza estat√≠sticas
        initChat();                // Inicia chat
        await loadRanking();       // Carrega ranking
        startGameTimer();          // Inicia timer do jogo
        
        document.getElementById("loadingScreen").style.display = "none";
        document.getElementById("mainContainer").classList.add("loaded");
        
        console.log("‚úÖ Jogo carregado com sucesso!");
        
      } catch (error) {
        console.error("‚ùå Erro ao carregar jogo:", error);
        alert("Erro ao carregar o jogo. Tente novamente.");
        window.location.href = "painel.html";
      }
    });

    // ===================================
    // üéÆ CARREGAR DADOS DO JOGO
    // ===================================
    async function loadGameData() {
      try {
        const jogoDoc = await db.collection("jogos").doc(jogoId).get();
        if (!jogoDoc.exists) {
          throw new Error("Jogo n√£o encontrado!");
        }

        const jogo = jogoDoc.data();
        timeCasaId = jogo.timeCasaId;
        timeForaId = jogo.timeForaId;
        
        // Carregar dados dos times
        const [timeCasaDoc, timeForaDoc] = await Promise.all([
          db.collection("times").doc(timeCasaId).get(),
          db.collection("times").doc(timeForaId).get()
        ]);

        timeCasaData = timeCasaDoc.exists ? timeCasaDoc.data() : { nome: "Time Casa", primaria: "#28a745", secundaria: "#ffffff", terciaria: "#28a745" };
        timeForaData = timeForaDoc.exists ? timeForaDoc.data() : { nome: "Time Fora", primaria: "#dc3545", secundaria: "#ffffff", terciaria: "#dc3545" };

        // Atualizar cores CSS
        document.documentElement.style.setProperty('--cor-timeA', timeCasaData.primaria || '#28a745');
        document.documentElement.style.setProperty('--cor-timeB', timeForaData.primaria || '#dc3545');

        // Atualizar t√≠tulo
        document.getElementById("matchTitle").textContent = `${timeCasaData.nome} vs ${timeForaData.nome}`;
        
        // Atualizar nomes dos times
        document.getElementById("teamAName").textContent = timeCasaData.nome;
        document.getElementById("teamBName").textContent = timeForaData.nome;
        document.getElementById("forceTeamAName").textContent = timeCasaData.nome;
        document.getElementById("forceTeamBName").textContent = timeForaData.nome;

        // Gerar camisetas
        document.getElementById("jerseyA").innerHTML = gerarCamisetaSVG(
          timeCasaData.primaria || '#28a745',
          timeCasaData.secundaria || '#ffffff',
          timeCasaData.terciaria || '#28a745'
        );
        document.getElementById("jerseyB").innerHTML = gerarCamisetaSVG(
          timeForaData.primaria || '#dc3545',
          timeForaData.secundaria || '#ffffff',
          timeForaData.terciaria || '#dc3545'
        );

        // Aplicar estilos aos nomes
        document.getElementById("teamAName").style.background = `linear-gradient(135deg, ${timeCasaData.primaria}99, ${timeCasaData.primaria}44)`;
        document.getElementById("teamBName").style.background = `linear-gradient(135deg, ${timeForaData.primaria}99, ${timeForaData.primaria}44)`;

        // Formatar data
        if (jogo.dataInicio) {
          const dataInicio = jogo.dataInicio.toDate ? jogo.dataInicio.toDate() : new Date(jogo.dataInicio);
          document.getElementById("matchDate").textContent = dataInicio.toLocaleDateString('pt-BR', {
            day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit'
          });
        }

        document.getElementById("matchLeague").textContent = jogo.liga || jogo.campeonato || "Partida";

      } catch (error) {
        console.error("‚ùå Erro ao carregar jogo:", error);
        throw error;
      }
    }

    // ===================================
    // üë§ CARREGAR DADOS DO USU√ÅRIO
    // ===================================
    async function loadUserData() {
      try {
        const userDoc = await db.collection("usuarios").doc(uid).get();
        if (!userDoc.exists) {
          throw new Error("Usu√°rio n√£o encontrado!");
        }

        const user = userDoc.data();
        
        const displayName = user.usuarioUnico || user.usuario || user.nome || "Usu√°rio";
        document.getElementById("userName").textContent = displayName;
        document.getElementById("userAvatar").textContent = displayName.charAt(0).toUpperCase();
        document.getElementById("userLevel").textContent = `Level ${user.level || 1}`;

        // Verificar se tem time escolhido para este jogo
        timeTorcida = user.torcidas?.[jogoId];
        if (!timeTorcida) {
          alert("Voc√™ precisa escolher um time primeiro!");
          window.location.href = "painel.html";
          return;
        }

        // Destacar card do time que est√° torcendo
        if (timeTorcida === timeCasaId) {
          document.getElementById("teamACard").classList.add("my-team");
        } else if (timeTorcida === timeForaId) {
          document.getElementById("teamBCard").classList.add("my-team");
        }

        // Carregar perguntas j√° respondidas
        perguntasRespondidas = user[`perguntasRespondidas_${jogoId}`] || [];
        console.log("üìù Perguntas j√° respondidas:", perguntasRespondidas.length);

        await updateFreePlays();

      } catch (error) {
        console.error("‚ùå Erro ao carregar usu√°rio:", error);
        throw error;
      }
    }

    // ===================================
    // üíé ATUALIZAR JOGADAS GR√ÅTIS
    // ===================================
    async function updateFreePlays() {
      try {
        const userDoc = await db.collection("usuarios").doc(uid).get();
        const user = userDoc.data() || {};
        
        const jogadasUsadas = user.jogadasGratis?.usadas || 0;
        const creditosPagos = user.creditos || 0;
        
        const gratisRestantes = Math.max(0, 5 - jogadasUsadas);
        
        document.getElementById("freeCredits").textContent = `${gratisRestantes}/5`;
        document.getElementById("paidCredits").textContent = creditosPagos;

        const btnAnswer = document.getElementById("btnAnswer");
        if (gratisRestantes === 0 && creditosPagos <= 0) {
          btnAnswer.disabled = true;
          btnAnswer.textContent = "‚ùå Sem Cr√©ditos";
          btnAnswer.style.background = "rgba(239, 68, 68, 0.5)";
        } else if (!currentQuestion) {
          btnAnswer.disabled = false;
          btnAnswer.textContent = "üéØ Responder Pergunta";
          btnAnswer.style.background = "linear-gradient(135deg, var(--accent), #ff8c42)";
        }

      } catch (error) {
        console.error("‚ùå Erro ao atualizar jogadas:", error);
      }
    }

    // ===================================
    // üìä ATUALIZAR ESTAT√çSTICAS
    // ===================================
    async function updateStats() {
      try {
        const usuarios = await db.collection("usuarios").get();
        
        let torcidaA = 0, torcidaB = 0;
        let pontosA = 0, pontosB = 0;

        usuarios.forEach(doc => {
          const user = doc.data();
          const timeUser = user.torcidas?.[jogoId];
          const pontos = user.pontuacoes?.[jogoId] || 0;

          // Comparar com IDs reais dos times
          if (timeUser === timeCasaId) {
            torcidaA++;
            pontosA += pontos;
          } else if (timeUser === timeForaId) {
            torcidaB++;
            pontosB += pontos;
          }
        });

        // Atualizar cards dos times
        document.getElementById("teamATorcida").textContent = torcidaA;
        document.getElementById("teamBTorcida").textContent = torcidaB;
        document.getElementById("teamAPontos").textContent = pontosA.toLocaleString('pt-BR');
        document.getElementById("teamBPontos").textContent = pontosB.toLocaleString('pt-BR');

        // Calcular percentuais
        const totalTorcida = torcidaA + torcidaB || 1;
        const percTorcidaA = Math.round((torcidaA / totalTorcida) * 100);
        const percTorcidaB = 100 - percTorcidaA;

        const totalPontos = pontosA + pontosB || 1;
        const percPontosA = Math.round((pontosA / totalPontos) * 100);
        const percPontosB = 100 - percPontosA;

        // Atualizar barras de torcida
        document.getElementById("forceTorcidaA").style.width = percTorcidaA + "%";
        document.getElementById("forceTorcidaB").style.width = percTorcidaB + "%";
        document.getElementById("forceTorcidaAPerc").textContent = percTorcidaA + "%";
        document.getElementById("forceTorcidaBPerc").textContent = percTorcidaB + "%";

        // Atualizar barras de pontua√ß√£o
        document.getElementById("forcePontosA").style.width = percPontosA + "%";
        document.getElementById("forcePontosB").style.width = percPontosB + "%";
        document.getElementById("forcePontosAPerc").textContent = percPontosA + "%";
        document.getElementById("forcePontosBPerc").textContent = percPontosB + "%";
        document.getElementById("pointsTeamAValue").textContent = pontosA + " pts";
        document.getElementById("pointsTeamBValue").textContent = pontosB + " pts";

      } catch (error) {
        console.error("‚ùå Erro ao atualizar estat√≠sticas:", error);
      }
    }

    // ===================================
    // ‚è±Ô∏è TIMER DO JOGO
    // ===================================
    let gameTimerInterval;
    function startGameTimer() {
      let seconds = 0;
      gameTimerInterval = setInterval(() => {
        seconds++;
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        document.getElementById("timer").textContent = 
          `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
      }, 1000);
    }

    // ===================================
    // ‚ùì BUSCAR PERGUNTA (CORRIGIDO!)
    // ===================================
    function shuffleArray(array) {
      const newArray = [...array];
      for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
      }
      return newArray;
    }

    async function getQuestion() {
      try {
        const btnAnswer = document.getElementById("btnAnswer");
        btnAnswer.disabled = true;
        btnAnswer.textContent = "üîç Buscando pergunta...";

        // Verificar cr√©ditos ANTES de buscar
        const userDoc = await db.collection("usuarios").doc(uid).get();
        const userData = userDoc.data() || {};
        const jogadasUsadas = userData.jogadasGratis?.usadas || 0;
        const creditosPagos = userData.creditos || 0;

        if (jogadasUsadas >= 5 && creditosPagos <= 0) {
          alert("‚ùå Voc√™ n√£o tem cr√©ditos dispon√≠veis!\n\nCompre mais cr√©ditos ou indique amigos.");
          btnAnswer.disabled = false;
          btnAnswer.textContent = "‚ùå Sem Cr√©ditos";
          return;
        }

        // ‚úÖ CORRE√á√ÉO: Buscar perguntas pelo TIME que est√° torcendo (n√£o pelo jogo)
        console.log("üîç Buscando perguntas para o time:", timeTorcida);
        
        const perguntasSnap = await db.collection("perguntas")
          .where("timeId", "==", timeTorcida)
          .get();

        console.log("üìö Perguntas encontradas:", perguntasSnap.size);

        if (perguntasSnap.empty) {
          alert("Nenhuma pergunta dispon√≠vel para este time!\n\nO administrador precisa cadastrar perguntas.");
          btnAnswer.disabled = false;
          btnAnswer.textContent = "üéØ Responder Pergunta";
          return;
        }

        // Filtrar perguntas n√£o respondidas
        const perguntasDisponiveis = [];
        perguntasSnap.forEach(doc => {
          if (!perguntasRespondidas.includes(doc.id)) {
            perguntasDisponiveis.push({ id: doc.id, ...doc.data() });
          }
        });

        console.log("üìù Perguntas dispon√≠veis (n√£o respondidas):", perguntasDisponiveis.length);

        if (perguntasDisponiveis.length === 0) {
          todasPerguntasRespondidas = true;
          alert("üéâ Parab√©ns! Voc√™ respondeu todas as perguntas deste time!");
          btnAnswer.disabled = true;
          btnAnswer.textContent = "‚úÖ Todas Respondidas";
          return;
        }

        // Escolher pergunta aleat√≥ria
        const perguntaAleatoria = perguntasDisponiveis[Math.floor(Math.random() * perguntasDisponiveis.length)];
        currentQuestion = perguntaAleatoria;

        console.log("üìù Pergunta selecionada:", currentQuestion.pergunta);

        displayQuestion();

      } catch (error) {
        console.error("‚ùå Erro ao buscar pergunta:", error);
        alert("Erro ao buscar pergunta. Tente novamente!");
        document.getElementById("btnAnswer").disabled = false;
        document.getElementById("btnAnswer").textContent = "üéØ Responder Pergunta";
      }
    }

    // ===================================
    // üìù EXIBIR PERGUNTA COM TIMER
    // ===================================
    function displayQuestion() {
      const questionContainer = document.getElementById("questionContainer");
      const questionText = document.getElementById("questionText");
      const optionsContainer = document.getElementById("optionsContainer");
      const resultMessage = document.getElementById("resultMessage");
      const questionPoints = document.getElementById("questionPoints");

      // Resetar
      questionContainer.style.display = "block";
      questionText.textContent = currentQuestion.pergunta;
      optionsContainer.innerHTML = "";
      resultMessage.style.display = "none";

      // Mostrar pontua√ß√£o
      const pontos = currentQuestion.pontuacao || currentQuestion.pontos || 10;
      questionPoints.textContent = `Vale ${pontos} pontos`;

      // Verificar estrutura das alternativas
      const alternativas = currentQuestion.alternativas || {};
      
      // Verificar se usa letras mai√∫sculas ou min√∫sculas
      let letras = ['a', 'b', 'c', 'd'];
      if (alternativas['A'] && !alternativas['a']) {
        letras = ['A', 'B', 'C', 'D'];
      }

      if (!letras.some(letra => alternativas[letra])) {
        alert("Erro: Pergunta sem alternativas v√°lidas!");
        document.getElementById("btnAnswer").disabled = false;
        document.getElementById("btnAnswer").textContent = "üéØ Responder Pergunta";
        questionContainer.style.display = "none";
        return;
      }

      // Criar array com as op√ß√µes e embaralhar
      const opcoes = letras
        .filter(letra => alternativas[letra])
        .map(letra => ({
          letra: letra,
          texto: alternativas[letra]
        }));

      const opcoesEmbaralhadas = shuffleArray(opcoes);

      // Criar bot√µes das op√ß√µes
      opcoesEmbaralhadas.forEach((opcao) => {
        const btn = document.createElement("button");
        btn.className = "option-btn";
        btn.textContent = opcao.texto;
        btn.onclick = () => answerQuestion(opcao.letra);
        optionsContainer.appendChild(btn);
      });

      // ‚úÖ INICIAR TIMER DE 10 SEGUNDOS
      startQuestionTimer();
    }

    // ===================================
    // ‚è±Ô∏è TIMER DA PERGUNTA (10 SEGUNDOS)
    // ===================================
    function startQuestionTimer() {
      questionTimeLeft = 10;
      updateTimerDisplay();

      questionTimer = setInterval(() => {
        questionTimeLeft--;
        updateTimerDisplay();

        if (questionTimeLeft <= 0) {
          clearInterval(questionTimer);
          timeoutQuestion();
        }
      }, 1000);
    }

    function updateTimerDisplay() {
      const timerValue = document.getElementById("questionTimerValue");
      const timerCircle = document.getElementById("questionTimerCircle");
      
      timerValue.textContent = questionTimeLeft;

      // Mudar cor baseado no tempo
      timerCircle.classList.remove("warning", "danger");
      if (questionTimeLeft <= 3) {
        timerCircle.classList.add("danger");
      } else if (questionTimeLeft <= 5) {
        timerCircle.classList.add("warning");
      }
    }

    function stopQuestionTimer() {
      if (questionTimer) {
        clearInterval(questionTimer);
        questionTimer = null;
      }
    }

    // ===================================
    // ‚è∞ TEMPO ESGOTADO
    // ===================================
    async function timeoutQuestion() {
      try {
        // Desabilitar todas as op√ß√µes
        const options = document.querySelectorAll(".option-btn");
        options.forEach(opt => opt.disabled = true);

        // Mostrar resposta correta
        const correct = currentQuestion.correta;
        const alternativas = currentQuestion.alternativas || {};
        
        options.forEach((opt) => {
          const textoOpcao = opt.textContent;
          for (let letra in alternativas) {
            if (alternativas[letra] === textoOpcao && letra.toLowerCase() === correct.toLowerCase()) {
              opt.classList.add("correct");
              break;
            }
          }
        });

        // Mostrar mensagem de timeout
        const resultMessage = document.getElementById("resultMessage");
        resultMessage.style.display = "block";
        resultMessage.className = "result-message timeout";
        resultMessage.textContent = `‚è∞ Tempo esgotado! A resposta correta era: ${alternativas[correct]}`;

        // Adicionar pergunta ao hist√≥rico
        perguntasRespondidas.push(currentQuestion.id);

        // Descontar cr√©dito mesmo sem responder
        const userDoc = await db.collection("usuarios").doc(uid).get();
        const userData = userDoc.data() || {};
        const jogadasUsadas = userData.jogadasGratis?.usadas || 0;
        const temGratis = jogadasUsadas < 5;

        const updates = {
          [`perguntasRespondidas_${jogoId}`]: firebase.firestore.FieldValue.arrayUnion(currentQuestion.id)
        };

        if (temGratis) {
          updates['jogadasGratis.usadas'] = firebase.firestore.FieldValue.increment(1);
        } else {
          updates.creditos = firebase.firestore.FieldValue.increment(-1);
        }

        await db.collection("usuarios").doc(uid).update(updates);

        await updateFreePlays();

        // Reabilitar ap√≥s 3 segundos
        setTimeout(() => {
          currentQuestion = null;
          document.getElementById("btnAnswer").disabled = false;
          document.getElementById("btnAnswer").textContent = "üéØ Responder Pergunta";
          document.getElementById("questionContainer").style.display = "none";
        }, 3000);

      } catch (error) {
        console.error("‚ùå Erro no timeout:", error);
      }
    }

    // ===================================
    // ‚úÖ RESPONDER PERGUNTA
    // ===================================
    async function answerQuestion(selectedLetter) {
      try {
        // Parar timer
        stopQuestionTimer();

        // Desabilitar todas as op√ß√µes
        const options = document.querySelectorAll(".option-btn");
        options.forEach(opt => opt.disabled = true);

        const correct = currentQuestion.correta;
        const pontos = currentQuestion.pontuacao || currentQuestion.pontos || 10;
        
        // Comparar ignorando mai√∫sculas/min√∫sculas
        const acertou = selectedLetter.toLowerCase() === correct.toLowerCase();

        console.log("üìù Resposta:", selectedLetter, "| Correta:", correct, "| Acertou:", acertou);

        // Marcar resposta visualmente
        const alternativas = currentQuestion.alternativas || {};
        options.forEach((opt) => {
          const textoOpcao = opt.textContent;
          
          let letraOpcao = null;
          for (let letra in alternativas) {
            if (alternativas[letra] === textoOpcao) {
              letraOpcao = letra;
              break;
            }
          }
          
          if (letraOpcao && letraOpcao.toLowerCase() === selectedLetter.toLowerCase()) {
            opt.classList.add(acertou ? "correct" : "wrong");
          }
          if (letraOpcao && letraOpcao.toLowerCase() === correct.toLowerCase() && !acertou) {
            opt.classList.add("correct");
          }
        });

        // Mostrar resultado
        const resultMessage = document.getElementById("resultMessage");
        resultMessage.style.display = "block";
        resultMessage.className = `result-message ${acertou ? "success" : "error"}`;
        
        resultMessage.textContent = acertou 
          ? `üéâ Correto! +${pontos} pontos` 
          : `‚ùå Errado! A resposta correta era: ${alternativas[correct]}`;

        // Adicionar pergunta ao hist√≥rico
        perguntasRespondidas.push(currentQuestion.id);

        // Verificar e descontar cr√©ditos
        const userDoc = await db.collection("usuarios").doc(uid).get();
        const userData = userDoc.data() || {};
        const jogadasUsadas = userData.jogadasGratis?.usadas || 0;
        const temGratis = jogadasUsadas < 5;

        const updates = {
          [`perguntasRespondidas_${jogoId}`]: firebase.firestore.FieldValue.arrayUnion(currentQuestion.id)
        };

        if (temGratis) {
          updates['jogadasGratis.usadas'] = firebase.firestore.FieldValue.increment(1);
          console.log(`‚úÖ Usando jogada gr√°tis (${jogadasUsadas + 1}/5)`);
        } else {
          // ‚úÖ Validar se tem cr√©ditos antes de descontar
          if (userData.creditos > 0) {
            updates.creditos = firebase.firestore.FieldValue.increment(-1);
            console.log(`üíé Descontando 1 cr√©dito pago`);
          }
        }

        // Adicionar pontos se acertou
        if (acertou) {
          updates[`pontuacoes.${jogoId}`] = firebase.firestore.FieldValue.increment(pontos);
          updates.xp = firebase.firestore.FieldValue.increment(pontos);
        }

        await db.collection("usuarios").doc(uid).update(updates);

        // Atualizar interface
        await updateFreePlays();
        await updateStats();
        await loadRanking();

        // Reabilitar bot√£o ap√≥s 3 segundos
        setTimeout(() => {
          currentQuestion = null;
          document.getElementById("btnAnswer").disabled = false;
          document.getElementById("btnAnswer").textContent = "üéØ Responder Pergunta";
          document.getElementById("questionContainer").style.display = "none";
        }, 3000);

      } catch (error) {
        console.error("‚ùå Erro ao processar resposta:", error);
        alert("Erro ao salvar resposta. Tente novamente!");
      }
    }

    // ===================================
    // üí¨ SISTEMA DE CHAT (CORRIGIDO!)
    // ===================================
    function switchChat(type) {
      const tabs = document.querySelectorAll(".chat-tab");
      const contents = document.querySelectorAll(".chat-content");

      tabs.forEach(tab => tab.classList.remove("active"));
      contents.forEach(content => content.classList.remove("active"));

      if (type === "team") {
        tabs[0].classList.add("active");
        document.getElementById("teamChatContent").classList.add("active");
      } else {
        tabs[1].classList.add("active");
        document.getElementById("generalChatContent").classList.add("active");
      }
    }

    function initChat() {
      // Chat da torcida (s√≥ do time que estou torcendo)
      db.collection("chats")
        .where("jogoId", "==", jogoId)
        .where("timeId", "==", timeTorcida)
        .orderBy("timestamp", "desc")
        .limit(50)
        .onSnapshot(snap => {
          const container = document.getElementById("teamChat");
          container.innerHTML = "";
          const msgs = [];
          snap.forEach(doc => msgs.push({ id: doc.id, ...doc.data() }));
          msgs.reverse().forEach(msg => renderMessage(msg, container));
          container.scrollTop = container.scrollHeight;
        }, error => {
          console.error("‚ùå Erro no chat da torcida:", error);
        });

      // ‚úÖ Chat geral - pega TODAS as mensagens do jogo que s√£o gerais
      db.collection("chats")
        .where("jogoId", "==", jogoId)
        .where("tipo", "==", "geral")
        .orderBy("timestamp", "desc")
        .limit(50)
        .onSnapshot(snap => {
          const container = document.getElementById("generalChat");
          container.innerHTML = "";
          const msgs = [];
          snap.forEach(doc => msgs.push({ id: doc.id, ...doc.data() }));
          msgs.reverse().forEach(msg => renderMessage(msg, container));
          container.scrollTop = container.scrollHeight;
        }, error => {
          console.error("‚ùå Erro no chat geral:", error);
          // Fallback: tentar sem o filtro tipo
          db.collection("chats")
            .where("jogoId", "==", jogoId)
            .orderBy("timestamp", "desc")
            .limit(50)
            .onSnapshot(snap => {
              const container = document.getElementById("generalChat");
              container.innerHTML = "";
              const msgs = [];
              snap.forEach(doc => {
                const data = doc.data();
                // Mostrar apenas mensagens gerais (sem timeId ou timeId vazio)
                if (!data.timeId || data.tipo === "geral") {
                  msgs.push({ id: doc.id, ...data });
                }
              });
              msgs.reverse().forEach(msg => renderMessage(msg, container));
              container.scrollTop = container.scrollHeight;
            });
        });

      // Enter para enviar
      document.getElementById("teamChatInput").addEventListener("keypress", (e) => {
        if (e.key === "Enter") sendMessage("team");
      });
      document.getElementById("generalChatInput").addEventListener("keypress", (e) => {
        if (e.key === "Enter") sendMessage("general");
      });
    }

    function renderMessage(msg, container) {
      const div = document.createElement("div");
      div.className = "chat-message";
      
      const displayName = msg.usuarioUnico || msg.usuario || msg.nome || "An√¥nimo";
      const avatar = msg.avatar || `https://ui-avatars.com/api/?name=${encodeURIComponent(displayName)}&background=random`;
      
      div.innerHTML = `
        <img src="${avatar}" alt="${displayName}" class="chat-avatar">
        <div class="chat-content-msg">
          <div class="chat-author">${displayName}</div>
          <div class="chat-text">${escapeHtml(msg.mensagem)}</div>
        </div>
      `;
      container.appendChild(div);
    }

    // Fun√ß√£o para escapar HTML e prevenir XSS
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    async function sendMessage(type) {
      const inputId = type === "team" ? "teamChatInput" : "generalChatInput";
      const input = document.getElementById(inputId);
      const mensagem = input.value.trim();
      
      if (!mensagem) return;

      try {
        const userDoc = await db.collection("usuarios").doc(uid).get();
        const user = userDoc.data() || {};
        
        const displayName = user.usuarioUnico || user.usuario || user.nome || "An√¥nimo";
        const avatar = user.avatarUrl || user.avatar || user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(displayName)}&background=random`;

        await db.collection("chats").add({
          jogoId,
          timeId: type === "team" ? timeTorcida : null,
          tipo: type === "team" ? "torcida" : "geral",
          userId: uid,
          usuario: user.usuario || null,
          usuarioUnico: user.usuarioUnico || null,
          nome: displayName,
          avatar,
          mensagem,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });

        input.value = "";

      } catch (error) {
        console.error("‚ùå Erro ao enviar mensagem:", error);
        alert("Erro ao enviar mensagem. Tente novamente!");
      }
    }

    // ===================================
    // üèÜ RANKING
    // ===================================
    async function loadRanking() {
      try {
        const usuarios = await db.collection("usuarios").get();
        const ranking = [];

        usuarios.forEach(doc => {
          const user = doc.data();
          const timeUser = user.torcidas?.[jogoId];
          
          // Mostrar apenas usu√°rios da mesma torcida
          if (timeUser !== timeTorcida) return;

          const pontos = user.pontuacoes?.[jogoId] || 0;
          if (pontos > 0) {
            const displayName = user.usuarioUnico || user.usuario || user.nome || "An√¥nimo";
            ranking.push({
              odName: displayName,
              pontos: pontos,
              avatar: user.avatarUrl || user.avatar || user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(displayName)}&background=random`
            });
          }
        });

        ranking.sort((a, b) => b.pontos - a.pontos);

        const rankingList = document.getElementById("rankingList");
        rankingList.innerHTML = "";

        if (ranking.length === 0) {
          rankingList.innerHTML = '<li style="text-align: center; color: var(--text-secondary); padding: 40px;">Nenhuma pontua√ß√£o ainda. Seja o primeiro!</li>';
          return;
        }

        ranking.slice(0, 10).forEach((user, index) => {
          const li = document.createElement("li");
          li.className = "ranking-item";
          
          const posicao = index + 1;
          const medalha = posicao === 1 ? 'ü•á' : posicao === 2 ? 'ü•à' : posicao === 3 ? 'ü•â' : `${posicao}¬∫`;
          
          li.innerHTML = `
            <span class="ranking-position">${medalha}</span>
            <img src="${user.avatar}" alt="${user.nome}" class="ranking-avatar">
            <span class="ranking-name">${user.nome}</span>
            <span class="ranking-points">${user.pontos} pts</span>
          `;
          
          rankingList.appendChild(li);
        });

      } catch (error) {
        console.error("‚ùå Erro ao carregar ranking:", error);
      }
    }

    // ===================================
    // üîô VOLTAR AO PAINEL
    // ===================================
    function voltarPainel() {
      stopQuestionTimer();
      if (confirm("Deseja realmente sair do jogo?")) {
        window.location.href = "painel.html";
      }
    }

    console.log("‚úÖ Yellup Game v5.0 - Quiz Corrigido + Timer + Camisetas + Barras de For√ßa!");
  </script>

</body>
</html>
