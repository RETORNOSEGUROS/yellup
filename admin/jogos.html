<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogos - Yellup Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --bg-primary: #0c0e14; --bg-secondary: #12141c; --bg-card: #181a24;
            --bg-card-hover: #1e2030; --bg-sidebar: #10121a;
            --border: #1e2030; --border-light: #282a3a;
            --text-primary: #e8e9ed; --text-secondary: #8b8d9a; --text-muted: #5c5e6e;
            --accent: #f0b429; --accent-dim: rgba(240, 180, 41, 0.12);
            --green: #34d399; --green-dim: rgba(52, 211, 153, 0.12);
            --red: #f87171; --red-dim: rgba(248, 113, 113, 0.12);
            --blue: #60a5fa; --blue-dim: rgba(96, 165, 250, 0.12);
            --purple: #a78bfa; --purple-dim: rgba(167, 139, 250, 0.12);
            --orange: #fb923c; --orange-dim: rgba(251, 146, 60, 0.12);
            --sidebar-w: 250px; --header-h: 64px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'DM Sans', -apple-system, sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }

        /* SIDEBAR */
        .sidebar { position: fixed; left: 0; top: 0; width: var(--sidebar-w); height: 100vh; background: var(--bg-sidebar); border-right: 1px solid var(--border); display: flex; flex-direction: column; z-index: 100; transition: transform 0.3s ease; }
        .sidebar-brand { height: var(--header-h); display: flex; align-items: center; gap: 10px; padding: 0 20px; border-bottom: 1px solid var(--border); flex-shrink: 0; }
        .sidebar-brand .logo { width: 32px; height: 32px; background: var(--accent); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 16px; font-weight: 700; color: #000; }
        .sidebar-brand h1 { font-size: 17px; font-weight: 700; }
        .sidebar-brand h1 span { color: var(--text-muted); font-weight: 500; font-size: 12px; margin-left: 6px; }
        .sidebar-nav { flex: 1; overflow-y: auto; padding: 12px 0; }
        .sidebar-nav::-webkit-scrollbar { width: 0; }
        .nav-group { margin-bottom: 8px; }
        .nav-group-title { font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 1.2px; color: var(--text-muted); padding: 12px 20px 6px; }
        .nav-item { display: flex; align-items: center; gap: 10px; padding: 8px 16px; margin: 1px 8px; border-radius: 8px; color: var(--text-secondary); text-decoration: none; font-size: 13px; font-weight: 500; transition: all 0.15s; }
        .nav-item:hover { background: var(--bg-card); color: var(--text-primary); }
        .nav-item.active { background: var(--accent-dim); color: var(--accent); }
        .nav-item .icon { width: 20px; text-align: center; font-size: 14px; flex-shrink: 0; }
        .sidebar-footer { padding: 12px 16px; border-top: 1px solid var(--border); flex-shrink: 0; }
        .sidebar-footer .admin-box { display: flex; align-items: center; gap: 10px; padding: 8px; }
        .admin-avatar { width: 32px; height: 32px; background: linear-gradient(135deg, var(--accent), #e09800); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 13px; color: #000; }
        .admin-info-text { flex: 1; }
        .admin-info-text .name { font-size: 13px; font-weight: 600; }
        .admin-info-text .role { font-size: 11px; color: var(--text-muted); }
        .btn-logout { background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 16px; padding: 4px; border-radius: 6px; }
        .btn-logout:hover { color: var(--red); background: var(--red-dim); }

        /* MAIN */
        .main { margin-left: var(--sidebar-w); min-height: 100vh; }
        .topbar { height: var(--header-h); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 32px; background: var(--bg-primary); position: sticky; top: 0; z-index: 50; }
        .topbar-left h2 { font-size: 16px; font-weight: 600; }
        .topbar-left p { font-size: 12px; color: var(--text-muted); margin-top: 1px; }
        .topbar-actions { display: flex; gap: 8px; }
        .content { padding: 24px 32px 40px; }

        /* STATS */
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 20px; }
        .stat-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 10px; padding: 16px; }
        .stat-card .stat-value { font-size: 24px; font-weight: 700; font-family: 'JetBrains Mono', monospace; }
        .stat-card .stat-label { font-size: 11px; color: var(--text-muted); margin-top: 2px; }

        /* FILTER */
        .filter-bar { display: flex; gap: 10px; margin-bottom: 16px; flex-wrap: wrap; align-items: center; }
        .filter-select, .filter-input { padding: 9px 14px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-card); color: var(--text-primary); font-size: 13px; font-family: inherit; }
        .filter-select:focus, .filter-input:focus { outline: none; border-color: var(--accent); }
        .filter-select option { background: var(--bg-card); }
        .filter-input { color-scheme: dark; }

        /* TABLE */
        .table-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
        table { width: 100%; border-collapse: collapse; }
        thead th { padding: 10px 14px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-muted); border-bottom: 1px solid var(--border); text-align: left; background: var(--bg-secondary); white-space: nowrap; }
        tbody td { padding: 10px 14px; border-bottom: 1px solid var(--border); font-size: 13px; vertical-align: middle; }
        tbody tr:hover { background: var(--bg-card-hover); }
        tbody tr:last-child td { border-bottom: none; }

        /* MATCH CELL */
        .match-cell { display: flex; align-items: center; gap: 8px; min-width: 200px; }
        .escudo { width: 30px; height: 30px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 12px; color: #fff; flex-shrink: 0; border: 1px solid rgba(255,255,255,0.1); }
        .team-n { font-size: 12px; font-weight: 600; max-width: 80px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .vs-tag { font-size: 10px; font-weight: 700; color: var(--accent); flex-shrink: 0; }

        .date-cell .date-main { font-size: 12px; font-weight: 500; }
        .date-cell .date-time { font-size: 11px; color: var(--text-muted); }

        /* BADGES */
        .badge { display: inline-flex; padding: 3px 10px; border-radius: 6px; font-size: 11px; font-weight: 600; white-space: nowrap; }
        .badge-free { background: var(--green-dim); color: var(--green); }
        .badge-paid { background: var(--accent-dim); color: var(--accent); }
        .badge-live { background: var(--red-dim); color: var(--red); animation: pulse 2s infinite; }
        .badge-scheduled { background: var(--blue-dim); color: var(--blue); }
        .badge-finished { background: var(--green-dim); color: var(--green); }
        .badge-sponsor { background: var(--purple-dim); color: var(--purple); }

        @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.6; } }

        .mono { font-family: 'JetBrains Mono', monospace; font-size: 12px; }

        /* ACTIONS */
        .actions { display: flex; gap: 4px; }
        .btn-icon { width: 28px; height: 28px; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-secondary); color: var(--text-secondary); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 12px; transition: all 0.15s; }
        .btn-icon:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-dim); }
        .btn-icon.danger:hover { border-color: var(--red); color: var(--red); background: var(--red-dim); }
        .btn-icon.play:hover { border-color: var(--purple); color: var(--purple); background: var(--purple-dim); }

        /* PAGINATION */
        .pagination { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-top: 1px solid var(--border); }
        .pagination .info { font-size: 12px; color: var(--text-muted); }
        .pg-btn { padding: 6px 14px; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-secondary); color: var(--text-primary); font-size: 12px; cursor: pointer; font-family: inherit; }
        .pg-btn:hover { border-color: var(--accent); }
        .pg-btn:disabled { opacity: 0.3; cursor: not-allowed; }

        /* BUTTONS */
        .btn-primary { padding: 8px 16px; border-radius: 8px; border: none; background: var(--accent); color: #000; font-size: 13px; font-weight: 600; cursor: pointer; font-family: inherit; display: inline-flex; align-items: center; gap: 6px; }
        .btn-primary:hover { opacity: 0.9; }
        .btn-outline { padding: 8px 16px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-primary); font-size: 13px; font-weight: 500; cursor: pointer; font-family: inherit; display: inline-flex; align-items: center; gap: 6px; }
        .btn-outline:hover { border-color: var(--accent); }

        /* MODAL */
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 200; align-items: flex-start; justify-content: center; padding: 30px 20px; overflow-y: auto; }
        .modal-overlay.active { display: flex; }
        .modal { background: var(--bg-card); border: 1px solid var(--border); border-radius: 14px; width: 100%; max-width: 640px; }
        .modal-header { padding: 16px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; background: var(--bg-card); border-radius: 14px 14px 0 0; z-index: 10; }
        .modal-header h3 { font-size: 15px; font-weight: 600; }
        .modal-close { background: none; border: none; color: var(--text-muted); font-size: 18px; cursor: pointer; padding: 4px; border-radius: 6px; }
        .modal-close:hover { color: var(--red); background: var(--red-dim); }
        .modal-body { padding: 20px; }
        .modal-footer { padding: 0 20px 20px; display: flex; gap: 10px; }
        .modal-footer .btn-primary { flex: 1; justify-content: center; padding: 10px; }
        .modal-footer .btn-cancel { padding: 10px 20px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg-secondary); color: var(--text-primary); font-size: 13px; cursor: pointer; font-family: inherit; }

        /* FORM */
        .form-group { margin-bottom: 14px; }
        .form-group label { display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); margin-bottom: 5px; }
        .form-group input, .form-group select { width: 100%; padding: 9px 12px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary); font-size: 13px; font-family: inherit; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: var(--accent); }
        .form-group select option { background: var(--bg-card); }
        .form-hint { font-size: 11px; color: var(--text-muted); margin-top: 3px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .form-row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }

        /* TEAM SELECTOR */
        .team-selector { display: flex; align-items: center; gap: 10px; margin-bottom: 16px; }
        .team-selector .team-wrap { flex: 1; position: relative; }
        .team-selector .team-wrap input { width: 100%; padding: 12px 14px; border: 1px solid var(--border); border-radius: 10px; background: var(--bg-secondary); color: var(--text-primary); font-size: 13px; font-family: inherit; }
        .team-selector .team-wrap input:focus { outline: none; border-color: var(--accent); }
        .team-selector .team-wrap input::placeholder { color: var(--text-muted); }
        .team-selector .vs-label { font-size: 16px; font-weight: 700; color: var(--accent); flex-shrink: 0; }

        .autocomplete { position: absolute; top: calc(100% + 4px); left: 0; right: 0; background: var(--bg-card); border: 1px solid var(--border); border-radius: 10px; max-height: 200px; overflow-y: auto; z-index: 50; display: none; box-shadow: 0 8px 30px rgba(0,0,0,0.4); }
        .autocomplete.show { display: block; }
        .ac-item { padding: 10px 14px; cursor: pointer; font-size: 13px; border-bottom: 1px solid var(--border); transition: background 0.1s; }
        .ac-item:hover { background: var(--accent-dim); }
        .ac-item:last-child { border-bottom: none; }

        /* SPONSORS */
        .sponsors-section { border-top: 1px solid var(--border); padding-top: 16px; margin-top: 16px; }
        .sponsors-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .sponsors-header h4 { font-size: 13px; font-weight: 600; }
        .btn-add-sm { padding: 4px 12px; border-radius: 6px; border: 1px solid var(--green); background: var(--green-dim); color: var(--green); font-size: 11px; cursor: pointer; font-family: inherit; font-weight: 600; }
        .btn-add-sm:hover { background: rgba(52,211,153,0.2); }

        .sponsor-item { background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 10px; padding: 14px; margin-bottom: 8px; position: relative; }
        .sponsor-item .btn-rm { position: absolute; top: 8px; right: 8px; width: 22px; height: 22px; border-radius: 6px; border: none; background: var(--red-dim); color: var(--red); font-size: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .sponsor-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .sponsor-grid .full { grid-column: span 2; }
        .sponsor-grid label { font-size: 11px; color: var(--text-muted); margin-bottom: 3px; display: block; }
        .sponsor-grid input { width: 100%; padding: 7px 10px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-card); color: var(--text-primary); font-size: 12px; font-family: inherit; }
        .sponsor-grid input:focus { outline: none; border-color: var(--accent); }

        .empty-state { text-align: center; padding: 40px; color: var(--text-muted); font-size: 13px; }

        /* TOAST */
        .toast { position: fixed; bottom: 20px; right: 20px; padding: 12px 20px; border-radius: 10px; background: var(--bg-card); border: 1px solid var(--border); color: var(--text-primary); font-size: 13px; font-weight: 500; z-index: 999; transform: translateY(100px); opacity: 0; transition: all 0.3s; }
        .toast.show { transform: translateY(0); opacity: 1; }

        /* MOBILE */
        .mobile-toggle { display: none; position: fixed; top: 16px; left: 16px; z-index: 200; width: 40px; height: 40px; border-radius: 10px; background: var(--bg-card); border: 1px solid var(--border); color: var(--text-primary); font-size: 18px; cursor: pointer; align-items: center; justify-content: center; }
        .overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 90; }
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.open { transform: translateX(0); }
            .overlay.open { display: block; }
            .mobile-toggle { display: flex; }
            .main { margin-left: 0; }
            .topbar { padding: 0 16px 0 64px; }
            .content { padding: 16px; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .form-row, .form-row-3 { grid-template-columns: 1fr; }
            .team-selector { flex-direction: column; }
            .sponsor-grid { grid-template-columns: 1fr; }
            .sponsor-grid .full { grid-column: span 1; }
            .table-card { overflow-x: auto; }
        }
    </style>
</head>
<body>

    <button class="mobile-toggle" onclick="toggleSidebar()">‚ò∞</button>
    <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-brand"><div class="logo">Y</div><h1>Yellup <span>Admin</span></h1></div>
        <nav class="sidebar-nav">
            <div class="nav-group"><div class="nav-group-title">Vis√£o Geral</div><a href="dashboard.html" class="nav-item"><span class="icon">üìä</span> Dashboard</a></div>
            <div class="nav-group"><div class="nav-group-title">Conte√∫do</div><a href="jogos.html" class="nav-item active"><span class="icon">üéÆ</span> Jogos</a><a href="perguntas.html" class="nav-item"><span class="icon">‚ùì</span> Perguntas</a><a href="importar-perguntas.html" class="nav-item"><span class="icon">üì•</span> Importar</a><a href="gerar-perguntas.html" class="nav-item"><span class="icon">ü§ñ</span> Gerar com IA</a><a href="times.html" class="nav-item"><span class="icon">‚öΩ</span> Times</a></div>
            <div class="nav-group"><div class="nav-group-title">Jogadores</div><a href="usuarios.html" class="nav-item"><span class="icon">üë•</span> Usu√°rios</a><a href="ranking.html" class="nav-item"><span class="icon">üèÜ</span> Rankings</a><a href="admin-noticias.html" class="nav-item"><span class="icon">üì∞</span> Not√≠cias</a></div>
            <div class="nav-group"><div class="nav-group-title">Competi√ß√µes</div><a href="torneios.html" class="nav-item"><span class="icon">üèÖ</span> Torneios</a><a href="inicializar-pvp.html" class="nav-item"><span class="icon">‚öîÔ∏è</span> Embates PvP</a></div>
            <div class="nav-group"><div class="nav-group-title">Financeiro</div><a href="financeiro.html" class="nav-item"><span class="icon">üí∞</span> Resumo</a><a href="creditar-manual.html" class="nav-item"><span class="icon">‚ûï</span> Creditar Manual</a><a href="transacoes.html" class="nav-item"><span class="icon">üí≥</span> Transa√ß√µes</a><a href="premiacao.html" class="nav-item"><span class="icon">üéÅ</span> Premia√ß√£o</a><a href="indicacoes.html" class="nav-item"><span class="icon">üîó</span> Indica√ß√µes</a></div>
            <div class="nav-group"><div class="nav-group-title">Bolsa</div><a href="bolsa-admin.html" class="nav-item"><span class="icon">üìà</span> Gest√£o da Bolsa</a></div>
            <div class="nav-group"><div class="nav-group-title">Sistema</div><a href="configuracoes.html" class="nav-item"><span class="icon">‚öôÔ∏è</span> Configura√ß√µes</a><a href="checkup.html" class="nav-item"><span class="icon">üîç</span> Checkup</a><a href="simulador_avancado.html" class="nav-item"><span class="icon">üß™</span> Simulador</a><a href="teste-regras.html" class="nav-item"><span class="icon">üìú</span> Regras</a></div>
        </nav>
        <div class="sidebar-footer"><div class="admin-box"><div class="admin-avatar">A</div><div class="admin-info-text"><div class="name">Admin</div><div class="role">Administrador</div></div><button class="btn-logout" onclick="sair()" title="Sair">‚èª</button></div></div>
    </aside>

    <!-- MAIN -->
    <div class="main">
        <div class="topbar">
            <div class="topbar-left">
                <h2>üéÆ Jogos</h2>
                <p>Criar, gerenciar e acompanhar partidas</p>
            </div>
            <div class="topbar-actions">
                <button class="btn-outline" onclick="exportarCSV()">üì• CSV</button>
                <button class="btn-primary" onclick="abrirModal()">+ Novo Jogo</button>
            </div>
        </div>

        <div class="content">
            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card"><div class="stat-value" id="statTotal">0</div><div class="stat-label">üìÖ Total de Jogos</div></div>
                <div class="stat-card"><div class="stat-value" id="statAoVivo" style="color:var(--red)">0</div><div class="stat-label">üî¥ Ao Vivo</div></div>
                <div class="stat-card"><div class="stat-value" id="statAgendados" style="color:var(--blue)">0</div><div class="stat-label">üìÜ Agendados</div></div>
                <div class="stat-card"><div class="stat-value" id="statFinalizados" style="color:var(--green)">0</div><div class="stat-label">‚úÖ Finalizados</div></div>
            </div>

            <!-- Filters -->
            <div class="filter-bar">
                <select class="filter-select" id="filtroStatus" onchange="filtrarJogos()">
                    <option value="">Todos</option>
                    <option value="ao_vivo">üî¥ Ao Vivo</option>
                    <option value="agendado">üìÜ Agendado</option>
                    <option value="finalizado">‚úÖ Finalizado</option>
                </select>
                <select class="filter-select" id="filtroTime" onchange="filtrarJogos()">
                    <option value="">Todos os Times</option>
                </select>
                <input type="date" class="filter-input" id="filtroDataInicio" onchange="filtrarJogos()" title="Data in√≠cio">
                <input type="date" class="filter-input" id="filtroDataFim" onchange="filtrarJogos()" title="Data fim">
            </div>

            <!-- Table -->
            <div class="table-card">
                <table>
                    <thead>
                        <tr>
                            <th>Partida</th>
                            <th>Data</th>
                            <th>Entrada</th>
                            <th>Sponsors</th>
                            <th>Jogadores</th>
                            <th>Cr√©ditos</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="listaJogos">
                        <tr><td colspan="8" class="empty-state">Carregando jogos...</td></tr>
                    </tbody>
                </table>
                <div class="pagination">
                    <span class="info" id="paginaInfo">‚Äî</span>
                    <div style="display:flex;gap:6px">
                        <button class="pg-btn" onclick="paginaAnterior()" id="btnAnterior" disabled>‚Üê</button>
                        <button class="pg-btn" onclick="proximaPagina()" id="btnProxima">‚Üí</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitulo">Novo Jogo</h3>
                <button class="modal-close" onclick="fecharModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="jogoId">

                <!-- Team selector -->
                <div class="team-selector">
                    <div class="team-wrap">
                        <input type="text" id="timeCasaInput" placeholder="üè† Time da Casa..." autocomplete="off">
                        <input type="hidden" id="timeCasa">
                        <div class="autocomplete" id="listaCasa"></div>
                    </div>
                    <span class="vs-label">VS</span>
                    <div class="team-wrap">
                        <input type="text" id="timeVisitanteInput" placeholder="‚úàÔ∏è Visitante..." autocomplete="off">
                        <input type="hidden" id="timeVisitante">
                        <div class="autocomplete" id="listaVisitante"></div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>üìÖ In√≠cio</label>
                        <input type="datetime-local" id="dataInicio">
                    </div>
                    <div class="form-group">
                        <label>üèÅ Fim</label>
                        <input type="datetime-local" id="dataFim">
                    </div>
                </div>

                <div class="form-row-3">
                    <div class="form-group">
                        <label>üèÜ Liga / Campeonato</label>
                        <select id="liga"><option value="">Selecione...</option></select>
                    </div>
                </div>

                <!-- Sponsors -->
                <div class="sponsors-section">

                <!-- ‚öΩ API-FOOTBALL: Vincular partida real -->
                <div style="background:rgba(46,204,113,0.08);border:1px solid rgba(46,204,113,0.25);border-radius:12px;padding:14px;margin-bottom:16px;">
                    <h4 style="margin:0 0 8px;font-size:0.95em;">‚öΩ Placar Ao Vivo (API-Football)</h4>
                    <div class="form-hint" style="margin-bottom:10px;">Vincule uma partida real para placar autom√°tico. Busque por data ou ID.</div>
                    <div style="display:flex;gap:8px;margin-bottom:8px;">
                        <input type="text" id="apiBusca" placeholder="Buscar por time ou ID da partida..." style="flex:1;padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.06);color:white;font-size:0.9em;">
                        <button type="button" onclick="buscarPartidaAPI()" style="padding:8px 16px;background:linear-gradient(135deg,#2ecc71,#27ae60);border:none;border-radius:8px;color:white;font-weight:600;cursor:pointer;white-space:nowrap;">üîç Buscar</button>
                    </div>
                    <div id="apiResultados" style="max-height:200px;overflow-y:auto;"></div>
                    <div id="apiVinculado" style="display:none;padding:10px;background:rgba(46,204,113,0.15);border-radius:8px;margin-top:8px;">
                        <span id="apiVinculadoTexto" style="font-size:0.85em;"></span>
                        <button type="button" onclick="desvincularAPI()" style="margin-left:8px;background:none;border:none;color:#e74c3c;cursor:pointer;font-size:0.8em;">‚úï Remover</button>
                    </div>
                    <input type="hidden" id="apiFootballId">
                </div>

                <!-- üìä Placar Manual (fallback) -->
                <div style="background:rgba(52,152,219,0.08);border:1px solid rgba(52,152,219,0.25);border-radius:12px;padding:14px;margin-bottom:16px;">
                    <h4 style="margin:0 0 8px;font-size:0.95em;">üìä Placar Manual <span style="font-size:0.75em;color:var(--text-secondary);">(se n√£o usar API)</span></h4>
                    <div style="display:flex;gap:12px;align-items:center;justify-content:center;">
                        <div style="text-align:center;">
                            <label style="font-size:0.75em;color:var(--text-secondary);">Casa</label>
                            <input type="number" id="placarCasa" min="0" value="" placeholder="-" style="width:60px;padding:8px;text-align:center;border-radius:8px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.06);color:white;font-size:1.2em;font-weight:700;">
                        </div>
                        <span style="font-size:1.5em;font-weight:700;color:var(--text-secondary);">√ó</span>
                        <div style="text-align:center;">
                            <label style="font-size:0.75em;color:var(--text-secondary);">Fora</label>
                            <input type="number" id="placarFora" min="0" value="" placeholder="-" style="width:60px;padding:8px;text-align:center;border-radius:8px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.06);color:white;font-size:1.2em;font-weight:700;">
                        </div>
                        <div style="text-align:center;">
                            <label style="font-size:0.75em;color:var(--text-secondary);">Min.</label>
                            <input type="number" id="minutosJogo" min="0" max="120" value="" placeholder="-" style="width:60px;padding:8px;text-align:center;border-radius:8px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.06);color:white;font-size:1.2em;font-weight:700;">
                        </div>
                    </div>
                </div>

                <div class="sponsors-section">
                    <div class="sponsors-header">
                        <h4>üì¢ Patrocinadores</h4>
                        <button class="btn-add-sm" onclick="adicionarPatrocinador()">+ Adicionar</button>
                    </div>
                    <div class="form-hint" style="margin-bottom:10px">A cada 5 respostas, o usu√°rio v√™ um patrocinador. Ao clicar, ganha cr√©ditos.</div>
                    <div id="patrocinadoresContainer"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" onclick="salvarJogo()">üíæ Salvar Jogo</button>
                <button class="btn-cancel" onclick="fecharModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        // ===== BANDEIRAS =====
        const BANDEIRAS = {
            'brasil':'üáßüá∑','argentina':'üá¶üá∑','uruguai':'üá∫üáæ','paraguai':'üáµüáæ','chile':'üá®üá±',
            'col√¥mbia':'üá®üá¥','colombia':'üá®üá¥','peru':'üáµüá™','equador':'üá™üá®','venezuela':'üáªüá™',
            'bol√≠via':'üáßüá¥','bolivia':'üáßüá¥','espanha':'üá™üá∏','it√°lia':'üáÆüáπ','italia':'üáÆüáπ',
            'alemanha':'üá©üá™','fran√ßa':'üá´üá∑','franca':'üá´üá∑','inglaterra':'üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø','portugal':'üáµüáπ',
            'holanda':'üá≥üá±','b√©lgica':'üáßüá™','belgica':'üáßüá™','su√≠√ßa':'üá®üá≠','√°ustria':'üá¶üáπ',
            'pol√¥nia':'üáµüá±','ucr√¢nia':'üá∫üá¶','gr√©cia':'üá¨üá∑','turquia':'üáπüá∑','r√∫ssia':'üá∑üá∫',
            'russia':'üá∑üá∫','su√©cia':'üá∏üá™','dinamarca':'üá©üá∞','noruega':'üá≥üá¥','esc√≥cia':'üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø',
            'jap√£o':'üáØüáµ','china':'üá®üá≥','coreia do sul':'üá∞üá∑','ar√°bia saudita':'üá∏üá¶',
            'qatar':'üá∂üá¶','austr√°lia':'üá¶üá∫','m√©xico':'üá≤üáΩ','mexico':'üá≤üáΩ','eua':'üá∫üá∏'
        };
        function bandeira(t) { return t?.pais ? (BANDEIRAS[(t.pais||'').toLowerCase().trim()]||'') : ''; }
        function nomeComBandeira(t) { return t?.nome ? `${bandeira(t)} ${t.nome}`.trim() : 'Desconhecido'; }

        // ===== FIREBASE =====
        firebase.initializeApp({
            apiKey: "AIzaSyC5ZrkEy7KuCFJOtPvI7-P-JcA0MF4im5c",
            authDomain: "painel-yellup.firebaseapp.com",
            projectId: "painel-yellup",
            storageBucket: "painel-yellup.appspot.com",
            messagingSenderId: "608347210297",
            appId: "1:608347210297:web:75092713724e617c7203e8"
        });
        const db = firebase.firestore();
        const auth = firebase.auth();

        let todosJogos = [], jogosFiltrados = [], todosTimes = [], timesMap = {};
        let torcidaCountMap = {}, creditosPagosMap = {};
        let paginaAtual = 1;
        const porPagina = 10;

        auth.onAuthStateChanged(user => {
            if (!user || user.email !== 'admin@yellup.com') { window.location.href = 'login.html'; return; }
            Promise.all([carregarTimes(), carregarCampeonatos()]).then(() => carregarJogos());
        });

        function sair() { auth.signOut().then(() => window.location.href = 'login.html'); }
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); document.getElementById('overlay').classList.toggle('open'); }

        // ===== STATUS AUTO =====
        function calcularStatus(dataInicio, dataFim) {
            const agora = new Date();
            const ini = dataInicio?.toDate ? dataInicio.toDate() : new Date(dataInicio);
            const fim = dataFim?.toDate ? dataFim.toDate() : new Date(dataFim);
            if (agora < ini) return 'agendado';
            if (agora >= ini && agora <= fim) return 'ao_vivo';
            return 'finalizado';
        }

        async function atualizarStatusJogos() {
            const batch = db.batch();
            let n = 0;
            for (const j of todosJogos) {
                const calc = calcularStatus(j.dataInicio, j.dataFim);
                if (j.status !== calc) {
                    batch.update(db.collection('jogos').doc(j.id), { status: calc });
                    j.status = calc;
                    n++;
                }
            }
            if (n > 0) { await batch.commit(); atualizarStats(); renderizarJogos(); }
        }

        // ===== LOAD TORCEDORES =====
        async function carregarContagemTorcedores() {
            try {
                const snap = await db.collection('usuarios').get();
                torcidaCountMap = {}; creditosPagosMap = {};
                snap.forEach(doc => {
                    const u = doc.data();
                    if (u.torcidas) Object.keys(u.torcidas).forEach(jid => { torcidaCountMap[jid] = (torcidaCountMap[jid]||0) + 1; });
                    if (u.creditosPagosJogo) Object.keys(u.creditosPagosJogo).forEach(jid => { creditosPagosMap[jid] = (creditosPagosMap[jid]||0) + (u.creditosPagosJogo[jid]||0); });
                });
            } catch (e) { console.error('Erro torcidas:', e); }
        }

        // ===== LOAD TIMES =====
        async function carregarTimes() {
            const snap = await db.collection('times').orderBy('nome').get();
            todosTimes = [];
            snap.forEach(doc => { const t = { id: doc.id, ...doc.data() }; todosTimes.push(t); timesMap[doc.id] = t; });
            // Filtro
            const sel = document.getElementById('filtroTime');
            sel.innerHTML = '<option value="">Todos os Times</option>' + todosTimes.map(t => `<option value="${t.id}">${nomeComBandeira(t)}</option>`).join('');
            // Autocomplete
            setupAC('timeCasaInput', 'timeCasa', 'listaCasa');
            setupAC('timeVisitanteInput', 'timeVisitante', 'listaVisitante');
        }

        function setupAC(inputId, hiddenId, listId) {
            const input = document.getElementById(inputId);
            const hidden = document.getElementById(hiddenId);
            const list = document.getElementById(listId);
            input.addEventListener('input', () => {
                const v = input.value.toLowerCase().trim();
                hidden.value = '';
                if (v.length < 1) { list.classList.remove('show'); return; }
                const f = todosTimes.filter(t => t.nome.toLowerCase().includes(v) || (t.pais||'').toLowerCase().includes(v)).slice(0, 10);
                if (!f.length) { list.classList.remove('show'); return; }
                list.innerHTML = f.map(t => `<div class="ac-item" data-id="${t.id}" data-nome="${t.nome}">${nomeComBandeira(t)}</div>`).join('');
                list.querySelectorAll('.ac-item').forEach(item => {
                    item.addEventListener('click', () => { input.value = item.dataset.nome; hidden.value = item.dataset.id; list.classList.remove('show'); });
                });
                list.classList.add('show');
            });
            document.addEventListener('click', e => { if (!input.contains(e.target) && !list.contains(e.target)) list.classList.remove('show'); });
        }

        // ===== LOAD CAMPEONATOS =====
        async function carregarCampeonatos() {
            try {
                const snap = await db.collection('campeonatos').orderBy('nome').get();
                let html = '<option value="">Selecione...</option><option value="Amistoso">Amistoso</option>';
                snap.forEach(doc => { html += `<option value="${doc.data().nome}">${doc.data().nome}</option>`; });
                html += '<option value="outro">‚ûï Outro</option>';
                document.getElementById('liga').innerHTML = html;
            } catch (e) {
                document.getElementById('liga').innerHTML = '<option value="">Selecione...</option><option value="Amistoso">Amistoso</option><option value="Brasileir√£o S√©rie A">Brasileir√£o S√©rie A</option><option value="Copa do Brasil">Copa do Brasil</option><option value="Libertadores">Libertadores</option><option value="Champions League">Champions League</option>';
            }
        }

        // ===== LOAD JOGOS =====
        async function carregarJogos() {
            try {
                await carregarContagemTorcedores();
                const snap = await db.collection('jogos').orderBy('dataInicio', 'desc').get();
                todosJogos = [];
                snap.forEach(doc => todosJogos.push({ id: doc.id, ...doc.data() }));
                await atualizarStatusJogos();
                atualizarStats();
                jogosFiltrados = [...todosJogos];
                renderizarJogos();
            } catch (e) { console.error('Erro jogos:', e); }
        }

        function atualizarStats() {
            let ao = 0, ag = 0, fi = 0;
            todosJogos.forEach(j => { if (j.status === 'ao_vivo') ao++; else if (j.status === 'agendado') ag++; else fi++; });
            document.getElementById('statTotal').textContent = todosJogos.length;
            document.getElementById('statAoVivo').textContent = ao;
            document.getElementById('statAgendados').textContent = ag;
            document.getElementById('statFinalizados').textContent = fi;
        }

        // ===== RENDER =====
        function renderizarJogos() {
            const tbody = document.getElementById('listaJogos');
            if (!jogosFiltrados.length) { tbody.innerHTML = '<tr><td colspan="8" class="empty-state">Nenhum jogo encontrado</td></tr>'; atualizarPag(); return; }

            const inicio = (paginaAtual - 1) * porPagina;
            const pagina = jogosFiltrados.slice(inicio, inicio + porPagina);

            tbody.innerHTML = pagina.map(j => {
                const tc = timesMap[j.timeCasaId] || { nome: 'Time A', primaria: '#666', secundaria: '#444' };
                const tf = timesMap[j.timeForaId] || { nome: 'Time B', primaria: '#666', secundaria: '#444' };
                const di = j.dataInicio?.toDate ? j.dataInicio.toDate() : new Date(j.dataInicio);
                const df = j.dataFim?.toDate ? j.dataFim.toDate() : new Date(j.dataFim);
                const pats = (j.patrocinadores||[]).length;
                const jogadores = torcidaCountMap[j.id] || j.participantes || 0;
                const creds = creditosPagosMap[j.id] || 0;

                const statusBadge = j.status === 'ao_vivo' ? '<span class="badge badge-live">üî¥ Ao Vivo</span>'
                    : j.status === 'agendado' ? '<span class="badge badge-scheduled">üìÜ Agendado</span>'
                    : '<span class="badge badge-finished">‚úÖ Finalizado</span>';

                const apiBadge = j.apiFootballId ? '<span class="badge" style="background:rgba(46,204,113,0.15);color:#2ecc71;font-size:0.7em;" title="Placar autom√°tico vinculado">‚öΩ API</span>' : '';
                const placarTxt = (j.placarCasa != null && j.placarFora != null) ? `<div style="font-weight:700;font-size:0.95em;margin-top:2px;">${j.placarCasa} √ó ${j.placarFora}${j.minutosJogo ? " <span style='font-size:0.75em;color:var(--text-secondary)'>"+j.minutosJogo+"'</span>" : ''}</div>` : '';

                const entradaBadge = '<span class="badge badge-free">üÜì Gr√°tis</span>';

                return `<tr>
                    <td><div class="match-cell">
                        <div class="escudo" style="background:linear-gradient(135deg,${tc.primaria||'#666'},${tc.secundaria||'#444'})">${(tc.nome||'T').charAt(0)}</div>
                        <span class="team-n" title="${esc(tc.nome)}">${esc(tc.nome)}</span>
                        <span class="vs-tag">VS</span>
                        <div class="escudo" style="background:linear-gradient(135deg,${tf.primaria||'#666'},${tf.secundaria||'#444'})">${(tf.nome||'T').charAt(0)}</div>
                        <span class="team-n" title="${esc(tf.nome)}">${esc(tf.nome)}</span>
                    </div></td>
                    <td><div class="date-cell"><div class="date-main">${di.toLocaleDateString('pt-BR')}</div><div class="date-time">${di.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'})} ‚Üí ${df.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'})}</div></div></td>
                    <td>${entradaBadge}</td>
                    <td><span class="badge badge-sponsor">üì¢ ${pats}</span></td>
                    <td><span class="mono">${jogadores}</span> üë•</td>
                    <td><span class="mono" style="color:var(--accent)">${creds}</span> üí∞</td>
                    <td>${statusBadge} ${apiBadge}${placarTxt}</td>
                    <td><div class="actions">
                        <button class="btn-icon play" onclick="window.open('painel-jogo.html?jogoId=${j.id}','_blank')" title="Acessar Partida">üéÆ</button>
                        ${j.status === 'ao_vivo' && j.apiFootballId ? `<button class="btn-icon" onclick="atualizarPlacarManual('${j.id}')" title="Atualizar Placar API" style="color:#2ecc71;">‚öΩ</button>` : ''}
                        <button class="btn-icon" onclick="editarJogo('${j.id}')" title="Editar">‚úèÔ∏è</button>
                        <button class="btn-icon danger" onclick="excluirJogo('${j.id}')" title="Excluir">üóëÔ∏è</button>
                    </div></td>
                </tr>`;
            }).join('');

            atualizarPag();
        }

        function esc(t) { const d = document.createElement('div'); d.textContent = t; return d.innerHTML; }

        // ===== FILTER =====
        function filtrarJogos() {
            const status = document.getElementById('filtroStatus').value;
            const timeId = document.getElementById('filtroTime').value;
            const di = document.getElementById('filtroDataInicio').value;
            const df = document.getElementById('filtroDataFim').value;

            jogosFiltrados = todosJogos.filter(j => {
                if (status && j.status !== status) return false;
                if (timeId && j.timeCasaId !== timeId && j.timeForaId !== timeId) return false;
                if (di && j.dataInicio?.toDate) { if (j.dataInicio.toDate() < new Date(di)) return false; }
                if (df && j.dataInicio?.toDate) { const fd = new Date(df); fd.setHours(23,59,59); if (j.dataInicio.toDate() > fd) return false; }
                return true;
            });
            paginaAtual = 1;
            renderizarJogos();
        }

        // ===== PAGINATION =====
        function atualizarPag() {
            const total = Math.ceil(jogosFiltrados.length / porPagina) || 1;
            document.getElementById('paginaInfo').textContent = `P√°gina ${paginaAtual} de ${total} ¬∑ ${jogosFiltrados.length} jogos`;
            document.getElementById('btnAnterior').disabled = paginaAtual <= 1;
            document.getElementById('btnProxima').disabled = paginaAtual >= total;
        }
        function paginaAnterior() { if (paginaAtual > 1) { paginaAtual--; renderizarJogos(); } }
        function proximaPagina() { if (paginaAtual < Math.ceil(jogosFiltrados.length / porPagina)) { paginaAtual++; renderizarJogos(); } }

        // ===== MODAL =====
        function abrirModal() {
            document.getElementById('modalTitulo').textContent = 'Novo Jogo';
            document.getElementById('jogoId').value = '';
            document.getElementById('timeCasaInput').value = '';
            document.getElementById('timeCasa').value = '';
            document.getElementById('timeVisitanteInput').value = '';
            document.getElementById('timeVisitante').value = '';
            document.getElementById('dataInicio').value = '';
            document.getElementById('dataFim').value = '';
            document.getElementById('liga').value = '';
            document.getElementById('patrocinadoresContainer').innerHTML = '';
            // Reset API-Football fields
            document.getElementById('apiFootballId').value = '';
            document.getElementById('apiBusca').value = '';
            document.getElementById('apiResultados').innerHTML = '';
            document.getElementById('apiVinculado').style.display = 'none';
            document.getElementById('placarCasa').value = '';
            document.getElementById('placarFora').value = '';
            document.getElementById('minutosJogo').value = '';
            document.getElementById('modalOverlay').classList.add('active');
        }

        function fecharModal() { document.getElementById('modalOverlay').classList.remove('active'); }

        // ===== API-FOOTBALL BUSCA =====
        async function buscarPartidaAPI() {
            const busca = document.getElementById('apiBusca').value.trim();
            const res = document.getElementById('apiResultados');
            if (!busca) { showToast('‚ö†Ô∏è Digite um time ou ID'); return; }
            res.innerHTML = '<div style="padding:10px;color:var(--text-secondary);font-size:0.85em;">üîç Buscando...</div>';

            try {
                const fn = firebase.functions().httpsCallable('buscarPartidaAPIFootball');
                let params = {};
                
                if (/^\d+$/.test(busca)) {
                    params.fixtureId = busca;
                } else {
                    // Buscar por nome do time na data selecionada ou hoje
                    const dataInput = document.getElementById('dataInicio').value;
                    const dataJogo = dataInput ? dataInput.split('T')[0] : new Date().toISOString().split('T')[0];
                    params.timeA = busca;
                    params.data = dataJogo;
                }

                const result = await fn(params);
                if (!result.data.sucesso || result.data.partidas.length === 0) {
                    res.innerHTML = '<div style="padding:10px;color:#e74c3c;font-size:0.85em;">‚ùå Nenhuma partida encontrada. Tente outro termo ou data.</div>';
                    return;
                }

                res.innerHTML = result.data.partidas.map(p => `
                    <div onclick="selecionarPartidaAPI(${p.fixtureId}, '${esc(p.timeCasa.nome)}', '${esc(p.timeFora.nome)}', '${p.status}', ${p.placar.casa??'null'}, ${p.placar.fora??'null'}, '${esc(p.liga.nome)}')" 
                         style="padding:8px 10px;border-radius:8px;cursor:pointer;margin-bottom:4px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);display:flex;justify-content:space-between;align-items:center;transition:background 0.2s;"
                         onmouseover="this.style.background='rgba(46,204,113,0.15)'" onmouseout="this.style.background='rgba(255,255,255,0.04)'">
                        <div>
                            <div style="font-weight:600;font-size:0.9em;">${esc(p.timeCasa.nome)} vs ${esc(p.timeFora.nome)}</div>
                            <div style="font-size:0.75em;color:var(--text-secondary);">${esc(p.liga.nome)} ¬∑ ${p.statusLong} ${p.minutos ? '¬∑ '+p.minutos+"'" : ''}</div>
                        </div>
                        <div style="text-align:right;">
                            <div style="font-weight:700;font-size:1.1em;">${p.placar.casa??'-'} √ó ${p.placar.fora??'-'}</div>
                            <div style="font-size:0.7em;color:var(--text-secondary);">ID: ${p.fixtureId}</div>
                        </div>
                    </div>
                `).join('');
            } catch(e) {
                res.innerHTML = `<div style="padding:10px;color:#e74c3c;font-size:0.85em;">‚ùå Erro: ${e.message}</div>`;
            }
        }

        function selecionarPartidaAPI(id, casa, fora, status, golsCasa, golsFora, liga) {
            document.getElementById('apiFootballId').value = id;
            document.getElementById('apiResultados').innerHTML = '';
            document.getElementById('apiVinculado').style.display = 'block';
            document.getElementById('apiVinculadoTexto').innerHTML = `‚úÖ <strong>${casa} vs ${fora}</strong> ¬∑ ${liga} ¬∑ ID: ${id}`;
            if (golsCasa !== null) document.getElementById('placarCasa').value = golsCasa;
            if (golsFora !== null) document.getElementById('placarFora').value = golsFora;
            showToast(`‚úÖ Partida vinculada! ID: ${id}`);
        }

        function desvincularAPI() {
            document.getElementById('apiFootballId').value = '';
            document.getElementById('apiVinculado').style.display = 'none';
            document.getElementById('apiVinculadoTexto').innerHTML = '';
        }

        async function atualizarPlacarManual(jogoId) {
            try {
                showToast('‚öΩ Atualizando placar...');
                const fn = firebase.functions().httpsCallable('atualizarPlacarAoVivo');
                const result = await fn({});
                showToast(`‚úÖ ${result.data.atualizados} jogo(s) atualizado(s)!`);
                carregarJogos();
            } catch(e) { showToast('‚ùå Erro: ' + e.message); }
        }

        // ===== EDIT =====
        function editarJogo(id) {
            const j = todosJogos.find(x => x.id === id);
            if (!j) return;
            document.getElementById('modalTitulo').textContent = 'Editar Jogo';
            document.getElementById('jogoId').value = id;
            const tc = timesMap[j.timeCasaId], tf = timesMap[j.timeForaId];
            document.getElementById('timeCasaInput').value = tc ? tc.nome : '';
            document.getElementById('timeCasa').value = j.timeCasaId || '';
            document.getElementById('timeVisitanteInput').value = tf ? tf.nome : '';
            document.getElementById('timeVisitante').value = j.timeForaId || '';
            document.getElementById('liga').value = j.liga || j.campeonato || '';
            if (j.dataInicio?.toDate) document.getElementById('dataInicio').value = fmtLocal(j.dataInicio.toDate());
            if (j.dataFim?.toDate) document.getElementById('dataFim').value = fmtLocal(j.dataFim.toDate());
            document.getElementById('patrocinadoresContainer').innerHTML = '';
            if (j.patrocinadores?.length) j.patrocinadores.forEach(p => adicionarPatrocinador(p));
            // API-Football fields
            document.getElementById('apiFootballId').value = j.apiFootballId || '';
            document.getElementById('placarCasa').value = j.placarCasa ?? '';
            document.getElementById('placarFora').value = j.placarFora ?? '';
            document.getElementById('minutosJogo').value = j.minutosJogo ?? '';
            document.getElementById('apiBusca').value = '';
            document.getElementById('apiResultados').innerHTML = '';
            if (j.apiFootballId) {
                document.getElementById('apiVinculado').style.display = 'block';
                document.getElementById('apiVinculadoTexto').innerHTML = `‚úÖ Partida vinculada ¬∑ ID: <strong>${j.apiFootballId}</strong>`;
            } else {
                document.getElementById('apiVinculado').style.display = 'none';
            }
            document.getElementById('modalOverlay').classList.add('active');
        }

        function fmtLocal(d) {
            return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}T${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
        }

        // ===== PATROCINADORES =====
        function adicionarPatrocinador(dados = null) {
            const c = document.getElementById('patrocinadoresContainer');
            const div = document.createElement('div');
            div.className = 'sponsor-item';
            const n = dados?.nome||'', url = dados?.url||'', cr = dados?.creditos||5, logo = dados?.logo||'üéÅ', logoUrl = dados?.logoUrl||'', desc = dados?.descricao||'';
            div.innerHTML = `
                <button class="btn-rm" onclick="this.parentElement.remove()">‚úï</button>
                <div class="sponsor-grid">
                    <div><label>Nome</label><input type="text" class="pat-nome" placeholder="Empresa ABC" value="${esc(n)}"></div>
                    <div><label>Cr√©ditos</label><input type="number" class="pat-creditos" value="${cr}" min="1"></div>
                    <div class="full"><label>URL do Site</label><input type="url" class="pat-url" placeholder="https://..." value="${esc(url)}"></div>
                    <div><label>Emoji</label><input type="text" class="pat-logo" placeholder="üéÅ" value="${logo}" maxlength="4"></div>
                    <div><label>Logo URL</label><input type="url" class="pat-logoUrl" placeholder="https://..." value="${esc(logoUrl)}"></div>
                    <div class="full"><label>Descri√ß√£o</label><input type="text" class="pat-descricao" placeholder="Visite nosso site!" value="${esc(desc)}"></div>
                </div>`;
            c.appendChild(div);
        }

        function coletarPatrocinadores() {
            return [...document.querySelectorAll('.sponsor-item')].map(item => ({
                nome: item.querySelector('.pat-nome').value.trim(),
                creditos: parseInt(item.querySelector('.pat-creditos').value) || 5,
                url: item.querySelector('.pat-url').value.trim(),
                logo: item.querySelector('.pat-logo').value.trim() || 'üéÅ',
                logoUrl: item.querySelector('.pat-logoUrl').value.trim(),
                descricao: item.querySelector('.pat-descricao').value.trim()
            })).filter(p => p.nome);
        }

        // ===== SAVE =====
        async function salvarJogo() {
            const id = document.getElementById('jogoId').value;
            const casaId = document.getElementById('timeCasa').value;
            const foraId = document.getElementById('timeVisitante').value;
            if (!casaId || !foraId) { showToast('‚ö†Ô∏è Selecione os dois times!'); return; }
            if (casaId === foraId) { showToast('‚ö†Ô∏è Times diferentes!'); return; }
            const diVal = document.getElementById('dataInicio').value;
            const dfVal = document.getElementById('dataFim').value;
            if (!diVal || !dfVal) { showToast('‚ö†Ô∏è Preencha as datas!'); return; }

            const dataInicio = new Date(diVal), dataFim = new Date(dfVal);
            const dados = {
                timeCasaId: casaId, timeForaId: foraId,
                status: calcularStatus(dataInicio, dataFim),
                liga: document.getElementById('liga').value || 'Amistoso',
                patrocinadores: coletarPatrocinadores(),
                dataInicio, dataFim
            };

            // API-Football
            const apiId = document.getElementById('apiFootballId').value.trim();
            if (apiId) dados.apiFootballId = parseInt(apiId) || apiId;
            else if (id) dados.apiFootballId = firebase.firestore.FieldValue.delete();

            // Placar manual
            const pc = document.getElementById('placarCasa').value;
            const pf = document.getElementById('placarFora').value;
            const mj = document.getElementById('minutosJogo').value;
            if (pc !== '') dados.placarCasa = parseInt(pc);
            if (pf !== '') dados.placarFora = parseInt(pf);
            if (mj !== '') dados.minutosJogo = parseInt(mj);

            try {
                if (id) {
                    await db.collection('jogos').doc(id).update(dados);
                    showToast('‚úÖ Jogo atualizado!');
                } else {
                    dados.participantes = 0;
                    dados.dataCriacao = firebase.firestore.FieldValue.serverTimestamp();
                    dados.premiado = false;
                    await db.collection('jogos').add(dados);
                    showToast('‚úÖ Jogo criado!');
                }
                fecharModal(); carregarJogos();
            } catch (e) { showToast('‚ùå ' + e.message); }
        }

        async function excluirJogo(id) {
            if (!confirm('Excluir este jogo?')) return;
            try { await db.collection('jogos').doc(id).delete(); showToast('üóëÔ∏è Exclu√≠do!'); carregarJogos(); }
            catch (e) { showToast('‚ùå ' + e.message); }
        }

        // ===== EXPORT =====
        function calcularPremioTotal(numJogadores) {
            const faixas = [
                { min: 0, max: 9, top: [10, 7, 5], fx: [] },
                { min: 10, max: 100, top: [18,16,14,12,10], fx: [{d:6,a:15,v:9},{d:16,a:25,v:7},{d:26,a:35,v:5},{d:36,a:45,v:4},{d:46,a:50,v:3}] },
                { min: 101, max: 500, top: [30,25,22,20,18], fx: [{d:6,a:15,v:16},{d:16,a:25,v:14},{d:26,a:35,v:12},{d:36,a:45,v:10},{d:46,a:50,v:5}] },
                { min: 501, max: Infinity, top: [50,45,40,35,30], fx: [{d:6,a:15,v:25},{d:16,a:25,v:20},{d:26,a:35,v:18},{d:36,a:45,v:15},{d:46,a:50,v:10}] }
            ];
            const f = faixas.find(x => numJogadores >= x.min && numJogadores <= x.max) || faixas[0];
            const mp = Math.min(50, numJogadores);
            let total = 0;
            for (let i = 0; i < Math.min(mp, f.top.length); i++) total += f.top[i];
            for (const fx of f.fx) { for (let p = fx.d; p <= fx.a && p <= mp; p++) total += fx.v; }
            return total;
        }

        function exportarCSV() {
            let csv = 'Time Casa,Time Visitante,In√≠cio,Fim,Patrocinadores,Jogadores,Pr√™mio Sistema,Status\n';
            jogosFiltrados.forEach(j => {
                const c = timesMap[j.timeCasaId]?.nome||'N/A', f = timesMap[j.timeForaId]?.nome||'N/A';
                const di = j.dataInicio?.toDate?.()?.toLocaleString('pt-BR')||'', df = j.dataFim?.toDate?.()?.toLocaleString('pt-BR')||'';
                const jog = torcidaCountMap[j.id]||0;
                const premio = jog > 0 ? calcularPremioTotal(jog) : 0;
                csv += `"${c}","${f}","${di}","${df}",${(j.patrocinadores||[]).length},${jog},${premio},"${j.status}"\n`;
            });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(new Blob([csv],{type:'text/csv'}));
            a.download = 'jogos_yellup.csv'; a.click();
            showToast('üì• CSV exportado!');
        }

        // ===== TOAST =====
        function showToast(m) { const t=document.getElementById('toast'); t.textContent=m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),3000); }

        // ===== SHORTCUTS =====
        document.getElementById('modalOverlay').addEventListener('click', e => { if (e.target === e.currentTarget) fecharModal(); });
        document.addEventListener('keydown', e => { if (e.key === 'Escape') fecharModal(); });

        // Auto-refresh status every 1 minute
        setInterval(() => { if (todosJogos.length) atualizarStatusJogos(); }, 60000);
    </script>
</body>
</html>
