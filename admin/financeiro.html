<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard Financeiro - Yellup Admin</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #0e141b 0%, #1a2332 100%);
      color: #e7eef7;
      min-height: 100vh;
      padding-bottom: 30px;
    }

    .header {
      background: rgba(14, 20, 27, 0.95);
      backdrop-filter: blur(20px);
      padding: 15px 20px;
      position: sticky;
      top: 0;
      z-index: 100;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 { font-size: 1.3em; display: flex; align-items: center; gap: 10px; }

    .btn-back {
      padding: 8px 16px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      color: #e7eef7;
      text-decoration: none;
      font-size: 0.9em;
      transition: all 0.3s;
    }

    .btn-back:hover { background: rgba(255, 255, 255, 0.2); }

    .container { max-width: 1400px; margin: 0 auto; padding: 20px; }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }

    .stat-card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 18px;
      text-align: center;
      transition: all 0.3s;
    }

    .stat-card:hover { background: rgba(255, 255, 255, 0.08); transform: translateY(-2px); }

    .stat-icon { font-size: 1.8em; margin-bottom: 8px; }
    .stat-valor { font-size: 1.5em; font-weight: 800; margin-bottom: 5px; }
    .stat-label { font-size: 0.75em; color: #a9b5c6; }
    
    .stat-valor.verde { color: #2ecc71; }
    .stat-valor.vermelho { color: #e74c3c; }
    .stat-valor.amarelo { color: #f1c40f; }
    .stat-valor.azul { color: #3498db; }
    .stat-valor.roxo { color: #9b59b6; }

    .section { margin-bottom: 30px; }
    .section-header { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      margin-bottom: 15px;
      flex-wrap: wrap;
      gap: 10px;
    }
    .section-title { font-size: 1em; font-weight: 600; display: flex; align-items: center; gap: 10px; }

    .filtros { display: flex; gap: 8px; flex-wrap: wrap; }

    .filtro-btn {
      padding: 6px 14px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      color: #a9b5c6;
      cursor: pointer;
      font-family: 'Poppins', sans-serif;
      font-size: 0.75em;
      transition: all 0.3s;
    }

    .filtro-btn:hover { background: rgba(255, 255, 255, 0.1); }
    .filtro-btn.active { background: rgba(255, 181, 71, 0.2); border-color: #ffb547; color: #ffb547; }

    .chart-container {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .chart-title { font-size: 0.9em; font-weight: 600; margin-bottom: 15px; color: #a9b5c6; }

    .charts-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }

    .table-container {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      overflow: hidden;
    }

    table { width: 100%; border-collapse: collapse; }

    th, td { padding: 12px 15px; text-align: left; }

    th { 
      background: rgba(255, 255, 255, 0.05); 
      font-size: 0.75em; 
      color: #a9b5c6;
      font-weight: 600;
    }

    td { 
      border-bottom: 1px solid rgba(255, 255, 255, 0.05); 
      font-size: 0.85em;
    }

    tr:hover td { background: rgba(255, 255, 255, 0.02); }

    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.7em;
      font-weight: 600;
    }

    .badge-pendente { background: rgba(241, 196, 15, 0.2); color: #f1c40f; }
    .badge-aprovado { background: rgba(46, 204, 113, 0.2); color: #2ecc71; }
    .badge-rejeitado { background: rgba(231, 76, 60, 0.2); color: #e74c3c; }

    .btn-action {
      padding: 5px 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-family: 'Poppins', sans-serif;
      font-size: 0.75em;
      transition: all 0.3s;
      margin: 2px;
    }

    .btn-aprovar { background: rgba(46, 204, 113, 0.2); color: #2ecc71; }
    .btn-aprovar:hover { background: rgba(46, 204, 113, 0.4); }
    .btn-rejeitar { background: rgba(231, 76, 60, 0.2); color: #e74c3c; }
    .btn-rejeitar:hover { background: rgba(231, 76, 60, 0.4); }

    .loading { text-align: center; padding: 40px; color: #a9b5c6; }

    .loading-spinner {
      width: 40px; height: 40px;
      border: 3px solid rgba(255, 181, 71, 0.2);
      border-top-color: #ffb547;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .empty-state { text-align: center; padding: 30px; color: #6b7a8f; }
    .empty-icon { font-size: 2em; margin-bottom: 8px; }

    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      opacity: 0;
      transition: all 0.3s;
      z-index: 1000;
    }

    .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

    @media (max-width: 900px) {
      .charts-row { grid-template-columns: 1fr; }
    }

    @media (max-width: 600px) {
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
      .table-container { overflow-x: auto; }
      table { min-width: 600px; }
    }
  </style>
</head>
<body>

  <div class="header">
    <div class="header-content">
      <h1>üí∞ Dashboard Financeiro</h1>
      <a href="dashboard.html" class="btn-back">‚Üê Painel Admin</a>
    </div>
  </div>

  <div class="container">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">üí≥</div>
        <div class="stat-valor verde" id="receitaTotal">R$ --</div>
        <div class="stat-label">Receita Total</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üìÖ</div>
        <div class="stat-valor verde" id="receitaMes">R$ --</div>
        <div class="stat-label">Receita do M√™s</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üõí</div>
        <div class="stat-valor azul" id="comprasHoje">--</div>
        <div class="stat-label">Compras Hoje</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üèÜ</div>
        <div class="stat-valor amarelo" id="premiosPagos">--</div>
        <div class="stat-label">Pr√™mios (m√™s)</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üí∏</div>
        <div class="stat-valor vermelho" id="saquesPendentes">--</div>
        <div class="stat-label">Saques Pendentes</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üìä</div>
        <div class="stat-valor roxo" id="ticketMedio">R$ --</div>
        <div class="stat-label">Ticket M√©dio</div>
      </div>
    </div>

    <div class="section">
      <div class="section-header">
        <div class="section-title">üìà Evolu√ß√£o de Receita</div>
        <div class="filtros">
          <button class="filtro-btn active" onclick="filtrarGrafico('7d')">7 dias</button>
          <button class="filtro-btn" onclick="filtrarGrafico('30d')">30 dias</button>
          <button class="filtro-btn" onclick="filtrarGrafico('90d')">90 dias</button>
        </div>
      </div>

      <div class="charts-row">
        <div class="chart-container">
          <div class="chart-title">Receita por Dia</div>
          <canvas id="chartReceita"></canvas>
        </div>
        <div class="chart-container">
          <div class="chart-title">Compras por Pacote</div>
          <canvas id="chartPacotes"></canvas>
        </div>
      </div>
    </div>

    <div class="section">
      <div class="section-header">
        <div class="section-title">üí∏ Solicita√ß√µes de Saque</div>
      </div>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Usu√°rio</th>
              <th>Cr√©ditos</th>
              <th>Valor</th>
              <th>PIX</th>
              <th>Data</th>
              <th>Status</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="tabelaSaques">
            <tr><td colspan="7" class="loading"><div class="loading-spinner"></div>Carregando...</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="section">
      <div class="section-header">
        <div class="section-title">üõí Compras Recentes</div>
      </div>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Usu√°rio</th>
              <th>Cr√©ditos</th>
              <th>Valor</th>
              <th>Data</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="tabelaCompras">
            <tr><td colspan="5" class="loading"><div class="loading-spinner"></div>Carregando...</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="section">
      <div class="section-header">
        <div class="section-title">üëë Top Compradores do M√™s</div>
      </div>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Usu√°rio</th>
              <th>Compras</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody id="tabelaTop">
            <tr><td colspan="4" class="loading"><div class="loading-spinner"></div>Carregando...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC5ZrkEy7KuCFJOtPvI7-P-JcA0MF4im5c",
      authDomain: "painel-yellup.firebaseapp.com",
      projectId: "painel-yellup",
      storageBucket: "painel-yellup.appspot.com",
      messagingSenderId: "608347210297",
      appId: "1:608347210297:web:75092713724e617c7203e8"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    let chartReceita = null;
    let chartPacotes = null;
    let todasCompras = [];
    let periodoGrafico = '7d';
    const VALOR_CREDITO = 0.40;

    auth.onAuthStateChanged(async (user) => {
      if (!user || user.email !== 'admin@yellup.com') {
        window.location.href = '../usuarios/index.html';
        return;
      }
      await carregarDados();
    });

    function showToast(msg) {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    async function carregarDados() {
      await Promise.all([
        carregarEstatisticas(),
        carregarCompras(),
        carregarSaques(),
        carregarTopCompradores()
      ]);
      atualizarGraficos();
    }

    async function carregarEstatisticas() {
      try {
        const agora = new Date();
        const inicioMes = new Date(agora.getFullYear(), agora.getMonth(), 1);
        const inicioHoje = new Date(agora.getFullYear(), agora.getMonth(), agora.getDate());

        const comprasSnap = await db.collection('compras').where('status', '==', 'aprovado').get();

        let receitaTotal = 0, receitaMes = 0, comprasHoje = 0, totalCompras = 0;

        comprasSnap.forEach(doc => {
          const c = doc.data();
          const valor = c.valor || 0;
          const data = c.data?.toDate ? c.data.toDate() : new Date();
          
          receitaTotal += valor;
          totalCompras++;
          if (data >= inicioMes) receitaMes += valor;
          if (data >= inicioHoje) comprasHoje++;
        });

        document.getElementById('receitaTotal').textContent = `R$ ${receitaTotal.toFixed(2)}`;
        document.getElementById('receitaMes').textContent = `R$ ${receitaMes.toFixed(2)}`;
        document.getElementById('comprasHoje').textContent = comprasHoje;
        document.getElementById('ticketMedio').textContent = `R$ ${(totalCompras > 0 ? receitaTotal / totalCompras : 0).toFixed(2)}`;

        const saquesSnap = await db.collection('vendas_creditos').where('status', '==', 'pendente').get();
        document.getElementById('saquesPendentes').textContent = saquesSnap.size;

        // Buscar transa√ß√µes de pr√™mio (sem √≠ndice composto)
        const premiosSnap = await db.collection('transacoes').where('tipo', '==', 'credito').limit(200).get();
        let premiosPagos = 0;
        premiosSnap.forEach(doc => {
          const t = doc.data();
          const dataT = t.data?.toDate ? t.data.toDate() : new Date(0);
          if (t.categoria?.includes('premio') && dataT >= inicioMes) {
            premiosPagos += t.valor || 0;
          }
        });
        document.getElementById('premiosPagos').textContent = premiosPagos + ' üíé';
      } catch (e) { console.error(e); }
    }

    // Cache de nomes de usu√°rios
    let cacheUsuarios = {};

    async function carregarCompras() {
      try {
        const snap = await db.collection('compras').orderBy('data', 'desc').limit(50).get();
        todasCompras = [];
        snap.forEach(doc => todasCompras.push({ id: doc.id, ...doc.data() }));
        
        // Buscar nomes dos usu√°rios que n√£o tem userName
        const idsParaBuscar = [...new Set(todasCompras.filter(c => !c.userName).map(c => c.usuarioId))];
        
        for (const odId of idsParaBuscar) {
          if (!cacheUsuarios[odId] && odId) {
            try {
              const userDoc = await db.collection('usuarios').doc(odId).get();
              if (userDoc.exists) {
                const userData = userDoc.data();
                cacheUsuarios[odId] = userData.nome || userData.usuarioUnico || userData.email || odId.substring(0,8);
              }
            } catch (e) { /* ignora */ }
          }
        }
        
        renderizarCompras();
      } catch (e) { console.error(e); }
    }

    function renderizarCompras() {
      const tbody = document.getElementById('tabelaCompras');
      if (todasCompras.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="empty-state"><div class="empty-icon">üì≠</div>Nenhuma compra</td></tr>';
        return;
      }
      tbody.innerHTML = todasCompras.slice(0, 15).map(c => {
        const data = c.data?.toDate ? c.data.toDate() : new Date();
        const statusClass = c.status === 'aprovado' ? 'badge-aprovado' : 'badge-pendente';
        const statusText = c.status === 'aprovado' ? 'OK' : 'Pend';
        const nome = c.userName || cacheUsuarios[c.usuarioId] || c.userEmail || c.usuarioId?.substring(0,8) || 'An√¥nimo';
        return `<tr><td>${nome}</td><td>${c.creditos || 0} üíé</td><td>R$ ${(c.valor || 0).toFixed(2)}</td><td>${data.toLocaleString('pt-BR')}</td><td><span class="badge ${statusClass}">${statusText}</span></td></tr>`;
      }).join('');
    }

    async function carregarSaques() {
      try {
        const snap = await db.collection('vendas_creditos').orderBy('dataSolicitacao', 'desc').limit(20).get();
        const saques = [];
        snap.forEach(doc => saques.push({ id: doc.id, ...doc.data() }));
        renderizarSaques(saques);
      } catch (e) { console.error(e); }
    }

    function renderizarSaques(saques) {
      const tbody = document.getElementById('tabelaSaques');
      if (saques.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" class="empty-state"><div class="empty-icon">üì≠</div>Nenhuma solicita√ß√£o</td></tr>';
        return;
      }
      tbody.innerHTML = saques.map(s => {
        const data = s.dataSolicitacao?.toDate ? s.dataSolicitacao.toDate() : new Date();
        const valor = (s.creditos || 0) * VALOR_CREDITO;
        let statusClass = s.status === 'aprovado' ? 'badge-aprovado' : s.status === 'rejeitado' ? 'badge-rejeitado' : 'badge-pendente';
        const acoes = s.status === 'pendente' ? `<button class="btn-action btn-aprovar" onclick="aprovarSaque('${s.id}')">‚úì</button><button class="btn-action btn-rejeitar" onclick="rejeitarSaque('${s.id}')">‚úó</button>` : '--';
        return `<tr><td>${s.usuarioNome || 'An√¥nimo'}</td><td>${s.creditos || 0} üíé</td><td>R$ ${valor.toFixed(2)}</td><td style="font-size:0.7em;max-width:120px;overflow:hidden;text-overflow:ellipsis;">${s.chavePix || '--'}</td><td>${data.toLocaleDateString('pt-BR')}</td><td><span class="badge ${statusClass}">${s.status || 'pendente'}</span></td><td>${acoes}</td></tr>`;
      }).join('');
    }

    async function aprovarSaque(id) {
      if (!confirm('Aprovar saque?')) return;
      try {
        const doc = await db.collection('vendas_creditos').doc(id).get();
        const s = doc.data();
        await db.collection('vendas_creditos').doc(id).update({ status: 'aprovado', dataAprovacao: firebase.firestore.FieldValue.serverTimestamp() });
        await db.collection('usuarios').doc(s.usuarioId).update({ creditos: firebase.firestore.FieldValue.increment(-(s.creditos || 0)), creditosPagos: firebase.firestore.FieldValue.increment(-(s.creditos || 0)) });
        await db.collection('transacoes').add({ usuarioId: s.usuarioId, tipo: 'debito', categoria: 'saque', valor: s.creditos || 0, descricao: 'Saque aprovado', data: firebase.firestore.FieldValue.serverTimestamp() });
        await db.collection('notificacoes').add({ para: s.usuarioId, tipo: 'saque_aprovado', titulo: 'üí∞ Saque Aprovado!', mensagem: `Seu saque de ${s.creditos} cr√©ditos foi aprovado!`, lida: false, data: firebase.firestore.FieldValue.serverTimestamp() });
        showToast('‚úÖ Saque aprovado!');
        carregarSaques();
        carregarEstatisticas();
      } catch (e) { showToast('‚ùå Erro'); console.error(e); }
    }

    async function rejeitarSaque(id) {
      const motivo = prompt('Motivo:');
      if (motivo === null) return;
      try {
        const doc = await db.collection('vendas_creditos').doc(id).get();
        const s = doc.data();
        await db.collection('vendas_creditos').doc(id).update({ status: 'rejeitado', motivoRejeicao: motivo || 'N√£o informado' });
        await db.collection('notificacoes').add({ para: s.usuarioId, tipo: 'saque_rejeitado', titulo: '‚ùå Saque Rejeitado', mensagem: motivo || 'Seu saque foi rejeitado.', lida: false, data: firebase.firestore.FieldValue.serverTimestamp() });
        showToast('Saque rejeitado');
        carregarSaques();
      } catch (e) { showToast('‚ùå Erro'); console.error(e); }
    }

    async function carregarTopCompradores() {
      try {
        const inicioMes = new Date(); inicioMes.setDate(1); inicioMes.setHours(0, 0, 0, 0);
        // Buscar compras aprovadas (sem √≠ndice composto - filtra no JS)
        const snap = await db.collection('compras').where('status', '==', 'aprovado').limit(500).get();
        const porUsuario = {};
        snap.forEach(doc => {
          const c = doc.data();
          const dataC = c.data?.toDate ? c.data.toDate() : new Date(0);
          if (dataC < inicioMes) return; // Filtrar por data no JS
          const uid = c.usuarioId;
          if (!porUsuario[uid]) porUsuario[uid] = { odId: uid, nome: c.userName || cacheUsuarios[uid] || null, compras: 0, total: 0 };
          porUsuario[uid].compras++;
          porUsuario[uid].total += c.valor || 0;
        });
        
        // Buscar nomes que faltam
        const semNome = Object.values(porUsuario).filter(u => !u.nome);
        for (const u of semNome) {
          if (!cacheUsuarios[u.odId] && u.odId) {
            try {
              const userDoc = await db.collection('usuarios').doc(u.odId).get();
              if (userDoc.exists) {
                const userData = userDoc.data();
                cacheUsuarios[u.odId] = userData.nome || userData.usuarioUnico || userData.email || u.odId.substring(0,8);
              }
            } catch (e) { /* ignora */ }
          }
          u.nome = cacheUsuarios[u.odId] || u.odId?.substring(0,8) || 'An√¥nimo';
        }
        
        const top = Object.values(porUsuario).sort((a, b) => b.total - a.total).slice(0, 10);
        const tbody = document.getElementById('tabelaTop');
        if (top.length === 0) { tbody.innerHTML = '<tr><td colspan="4" class="empty-state">Nenhum</td></tr>'; return; }
        tbody.innerHTML = top.map((u, i) => `<tr><td>${i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : i + 1}</td><td>${u.nome}</td><td>${u.compras}</td><td style="color:#2ecc71;font-weight:700;">R$ ${u.total.toFixed(2)}</td></tr>`).join('');
      } catch (e) { console.error(e); }
    }

    function atualizarGraficos() {
      const dias = periodoGrafico === '7d' ? 7 : periodoGrafico === '30d' ? 30 : 90;
      const receitaPorDia = {};
      const compraPorPacote = { '10': 0, '30': 0, '60': 0, '75': 0, '150': 0, '200': 0, 'Outro': 0 };

      for (let i = dias - 1; i >= 0; i--) {
        const d = new Date(); d.setDate(d.getDate() - i);
        receitaPorDia[d.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' })] = 0;
      }

      const limite = new Date(); limite.setDate(limite.getDate() - dias);
      todasCompras.forEach(c => {
        if (c.status !== 'aprovado') return;
        const data = c.data?.toDate ? c.data.toDate() : new Date();
        if (data < limite) return;
        const key = data.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' });
        if (receitaPorDia[key] !== undefined) receitaPorDia[key] += c.valor || 0;
        const cred = c.creditos || 0;
        if (cred === 10) compraPorPacote['10']++;
        else if (cred === 30) compraPorPacote['30']++;
        else if (cred === 60) compraPorPacote['60']++;
        else if (cred === 75) compraPorPacote['75']++;
        else if (cred === 150) compraPorPacote['150']++;
        else if (cred === 200) compraPorPacote['200']++;
        else compraPorPacote['Outro']++;
      });

      if (chartReceita) chartReceita.destroy();
      chartReceita = new Chart(document.getElementById('chartReceita'), {
        type: 'line',
        data: { labels: Object.keys(receitaPorDia), datasets: [{ label: 'R$', data: Object.values(receitaPorDia), borderColor: '#2ecc71', backgroundColor: 'rgba(46,204,113,0.1)', fill: true, tension: 0.4 }] },
        options: { responsive: true, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, ticks: { color: '#a9b5c6' }, grid: { color: 'rgba(255,255,255,0.05)' } }, x: { ticks: { color: '#a9b5c6' }, grid: { display: false } } } }
      });

      if (chartPacotes) chartPacotes.destroy();
      chartPacotes = new Chart(document.getElementById('chartPacotes'), {
        type: 'doughnut',
        data: { labels: Object.keys(compraPorPacote).map(k => k + ' cr√©d'), datasets: [{ data: Object.values(compraPorPacote), backgroundColor: ['#3498db', '#9b59b6', '#e74c3c', '#1abc9c', '#f39c12', '#e67e22', '#95a5a6'] }] },
        options: { responsive: true, plugins: { legend: { position: 'bottom', labels: { color: '#a9b5c6' } } } }
      });
    }

    function filtrarGrafico(p) {
      periodoGrafico = p;
      document.querySelectorAll('.filtros .filtro-btn').forEach(b => b.classList.remove('active'));
      event.target.classList.add('active');
      atualizarGraficos();
    }

    console.log('‚úÖ Dashboard Financeiro Yellup v2.0');
  </script>
</body>
</html>
