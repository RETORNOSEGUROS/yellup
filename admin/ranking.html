<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rankings - Yellup Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --bg-primary:#0c0e14; --bg-secondary:#12141c; --bg-card:#181a24;
            --bg-card-hover:#1e2030; --bg-sidebar:#10121a;
            --border:#1e2030; --border-light:#282a3a;
            --text-primary:#e8e9ed; --text-secondary:#8b8d9a; --text-muted:#5c5e6e;
            --accent:#f0b429; --accent-dim:rgba(240,180,41,0.12);
            --green:#34d399; --green-dim:rgba(52,211,153,0.12);
            --red:#f87171; --red-dim:rgba(248,113,113,0.12);
            --blue:#60a5fa; --blue-dim:rgba(96,165,250,0.12);
            --purple:#a78bfa; --purple-dim:rgba(167,139,250,0.12);
            --orange:#fb923c; --orange-dim:rgba(251,146,60,0.12);
            --cyan:#22d3ee; --cyan-dim:rgba(34,211,238,0.12);
            --sidebar-w:250px; --header-h:64px;
        }
        *{margin:0;padding:0;box-sizing:border-box;}
        body{font-family:'DM Sans',-apple-system,sans-serif;background:var(--bg-primary);color:var(--text-primary);min-height:100vh;}

        .sidebar{position:fixed;left:0;top:0;width:var(--sidebar-w);height:100vh;background:var(--bg-sidebar);border-right:1px solid var(--border);display:flex;flex-direction:column;z-index:100;transition:transform .3s ease;}
        .sidebar-brand{height:var(--header-h);display:flex;align-items:center;gap:10px;padding:0 20px;border-bottom:1px solid var(--border);flex-shrink:0;}
        .sidebar-brand .logo{width:32px;height:32px;background:var(--accent);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:700;color:#000;}
        .sidebar-brand h1{font-size:17px;font-weight:700;} .sidebar-brand h1 span{color:var(--text-muted);font-weight:500;font-size:12px;margin-left:6px;}
        .sidebar-nav{flex:1;overflow-y:auto;padding:12px 0;} .sidebar-nav::-webkit-scrollbar{width:0;}
        .nav-group{margin-bottom:8px;} .nav-group-title{font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:1.2px;color:var(--text-muted);padding:12px 20px 6px;}
        .nav-item{display:flex;align-items:center;gap:10px;padding:8px 16px;margin:1px 8px;border-radius:8px;color:var(--text-secondary);text-decoration:none;font-size:13px;font-weight:500;transition:all .15s;}
        .nav-item:hover{background:var(--bg-card);color:var(--text-primary);} .nav-item.active{background:var(--accent-dim);color:var(--accent);}
        .nav-item .icon{width:20px;text-align:center;font-size:14px;flex-shrink:0;}
        .sidebar-footer{padding:12px 16px;border-top:1px solid var(--border);flex-shrink:0;}
        .sidebar-footer .admin-box{display:flex;align-items:center;gap:10px;padding:8px;}
        .admin-avatar{width:32px;height:32px;background:linear-gradient(135deg,var(--accent),#e09800);border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:13px;color:#000;}
        .admin-info-text{flex:1;} .admin-info-text .name{font-size:13px;font-weight:600;} .admin-info-text .role{font-size:11px;color:var(--text-muted);}
        .btn-logout{background:none;border:none;color:var(--text-muted);cursor:pointer;font-size:16px;padding:4px;border-radius:6px;} .btn-logout:hover{color:var(--red);background:var(--red-dim);}

        .main{margin-left:var(--sidebar-w);min-height:100vh;}
        .topbar{height:var(--header-h);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 32px;background:var(--bg-primary);position:sticky;top:0;z-index:50;}
        .topbar h2{font-size:16px;font-weight:600;}
        .btn-outline{padding:8px 16px;border-radius:8px;border:1px solid var(--border);background:var(--bg-card);color:var(--text-primary);font-size:13px;font-weight:500;cursor:pointer;font-family:inherit;display:inline-flex;align-items:center;gap:6px;}
        .btn-outline:hover{border-color:var(--accent);}
        .content{padding:24px 32px 40px;}

        /* TABS */
        .tabs{display:flex;gap:2px;background:var(--bg-secondary);border:1px solid var(--border);border-radius:10px;padding:3px;margin-bottom:24px;}
        .tab{padding:10px 20px;border-radius:8px;font-size:13px;font-weight:500;color:var(--text-muted);cursor:pointer;transition:all .15s;}
        .tab:hover{color:var(--text-primary);} .tab.active{background:var(--accent-dim);color:var(--accent);}

        /* PODIUM */
        .podium{display:flex;justify-content:center;align-items:flex-end;gap:16px;margin-bottom:24px;padding:20px 0;}
        .pod-item{text-align:center;padding:20px;border-radius:14px;background:var(--bg-card);border:1px solid var(--border);min-width:160px;transition:all .2s;}
        .pod-item.p1{transform:scale(1.08);border-color:rgba(255,215,0,.4);background:linear-gradient(135deg,rgba(255,215,0,.08),rgba(255,165,0,.04));}
        .pod-item.p2{border-color:rgba(192,192,192,.3);background:linear-gradient(135deg,rgba(192,192,192,.06),transparent);}
        .pod-item.p3{border-color:rgba(205,127,50,.3);background:linear-gradient(135deg,rgba(205,127,50,.06),transparent);}
        .pod-medal{font-size:32px;margin-bottom:8px;}
        .pod-avatar{width:52px;height:52px;border-radius:50%;margin:0 auto 8px;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:700;color:#000;}
        .p1 .pod-avatar{background:linear-gradient(135deg,#FFD700,#FFA500);}
        .p2 .pod-avatar{background:linear-gradient(135deg,#C0C0C0,#A9A9A9);}
        .p3 .pod-avatar{background:linear-gradient(135deg,#CD7F32,#B8860B);color:#fff;}
        .pod-name{font-size:14px;font-weight:700;margin-bottom:2px;}
        .pod-score{font-size:18px;font-weight:700;color:var(--accent);font-family:'JetBrains Mono',monospace;}

        /* TABLE */
        .table-card{background:var(--bg-card);border:1px solid var(--border);border-radius:12px;overflow:hidden;}
        table{width:100%;border-collapse:collapse;}
        thead th{padding:10px 16px;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:var(--text-muted);border-bottom:1px solid var(--border);text-align:left;background:var(--bg-secondary);}
        tbody td{padding:12px 16px;border-bottom:1px solid var(--border);font-size:13px;}
        tbody tr:hover{background:var(--bg-card-hover);}
        tbody tr:last-child td{border-bottom:none;}

        .rank-num{font-weight:700;font-size:14px;font-family:'JetBrains Mono',monospace;}
        .rank-1{color:#FFD700;} .rank-2{color:#C0C0C0;} .rank-3{color:#CD7F32;}
        .user-cell{display:flex;align-items:center;gap:10px;}
        .user-av{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:14px;flex-shrink:0;}
        .user-name{font-weight:600;font-size:13px;}
        .user-email{font-size:11px;color:var(--text-muted);}
        .nivel-badge{padding:3px 10px;border-radius:10px;font-size:11px;font-weight:600;}
        .nivel-bronze{background:rgba(205,127,50,.15);color:#CD7F32;}
        .nivel-prata{background:rgba(192,192,192,.15);color:#C0C0C0;}
        .nivel-ouro{background:var(--accent-dim);color:var(--accent);}
        .nivel-diamante{background:var(--cyan-dim);color:var(--cyan);}
        .nivel-mestre{background:var(--purple-dim);color:var(--purple);}
        .score-val{color:var(--green);font-weight:700;font-size:14px;font-family:'JetBrains Mono',monospace;}

        .empty{text-align:center;padding:40px;color:var(--text-muted);font-size:13px;}

        .mobile-toggle{display:none;position:fixed;top:16px;left:16px;z-index:200;width:40px;height:40px;border-radius:10px;background:var(--bg-card);border:1px solid var(--border);color:var(--text-primary);font-size:18px;cursor:pointer;align-items:center;justify-content:center;}
        .overlay-bg{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:90;}
        @media(max-width:768px){
            .sidebar{transform:translateX(-100%);} .sidebar.open{transform:translateX(0);} .overlay-bg.open{display:block;}
            .mobile-toggle{display:flex;} .main{margin-left:0;} .topbar{padding:0 16px 0 64px;} .content{padding:16px;}
            .podium{flex-direction:column;align-items:center;} .pod-item.p1{transform:none;}
            .tabs{overflow-x:auto;flex-wrap:nowrap;} .tab{white-space:nowrap;}
        }
    </style>
</head>
<body>

    <button class="mobile-toggle" onclick="toggleSidebar()">‚ò∞</button>
    <div class="overlay-bg" id="overlay" onclick="toggleSidebar()"></div>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-brand"><div class="logo">Y</div><h1>Yellup <span>Admin</span></h1></div>
        <nav class="sidebar-nav">
            <div class="nav-group"><div class="nav-group-title">Vis√£o Geral</div><a href="dashboard.html" class="nav-item"><span class="icon">üìä</span> Dashboard</a></div>
            <div class="nav-group"><div class="nav-group-title">Conte√∫do</div><a href="jogos.html" class="nav-item"><span class="icon">üéÆ</span> Jogos</a><a href="perguntas.html" class="nav-item"><span class="icon">‚ùì</span> Perguntas</a><a href="gerar-perguntas.html" class="nav-item"><span class="icon">ü§ñ</span> Gerar com IA</a><a href="times.html" class="nav-item"><span class="icon">‚öΩ</span> Times</a></div>
            <div class="nav-group"><div class="nav-group-title">Jogadores</div><a href="usuarios.html" class="nav-item"><span class="icon">üë•</span> Usu√°rios</a><a href="ranking.html" class="nav-item active"><span class="icon">üèÜ</span> Rankings</a><a href="admin-noticias.html" class="nav-item"><span class="icon">üì∞</span> Not√≠cias</a></div>
            <div class="nav-group"><div class="nav-group-title">Competi√ß√µes</div><a href="torneios.html" class="nav-item"><span class="icon">üèÖ</span> Torneios</a><a href="inicializar-pvp.html" class="nav-item"><span class="icon">‚öîÔ∏è</span> Embates PvP</a></div>
            <div class="nav-group"><div class="nav-group-title">Financeiro</div><a href="financeiro.html" class="nav-item"><span class="icon">üí∞</span> Resumo</a><a href="creditar-manual.html" class="nav-item"><span class="icon">‚ûï</span> Creditar Manual</a><a href="transacoes.html" class="nav-item"><span class="icon">üí≥</span> Transa√ß√µes</a><a href="premiacao.html" class="nav-item"><span class="icon">üéÅ</span> Premia√ß√£o</a><a href="indicacoes.html" class="nav-item"><span class="icon">üîó</span> Indica√ß√µes</a></div>
            <div class="nav-group"><div class="nav-group-title">Bolsa</div><a href="bolsa-admin.html" class="nav-item"><span class="icon">üìà</span> Gest√£o da Bolsa</a></div>
            <div class="nav-group"><div class="nav-group-title">Sistema</div><a href="configuracoes.html" class="nav-item"><span class="icon">‚öôÔ∏è</span> Configura√ß√µes</a><a href="checkup.html" class="nav-item"><span class="icon">üîç</span> Checkup</a><a href="simulador_avancado.html" class="nav-item"><span class="icon">üß™</span> Simulador</a><a href="teste-regras.html" class="nav-item"><span class="icon">üìú</span> Regras</a></div>
        </nav>
        <div class="sidebar-footer"><div class="admin-box"><div class="admin-avatar">A</div><div class="admin-info-text"><div class="name">Admin</div><div class="role">Administrador</div></div><button class="btn-logout" onclick="sair()" title="Sair">‚èª</button></div></div>
    </aside>

    <div class="main">
        <div class="topbar">
            <h2>üèÜ Rankings</h2>
            <button class="btn-outline" onclick="carregarDados()">üîÑ Atualizar</button>
        </div>

        <div class="content">
            <div class="tabs">
                <div class="tab active" onclick="mudarTab('xp',this)">‚≠ê XP Total</div>
                <div class="tab" onclick="mudarTab('creditos',this)">üíé Cr√©ditos</div>
                <div class="tab" onclick="mudarTab('jogos',this)">üéÆ Jogos</div>
                <div class="tab" onclick="mudarTab('vitorias',this)">üèÖ Vit√≥rias</div>
                <div class="tab" onclick="mudarTab('streak',this)">üî• Maior Streak</div>
            </div>

            <div class="podium" id="podium"></div>

            <div class="table-card">
                <table>
                    <thead><tr>
                        <th style="width:60px">#</th>
                        <th>Usu√°rio</th>
                        <th>N√≠vel</th>
                        <th id="colPontuacao">‚≠ê XP</th>
                    </tr></thead>
                    <tbody id="tabela"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        firebase.initializeApp({
            apiKey: "AIzaSyC5ZrkEy7KuCFJOtPvI7-P-JcA0MF4im5c", authDomain: "painel-yellup.firebaseapp.com",
            projectId: "painel-yellup", storageBucket: "painel-yellup.appspot.com",
            messagingSenderId: "608347210297", appId: "1:608347210297:web:75092713724e617c7203e8"
        });
        const db = firebase.firestore(), auth = firebase.auth();
        let usuarios = [], tabAtual = 'xp';

        auth.onAuthStateChanged(u => {
            if (!u || u.email !== 'admin@yellup.com') { window.location.href = 'login.html'; return; }
            carregarDados();
        });
        function sair() { auth.signOut().then(() => window.location.href = 'login.html'); }
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); document.getElementById('overlay').classList.toggle('open'); }

        async function carregarDados() {
            try {
                const snap = await db.collection('usuarios').get();
                usuarios = [];
                snap.forEach(doc => usuarios.push({ id: doc.id, ...doc.data() }));
                renderizar();
            } catch(e) { console.error('Erro:', e); }
        }

        function mudarTab(tab, el) {
            tabAtual = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            const cols = { xp:'‚≠ê XP', creditos:'üíé Cr√©ditos', jogos:'üéÆ Jogos', vitorias:'üèÖ Vit√≥rias', streak:'üî• Streak' };
            document.getElementById('colPontuacao').textContent = cols[tab];
            renderizar();
        }

        function getValor(u) {
            switch(tabAtual) {
                case 'xp': return u.xp || u.pontuacao || 0;
                case 'creditos': return u.creditos || 0;
                case 'jogos': return u.jogosParticipados || u.totalJogos || 0;
                case 'vitorias': return u.vitorias || 0;
                case 'streak': return u.maiorStreak || u.streakMaximo || 0;
                default: return 0;
            }
        }

        function getNivel(xp) {
            if (xp >= 5000) return { nome:'Mestre', classe:'nivel-mestre' };
            if (xp >= 3000) return { nome:'Diamante', classe:'nivel-diamante' };
            if (xp >= 1500) return { nome:'Ouro', classe:'nivel-ouro' };
            if (xp >= 500) return { nome:'Prata', classe:'nivel-prata' };
            return { nome:'Bronze', classe:'nivel-bronze' };
        }

        function esc(t) { const d=document.createElement('div'); d.textContent=t; return d.innerHTML; }

        function renderizar() {
            const ordenados = [...usuarios].sort((a, b) => getValor(b) - getValor(a));
            const top3 = ordenados.slice(0, 3);
            const resto = ordenados.slice(3, 50);

            // Podium
            const pod = document.getElementById('podium');
            if (top3.length >= 3) {
                const order = [1, 0, 2]; // silver, gold, bronze
                pod.innerHTML = order.map(idx => {
                    const u = top3[idx];
                    const cls = idx === 0 ? 'p1' : idx === 1 ? 'p2' : 'p3';
                    const medal = idx === 0 ? 'ü•á' : idx === 1 ? 'ü•à' : 'ü•â';
                    const ini = (u.nome || u.usuarioUnico || 'U')[0].toUpperCase();
                    const nome = u.nome || u.usuarioUnico || 'Usu√°rio';
                    return `<div class="pod-item ${cls}">
                        <div class="pod-medal">${medal}</div>
                        <div class="pod-avatar">${ini}</div>
                        <div class="pod-name">${esc(nome)}</div>
                        <div class="pod-score">${getValor(u).toLocaleString()}</div>
                    </div>`;
                }).join('');
            } else {
                pod.innerHTML = '<div class="empty">Poucos usu√°rios para p√≥dio</div>';
            }

            // Table
            const tbody = document.getElementById('tabela');
            if (!resto.length) { tbody.innerHTML = '<tr><td colspan="4" class="empty">Sem mais usu√°rios</td></tr>'; return; }

            tbody.innerHTML = resto.map((u, i) => {
                const pos = i + 4;
                const nivel = getNivel(u.xp || 0);
                const ini = (u.nome || u.usuarioUnico || 'U')[0].toUpperCase();
                const nome = u.nome || u.usuarioUnico || 'Usu√°rio';
                return `<tr>
                    <td><span class="rank-num ${pos<=3?'rank-'+pos:''}">${pos}¬∫</span></td>
                    <td><div class="user-cell"><div class="user-av">${ini}</div><div><div class="user-name">${esc(nome)}</div><div class="user-email">${esc(u.email || '')}</div></div></div></td>
                    <td><span class="nivel-badge ${nivel.classe}">${nivel.nome}</span></td>
                    <td><span class="score-val">${getValor(u).toLocaleString()}</span></td>
                </tr>`;
            }).join('');
        }
    </script>
</body>
</html>
