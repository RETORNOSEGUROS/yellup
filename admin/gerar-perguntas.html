<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerar Perguntas V5 - Yellup Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }
        
        .container { max-width: 1400px; margin: 0 auto; }
        
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        .header p { color: #a0a0a0; font-size: 1.1rem; }
        
        /* Tabs */
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab-btn {
            padding: 12px 24px;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 10px;
            color: #fff;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .tab-btn:hover { background: rgba(255,255,255,0.2); }
        .tab-btn.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        /* Cards */
        .card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .card-title {
            font-size: 1.3rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .card-title .material-icons { color: #667eea; }
        
        /* Form elements */
        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #a0a0a0;
            font-size: 0.9rem;
        }
        .form-group select,
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            color: #fff;
            font-size: 1rem;
            transition: all 0.3s;
        }
        .form-group select:focus,
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(255,255,255,0.15);
        }
        .form-group select option { background: #1a1a2e; color: #fff; }
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* V5 - SEARCH SELECT (NOVO!) */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .search-select-container {
            position: relative;
        }
        .search-select-input {
            width: 100%;
            padding: 12px 15px;
            padding-right: 40px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            color: #fff;
            font-size: 1rem;
            transition: all 0.3s;
        }
        .search-select-input:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(255,255,255,0.15);
        }
        .search-select-input::placeholder { color: #888; }
        .search-select-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #667eea;
            pointer-events: none;
        }
        .search-select-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #1a1a2e;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            margin-top: 5px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .search-select-dropdown.show { display: block; }
        .search-select-option {
            padding: 12px 15px;
            cursor: pointer;
            transition: background 0.2s;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .search-select-option:hover,
        .search-select-option.highlighted {
            background: rgba(102, 126, 234, 0.3);
        }
        .search-select-option:last-child { border-bottom: none; }
        .search-select-option .bandeira { margin-right: 8px; }
        .search-select-option .pais { color: #888; font-size: 0.85rem; margin-left: 5px; }
        .search-select-no-results {
            padding: 15px;
            text-align: center;
            color: #888;
        }
        .search-select-count {
            padding: 8px 15px;
            background: rgba(255,255,255,0.05);
            font-size: 0.8rem;
            color: #888;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        /* Checkboxes para temas */
        .tema-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        .tema-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .tema-item:hover { background: rgba(255,255,255,0.1); }
        .tema-item input[type="checkbox"] { width: 18px; height: 18px; accent-color: #667eea; }
        .tema-item.selected { background: rgba(102, 126, 234, 0.2); border: 1px solid #667eea; }
        
        /* Upload area */
        .upload-area {
            border: 2px dashed rgba(255,255,255,0.3);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }
        .upload-area:hover { border-color: #667eea; background: rgba(102, 126, 234, 0.1); }
        .upload-area.dragover { border-color: #667eea; background: rgba(102, 126, 234, 0.2); }
        .upload-area .material-icons { font-size: 48px; color: #667eea; margin-bottom: 10px; }
        .upload-info {
            margin-top: 15px;
            padding: 15px;
            background: rgba(102, 126, 234, 0.2);
            border-radius: 10px;
            display: none;
        }
        .upload-info.show { display: block; }
        
        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        .btn-secondary { background: rgba(255,255,255,0.1); color: #fff; }
        .btn-secondary:hover { background: rgba(255,255,255,0.2); }
        .btn-success { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: #fff; }
        .btn-danger { background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%); color: #fff; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-group { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 20px; }
        
        /* Prompt display */
        .prompt-display {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-word;
        }
        
        /* Preview table */
        .preview-container { overflow-x: auto; }
        .preview-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .preview-table th, .preview-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .preview-table th { background: rgba(255,255,255,0.1); font-weight: 500; }
        .preview-table tr:hover { background: rgba(255,255,255,0.05); }
        
        .badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        .badge-easy { background: linear-gradient(135deg, #11998e, #38ef7d); }
        .badge-medium { background: linear-gradient(135deg, #f7971e, #ffd200); color: #000; }
        .badge-hard { background: linear-gradient(135deg, #eb3349, #f45c43); }
        .correct-answer { color: #38ef7d; font-weight: 500; }
        
        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-item {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .stat-label { font-size: 0.85rem; color: #a0a0a0; margin-top: 5px; }
        
        /* Letter distribution */
        .letter-dist { display: flex; gap: 20px; flex-wrap: wrap; }
        .letter-item { display: flex; align-items: center; gap: 10px; }
        .letter-badge {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        /* Info do Time */
        .time-info-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 20px;
            display: none;
        }
        .time-info-card.show { display: block; }
        .time-info-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        .time-info-header .bandeira { font-size: 2rem; }
        .time-info-header .nome { font-size: 1.3rem; font-weight: 600; }
        .time-info-header .pais { color: #a0a0a0; font-size: 0.9rem; }
        .time-info-stats { display: flex; gap: 20px; flex-wrap: wrap; }
        .time-info-stat {
            background: rgba(0,0,0,0.2);
            padding: 8px 15px;
            border-radius: 8px;
        }
        .time-info-stat .valor { font-weight: 700; color: #38ef7d; }
        .time-info-stat .slug { font-family: monospace; color: #667eea; }
        
        /* ValidaÃ§Ã£o */
        .validation-card {
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }
        .validation-card.show { display: block; }
        .validation-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .validation-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 8px;
            background: rgba(255,255,255,0.05);
        }
        .validation-item.ok { border-left: 3px solid #38ef7d; }
        .validation-item.warning { border-left: 3px solid #ffd200; }
        .validation-item.error { border-left: 3px solid #f45c43; }
        .validation-item .icon { font-size: 1.2rem; }
        .validation-item.ok .icon { color: #38ef7d; }
        .validation-item.warning .icon { color: #ffd200; }
        .validation-item.error .icon { color: #f45c43; }
        
        /* Alertas temporais */
        .temporal-alerts { margin-top: 15px; max-height: 200px; overflow-y: auto; }
        .temporal-alert {
            background: rgba(247, 151, 30, 0.1);
            border: 1px solid rgba(247, 151, 30, 0.3);
            border-radius: 8px;
            padding: 10px 15px;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        .temporal-alert .pergunta-num { color: #ffd200; font-weight: 600; }
        .temporal-alert .sugestao { color: #a0a0a0; font-style: italic; margin-top: 5px; }
        
        /* Grid de pontuaÃ§Ã£o */
        .pontuacao-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 5px;
            margin-top: 10px;
        }
        .pontuacao-bar {
            text-align: center;
            padding: 5px;
            border-radius: 5px;
            font-size: 0.75rem;
        }
        .pontuacao-bar .valor { font-weight: 700; font-size: 1rem; }
        .pontuacao-bar.ok { background: rgba(56, 239, 125, 0.2); }
        .pontuacao-bar.warning { background: rgba(255, 210, 0, 0.2); }
        .pontuacao-bar.error { background: rgba(244, 92, 67, 0.2); }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: #fff;
            font-weight: 500;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }
        .toast-success { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
        .toast-error { background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%); }
        .toast-warning { background: linear-gradient(135deg, #f7971e 0%, #ffd200 100%); color: #000; }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .btn-delete {
            background: transparent;
            color: #f45c43;
            padding: 5px 10px;
            font-size: 0.85rem;
        }
        .btn-delete:hover { background: rgba(244, 92, 67, 0.2); }
        
        @media (max-width: 768px) {
            .header h1 { font-size: 1.8rem; }
            .tabs { flex-direction: column; }
            .tab-btn { justify-content: center; }
            .form-row { grid-template-columns: 1fr; }
            .pontuacao-grid { grid-template-columns: repeat(5, 1fr); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ Gerador de Perguntas V5</h1>
            <p>IDs amigÃ¡veis (santos-001) + Busca inteligente + ValidaÃ§Ã£o automÃ¡tica</p>
        </div>
        
        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="times">
                <span class="material-icons">sports_soccer</span>
                Times
            </button>
            <button class="tab-btn" data-tab="campeonatos">
                <span class="material-icons">emoji_events</span>
                Campeonatos
            </button>
            <button class="tab-btn" data-tab="preview">
                <span class="material-icons">visibility</span>
                Preview & Validar
            </button>
        </div>
        
        <!-- Tab: Times -->
        <div id="tab-times" class="tab-content active">
            <div class="card">
                <h2 class="card-title">
                    <span class="material-icons">sports_soccer</span>
                    Gerar Perguntas de Time
                </h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Buscar Time (digite para filtrar)</label>
                        <div class="search-select-container">
                            <input type="text" class="search-select-input" id="searchTime" placeholder="Digite o nome do time..." autocomplete="off">
                            <span class="material-icons search-select-icon">search</span>
                            <input type="hidden" id="selectTime" value="">
                            <div class="search-select-dropdown" id="dropdownTime"></div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Quantidade de Perguntas</label>
                        <select id="qtdPerguntasTime">
                            <option value="20">20 perguntas (1 bloco)</option>
                            <option value="25" selected>25 perguntas (1 bloco)</option>
                            <option value="50">50 perguntas (2 blocos)</option>
                            <option value="100">100 perguntas (4 blocos)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>ID Inicial</label>
                        <input type="number" id="idInicialTime" value="1" min="1" max="9999" style="width: 100px;">
                        <button class="btn btn-secondary" onclick="buscarProximoIdTime()" style="margin-left: 10px; padding: 8px 12px;">
                            <span class="material-icons" style="font-size: 18px;">search</span>
                            Auto
                        </button>
                    </div>
                </div>
                
                <!-- Info do Time Selecionado -->
                <div class="time-info-card" id="timeInfoCard">
                    <div class="time-info-header">
                        <span class="bandeira" id="timeInfoBandeira">ğŸ‡§ğŸ‡·</span>
                        <div>
                            <div class="nome" id="timeInfoNome">Nome do Time</div>
                            <div class="pais" id="timeInfoPais">PaÃ­s</div>
                        </div>
                    </div>
                    <div class="time-info-stats">
                        <div class="time-info-stat">
                            <span class="valor" id="timeInfoQtdPerguntas">0</span> perguntas existentes
                        </div>
                        <div class="time-info-stat">
                            PrÃ³ximo ID: <span class="valor" id="timeInfoProximoId">001</span>
                        </div>
                        <div class="time-info-stat">
                            Slug: <span class="slug" id="timeInfoSlug">nome-time</span>
                        </div>
                    </div>
                </div>
                
                <!-- Seletor de Temas -->
                <div class="form-group">
                    <label>Temas das Perguntas</label>
                    <div class="tema-grid" id="temasTime">
                        <label class="tema-item selected">
                            <input type="checkbox" name="temaTime" value="geral" checked>
                            <span>ğŸ“‹ Geral (todos)</span>
                        </label>
                        <label class="tema-item">
                            <input type="checkbox" name="temaTime" value="historia">
                            <span>ğŸ“œ HistÃ³ria</span>
                        </label>
                        <label class="tema-item">
                            <input type="checkbox" name="temaTime" value="titulos">
                            <span>ğŸ† TÃ­tulos</span>
                        </label>
                        <label class="tema-item">
                            <input type="checkbox" name="temaTime" value="jogadores">
                            <span>âš½ Jogadores</span>
                        </label>
                        <label class="tema-item">
                            <input type="checkbox" name="temaTime" value="estadio">
                            <span>ğŸŸï¸ EstÃ¡dio</span>
                        </label>
                        <label class="tema-item">
                            <input type="checkbox" name="temaTime" value="curiosidades">
                            <span>ğŸ¯ Curiosidades</span>
                        </label>
                        <label class="tema-item">
                            <input type="checkbox" name="temaTime" value="tecnicos">
                            <span>ğŸ‘” TÃ©cnicos</span>
                        </label>
                        <label class="tema-item">
                            <input type="checkbox" name="temaTime" value="classicos">
                            <span>âš”ï¸ ClÃ¡ssicos</span>
                        </label>
                    </div>
                </div>
                
                <!-- Upload JSON existente -->
                <div class="form-group">
                    <label>Perguntas Existentes (para evitar repetiÃ§Ãµes)</label>
                    <div class="upload-area" id="uploadAreaTime">
                        <span class="material-icons">upload_file</span>
                        <p>Arraste um arquivo JSON ou clique</p>
                        <input type="file" id="fileInputTime" accept=".json" style="display: none;">
                    </div>
                    <div class="upload-info" id="uploadInfoTime">
                        <span class="material-icons" style="color: #38ef7d;">check_circle</span>
                        <span id="uploadInfoTextTime"></span>
                        <button class="btn btn-danger btn-delete" onclick="limparUploadTime()">Remover</button>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="gerarPromptTime()">
                        <span class="material-icons">auto_awesome</span>
                        Gerar Prompt
                    </button>
                    <button class="btn btn-secondary" onclick="copiarPromptTime()">
                        <span class="material-icons">content_copy</span>
                        Copiar Prompt
                    </button>
                </div>
            </div>
            
            <div class="card" id="promptCardTime" style="display: none;">
                <h2 class="card-title">
                    <span class="material-icons">description</span>
                    Prompt Gerado
                </h2>
                <div class="prompt-display" id="promptDisplayTime"></div>
            </div>
        </div>
        
        <!-- Tab: Campeonatos -->
        <div id="tab-campeonatos" class="tab-content">
            <div class="card">
                <h2 class="card-title">
                    <span class="material-icons">emoji_events</span>
                    Gerar Perguntas de Campeonato
                </h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Buscar Campeonato (digite para filtrar)</label>
                        <div class="search-select-container">
                            <input type="text" class="search-select-input" id="searchCamp" placeholder="Digite o nome do campeonato..." autocomplete="off">
                            <span class="material-icons search-select-icon">search</span>
                            <input type="hidden" id="selectCampeonato" value="">
                            <div class="search-select-dropdown" id="dropdownCamp"></div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Quantidade de Perguntas</label>
                        <select id="qtdPerguntasCamp">
                            <option value="20">20 perguntas (1 bloco)</option>
                            <option value="25" selected>25 perguntas (1 bloco)</option>
                            <option value="50">50 perguntas (2 blocos)</option>
                            <option value="100">100 perguntas (4 blocos)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>ID Inicial</label>
                        <input type="number" id="idInicialCamp" value="1" min="1" max="9999" style="width: 100px;">
                        <button class="btn btn-secondary" onclick="buscarProximoIdCamp()" style="margin-left: 10px; padding: 8px 12px;">
                            <span class="material-icons" style="font-size: 18px;">search</span>
                            Auto
                        </button>
                    </div>
                </div>
                
                <!-- Info do Campeonato Selecionado -->
                <div class="time-info-card" id="campInfoCard">
                    <div class="time-info-header">
                        <span class="bandeira">ğŸ†</span>
                        <div>
                            <div class="nome" id="campInfoNome">Nome do Campeonato</div>
                        </div>
                    </div>
                    <div class="time-info-stats">
                        <div class="time-info-stat">
                            <span class="valor" id="campInfoQtdPerguntas">0</span> perguntas existentes
                        </div>
                        <div class="time-info-stat">
                            PrÃ³ximo ID: <span class="valor" id="campInfoProximoId">001</span>
                        </div>
                        <div class="time-info-stat">
                            Slug: <span class="slug" id="campInfoSlug">nome-camp</span>
                        </div>
                    </div>
                </div>
                
                <!-- Seletor de Temas -->
                <div class="form-group">
                    <label>Temas das Perguntas</label>
                    <div class="tema-grid" id="temasCamp">
                        <label class="tema-item selected">
                            <input type="checkbox" name="temaCamp" value="geral" checked>
                            <span>ğŸ“‹ Geral (todos)</span>
                        </label>
                        <label class="tema-item">
                            <input type="checkbox" name="temaCamp" value="campeoes">
                            <span>ğŸ† CampeÃµes</span>
                        </label>
                        <label class="tema-item">
                            <input type="checkbox" name="temaCamp" value="artilheiros">
                            <span>âš½ Artilheiros</span>
                        </label>
                        <label class="tema-item">
                            <input type="checkbox" name="temaCamp" value="curiosidades">
                            <span>ğŸ¯ Curiosidades</span>
                        </label>
                        <label class="tema-item">
                            <input type="checkbox" name="temaCamp" value="tecnicos">
                            <span>ğŸ‘” TÃ©cnicos</span>
                        </label>
                        <label class="tema-item">
                            <input type="checkbox" name="temaCamp" value="estadios">
                            <span>ğŸŸï¸ EstÃ¡dios</span>
                        </label>
                        <label class="tema-item">
                            <input type="checkbox" name="temaCamp" value="decadas">
                            <span>ğŸ“… Por DÃ©cadas</span>
                        </label>
                        <label class="tema-item">
                            <input type="checkbox" name="temaCamp" value="recente">
                            <span>ğŸ†• Recentes</span>
                        </label>
                    </div>
                </div>
                
                <!-- DÃ©cadas -->
                <div class="form-group" id="decadasGroup" style="display: none;">
                    <label>DÃ©cadas EspecÃ­ficas</label>
                    <div class="tema-grid">
                        <label class="tema-item"><input type="checkbox" name="decada" value="1960"><span>1960s</span></label>
                        <label class="tema-item"><input type="checkbox" name="decada" value="1970"><span>1970s</span></label>
                        <label class="tema-item"><input type="checkbox" name="decada" value="1980"><span>1980s</span></label>
                        <label class="tema-item"><input type="checkbox" name="decada" value="1990"><span>1990s</span></label>
                        <label class="tema-item"><input type="checkbox" name="decada" value="2000"><span>2000s</span></label>
                        <label class="tema-item"><input type="checkbox" name="decada" value="2010"><span>2010s</span></label>
                        <label class="tema-item"><input type="checkbox" name="decada" value="2020"><span>2020s</span></label>
                    </div>
                </div>
                
                <!-- Upload -->
                <div class="form-group">
                    <label>Perguntas Existentes</label>
                    <div class="upload-area" id="uploadAreaCamp">
                        <span class="material-icons">upload_file</span>
                        <p>Arraste um arquivo JSON ou clique</p>
                        <input type="file" id="fileInputCamp" accept=".json" style="display: none;">
                    </div>
                    <div class="upload-info" id="uploadInfoCamp">
                        <span class="material-icons" style="color: #38ef7d;">check_circle</span>
                        <span id="uploadInfoTextCamp"></span>
                        <button class="btn btn-danger btn-delete" onclick="limparUploadCamp()">Remover</button>
                    </div>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="gerarPromptCampeonato()">
                        <span class="material-icons">auto_awesome</span>
                        Gerar Prompt
                    </button>
                    <button class="btn btn-secondary" onclick="copiarPromptCampeonato()">
                        <span class="material-icons">content_copy</span>
                        Copiar Prompt
                    </button>
                </div>
            </div>
            
            <div class="card" id="promptCardCamp" style="display: none;">
                <h2 class="card-title">
                    <span class="material-icons">description</span>
                    Prompt Gerado
                </h2>
                <div class="prompt-display" id="promptDisplayCamp"></div>
            </div>
        </div>
        
        <!-- Tab: Preview -->
        <div id="tab-preview" class="tab-content">
            <div class="card">
                <h2 class="card-title">
                    <span class="material-icons">fact_check</span>
                    Colar JSON para ValidaÃ§Ã£o
                </h2>
                
                <div class="form-group">
                    <label>Cole o JSON gerado pela IA</label>
                    <textarea id="jsonInput" rows="10" placeholder='Cole aqui o JSON gerado...'></textarea>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="processarEValidarJSON()">
                        <span class="material-icons">play_arrow</span>
                        Processar e Validar
                    </button>
                    <button class="btn btn-secondary" onclick="document.getElementById('fileInputPreview').click()">
                        <span class="material-icons">upload_file</span>
                        Carregar JSON
                    </button>
                    <input type="file" id="fileInputPreview" accept=".json" style="display: none;" onchange="carregarJSONPreview(event)">
                </div>
            </div>
            
            <div class="card validation-card" id="validationCard">
                <h2 class="validation-title">
                    <span class="material-icons">checklist</span>
                    Resultado da ValidaÃ§Ã£o
                </h2>
                <div id="validationResults"></div>
                
                <div style="margin-top: 20px;">
                    <h3 style="font-size: 1rem; margin-bottom: 10px;">ğŸ“Š DistribuiÃ§Ã£o de PontuaÃ§Ã£o</h3>
                    <div class="pontuacao-grid" id="pontuacaoGrid"></div>
                </div>
                
                <div class="temporal-alerts" id="temporalAlerts" style="display: none;">
                    <h3 style="font-size: 1rem; margin-bottom: 10px; color: #ffd200;">â° Perguntas Atemporais</h3>
                    <div id="temporalAlertsList"></div>
                </div>
            </div>
            
            <div class="card" id="statsCard" style="display: none;">
                <h2 class="card-title">
                    <span class="material-icons">analytics</span>
                    EstatÃ­sticas
                    <span id="previewCount" style="margin-left: auto; font-size: 0.9rem; color: #a0a0a0;"></span>
                </h2>
                
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="statTotal">0</div>
                        <div class="stat-label">Total</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="statFacil">0</div>
                        <div class="stat-label">FÃ¡cil (1-4)</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="statMedio">0</div>
                        <div class="stat-label">MÃ©dio (5-6)</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="statDificil">0</div>
                        <div class="stat-label">DifÃ­cil (7-10)</div>
                    </div>
                </div>
                
                <h3 style="font-size: 1rem; margin-bottom: 10px;">DistribuiÃ§Ã£o de Letras</h3>
                <div class="letter-dist" id="letterDist"></div>
            </div>
            
            <div class="card" id="previewCard" style="display: none;">
                <h2 class="card-title">
                    <span class="material-icons">list</span>
                    Perguntas
                </h2>
                
                <div class="preview-container">
                    <table class="preview-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Pergunta</th>
                                <th>Correta</th>
                                <th>Pts</th>
                                <th>AÃ§Ãµes</th>
                            </tr>
                        </thead>
                        <tbody id="previewBody"></tbody>
                    </table>
                </div>
                
                <div class="btn-group">
                    <button class="btn btn-success" onclick="salvarNoFirebase()">
                        <span class="material-icons">cloud_upload</span>
                        Salvar no Firebase
                    </button>
                    <button class="btn btn-secondary" onclick="exportarExcel()">
                        <span class="material-icons">table_chart</span>
                        Exportar Excel
                    </button>
                    <button class="btn btn-secondary" onclick="exportarJSON()">
                        <span class="material-icons">code</span>
                        Exportar JSON
                    </button>
                </div>
            </div>
        </div>
    </div>
    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // V5 - CONSTANTES E UTILITÃRIOS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        const BANDEIRAS = {
            'Brasil': 'ğŸ‡§ğŸ‡·', 'Argentina': 'ğŸ‡¦ğŸ‡·', 'Uruguai': 'ğŸ‡ºğŸ‡¾', 'Paraguai': 'ğŸ‡µğŸ‡¾',
            'Chile': 'ğŸ‡¨ğŸ‡±', 'ColÃ´mbia': 'ğŸ‡¨ğŸ‡´', 'Peru': 'ğŸ‡µğŸ‡ª', 'Equador': 'ğŸ‡ªğŸ‡¨',
            'Venezuela': 'ğŸ‡»ğŸ‡ª', 'BolÃ­via': 'ğŸ‡§ğŸ‡´', 'MÃ©xico': 'ğŸ‡²ğŸ‡½', 'Espanha': 'ğŸ‡ªğŸ‡¸',
            'ItÃ¡lia': 'ğŸ‡®ğŸ‡¹', 'Inglaterra': 'ğŸ´ó §ó ¢ó ¥ó ®ó §ó ¿', 'Alemanha': 'ğŸ‡©ğŸ‡ª', 'FranÃ§a': 'ğŸ‡«ğŸ‡·',
            'Portugal': 'ğŸ‡µğŸ‡¹', 'Holanda': 'ğŸ‡³ğŸ‡±', 'PaÃ­ses Baixos': 'ğŸ‡³ğŸ‡±', 'BÃ©lgica': 'ğŸ‡§ğŸ‡ª', 
            'SuÃ­Ã§a': 'ğŸ‡¨ğŸ‡­', 'RÃºssia': 'ğŸ‡·ğŸ‡º', 'Turquia': 'ğŸ‡¹ğŸ‡·', 'GrÃ©cia': 'ğŸ‡¬ğŸ‡·', 
            'EscÃ³cia': 'ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿', 'Estados Unidos': 'ğŸ‡ºğŸ‡¸', 'EUA': 'ğŸ‡ºğŸ‡¸',
            'JapÃ£o': 'ğŸ‡¯ğŸ‡µ', 'China': 'ğŸ‡¨ğŸ‡³', 'Coreia do Sul': 'ğŸ‡°ğŸ‡·',
            'ArÃ¡bia Saudita': 'ğŸ‡¸ğŸ‡¦', 'AustrÃ¡lia': 'ğŸ‡¦ğŸ‡º', 'Catar': 'ğŸ‡¶ğŸ‡¦', 
            'Emirados Ãrabes': 'ğŸ‡¦ğŸ‡ª', 'CroÃ¡cia': 'ğŸ‡­ğŸ‡·', 'SÃ©rvia': 'ğŸ‡·ğŸ‡¸', 
            'UcrÃ¢nia': 'ğŸ‡ºğŸ‡¦', 'PolÃ´nia': 'ğŸ‡µğŸ‡±', 'Dinamarca': 'ğŸ‡©ğŸ‡°', 
            'SuÃ©cia': 'ğŸ‡¸ğŸ‡ª', 'Noruega': 'ğŸ‡³ğŸ‡´', 'Ãustria': 'ğŸ‡¦ğŸ‡¹',
            'Senegal': 'ğŸ‡¸ğŸ‡³', 'NigÃ©ria': 'ğŸ‡³ğŸ‡¬', 'Egito': 'ğŸ‡ªğŸ‡¬', 
            'Marrocos': 'ğŸ‡²ğŸ‡¦', 'CamarÃµes': 'ğŸ‡¨ğŸ‡²', 'Gana': 'ğŸ‡¬ğŸ‡­',
            'Costa do Marfim': 'ğŸ‡¨ğŸ‡®', 'Ãfrica do Sul': 'ğŸ‡¿ğŸ‡¦'
        };

        const FONTES_POR_PAIS = {
            'Brasil': ['Site oficial', 'ge.globo.com', 'ESPN Brasil', 'UOL Esporte', 'Lance!', 'CBF', 'Transfermarkt', 'Wikipedia'],
            'Argentina': ['Site oficial', 'TyC Sports', 'OlÃ©', 'ESPN Argentina', 'AFA', 'Transfermarkt', 'Wikipedia'],
            'Espanha': ['Site oficial', 'Marca', 'AS', 'Sport', 'Mundo Deportivo', 'RFEF', 'Transfermarkt', 'Wikipedia'],
            'ItÃ¡lia': ['Site oficial', 'La Gazzetta dello Sport', 'Corriere dello Sport', 'FIGC', 'Transfermarkt', 'Wikipedia'],
            'Inglaterra': ['Site oficial', 'BBC Sport', 'The Guardian', 'Sky Sports', 'FA', 'Transfermarkt', 'Wikipedia'],
            'Alemanha': ['Site oficial', 'Kicker', 'Bild', 'DFB', 'Transfermarkt', 'Wikipedia'],
            'FranÃ§a': ['Site oficial', "L'Ã‰quipe", 'France Football', 'FFF', 'Transfermarkt', 'Wikipedia'],
            'Portugal': ['Site oficial', 'A Bola', 'Record', 'O Jogo', 'FPF', 'Transfermarkt', 'Wikipedia'],
            'default': ['Site oficial', 'Transfermarkt', 'RSSSF', 'FIFA', 'CONMEBOL', 'UEFA', 'Wikipedia']
        };
        
        const PALAVRAS_ATEMPORAIS = [
            'quem Ã© o maior', 'qual Ã© o maior', 'quem Ã© o melhor',
            'quantos tÃ­tulos tem', 'quantos tÃ­tulos possui',
            'qual o recorde atual', 'quem Ã© o artilheiro',
            'quem Ã© o jogador com mais', 'atualmente', 'nos dias de hoje', 'Ã© o atual'
        ];

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // V5 - FUNÃ‡ÃƒO SLUG (NOVO!) - Cria IDs amigÃ¡veis
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function criarSlug(texto) {
            if (!texto) return 'sem-nome';
            
            return texto
                .toLowerCase()
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '') // Remove acentos
                .replace(/[^a-z0-9\s-]/g, '')    // Remove caracteres especiais
                .replace(/\s+/g, '-')             // EspaÃ§os viram hÃ­fens
                .replace(/-+/g, '-')              // Remove hÃ­fens duplicados
                .replace(/^-|-$/g, '')            // Remove hÃ­fens inÃ­cio/fim
                .substring(0, 30);                // MÃ¡ximo 30 caracteres
        }
        
        function getBandeira(pais) {
            return BANDEIRAS[pais] || 'ğŸ³ï¸';
        }

        function getFontesPorPais(pais) {
            return FONTES_POR_PAIS[pais] || FONTES_POR_PAIS['default'];
        }
    </script>
    
    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // FIREBASE E VARIÃVEIS GLOBAIS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        const firebaseConfig = {
            apiKey: "AIzaSyC5ZrkEy7KuCFJOtPvI7-P-JcA0MF4im5c",
            authDomain: "painel-yellup.firebaseapp.com",
            projectId: "painel-yellup",
            storageBucket: "painel-yellup.appspot.com",
            messagingSenderId: "608347210297",
            appId: "1:608347210297:web:75092713724e617c7203e8"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        let times = [];
        let campeonatos = [];
        let perguntasPreview = [];
        let perguntasExistentesTime = [];
        let perguntasExistentesCamp = [];
        let promptGeradoTime = '';
        let promptGeradoCamp = '';
        let timeSelecionado = null;
        let campeonatoSelecionado = null;
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // INICIALIZAÃ‡ÃƒO
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('V5 Iniciando...');
            
            setupTabs();
            setupUploads();
            setupTemaCheckboxes();
            setupSearchSelects();
            
            try {
                await Promise.all([carregarTimes(), carregarCampeonatos()]);
                console.log('Dados carregados!', times.length, 'times,', campeonatos.length, 'campeonatos');
            } catch (err) {
                console.error('Erro:', err);
                showToast('Erro ao conectar com Firebase', 'error');
            }
        });
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // V5 - SEARCH SELECT (NOVO!) - Busca por digitaÃ§Ã£o
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function setupSearchSelects() {
            // Times
            var inputTime = document.getElementById('searchTime');
            var dropdownTime = document.getElementById('dropdownTime');
            
            inputTime.addEventListener('input', function() {
                filtrarOpcoes('time', this.value);
            });
            
            inputTime.addEventListener('focus', function() {
                if (times.length > 0) {
                    filtrarOpcoes('time', this.value);
                    dropdownTime.classList.add('show');
                }
            });
            
            // Campeonatos
            var inputCamp = document.getElementById('searchCamp');
            var dropdownCamp = document.getElementById('dropdownCamp');
            
            inputCamp.addEventListener('input', function() {
                filtrarOpcoes('camp', this.value);
            });
            
            inputCamp.addEventListener('focus', function() {
                if (campeonatos.length > 0) {
                    filtrarOpcoes('camp', this.value);
                    dropdownCamp.classList.add('show');
                }
            });
            
            // Fechar dropdowns ao clicar fora
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.search-select-container')) {
                    dropdownTime.classList.remove('show');
                    dropdownCamp.classList.remove('show');
                }
            });
        }
        
        function filtrarOpcoes(tipo, busca) {
            var dropdown = document.getElementById(tipo === 'time' ? 'dropdownTime' : 'dropdownCamp');
            var lista = tipo === 'time' ? times : campeonatos;
            var buscaLower = busca.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
            
            var filtrados = lista.filter(function(item) {
                var nome = item.nome.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
                return nome.includes(buscaLower);
            });
            
            var html = '';
            
            if (filtrados.length === 0) {
                html = '<div class="search-select-no-results">Nenhum resultado encontrado</div>';
            } else {
                html += '<div class="search-select-count">' + filtrados.length + ' resultados</div>';
                
                filtrados.slice(0, 50).forEach(function(item) {
                    if (tipo === 'time') {
                        var bandeira = getBandeira(item.pais);
                        var pais = item.pais || 'Brasil';
                        html += '<div class="search-select-option" data-id="' + item.id + '" onclick="selecionarTime(\'' + item.id + '\')">';
                        html += '<span class="bandeira">' + bandeira + '</span>';
                        html += item.nome;
                        html += '<span class="pais">(' + pais + ')</span>';
                        html += '</div>';
                    } else {
                        html += '<div class="search-select-option" data-id="' + item.id + '" onclick="selecionarCampeonato(\'' + item.id + '\')">';
                        html += 'ğŸ† ' + item.nome;
                        html += '</div>';
                    }
                });
                
                if (filtrados.length > 50) {
                    html += '<div class="search-select-no-results">... e mais ' + (filtrados.length - 50) + ' resultados. Digite mais para refinar.</div>';
                }
            }
            
            dropdown.innerHTML = html;
            dropdown.classList.add('show');
        }
        
        function selecionarTime(timeId) {
            var time = times.find(function(t) { return t.id === timeId; });
            if (!time) return;
            
            timeSelecionado = time;
            
            document.getElementById('selectTime').value = timeId;
            document.getElementById('searchTime').value = time.nome;
            document.getElementById('dropdownTime').classList.remove('show');
            
            // Atualizar info card
            var slug = criarSlug(time.nome);
            document.getElementById('timeInfoBandeira').textContent = getBandeira(time.pais);
            document.getElementById('timeInfoNome').textContent = time.nome;
            document.getElementById('timeInfoPais').textContent = (time.pais || 'Brasil') + (time.tipo === 'SeleÃ§Ã£o' ? ' (SeleÃ§Ã£o)' : '');
            document.getElementById('timeInfoSlug').textContent = slug;
            document.getElementById('timeInfoCard').classList.add('show');
            
            // Buscar contagem automaticamente
            buscarProximoIdTime();
        }
        
        function selecionarCampeonato(campId) {
            var camp = campeonatos.find(function(c) { return c.id === campId; });
            if (!camp) return;
            
            campeonatoSelecionado = camp;
            
            document.getElementById('selectCampeonato').value = campId;
            document.getElementById('searchCamp').value = camp.nome;
            document.getElementById('dropdownCamp').classList.remove('show');
            
            // Atualizar info card
            var slug = criarSlug(camp.nome);
            document.getElementById('campInfoNome').textContent = camp.nome;
            document.getElementById('campInfoSlug').textContent = slug;
            document.getElementById('campInfoCard').classList.add('show');
            
            // Buscar contagem
            buscarProximoIdCamp();
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SETUP FUNCTIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function setupTabs() {
            document.querySelectorAll('.tab-btn').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    var tabId = btn.dataset.tab;
                    document.querySelectorAll('.tab-btn').forEach(function(b) { b.classList.remove('active'); });
                    document.querySelectorAll('.tab-content').forEach(function(c) { c.classList.remove('active'); });
                    btn.classList.add('active');
                    document.getElementById('tab-' + tabId).classList.add('active');
                });
            });
        }
        
        function setupUploads() {
            setupUploadArea('uploadAreaTime', 'fileInputTime', function(perguntas) {
                perguntasExistentesTime = perguntas;
                document.getElementById('uploadInfoTime').classList.add('show');
                document.getElementById('uploadInfoTextTime').textContent = perguntas.length + ' perguntas carregadas';
            });
            
            setupUploadArea('uploadAreaCamp', 'fileInputCamp', function(perguntas) {
                perguntasExistentesCamp = perguntas;
                document.getElementById('uploadInfoCamp').classList.add('show');
                document.getElementById('uploadInfoTextCamp').textContent = perguntas.length + ' perguntas carregadas';
            });
        }
        
        function setupUploadArea(areaId, inputId, callback) {
            var area = document.getElementById(areaId);
            var input = document.getElementById(inputId);
            
            area.addEventListener('click', function() { input.click(); });
            area.addEventListener('dragover', function(e) { e.preventDefault(); area.classList.add('dragover'); });
            area.addEventListener('dragleave', function() { area.classList.remove('dragover'); });
            area.addEventListener('drop', function(e) {
                e.preventDefault();
                area.classList.remove('dragover');
                if (e.dataTransfer.files.length) processFile(e.dataTransfer.files[0], callback);
            });
            input.addEventListener('change', function(e) {
                if (e.target.files.length) processFile(e.target.files[0], callback);
            });
        }
        
        function processFile(file, callback) {
            var reader = new FileReader();
            reader.onload = function(e) {
                try {
                    var data = JSON.parse(e.target.result);
                    var perguntas = extrairPerguntasDoJSON(data);
                    callback(perguntas);
                    showToast(perguntas.length + ' perguntas carregadas!', 'success');
                } catch (err) {
                    showToast('Erro ao ler arquivo', 'error');
                }
            };
            reader.readAsText(file);
        }
        
        function extrairPerguntasDoJSON(data) {
            var perguntas = [];
            if (Array.isArray(data)) {
                perguntas = data.map(function(p) { return p.pergunta; }).filter(Boolean);
            } else if (typeof data === 'object') {
                perguntas = Object.values(data).map(function(p) { return p.pergunta; }).filter(Boolean);
            }
            return perguntas;
        }
        
        function limparUploadTime() {
            perguntasExistentesTime = [];
            document.getElementById('uploadInfoTime').classList.remove('show');
            document.getElementById('fileInputTime').value = '';
        }
        
        function limparUploadCamp() {
            perguntasExistentesCamp = [];
            document.getElementById('uploadInfoCamp').classList.remove('show');
            document.getElementById('fileInputCamp').value = '';
        }
        
        function setupTemaCheckboxes() {
            document.querySelectorAll('input[name="temaTime"]').forEach(function(cb) {
                cb.addEventListener('change', function() {
                    if (cb.value === 'geral' && cb.checked) {
                        document.querySelectorAll('input[name="temaTime"]').forEach(function(o) {
                            if (o.value !== 'geral') o.checked = false;
                        });
                    } else if (cb.value !== 'geral' && cb.checked) {
                        document.querySelector('input[name="temaTime"][value="geral"]').checked = false;
                    }
                    updateTemaStyles('temaTime');
                });
            });
            
            document.querySelectorAll('input[name="temaCamp"]').forEach(function(cb) {
                cb.addEventListener('change', function() {
                    if (cb.value === 'geral' && cb.checked) {
                        document.querySelectorAll('input[name="temaCamp"]').forEach(function(o) {
                            if (o.value !== 'geral') o.checked = false;
                        });
                    } else if (cb.value !== 'geral' && cb.checked) {
                        document.querySelector('input[name="temaCamp"][value="geral"]').checked = false;
                    }
                    document.getElementById('decadasGroup').style.display = 
                        document.querySelector('input[name="temaCamp"][value="decadas"]').checked ? 'block' : 'none';
                    updateTemaStyles('temaCamp');
                });
            });
            
            updateTemaStyles('temaTime');
            updateTemaStyles('temaCamp');
        }
        
        function updateTemaStyles(name) {
            document.querySelectorAll('input[name="' + name + '"]').forEach(function(cb) {
                var item = cb.closest('.tema-item');
                if (cb.checked) item.classList.add('selected');
                else item.classList.remove('selected');
            });
        }
        
        function getTemasSelected(name) {
            var checked = [];
            document.querySelectorAll('input[name="' + name + '"]:checked').forEach(function(cb) {
                checked.push(cb.value);
            });
            return checked.length > 0 ? checked : ['geral'];
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CARREGAR DADOS DO FIREBASE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        async function carregarTimes() {
            try {
                var snapshot = await db.collection('times').orderBy('nome').get();
                times = snapshot.docs.map(function(doc) { return { id: doc.id, ...doc.data() }; });
                console.log('Times carregados:', times.length);
            } catch (err) {
                console.error('Erro ao carregar times:', err);
            }
        }
        
        async function carregarCampeonatos() {
            try {
                var snapshot = await db.collection('campeonatos').orderBy('nome').get();
                campeonatos = snapshot.docs.map(function(doc) { return { id: doc.id, ...doc.data() }; });
                console.log('Campeonatos carregados:', campeonatos.length);
            } catch (err) {
                console.error('Erro ao carregar campeonatos:', err);
            }
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // BUSCAR PRÃ“XIMO ID
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        async function buscarProximoIdTime() {
            if (!timeSelecionado) {
                showToast('Selecione um time primeiro!', 'error');
                return;
            }
            
            try {
                var snapshot = await db.collection('perguntas')
                    .where('timeId', '==', timeSelecionado.id)
                    .get();
                
                var qtd = snapshot.size;
                var proximoId = qtd + 1;
                
                document.getElementById('idInicialTime').value = proximoId;
                document.getElementById('timeInfoQtdPerguntas').textContent = qtd;
                document.getElementById('timeInfoProximoId').textContent = String(proximoId).padStart(3, '0');
                
                if (qtd > 0) {
                    showToast(qtd + ' perguntas existentes. PrÃ³ximo: ' + proximoId, 'success');
                }
            } catch (err) {
                console.error('Erro:', err);
            }
        }
        
        async function buscarProximoIdCamp() {
            if (!campeonatoSelecionado) {
                showToast('Selecione um campeonato primeiro!', 'error');
                return;
            }
            
            try {
                var snapshot = await db.collection('perguntas')
                    .where('campeonatoId', '==', campeonatoSelecionado.id)
                    .get();
                
                var qtd = snapshot.size;
                var proximoId = qtd + 1;
                
                document.getElementById('idInicialCamp').value = proximoId;
                document.getElementById('campInfoQtdPerguntas').textContent = qtd;
                document.getElementById('campInfoProximoId').textContent = String(proximoId).padStart(3, '0');
                
                if (qtd > 0) {
                    showToast(qtd + ' perguntas existentes. PrÃ³ximo: ' + proximoId, 'success');
                }
            } catch (err) {
                console.error('Erro:', err);
            }
        }
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // GERAR PROMPT - TIMES (V5 - Com Slug no ID!)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function gerarPromptTime() {
            if (!timeSelecionado) {
                showToast('Selecione um time!', 'error');
                return;
            }
            
            var time = timeSelecionado;
            var qtd = parseInt(document.getElementById('qtdPerguntasTime').value);
            var idInicial = parseInt(document.getElementById('idInicialTime').value) || 1;
            var temasSelecionados = getTemasSelected('temaTime');
            
            // V5: Usar SLUG no ID!
            var slug = criarSlug(time.nome);
            var bandeira = getBandeira(time.pais);
            var fontes = getFontesPorPais(time.pais);
            var paisTime = time.pais || 'Brasil';
            var eTipoSelecao = time.tipo === 'SeleÃ§Ã£o';
            
            var temasTexto = '';
            if (temasSelecionados.includes('geral')) {
                temasTexto = 'todos os temas (histÃ³ria, tÃ­tulos, jogadores, estÃ¡dio, curiosidades, tÃ©cnicos, clÃ¡ssicos)';
            } else {
                var temasMap = {
                    'historia': 'HistÃ³ria', 'titulos': 'TÃ­tulos', 'jogadores': 'Jogadores',
                    'estadio': 'EstÃ¡dio', 'curiosidades': 'Curiosidades',
                    'tecnicos': 'TÃ©cnicos', 'classicos': 'ClÃ¡ssicos'
                };
                temasTexto = temasSelecionados.map(function(t) { return temasMap[t]; }).join(', ');
            }
            
            var antiRepeticao = '';
            if (perguntasExistentesTime.length > 0) {
                var lista = perguntasExistentesTime.slice(0, 100).map(function(p, i) { return (i+1) + '. ' + p; }).join('\n');
                antiRepeticao = '\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nâš ï¸ PERGUNTAS EXISTENTES - NÃƒO REPETIR!\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' + lista;
            }
            
            // DistribuiÃ§Ãµes
            var d = {1: Math.round(qtd*0.05), 2: Math.round(qtd*0.10), 3: Math.round(qtd*0.10), 4: Math.round(qtd*0.10), 5: Math.round(qtd*0.15), 6: Math.round(qtd*0.15), 7: Math.round(qtd*0.10), 8: Math.round(qtd*0.10), 9: Math.round(qtd*0.08), 10: Math.round(qtd*0.07)};
            var facil = Math.round(qtd * 0.30);
            var medio = Math.round(qtd * 0.40);
            var dificil = Math.round(qtd * 0.30);
            var porLetra = Math.round(qtd * 0.25);
            
            var idFim = idInicial + qtd - 1;
            var idInicialStr = String(idInicial).padStart(3, '0');
            var idFimStr = String(idFim).padStart(3, '0');
            
            var tipoTexto = eTipoSelecao ? 'â­ SELEÃ‡ÃƒO NACIONAL' : 'âš½ Clube de Futebol';
            var avisoTipo = eTipoSelecao ? 'Este Ã© uma SELEÃ‡ÃƒO NACIONAL!' : 'NÃƒO confunda com times homÃ´nimos de outros paÃ­ses!';
            var fontesTexto = fontes.map(function(f) { return 'â€¢ ' + f; }).join('\n');
            
            promptGeradoTime = 'VocÃª Ã© um especialista em histÃ³ria do futebol. Crie ' + qtd + ' perguntas de quiz.\n\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
bandeira + ' IDENTIFICAÃ‡ÃƒO DO TIME\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'â€¢ Nome: ' + time.nome + '\n' +
'â€¢ PaÃ­s: ' + paisTime + ' ' + bandeira + '\n' +
'â€¢ Tipo: ' + tipoTexto + '\n' +
'â€¢ Slug para ID: ' + slug + '\n\n' +
'âš ï¸ ATENÃ‡ÃƒO: ' + avisoTipo + '\n\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'ğŸ“Š FORMATO JSON (Array de objetos)\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'[\n' +
'  {\n' +
'    "id": "' + slug + '-' + idInicialStr + '",\n' +
'    "pergunta": "Em que ano o ' + time.nome + ' foi fundado?",\n' +
'    "alternativas": {\n' +
'      "A": "1910",\n' +
'      "B": "1912",\n' +
'      "C": "1914",\n' +
'      "D": "1916"\n' +
'    },\n' +
'    "correta": "B",\n' +
'    "pontuacao": 4,\n' +
'    "timeId": "' + time.id + '",\n' +
'    "timeNome": "' + time.nome + '",\n' +
'    "campeonatoId": "",\n' +
'    "campeonatoNome": "",\n' +
'    "fonte": "Site oficial do clube"\n' +
'  }\n' +
']\n\n' +
'IMPORTANTE: O ID deve ser "' + slug + '-XXX" onde XXX Ã© o nÃºmero com 3 dÃ­gitos!\n' +
'IDs de ' + slug + '-' + idInicialStr + ' atÃ© ' + slug + '-' + idFimStr + '\n\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'â° REGRA DE OURO: PERGUNTAS TEMPORAIS!\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'Para NUNCA desatualizar, SEMPRE ancore as perguntas em:\n' +
'- Um perÃ­odo especÃ­fico (dÃ©cada de X, entre anos Y e Z)\n' +
'- Um evento especÃ­fico (na final de X, na conquista de Y)\n' +
'- Uma data de corte (atÃ© 2020, antes de 2000)\n\n' +
'âŒ PROIBIDO (podem desatualizar):\n' +
'â€¢ "Quem Ã© o maior artilheiro do ' + time.nome + '?"\n' +
'â€¢ "Quantos tÃ­tulos o ' + time.nome + ' tem?"\n' +
'â€¢ "Qual o recorde de pÃºblico?"\n' +
'â€¢ "Quem Ã© o jogador com mais jogos?"\n\n' +
'âœ… CORRETO (fatos histÃ³ricos imutÃ¡veis):\n' +
'â€¢ "Quem foi o maior artilheiro do ' + time.nome + ' na dÃ©cada de 1990?"\n' +
'â€¢ "Quantos tÃ­tulos o ' + time.nome + ' conquistou entre 2000 e 2010?"\n' +
'â€¢ "Qual era o recorde de pÃºblico atÃ© o ano 2000?"\n' +
'â€¢ "Quem era o capitÃ£o na conquista de 2011?"\n' +
'â€¢ "Quem foi o tÃ©cnico campeÃ£o em 2005?"\n\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'ğŸ“ PONTUAÃ‡ÃƒO GRANULAR 1-10 (Distribua bem!)\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'NÃƒO CONCENTRE EM 5 E 10! Use toda a escala:\n\n' +
'â€¢ 1 pt (~' + d[1] + '): Trivial - "Qual a cor da camisa?", "Em qual paÃ­s fica?"\n' +
'â€¢ 2 pts (~' + d[2] + '): Muito fÃ¡cil - "Qual o apelido?", "Qual o mascote?"\n' +
'â€¢ 3 pts (~' + d[3] + '): FÃ¡cil - "Em que dÃ©cada foi fundado?", "Nome do estÃ¡dio?"\n' +
'â€¢ 4 pts (~' + d[4] + '): FÃ¡cil-mÃ©dio - "Ano exato de fundaÃ§Ã£o?", "Ãdolo famoso?"\n' +
'â€¢ 5 pts (~' + d[5] + '): MÃ©dio - "TÃ©cnico campeÃ£o em ano X?", "AdversÃ¡rio da final de Y?"\n' +
'â€¢ 6 pts (~' + d[6] + '): MÃ©dio-difÃ­cil - "Artilheiro na temporada Z?", "Autor do gol do tÃ­tulo?"\n' +
'â€¢ 7 pts (~' + d[7] + '): DifÃ­cil - "Placar da final de 1998?", "Goleiro reserva em 2005?"\n' +
'â€¢ 8 pts (~' + d[8] + '): Muito difÃ­cil - "Primeiro gol no estÃ¡dio?", "PÃºblico exato da final?"\n' +
'â€¢ 9 pts (~' + d[9] + '): Expert - "Primeiro presidente?", "Ãrbitro da final de X?"\n' +
'â€¢ 10 pts (~' + d[10] + '): Especialista - "Primeiro adversÃ¡rio oficial?", "NÂº de fundadores?"\n\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'ğŸ“Š METAS DE DISTRIBUIÃ‡ÃƒO (' + qtd + ' perguntas)\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'DIFICULDADE:\n' +
'â€¢ FÃ¡cil (1-4 pts): ~' + facil + ' perguntas (30%)\n' +
'â€¢ MÃ©dio (5-6 pts): ~' + medio + ' perguntas (40%)\n' +
'â€¢ DifÃ­cil (7-10 pts): ~' + dificil + ' perguntas (30%)\n\n' +
'LETRAS (resposta correta):\n' +
'â€¢ A: ~' + porLetra + ' | B: ~' + porLetra + ' | C: ~' + porLetra + ' | D: ~' + porLetra + '\n' +
'â€¢ ğŸš« MÃXIMO 2 respostas iguais seguidas!\n\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'ğŸ“… COBERTURA TEMPORAL (distribua por toda a histÃ³ria!)\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'â€¢ FundaÃ§Ã£o atÃ© 1960: ~15% das perguntas\n' +
'â€¢ 1960-1980: ~15%\n' +
'â€¢ 1980-2000: ~20%\n' +
'â€¢ 2000-2015: ~25%\n' +
'â€¢ 2015-2024: ~25%\n\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'ğŸ¯ TEMAS: ' + temasTexto + '\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'1. HISTÃ“RIA/FUNDAÃ‡ÃƒO (~15%): Ano de fundaÃ§Ã£o, fundadores, primeiros anos\n' +
'2. TÃTULOS/CONQUISTAS (~20%): Campeonatos, finais, campanhas\n' +
'3. JOGADORES (~25%): Ãdolos de TODAS as Ã©pocas, artilheiros, recordistas\n' +
'4. TÃ‰CNICOS (~10%): Treinadores campeÃµes, recordistas\n' +
'5. ESTÃDIO/TORCIDA (~10%): Nome, inauguraÃ§Ã£o, recordes de pÃºblico\n' +
'6. CLÃSSICOS (~10%): Rivalidades, jogos histÃ³ricos\n' +
'7. CURIOSIDADES (~10%): Fatos inusitados, recordes\n\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'ğŸ” FONTES (cite sempre no campo "fonte")\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
fontesTexto + '\n\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'âœ… REGRAS FINAIS\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'FAÃ‡A:\n' +
'âœ“ Perguntas claras, objetivas, mÃ¡ximo 2 linhas\n' +
'âœ“ 4 alternativas plausÃ­veis (todas parecem possÃ­veis)\n' +
'âœ“ SEMPRE ancorar em perÃ­odo/evento especÃ­fico\n' +
'âœ“ Distribuir pontuaÃ§Ã£o de 1 a 10\n' +
'âœ“ Citar fonte em cada pergunta\n\n' +
'NÃƒO FAÃ‡A:\n' +
'âœ— Perguntas atemporais que podem desatualizar\n' +
'âœ— "Todas as anteriores" / "Nenhuma das anteriores"\n' +
'âœ— Perguntas sobre 2025 em diante\n' +
'âœ— 3+ respostas consecutivas com mesma letra\n' +
'âœ— Concentrar pontuaÃ§Ãµes em 5 e 10' +
antiRepeticao + '\n\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'ğŸ“¤ SAÃDA ESPERADA\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'Gere EXATAMENTE ' + qtd + ' perguntas em formato JSON.\n' +
'IDs: ' + slug + '-' + idInicialStr + ' atÃ© ' + slug + '-' + idFimStr + '\n\n' +
'Retorne APENAS o array JSON vÃ¡lido, sem explicaÃ§Ãµes.';
            
            document.getElementById('promptCardTime').style.display = 'block';
            document.getElementById('promptDisplayTime').textContent = promptGeradoTime;
            showToast('Prompt V5 gerado! ID: ' + slug + '-XXX', 'success');
        }
        
        function copiarPromptTime() {
            if (!promptGeradoTime) {
                showToast('Gere o prompt primeiro!', 'error');
                return;
            }
            navigator.clipboard.writeText(promptGeradoTime);
            showToast('Prompt copiado!', 'success');
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // GERAR PROMPT - CAMPEONATOS (V5 - COMPLETO como Times!)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function gerarPromptCampeonato() {
            if (!campeonatoSelecionado) {
                showToast('Selecione um campeonato!', 'error');
                return;
            }
            
            var camp = campeonatoSelecionado;
            var qtd = parseInt(document.getElementById('qtdPerguntasCamp').value);
            var idInicial = parseInt(document.getElementById('idInicialCamp').value) || 1;
            var temasSelecionados = getTemasSelected('temaCamp');
            
            // V5: Usar SLUG no ID!
            var slug = criarSlug(camp.nome);
            
            var temasTexto = '';
            var decadasTexto = '';
            
            if (temasSelecionados.includes('geral')) {
                temasTexto = 'todos os temas (campeÃµes, finais, artilheiros, recordes, curiosidades, tÃ©cnicos, estÃ¡dios)';
            } else {
                var temasMap = {
                    'campeoes': 'CampeÃµes e Finais', 'artilheiros': 'Artilheiros',
                    'curiosidades': 'Curiosidades', 'tecnicos': 'TÃ©cnicos',
                    'estadios': 'EstÃ¡dios', 'decadas': 'Por DÃ©cadas', 'recente': 'Recentes'
                };
                temasTexto = temasSelecionados.map(function(t) { return temasMap[t]; }).filter(Boolean).join(', ');
            }
            
            if (temasSelecionados.includes('decadas')) {
                var decadasSelecionadas = [];
                document.querySelectorAll('input[name="decada"]:checked').forEach(function(cb) {
                    decadasSelecionadas.push(cb.value);
                });
                if (decadasSelecionadas.length > 0) {
                    decadasTexto = '\nğŸ“… DÃ©cadas especÃ­ficas: ' + decadasSelecionadas.map(function(d) { return d + '-' + (parseInt(d)+9); }).join(', ');
                }
            }
            
            var antiRepeticao = '';
            if (perguntasExistentesCamp.length > 0) {
                var lista = perguntasExistentesCamp.slice(0, 100).map(function(p, i) { return (i+1) + '. ' + p; }).join('\n');
                antiRepeticao = '\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nâš ï¸ PERGUNTAS EXISTENTES - NÃƒO REPETIR!\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' + lista;
            }
            
            // DistribuiÃ§Ãµes
            var d = {1: Math.round(qtd*0.05), 2: Math.round(qtd*0.10), 3: Math.round(qtd*0.10), 4: Math.round(qtd*0.10), 5: Math.round(qtd*0.15), 6: Math.round(qtd*0.15), 7: Math.round(qtd*0.10), 8: Math.round(qtd*0.10), 9: Math.round(qtd*0.08), 10: Math.round(qtd*0.07)};
            var facil = Math.round(qtd * 0.30);
            var medio = Math.round(qtd * 0.40);
            var dificil = Math.round(qtd * 0.30);
            var porLetra = Math.round(qtd * 0.25);
            
            var idFim = idInicial + qtd - 1;
            var idInicialStr = String(idInicial).padStart(3, '0');
            var idFimStr = String(idFim).padStart(3, '0');
            
            promptGeradoCamp = 'VocÃª Ã© um especialista em histÃ³ria do futebol. Crie ' + qtd + ' perguntas sobre a ' + camp.nome + '.\n\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'ğŸ† IDENTIFICAÃ‡ÃƒO DO CAMPEONATO\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'â€¢ Nome: ' + camp.nome + '\n' +
'â€¢ Slug para ID: ' + slug + '\n' +
'â€¢ Temas: ' + temasTexto + decadasTexto + '\n\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'ğŸ“Š FORMATO JSON (Array de objetos)\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'[\n' +
'  {\n' +
'    "id": "' + slug + '-' + idInicialStr + '",\n' +
'    "pergunta": "Qual time venceu a ' + camp.nome + ' de 2019?",\n' +
'    "alternativas": {\n' +
'      "A": "Time A",\n' +
'      "B": "Time B",\n' +
'      "C": "Time C",\n' +
'      "D": "Time D"\n' +
'    },\n' +
'    "correta": "A",\n' +
'    "pontuacao": 3,\n' +
'    "timeId": "",\n' +
'    "timeNome": "",\n' +
'    "campeonatoId": "' + camp.id + '",\n' +
'    "campeonatoNome": "' + camp.nome + '",\n' +
'    "fonte": "Site oficial"\n' +
'  }\n' +
']\n\n' +
'IMPORTANTE: O ID deve ser "' + slug + '-XXX" onde XXX Ã© o nÃºmero com 3 dÃ­gitos!\n' +
'IDs de ' + slug + '-' + idInicialStr + ' atÃ© ' + slug + '-' + idFimStr + '\n\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'â° REGRA DE OURO: PERGUNTAS TEMPORAIS!\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'Para NUNCA desatualizar, SEMPRE ancore as perguntas em:\n' +
'- Uma ediÃ§Ã£o especÃ­fica (na ediÃ§Ã£o de 2019, em 1998)\n' +
'- Um perÃ­odo especÃ­fico (entre 2000 e 2010, na dÃ©cada de 90)\n' +
'- Uma data de corte (atÃ© 2015, antes de 2000)\n\n' +
'âŒ PROIBIDO (podem desatualizar):\n' +
'â€¢ "Qual time mais venceu a ' + camp.nome + '?"\n' +
'â€¢ "Quem Ã© o maior artilheiro da histÃ³ria?"\n' +
'â€¢ "Quantos tÃ­tulos o Boca Juniors tem?"\n' +
'â€¢ "Qual paÃ­s tem mais campeÃµes?"\n\n' +
'âœ… CORRETO (fatos histÃ³ricos imutÃ¡veis):\n' +
'â€¢ "Qual time era o maior vencedor atÃ© 2015?"\n' +
'â€¢ "Quem foi o artilheiro da ediÃ§Ã£o de 2019?"\n' +
'â€¢ "Quantas vezes o Boca venceu entre 2000 e 2010?"\n' +
'â€¢ "Quem foi o tÃ©cnico campeÃ£o em 2005?"\n' +
'â€¢ "Qual foi o placar da final de 2011?"\n\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'ğŸ“ PONTUAÃ‡ÃƒO GRANULAR 1-10 (Distribua bem!)\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'NÃƒO CONCENTRE EM 5 E 10! Use toda a escala:\n\n' +
'â€¢ 1 pt (~' + d[1] + '): Trivial - "CampeÃ£o mais recente?", "Time famoso que venceu?"\n' +
'â€¢ 2 pts (~' + d[2] + '): Muito fÃ¡cil - "Times multicampeÃµes conhecidos?"\n' +
'â€¢ 3 pts (~' + d[3] + '): FÃ¡cil - "Ano de criaÃ§Ã£o?", "PaÃ­s com mais tÃ­tulos atÃ© 2010?"\n' +
'â€¢ 4 pts (~' + d[4] + '): FÃ¡cil-mÃ©dio - "Vice-campeÃ£o de ediÃ§Ã£o famosa?"\n' +
'â€¢ 5 pts (~' + d[5] + '): MÃ©dio - "Artilheiro de ediÃ§Ã£o especÃ­fica?"\n' +
'â€¢ 6 pts (~' + d[6] + '): MÃ©dio-difÃ­cil - "TÃ©cnico campeÃ£o em ano X?", "Goleada histÃ³rica?"\n' +
'â€¢ 7 pts (~' + d[7] + '): DifÃ­cil - "Placar exato de final?", "Semifinalista de ano Y?"\n' +
'â€¢ 8 pts (~' + d[8] + '): Muito difÃ­cil - "Hat-trick em final?", "ExpulsÃ£o marcante?"\n' +
'â€¢ 9 pts (~' + d[9] + '): Expert - "Ãrbitro de final?", "PÃºblico exato?"\n' +
'â€¢ 10 pts (~' + d[10] + '): Especialista - "Primeiro gol da histÃ³ria?", "Detalhe raro?"\n\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'ğŸ“Š METAS DE DISTRIBUIÃ‡ÃƒO (' + qtd + ' perguntas)\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'DIFICULDADE:\n' +
'â€¢ FÃ¡cil (1-4 pts): ~' + facil + ' perguntas (30%)\n' +
'â€¢ MÃ©dio (5-6 pts): ~' + medio + ' perguntas (40%)\n' +
'â€¢ DifÃ­cil (7-10 pts): ~' + dificil + ' perguntas (30%)\n\n' +
'LETRAS (resposta correta):\n' +
'â€¢ A: ~' + porLetra + ' | B: ~' + porLetra + ' | C: ~' + porLetra + ' | D: ~' + porLetra + '\n' +
'â€¢ ğŸš« MÃXIMO 2 respostas iguais seguidas!\n\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'ğŸ“… COBERTURA TEMPORAL (distribua por toda a histÃ³ria!)\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'â€¢ Primeiras ediÃ§Ãµes / Anos 60: ~15%\n' +
'â€¢ Anos 1970-1990: ~20%\n' +
'â€¢ Anos 1990-2005: ~25%\n' +
'â€¢ Anos 2005-2015: ~20%\n' +
'â€¢ Anos 2015-2024: ~20%\n\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'ğŸ¯ TEMAS\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'1. CAMPEÃ•ES/FINAIS (~20%): Vencedores, vice-campeÃµes, placares\n' +
'2. ARTILHEIROS (~15%): Goleadores de ediÃ§Ãµes, hat-tricks\n' +
'3. TÃ‰CNICOS (~15%): Treinadores campeÃµes, recordistas\n' +
'4. RECORDES/ESTATÃSTICAS (~15%): Maiores goleadas, sequÃªncias\n' +
'5. CURIOSIDADES (~15%): Fatos inusitados, estreias, despedidas\n' +
'6. ESTÃDIOS/SEDES (~10%): Cidades-sede, estÃ¡dios das finais\n' +
'7. PAÃSES/CLUBES (~10%): DomÃ­nio de paÃ­ses em perÃ­odos\n\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'ğŸ” FONTES (cite sempre no campo "fonte")\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'â€¢ Site oficial (CONMEBOL, UEFA, CBF, FIFA)\n' +
'â€¢ Wikipedia\n' +
'â€¢ RSSSF.org\n' +
'â€¢ Transfermarkt\n' +
'â€¢ Jornais esportivos\n\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'âœ… REGRAS FINAIS\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'FAÃ‡A:\n' +
'âœ“ Perguntas claras e objetivas\n' +
'âœ“ 4 alternativas plausÃ­veis\n' +
'âœ“ SEMPRE ancorar em ediÃ§Ã£o/perÃ­odo especÃ­fico\n' +
'âœ“ Distribuir pontuaÃ§Ã£o de 1 a 10\n' +
'âœ“ Citar fonte em cada pergunta\n\n' +
'NÃƒO FAÃ‡A:\n' +
'âœ— Perguntas atemporais que desatualizam\n' +
'âœ— "Todas as anteriores" / "Nenhuma das anteriores"\n' +
'âœ— Perguntas sobre 2025 em diante\n' +
'âœ— 3+ respostas seguidas com mesma letra\n' +
'âœ— Concentrar em 5 e 10 pontos' +
antiRepeticao + '\n\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'ğŸ“¤ SAÃDA ESPERADA\n' +
'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n' +
'Gere EXATAMENTE ' + qtd + ' perguntas em formato JSON.\n' +
'IDs: ' + slug + '-' + idInicialStr + ' atÃ© ' + slug + '-' + idFimStr + '\n\n' +
'Retorne APENAS o array JSON vÃ¡lido, sem explicaÃ§Ãµes.';
            
            document.getElementById('promptCardCamp').style.display = 'block';
            document.getElementById('promptDisplayCamp').textContent = promptGeradoCamp;
            showToast('Prompt V5 gerado! ID: ' + slug + '-XXX', 'success');
        }
        
        function copiarPromptCampeonato() {
            if (!promptGeradoCamp) {
                showToast('Gere o prompt primeiro!', 'error');
                return;
            }
            navigator.clipboard.writeText(promptGeradoCamp);
            showToast('Prompt copiado!', 'success');
        }
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // VALIDAÃ‡ÃƒO E PROCESSAMENTO (V5)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function processarEValidarJSON() {
            var jsonText = document.getElementById('jsonInput').value.trim();
            
            if (!jsonText) {
                showToast('Cole ou carregue um JSON!', 'error');
                return;
            }
            
            try {
                var cleanJson = jsonText.replace(/```json\s*/g, '').replace(/```\s*/g, '');
                var data = JSON.parse(cleanJson);
                
                if (Array.isArray(data)) {
                    perguntasPreview = data;
                } else {
                    perguntasPreview = Object.values(data);
                }
                
                if (perguntasPreview.length === 0) {
                    showToast('Nenhuma pergunta encontrada!', 'error');
                    return;
                }
                
                var resultados = validarPerguntas(perguntasPreview);
                exibirResultadosValidacao(resultados);
                renderizarPreview();
                calcularEstatisticas();
                
                document.getElementById('validationCard').classList.add('show');
                document.getElementById('statsCard').style.display = 'block';
                document.getElementById('previewCard').style.display = 'block';
                
                showToast(perguntasPreview.length + ' perguntas processadas!', 'success');
                
            } catch (err) {
                showToast('Erro no JSON: ' + err.message, 'error');
                console.error(err);
            }
        }
        
        function carregarJSONPreview(event) {
            var file = event.target.files[0];
            if (!file) return;
            
            var reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('jsonInput').value = e.target.result;
                processarEValidarJSON();
            };
            reader.readAsText(file);
        }
        
        function validarPerguntas(perguntas) {
            var resultados = {
                total: perguntas.length,
                problemas: [],
                avisos: [],
                ok: [],
                distribuicaoPontuacao: {},
                distribuicaoLetras: { A: 0, B: 0, C: 0, D: 0 },
                sequenciasLetras: [],
                perguntasAtemporais: []
            };
            
            for (var i = 1; i <= 10; i++) {
                resultados.distribuicaoPontuacao[i] = 0;
            }
            
            var ultimaLetra = '';
            var sequenciaAtual = 0;
            
            perguntas.forEach(function(p, idx) {
                var pontuacao = p.pontuacao || 5;
                var correta = p.correta || 'A';
                var perguntaTexto = (p.pergunta || '').toLowerCase();
                
                if (resultados.distribuicaoPontuacao[pontuacao] !== undefined) {
                    resultados.distribuicaoPontuacao[pontuacao]++;
                }
                
                if (resultados.distribuicaoLetras[correta] !== undefined) {
                    resultados.distribuicaoLetras[correta]++;
                }
                
                if (correta === ultimaLetra) {
                    sequenciaAtual++;
                    if (sequenciaAtual >= 3) {
                        resultados.sequenciasLetras.push({ posicao: idx + 1, letra: correta, quantidade: sequenciaAtual });
                    }
                } else {
                    sequenciaAtual = 1;
                    ultimaLetra = correta;
                }
                
                PALAVRAS_ATEMPORAIS.forEach(function(palavra) {
                    if (perguntaTexto.includes(palavra)) {
                        resultados.perguntasAtemporais.push({ numero: idx + 1, pergunta: p.pergunta, problema: palavra });
                    }
                });
                
                if (!p.fonte || p.fonte.trim() === '') {
                    resultados.avisos.push('Pergunta ' + (idx + 1) + ' sem fonte');
                }
            });
            
            var total = perguntas.length;
            var ideais = {1:5, 2:10, 3:10, 4:10, 5:15, 6:15, 7:10, 8:10, 9:8, 10:7};
            
            for (var pont = 1; pont <= 10; pont++) {
                var qtdAtual = resultados.distribuicaoPontuacao[pont];
                var pctAtual = (qtdAtual / total) * 100;
                var pctIdeal = ideais[pont];
                var diff = Math.abs(pctAtual - pctIdeal);
                
                if (diff > 10) {
                    resultados.problemas.push('PontuaÃ§Ã£o ' + pont + ': ' + Math.round(pctAtual) + '% (ideal: ' + pctIdeal + '%)');
                } else if (diff > 5) {
                    resultados.avisos.push('PontuaÃ§Ã£o ' + pont + ': ' + Math.round(pctAtual) + '% (ideal: ' + pctIdeal + '%)');
                }
            }
            
            ['A', 'B', 'C', 'D'].forEach(function(letra) {
                var qtd = resultados.distribuicaoLetras[letra];
                var pct = (qtd / total) * 100;
                if (pct < 15 || pct > 35) {
                    resultados.problemas.push('Letra ' + letra + ': ' + Math.round(pct) + '% (esperado: 20-30%)');
                } else if (pct < 20 || pct > 30) {
                    resultados.avisos.push('Letra ' + letra + ': ' + Math.round(pct) + '% (ideal: ~25%)');
                }
            });
            
            if (resultados.sequenciasLetras.length > 0) {
                resultados.problemas.push(resultados.sequenciasLetras.length + ' sequÃªncias de 3+ letras iguais');
            }
            
            if (resultados.perguntasAtemporais.length > 0) {
                resultados.avisos.push(resultados.perguntasAtemporais.length + ' possÃ­veis perguntas atemporais');
            }
            
            if (resultados.problemas.length === 0) {
                resultados.ok.push('DistribuiÃ§Ã£o de pontuaÃ§Ã£o OK');
                resultados.ok.push('DistribuiÃ§Ã£o de letras OK');
                resultados.ok.push('Sem sequÃªncias problemÃ¡ticas');
            }
            
            return resultados;
        }
        
        function exibirResultadosValidacao(resultados) {
            var html = '';
            
            resultados.ok.forEach(function(msg) {
                html += '<div class="validation-item ok"><span class="material-icons icon">check_circle</span><span>' + msg + '</span></div>';
            });
            
            resultados.avisos.forEach(function(msg) {
                html += '<div class="validation-item warning"><span class="material-icons icon">warning</span><span>' + msg + '</span></div>';
            });
            
            resultados.problemas.forEach(function(msg) {
                html += '<div class="validation-item error"><span class="material-icons icon">error</span><span>' + msg + '</span></div>';
            });
            
            document.getElementById('validationResults').innerHTML = html;
            
            // Grid de pontuaÃ§Ã£o
            var gridHtml = '';
            var total = resultados.total;
            var ideais = {1:5, 2:10, 3:10, 4:10, 5:15, 6:15, 7:10, 8:10, 9:8, 10:7};
            
            for (var i = 1; i <= 10; i++) {
                var qtd = resultados.distribuicaoPontuacao[i];
                var pct = total > 0 ? Math.round((qtd / total) * 100) : 0;
                var ideal = ideais[i];
                var diff = Math.abs(pct - ideal);
                var classe = diff <= 5 ? 'ok' : (diff <= 10 ? 'warning' : 'error');
                
                gridHtml += '<div class="pontuacao-bar ' + classe + '"><div class="valor">' + qtd + '</div><div>' + i + 'pt</div><div style="font-size:0.7rem;color:#888;">' + pct + '%</div></div>';
            }
            document.getElementById('pontuacaoGrid').innerHTML = gridHtml;
            
            // Alertas temporais
            var alertsDiv = document.getElementById('temporalAlerts');
            var alertsList = document.getElementById('temporalAlertsList');
            
            if (resultados.perguntasAtemporais.length > 0) {
                alertsDiv.style.display = 'block';
                var alertsHtml = '';
                resultados.perguntasAtemporais.slice(0, 10).forEach(function(alerta) {
                    alertsHtml += '<div class="temporal-alert"><span class="pergunta-num">Pergunta ' + alerta.numero + ':</span> ' + alerta.pergunta.substring(0, 100) + '...<div class="sugestao">ğŸ’¡ Detectado: "' + alerta.problema + '" - ancore em perÃ­odo especÃ­fico</div></div>';
                });
                if (resultados.perguntasAtemporais.length > 10) {
                    alertsHtml += '<p style="color:#a0a0a0;">...e mais ' + (resultados.perguntasAtemporais.length - 10) + ' alertas</p>';
                }
                alertsList.innerHTML = alertsHtml;
            } else {
                alertsDiv.style.display = 'none';
            }
        }
        
        function renderizarPreview() {
            var tbody = document.getElementById('previewBody');
            tbody.innerHTML = '';
            
            perguntasPreview.forEach(function(p, index) {
                var dificuldade = getDificuldade(p.pontuacao);
                var tr = document.createElement('tr');
                tr.innerHTML = '<td><code>' + (p.id || (index + 1)) + '</code></td>' +
                    '<td><strong>' + p.pergunta + '</strong>' +
                    '<div style="font-size: 0.85rem; color: #a0a0a0; margin-top: 5px;">' +
                    'A) ' + (p.alternativas?.A || '-') + ' | B) ' + (p.alternativas?.B || '-') + ' | C) ' + (p.alternativas?.C || '-') + ' | D) ' + (p.alternativas?.D || '-') + '</div></td>' +
                    '<td><span class="correct-answer">' + p.correta + '</span></td>' +
                    '<td><span class="badge badge-' + dificuldade.classe + '">' + p.pontuacao + '</span></td>' +
                    '<td><button class="btn btn-danger btn-delete" onclick="removerPergunta(' + index + ')"><span class="material-icons">delete</span></button></td>';
                tbody.appendChild(tr);
            });
            
            document.getElementById('previewCount').textContent = perguntasPreview.length + ' perguntas';
        }
        
        function getDificuldade(pontuacao) {
            if (pontuacao <= 4) return { classe: 'easy', label: 'FÃ¡cil' };
            if (pontuacao <= 6) return { classe: 'medium', label: 'MÃ©dio' };
            return { classe: 'hard', label: 'DifÃ­cil' };
        }
        
        function calcularEstatisticas() {
            var total = perguntasPreview.length;
            var facil = 0, medio = 0, dificil = 0;
            var letras = { A: 0, B: 0, C: 0, D: 0 };
            
            perguntasPreview.forEach(function(p) {
                if (p.pontuacao <= 4) facil++;
                else if (p.pontuacao <= 6) medio++;
                else dificil++;
                
                if (p.correta && letras.hasOwnProperty(p.correta)) {
                    letras[p.correta]++;
                }
            });
            
            document.getElementById('statTotal').textContent = total;
            document.getElementById('statFacil').textContent = facil;
            document.getElementById('statMedio').textContent = medio;
            document.getElementById('statDificil').textContent = dificil;
            
            var letterDist = document.getElementById('letterDist');
            letterDist.innerHTML = '';
            ['A', 'B', 'C', 'D'].forEach(function(letra) {
                var pct = total > 0 ? Math.round((letras[letra] / total) * 100) : 0;
                letterDist.innerHTML += '<div class="letter-item"><span class="letter-badge">' + letra + '</span><span>' + letras[letra] + ' (' + pct + '%)</span></div>';
            });
        }
        
        function removerPergunta(index) {
            perguntasPreview.splice(index, 1);
            renderizarPreview();
            calcularEstatisticas();
            var resultados = validarPerguntas(perguntasPreview);
            exibirResultadosValidacao(resultados);
            showToast('Pergunta removida!', 'success');
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SALVAR E EXPORTAR
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        async function salvarNoFirebase() {
            if (perguntasPreview.length === 0) {
                showToast('Nenhuma pergunta para salvar!', 'error');
                return;
            }
            
            var btn = event.target.closest('button');
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner"></span> Salvando...';
            
            try {
                var batch = db.batch();
                var count = 0;
                
                for (var i = 0; i < perguntasPreview.length; i++) {
                    var p = perguntasPreview[i];
                    var docRef = db.collection('perguntas').doc();
                    
                    var dados = {
                        id: p.id || '',
                        pergunta: p.pergunta,
                        alternativas: p.alternativas,
                        correta: p.correta,
                        pontuacao: parseInt(p.pontuacao) || 5,
                        fonte: p.fonte || '',
                        criadoEm: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    if (p.timeId) {
                        dados.timeId = p.timeId;
                        dados.timeNome = p.timeNome || '';
                    }
                    if (p.campeonatoId) {
                        dados.campeonatoId = p.campeonatoId;
                        dados.campeonatoNome = p.campeonatoNome || '';
                    }
                    
                    batch.set(docRef, dados);
                    count++;
                    
                    if (count % 500 === 0) {
                        await batch.commit();
                        batch = db.batch();
                    }
                }
                
                await batch.commit();
                showToast(perguntasPreview.length + ' perguntas salvas!', 'success');
                
            } catch (err) {
                showToast('Erro ao salvar: ' + err.message, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<span class="material-icons">cloud_upload</span> Salvar no Firebase';
            }
        }
        
        function exportarExcel() {
            if (perguntasPreview.length === 0) {
                showToast('Nenhuma pergunta!', 'error');
                return;
            }
            
            var dados = perguntasPreview.map(function(p, i) {
                return {
                    'ID': p.id || (i + 1),
                    'Pergunta': p.pergunta,
                    'A': p.alternativas?.A || '',
                    'B': p.alternativas?.B || '',
                    'C': p.alternativas?.C || '',
                    'D': p.alternativas?.D || '',
                    'Correta': p.correta,
                    'Pontos': p.pontuacao,
                    'Fonte': p.fonte || ''
                };
            });
            
            var ws = XLSX.utils.json_to_sheet(dados);
            var wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Perguntas');
            XLSX.writeFile(wb, 'perguntas_' + new Date().toISOString().slice(0,10) + '.xlsx');
            showToast('Excel exportado!', 'success');
        }
        
        function exportarJSON() {
            if (perguntasPreview.length === 0) {
                showToast('Nenhuma pergunta!', 'error');
                return;
            }
            
            var blob = new Blob([JSON.stringify(perguntasPreview, null, 2)], { type: 'application/json' });
            var a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'perguntas_' + new Date().toISOString().slice(0,10) + '.json';
            a.click();
            showToast('JSON exportado!', 'success');
        }
        
        function showToast(message, type) {
            type = type || 'success';
            var toast = document.createElement('div');
            toast.className = 'toast toast-' + type;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(function() { toast.remove(); }, 3000);
        }
    </script>
</body>
</html>
