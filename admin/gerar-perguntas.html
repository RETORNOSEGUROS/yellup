<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerar Perguntas - Yellup Admin</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #0a0f1a 0%, #1a1f35 50%, #0d1520 100%);
      min-height: 100vh;
      color: #e4e8f1;
      padding: 20px;
    }
    
    .container { max-width: 1400px; margin: 0 auto; }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .header h1 {
      font-size: 1.8em;
      background: linear-gradient(135deg, #ffd700, #ffb347);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .btn-back {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      color: #e4e8f1;
      padding: 10px 20px;
      border-radius: 10px;
      text-decoration: none;
      font-weight: 500;
      transition: all 0.3s;
    }
    
    .btn-back:hover { background: rgba(255,255,255,0.2); }
    
    .card {
      background: rgba(30, 40, 60, 0.6);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 20px;
      padding: 25px;
      margin-bottom: 25px;
    }
    
    .card-title {
      font-size: 1.2em;
      font-weight: 600;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 15px;
    }
    
    .stat-box {
      background: rgba(0,0,0,0.3);
      border-radius: 15px;
      padding: 20px;
      text-align: center;
    }
    
    .stat-value { font-size: 2em; font-weight: 700; color: #ffd700; }
    .stat-label { font-size: 0.85em; color: #a0a8b8; margin-top: 5px; }
    
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: #ffd700; }
    
    .form-control {
      width: 100%;
      padding: 12px 15px;
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 10px;
      color: #e4e8f1;
      font-size: 1em;
      font-family: inherit;
    }
    
    .form-control:focus { outline: none; border-color: #ffd700; }
    textarea.form-control { min-height: 150px; resize: vertical; }
    .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
    
    .btn {
      padding: 12px 25px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.95em;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn-primary { background: linear-gradient(135deg, #ffd700, #ffb347); color: #0a0f1a; }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(255,215,0,0.3); }
    .btn-success { background: linear-gradient(135deg, #22c55e, #16a34a); color: white; }
    .btn-secondary { background: rgba(255,255,255,0.1); color: #e4e8f1; border: 1px solid rgba(255,255,255,0.2); }
    .btn-danger { background: rgba(239,68,68,0.2); color: #ef4444; border: 1px solid rgba(239,68,68,0.3); }
    .btn-group { display: flex; gap: 10px; flex-wrap: wrap; }
    
    .tabs {
      display: flex;
      gap: 5px;
      margin-bottom: 20px;
      background: rgba(0,0,0,0.2);
      padding: 5px;
      border-radius: 12px;
    }
    
    .tab {
      flex: 1;
      padding: 12px;
      text-align: center;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s;
      color: #a0a8b8;
    }
    
    .tab.active { background: linear-gradient(135deg, #ffd700, #ffb347); color: #0a0f1a; }
    .tab:hover:not(.active) { background: rgba(255,255,255,0.1); }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    
    .prompt-box {
      background: #0a0f1a;
      border: 1px solid rgba(255,215,0,0.3);
      border-radius: 12px;
      padding: 20px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 0.8em;
      line-height: 1.5;
      max-height: 500px;
      overflow-y: auto;
      white-space: pre-wrap;
      position: relative;
    }
    
    .copy-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(255,215,0,0.2);
      border: 1px solid #ffd700;
      color: #ffd700;
      padding: 8px 15px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9em;
      z-index: 10;
    }
    
    .copy-btn:hover { background: rgba(255,215,0,0.3); }
    
    .preview-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      font-size: 0.9em;
    }
    
    .preview-table th, .preview-table td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .preview-table th {
      background: rgba(0,0,0,0.3);
      font-weight: 600;
      color: #ffd700;
      position: sticky;
      top: 0;
    }
    
    .preview-table tr:hover { background: rgba(255,255,255,0.05); }
    .preview-table .btn-remove {
      background: rgba(239,68,68,0.2);
      border: none;
      color: #ef4444;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
    }
    
    .badge { display: inline-block; padding: 4px 10px; border-radius: 20px; font-size: 0.75em; font-weight: 600; }
    .badge-success { background: rgba(34,197,94,0.2); color: #22c55e; }
    .badge-warning { background: rgba(245,158,11,0.2); color: #f59e0b; }
    .badge-info { background: rgba(59,130,246,0.2); color: #3b82f6; }
    
    .progress-container { background: rgba(0,0,0,0.3); border-radius: 10px; overflow: hidden; margin: 20px 0; }
    .progress-bar {
      height: 35px;
      background: linear-gradient(90deg, #ffd700, #ffb347);
      width: 0%;
      transition: width 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: #0a0f1a;
    }
    
    .log-container {
      background: #0a0f1a;
      border-radius: 12px;
      padding: 15px;
      max-height: 200px;
      overflow-y: auto;
      font-family: 'Consolas', monospace;
      font-size: 0.85em;
    }
    
    .log-item { padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
    .log-success { color: #22c55e; }
    .log-error { color: #ef4444; }
    .log-info { color: #3b82f6; }
    .log-warning { color: #f59e0b; }
    
    .times-grid { display: flex; flex-wrap: wrap; gap: 8px; }
    .time-chip {
      background: rgba(255,215,0,0.1);
      border: 1px solid rgba(255,215,0,0.3);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.85em;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .time-chip .count { background: #ffd700; color: #0a0f1a; padding: 2px 8px; border-radius: 10px; font-weight: 600; }
    
    .hidden { display: none !important; }
    
    .alert { padding: 15px 20px; border-radius: 10px; margin-bottom: 20px; }
    .alert-info { background: rgba(59,130,246,0.1); border: 1px solid rgba(59,130,246,0.3); color: #93c5fd; }
    
    .stats-mini { display: flex; gap: 20px; flex-wrap: wrap; margin-bottom: 15px; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px; }
    .stats-mini-item { display: flex; align-items: center; gap: 8px; }
    .stats-mini-value { font-weight: 700; color: #ffd700; }
    
    .validation-errors { background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.3); border-radius: 10px; padding: 15px; margin-bottom: 15px; }
    .validation-errors h4 { color: #ef4444; margin-bottom: 10px; }
    .validation-errors ul { margin-left: 20px; color: #fca5a5; }
    
    @media (max-width: 768px) { .form-row { grid-template-columns: 1fr; } .tabs { flex-direction: column; } }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>üéØ Gerar Perguntas</h1>
    <a href="index.html" class="btn-back">‚Üê Voltar</a>
  </div>

  <div class="card">
    <div class="stats-grid">
      <div class="stat-box"><div class="stat-value" id="totalPerguntas">-</div><div class="stat-label">Total Perguntas</div></div>
      <div class="stat-box"><div class="stat-value" id="totalTimes">-</div><div class="stat-label">Times</div></div>
      <div class="stat-box"><div class="stat-value" id="timesComPerguntas">-</div><div class="stat-label">Com Perguntas</div></div>
      <div class="stat-box"><div class="stat-value" id="timesSemPerguntas">-</div><div class="stat-label">Sem Perguntas</div></div>
    </div>
  </div>

  <div class="tabs">
    <div class="tab active" onclick="switchTab('gerar')">üìù Prompt Times</div>
    <div class="tab" onclick="switchTab('campeonatos')">üèÜ Prompt Campeonatos</div>
    <div class="tab" onclick="switchTab('importar')">üì• Importar JSON</div>
  </div>

  <!-- Tab 1: Prompt Times -->
  <div class="tab-content active" id="tab-gerar">
    <div class="card">
      <div class="card-title">‚öΩ Selecionar Time</div>
      <div class="form-group">
        <label>Buscar time:</label>
        <input type="text" class="form-control" id="searchTime" placeholder="Digite o nome..." oninput="filtrarTimes()">
      </div>
      <div class="form-group">
        <label>Time selecionado:</label>
        <select class="form-control" id="timeSelect" onchange="atualizarPrompt()">
          <option value="">Carregando times...</option>
        </select>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Quantidade por bloco:</label>
          <select class="form-control" id="qtdPerguntas" onchange="atualizarPrompt()">
            <option value="25" selected>25 perguntas (recomendado)</option>
            <option value="30">30 perguntas</option>
            <option value="50">50 perguntas (risco m√©dio)</option>
          </select>
        </div>
        <div class="form-group">
          <label>Bloco:</label>
          <select class="form-control" id="blocoPerguntas" onchange="atualizarPrompt()">
            <option value="1">Bloco 1 - Hist√≥ria/Prim√≥rdios</option>
            <option value="2">Bloco 2 - T√≠tulos/Jogadores</option>
            <option value="3">Bloco 3 - Jogos/Era Moderna</option>
            <option value="4">Bloco 4 - Atualidades/Curiosidades</option>
          </select>
        </div>
      </div>
      <div class="alert alert-info">üí° <strong>Dica:</strong> Gere em blocos de 25-30 perguntas. IAs erram mais em lotes maiores que 50.</div>
    </div>

    <div class="card">
      <div class="card-title">üìã Prompt para IA</div>
      <p style="color: #a0a8b8; margin-bottom: 15px;">Copie e cole em Claude, ChatGPT ou Gemini:</p>
      <div class="prompt-box" id="promptBox">
        <button class="copy-btn" onclick="copiarPrompt()">üìã Copiar</button>
        <span id="promptText">Selecione um time para gerar o prompt...</span>
      </div>
    </div>
  </div>

  <!-- Tab 2: Prompt Campeonatos -->
  <div class="tab-content" id="tab-campeonatos">
    <div class="card">
      <div class="card-title">üèÜ Gerar Perguntas de Campeonatos</div>
      <div class="form-row">
        <div class="form-group">
          <label>Campeonato:</label>
          <select class="form-control" id="campeonatoSelect" onchange="atualizarPromptCampeonato()">
            <option value="">Selecione...</option>
            <optgroup label="üåé Continentais">
              <option value="libertadores|Copa Libertadores|Am√©rica do Sul">Libertadores</option>
              <option value="ucl|UEFA Champions League|Europa">Champions League</option>
              <option value="uel|UEFA Europa League|Europa">Europa League</option>
              <option value="sulamericana|Copa Sul-Americana|Am√©rica do Sul">Sul-Americana</option>
            </optgroup>
            <optgroup label="üåç Mundiais">
              <option value="copa-do-mundo|Copa do Mundo FIFA|Mundial">Copa do Mundo</option>
              <option value="eurocopa|Eurocopa|Europa">Eurocopa</option>
              <option value="copa-america|Copa Am√©rica|Am√©rica do Sul">Copa Am√©rica</option>
            </optgroup>
            <optgroup label="üáßüá∑ Brasil">
              <option value="brasileirao-a|Brasileir√£o S√©rie A|Brasil">Brasileir√£o</option>
              <option value="copa-do-brasil|Copa do Brasil|Brasil">Copa do Brasil</option>
              <option value="gauchao|Campeonato Ga√∫cho|Brasil">Gauch√£o</option>
              <option value="paulistao|Campeonato Paulista|Brasil">Paulist√£o</option>
            </optgroup>
            <optgroup label="üåç Europa">
              <option value="la-liga|La Liga|Espanha">La Liga</option>
              <option value="premier-league|Premier League|Inglaterra">Premier League</option>
              <option value="bundesliga|Bundesliga|Alemanha">Bundesliga</option>
              <option value="serie-a-ita|Serie A|It√°lia">Serie A</option>
            </optgroup>
          </select>
        </div>
        <div class="form-group">
          <label>Quantidade:</label>
          <select class="form-control" id="qtdPerguntasCamp" onchange="atualizarPromptCampeonato()">
            <option value="25" selected>25 perguntas</option>
            <option value="30">30 perguntas</option>
            <option value="50">50 perguntas</option>
          </select>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-title">üìã Prompt para Campeonato</div>
      <div class="prompt-box" id="promptBoxCamp">
        <button class="copy-btn" onclick="copiarPromptCamp()">üìã Copiar</button>
        <span id="promptTextCamp">Selecione um campeonato...</span>
      </div>
    </div>
  </div>

  <!-- Tab 3: Importar -->
  <div class="tab-content" id="tab-importar">
    <div class="card">
      <div class="card-title">üì• Colar JSON das Perguntas</div>
      <div class="form-group">
        <label>JSON gerado pela IA:</label>
        <textarea class="form-control" id="jsonInput" style="min-height: 200px;" placeholder='Cole aqui o JSON...'></textarea>
      </div>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="validarJSON()">üîç Validar JSON</button>
        <label class="btn btn-secondary" style="cursor: pointer;">üìÇ Upload .json<input type="file" accept=".json" onchange="carregarArquivo(event)" style="display: none;"></label>
      </div>
    </div>

    <div class="validation-errors hidden" id="validationErrors">
      <h4>‚ö†Ô∏è Problemas Encontrados</h4>
      <ul id="errorsList"></ul>
    </div>

    <div class="card hidden" id="previewCard">
      <div class="card-title">üëÄ Preview - Revise antes de importar!</div>
      <div class="stats-mini">
        <div class="stats-mini-item"><span>üìä Total:</span><span class="stats-mini-value" id="previewTotal">0</span></div>
        <div class="stats-mini-item"><span>üìà M√©dia pts:</span><span class="stats-mini-value" id="previewMediaPts">0</span></div>
        <div class="stats-mini-item"><span>üî§ Letras:</span><span class="stats-mini-value" id="previewLetras">-</span></div>
      </div>
      <div class="times-grid" id="timesPreview"></div>
      <div style="margin-top: 20px; max-height: 500px; overflow-y: auto;">
        <table class="preview-table">
          <thead><tr><th>#</th><th>Pergunta</th><th>Resposta Correta</th><th>Pts</th><th>A√ß√£o</th></tr></thead>
          <tbody id="perguntasPreview"></tbody>
        </table>
      </div>
      <div class="progress-container"><div class="progress-bar" id="progressBar">0%</div></div>
      <div class="btn-group" style="margin-top: 20px;">
        <button class="btn btn-success" id="btnImportar" onclick="importarPerguntas()">üöÄ Importar Perguntas</button>
        <button class="btn btn-secondary" onclick="exportarExcel()">üìä Exportar Excel</button>
        <button class="btn btn-danger" onclick="limparPreview()">üóëÔ∏è Limpar</button>
      </div>
    </div>

    <div class="card">
      <div class="card-title">üìù Log</div>
      <div class="log-container" id="logContainer"><div class="log-item log-info">[Sistema] Aguardando...</div></div>
    </div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="js/firebase-config.js"></script>

<script>
  let db, todosOsTimes = [], perguntasParaImportar = [];

  document.addEventListener('DOMContentLoaded', async () => {
    db = firebase.firestore();
    await carregarTimes();
    await carregarEstatisticas();
  });

  function switchTab(tabName) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    event.target.classList.add('active');
    document.getElementById(`tab-${tabName}`).classList.add('active');
  }

  async function carregarTimes() {
    const snapshot = await db.collection('times').orderBy('nome').get();
    todosOsTimes = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    const select = document.getElementById('timeSelect');
    select.innerHTML = '<option value="">Selecione um time...</option>';
    todosOsTimes.forEach(time => {
      const opt = document.createElement('option');
      opt.value = time.id;
      opt.textContent = `${time.nome} (${time.pais || 'N/A'})`;
      opt.dataset.nome = time.nome;
      opt.dataset.pais = time.pais || '';
      select.appendChild(opt);
    });
  }

  async function carregarEstatisticas() {
    const [perguntasSnap, timesSnap] = await Promise.all([
      db.collection('perguntas').get(),
      db.collection('times').get()
    ]);
    const timesComPerguntas = new Set();
    perguntasSnap.docs.forEach(doc => { if (doc.data().timeId) timesComPerguntas.add(doc.data().timeId); });
    document.getElementById('totalPerguntas').textContent = perguntasSnap.size.toLocaleString();
    document.getElementById('totalTimes').textContent = timesSnap.size.toLocaleString();
    document.getElementById('timesComPerguntas').textContent = timesComPerguntas.size;
    document.getElementById('timesSemPerguntas').textContent = timesSnap.size - timesComPerguntas.size;
  }

  function filtrarTimes() {
    const search = document.getElementById('searchTime').value.toLowerCase();
    const select = document.getElementById('timeSelect');
    select.innerHTML = '<option value="">Selecione um time...</option>';
    todosOsTimes.filter(t => t.nome.toLowerCase().includes(search)).forEach(time => {
      const opt = document.createElement('option');
      opt.value = time.id;
      opt.textContent = `${time.nome} (${time.pais || 'N/A'})`;
      opt.dataset.nome = time.nome;
      opt.dataset.pais = time.pais || '';
      select.appendChild(opt);
    });
  }

  function atualizarPrompt() {
    const select = document.getElementById('timeSelect');
    const qtd = parseInt(document.getElementById('qtdPerguntas').value);
    const bloco = parseInt(document.getElementById('blocoPerguntas').value);
    const promptText = document.getElementById('promptText');
    
    if (!select.value) { promptText.textContent = 'Selecione um time...'; return; }
    
    const opt = select.options[select.selectedIndex];
    const timeNome = opt.dataset.nome, timePais = opt.dataset.pais, timeId = select.value;
    const idPrefix = timeId.substring(0, 8);
    const inicio = (bloco - 1) * qtd + 1, fim = bloco * qtd;
    
    const focoBloco = {
      1: 'HIST√ìRIA, FUNDA√á√ÉO, PRIM√ìRDIOS (d√©cadas antigas)',
      2: 'T√çTULOS, CONQUISTAS, JOGADORES MARCANTES',
      3: 'JOGOS √âPICOS, ERA MODERNA (2000-2015)',
      4: 'ATUALIDADES (2015-2024), CURIOSIDADES, TORCIDA'
    };

    const prompt = `OBJETIVO: Gerar ${qtd} perguntas REAIS sobre "${timeNome}" (${timePais}) para o Yellup.

üéØ BLOCO ${bloco}: ${focoBloco[bloco]}
üìå Perguntas ${String(inicio).padStart(3,'0')} a ${String(fim).padStart(3,'0')}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üìå FORMATO JSON (Firefoo/Firestore):
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

{
  "${idPrefix}-${String(inicio).padStart(3,'0')}": {
    "pergunta": "Texto da pergunta?",
    "alternativas": { "A": "...", "B": "...", "C": "...", "D": "..." },
    "correta": "B",
    "pontuacao": 5,
    "timeId": "${timeId}",
    "timeNome": "${timeNome}",
    "fonte": "Transfermarkt / Wikipedia"
  }
}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üéØ PONTUA√á√ÉO (1 a 10):
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

| Pts | Quem Acerta?           | Exemplo                              |
|-----|------------------------|--------------------------------------|
| 1   | Qualquer pessoa        | Mascote, cores                       |
| 2   | Torcedor casual        | Cidade, est√°dio atual                |
| 3   | Torcedor regular       | Ano funda√ß√£o, rival principal        |
| 4   | Torcedor ass√≠duo       | T√≠tulos importantes (com ano)        |
| 5   | Torcedor conhecedor    | √çdolos famosos                       |
| 6   | F√£ dedicado            | Placar de jogos, t√©cnicos            |
| 7   | F√£ estudioso           | Artilheiro de temporada espec√≠fica   |
| 8   | F√£ hardcore            | Valores de transfer√™ncias            |
| 9   | Historiador            | Fatos pr√©-1990                       |
| 10  | Enciclop√©dia           | Curiosidades rar√≠ssimas              |

DISTRIBUI√á√ÉO: 10% f√°ceis (1-2), 20% m√©dias (3-4), 40% m√©dia-alta (5-6), 20% dif√≠ceis (7-8), 10% expert (9-10)

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üìÖ TEMAS DO BLOCO ${bloco}:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
${bloco === 1 ? `- Funda√ß√£o, fundadores, origem nome/cores
- Primeiro est√°dio, primeiro jogo
- T√≠tulos d√©cadas 20-60
- √çdolos d√©cadas 50/60/70` : bloco === 2 ? `- Todos t√≠tulos nacionais COM ANO
- T√≠tulos internacionais
- √çdolos hist√≥ricos
- Maior artilheiro, mais jogos
- Goleiros lend√°rios` : bloco === 3 ? `- Finais de campeonatos COM PLACAR
- Goleadas, viradas hist√≥ricas
- Quem fez gol decisivo em [final]
- T√©cnicos campe√µes 2000-2015
- Vendas para Europa` : `- T√≠tulos 2015-2024
- Jogadores recentes
- Contrata√ß√µes/vendas recentes
- Mascote, hino, m√∫sicas torcida
- Apelidos, recordes`}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚ö†Ô∏è REGRAS:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

1. NUNCA REPETIR perguntas
2. SEMPRE usar recorte temporal ("artilheiro do Brasileir√£o 2019")
3. LETRAS EQUILIBRADAS: ~25% cada (A, B, C, D)
4. VALIDAR em: Transfermarkt, Wikipedia, CBF, site oficial

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

GERE O JSON COM ${qtd} PERGUNTAS:`;

    promptText.textContent = prompt;
  }

  function copiarPrompt() {
    const prompt = document.getElementById('promptText').textContent;
    if (prompt.includes('Selecione')) { alert('Selecione um time!'); return; }
    navigator.clipboard.writeText(prompt).then(() => {
      const btn = document.querySelector('#promptBox .copy-btn');
      btn.textContent = '‚úÖ Copiado!';
      setTimeout(() => btn.textContent = 'üìã Copiar', 2000);
    });
  }

  function atualizarPromptCampeonato() {
    const select = document.getElementById('campeonatoSelect');
    const qtd = parseInt(document.getElementById('qtdPerguntasCamp').value);
    const promptText = document.getElementById('promptTextCamp');
    
    if (!select.value) { promptText.textContent = 'Selecione um campeonato...'; return; }
    
    const [campId, campNome, campRegiao] = select.value.split('|');

    const prompt = `OBJETIVO: Gerar ${qtd} perguntas REAIS sobre "${campNome}" (${campRegiao}) para o Yellup.

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üìå FORMATO JSON:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

{
  "${campId}-001": {
    "pergunta": "Pergunta sobre ${campNome}?",
    "alternativas": { "A": "...", "B": "...", "C": "...", "D": "..." },
    "correta": "C",
    "pontuacao": 6,
    "campeonatoId": "${campId}",
    "campeonatoNome": "${campNome}",
    "fonte": "FIFA / UEFA / CONMEBOL"
  }
}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üéØ PONTUA√á√ÉO:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

| Pts | Tipo de Pergunta                              |
|-----|-----------------------------------------------|
| 1-2 | Formato b√°sico, atual campe√£o                 |
| 3-4 | Maior campe√£o, campe√£o de edi√ß√£o recente      |
| 5-6 | Artilheiro de edi√ß√£o, placar de final         |
| 7-8 | Fatos de d√©cadas antigas                      |
| 9-10| Primeira edi√ß√£o, curiosidades raras           |

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üìÇ TEMAS:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

üèÜ CAMPE√ïES (30%): Campe√£o de [ano], time com mais t√≠tulos
‚öΩ FINAIS (20%): Placar, onde foi, quem fez gol do t√≠tulo
üëü ARTILHEIROS (15%): Artilheiro de [edi√ß√£o]
üìä RECORDES (15%): Maior goleada, maior p√∫blico
üé≠ CURIOSIDADES (10%): Primeira edi√ß√£o, trof√©u
üåç SEDES (10%): Pa√≠ses sede, est√°dios

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚ö†Ô∏è REGRAS:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

1. SEMPRE especificar ANO/EDI√á√ÉO
2. N√ÉO perguntar sobre "atual" (muda todo ano)
3. VARIAR times/pa√≠ses
4. LETRAS EQUILIBRADAS

GERE O JSON COM ${qtd} PERGUNTAS:`;

    promptText.textContent = prompt;
  }

  function copiarPromptCamp() {
    const prompt = document.getElementById('promptTextCamp').textContent;
    if (prompt.includes('Selecione')) { alert('Selecione um campeonato!'); return; }
    navigator.clipboard.writeText(prompt).then(() => {
      const btn = document.querySelector('#promptBoxCamp .copy-btn');
      btn.textContent = '‚úÖ Copiado!';
      setTimeout(() => btn.textContent = 'üìã Copiar', 2000);
    });
  }

  function carregarArquivo(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => { document.getElementById('jsonInput').value = e.target.result; validarJSON(); };
    reader.readAsText(file);
  }

  function validarJSON() {
    const jsonText = document.getElementById('jsonInput').value.trim();
    const errorsDiv = document.getElementById('validationErrors');
    const errorsList = document.getElementById('errorsList');
    errorsDiv.classList.add('hidden');
    errorsList.innerHTML = '';
    
    if (!jsonText) { log('JSON vazio!', 'error'); return; }
    
    try {
      let data = JSON.parse(jsonText);
      let errors = [];
      
      if (data.perguntas && Array.isArray(data.perguntas)) {
        perguntasParaImportar = data.perguntas.map(p => ({ ...p, timeId: p.timeId || data.timeId, timeNome: p.timeNome || data.timeNome }));
      } else if (Array.isArray(data)) {
        perguntasParaImportar = data;
      } else if (typeof data === 'object') {
        const keys = Object.keys(data);
        if (keys[0] && data[keys[0]] && data[keys[0]].pergunta) {
          perguntasParaImportar = keys.map(key => ({ ...data[key], _docId: key }));
          log(`Formato Firefoo: ${keys.length} docs`, 'info');
        } else { throw new Error('Formato n√£o reconhecido'); }
      }
      
      perguntasParaImportar.forEach((p, i) => {
        if (!p.pergunta) errors.push(`#${i+1}: Falta "pergunta"`);
        if (!p.alternativas) errors.push(`#${i+1}: Falta "alternativas"`);
        if (!p.correta) errors.push(`#${i+1}: Falta "correta"`);
        if (p.alternativas && !p.alternativas[p.correta]) errors.push(`#${i+1}: Resposta "${p.correta}" inv√°lida`);
      });
      
      const perguntas = perguntasParaImportar.map(p => p.pergunta?.toLowerCase().trim());
      const dups = perguntas.filter((p, i) => perguntas.indexOf(p) !== i);
      if (dups.length) errors.push(`${dups.length} perguntas duplicadas!`);
      
      if (errors.length) {
        errorsList.innerHTML = errors.slice(0, 10).map(e => `<li>${e}</li>`).join('');
        errorsDiv.classList.remove('hidden');
        log(`‚ö†Ô∏è ${errors.length} problemas`, 'warning');
      }
      
      const validas = perguntasParaImportar.filter(p => p.pergunta && p.alternativas && p.correta);
      if (!validas.length) throw new Error('Nenhuma v√°lida');
      
      perguntasParaImportar = validas;
      log(`‚úÖ ${perguntasParaImportar.length} perguntas v√°lidas!`, 'success');
      mostrarPreview();
      
    } catch (error) {
      log(`‚ùå Erro: ${error.message}`, 'error');
      perguntasParaImportar = [];
      document.getElementById('previewCard').classList.add('hidden');
    }
  }

  function mostrarPreview() {
    document.getElementById('previewTotal').textContent = perguntasParaImportar.length;
    const soma = perguntasParaImportar.reduce((s, p) => s + (Number(p.pontuacao) || 5), 0);
    document.getElementById('previewMediaPts').textContent = (soma / perguntasParaImportar.length).toFixed(1);
    
    const letras = { A: 0, B: 0, C: 0, D: 0 };
    perguntasParaImportar.forEach(p => { const l = String(p.correta).toUpperCase(); if (letras[l] !== undefined) letras[l]++; });
    document.getElementById('previewLetras').textContent = `A:${letras.A} B:${letras.B} C:${letras.C} D:${letras.D}`;
    
    const porTime = {};
    perguntasParaImportar.forEach(p => { const n = p.timeNome || p.campeonatoNome || 'Sem'; porTime[n] = (porTime[n] || 0) + 1; });
    document.getElementById('timesPreview').innerHTML = Object.entries(porTime).map(([n, c]) => `<div class="time-chip"><span>${n}</span><span class="count">${c}</span></div>`).join('');
    
    document.getElementById('perguntasPreview').innerHTML = perguntasParaImportar.map((p, i) => {
      const resp = p.alternativas?.[p.correta] || p.correta;
      const pts = Number(p.pontuacao) || 5;
      return `<tr><td>${i+1}</td><td title="${p.pergunta}">${p.pergunta.substring(0,60)}...</td><td><span class="badge badge-success">${p.correta}</span> ${resp.substring(0,25)}...</td><td>${pts}</td><td><button class="btn-remove" onclick="removerPergunta(${i})">üóëÔ∏è</button></td></tr>`;
    }).join('');
    
    document.getElementById('previewCard').classList.remove('hidden');
  }

  function removerPergunta(i) {
    perguntasParaImportar.splice(i, 1);
    log(`Pergunta ${i+1} removida`, 'warning');
    perguntasParaImportar.length ? mostrarPreview() : limparPreview();
  }

  function limparPreview() {
    perguntasParaImportar = [];
    document.getElementById('previewCard').classList.add('hidden');
    document.getElementById('validationErrors').classList.add('hidden');
    document.getElementById('jsonInput').value = '';
    document.getElementById('progressBar').style.width = '0%';
  }

  function exportarExcel() {
    if (!perguntasParaImportar.length) { alert('Nada para exportar!'); return; }
    let csv = 'Num,Pergunta,A,B,C,D,Correta,Resposta,Pts,Time,Fonte\n';
    perguntasParaImportar.forEach((p, i) => {
      const a = p.alternativas || {};
      csv += `${i+1},"${(p.pergunta||'').replace(/"/g,'""')}","${a.A||''}","${a.B||''}","${a.C||''}","${a.D||''}",${p.correta},"${a[p.correta]||''}",${p.pontuacao||5},"${p.timeNome||p.campeonatoNome||''}","${p.fonte||''}"\n`;
    });
    const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `perguntas_${new Date().toISOString().slice(0,10)}.csv`;
    a.click();
    log('CSV exportado!', 'success');
  }

  async function importarPerguntas() {
    if (!perguntasParaImportar.length) { alert('Nada para importar!'); return; }
    document.getElementById('btnImportar').disabled = true;
    log(`Importando ${perguntasParaImportar.length}...`, 'info');
    
    let importadas = 0;
    const total = perguntasParaImportar.length;
    
    try {
      for (let i = 0; i < total; i += 50) {
        const batch = db.batch();
        perguntasParaImportar.slice(i, i + 50).forEach(p => {
          const ref = p._docId ? db.collection('perguntas').doc(p._docId) : db.collection('perguntas').doc();
          const { _docId, ...dados } = p;
          batch.set(ref, {
            pergunta: String(dados.pergunta || ''),
            alternativas: { A: String(dados.alternativas?.A||''), B: String(dados.alternativas?.B||''), C: String(dados.alternativas?.C||''), D: String(dados.alternativas?.D||'') },
            correta: String(dados.correta || 'A').toUpperCase(),
            pontuacao: Number(dados.pontuacao) || 5,
            timeId: String(dados.timeId || ''),
            timeNome: String(dados.timeNome || ''),
            campeonatoId: String(dados.campeonatoId || ''),
            campeonatoNome: String(dados.campeonatoNome || ''),
            fonte: String(dados.fonte || ''),
            criadoEm: firebase.firestore.FieldValue.serverTimestamp()
          });
        });
        await batch.commit();
        importadas += Math.min(50, total - i);
        const pct = Math.round((importadas / total) * 100);
        document.getElementById('progressBar').style.width = pct + '%';
        document.getElementById('progressBar').textContent = pct + '%';
        log(`Lote ${Math.ceil(i/50)+1}: ${Math.min(50, total-i)} perguntas`, 'success');
      }
      log(`‚úÖ ${importadas} perguntas importadas!`, 'success');
      limparPreview();
      await carregarEstatisticas();
    } catch (e) { log(`‚ùå Erro: ${e.message}`, 'error'); }
    document.getElementById('btnImportar').disabled = false;
  }

  function log(msg, type = 'info') {
    const c = document.getElementById('logContainer');
    const t = new Date().toLocaleTimeString('pt-BR');
    const d = document.createElement('div');
    d.className = `log-item log-${type}`;
    d.textContent = `[${t}] ${msg}`;
    c.insertBefore(d, c.firstChild);
  }
</script>
</body>
</html>
