<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerar Perguntas - Yellup Admin</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #0a0f1a 0%, #1a1f35 50%, #0d1520 100%);
      min-height: 100vh;
      color: #e4e8f1;
      padding: 20px;
    }
    
    .container { max-width: 1200px; margin: 0 auto; }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }
    
    .header h1 {
      font-size: 1.8em;
      background: linear-gradient(135deg, #ffd700, #ffb347);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .btn-back {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      color: #e4e8f1;
      padding: 10px 20px;
      border-radius: 10px;
      text-decoration: none;
      font-weight: 500;
      transition: all 0.3s;
    }
    
    .btn-back:hover {
      background: rgba(255,255,255,0.2);
    }
    
    .card {
      background: rgba(30, 40, 60, 0.6);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 20px;
      padding: 25px;
      margin-bottom: 25px;
    }
    
    .card-title {
      font-size: 1.2em;
      font-weight: 600;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 15px;
    }
    
    .stat-box {
      background: rgba(0,0,0,0.3);
      border-radius: 15px;
      padding: 20px;
      text-align: center;
    }
    
    .stat-value {
      font-size: 2em;
      font-weight: 700;
      color: #ffd700;
    }
    
    .stat-label {
      font-size: 0.85em;
      color: #a0a8b8;
      margin-top: 5px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #c0c8d8;
    }
    
    .form-control {
      width: 100%;
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 12px;
      padding: 14px 18px;
      color: #e4e8f1;
      font-family: 'Poppins', sans-serif;
      font-size: 1em;
      transition: all 0.3s;
    }
    
    .form-control:focus {
      outline: none;
      border-color: #ffd700;
      box-shadow: 0 0 0 3px rgba(255,215,0,0.1);
    }
    
    select.form-control {
      cursor: pointer;
    }
    
    textarea.form-control {
      min-height: 150px;
      resize: vertical;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 0.9em;
    }
    
    .search-box {
      position: relative;
    }
    
    .search-box input {
      padding-left: 45px;
    }
    
    .search-box::before {
      content: 'üîç';
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
    }
    
    .btn {
      padding: 14px 28px;
      border: none;
      border-radius: 12px;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
      font-size: 1em;
      cursor: pointer;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #ffd700, #ffb347);
      color: #0a0f1a;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(255,215,0,0.3);
    }
    
    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    .btn-success {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: white;
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: white;
    }
    
    .btn-secondary {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      color: #e4e8f1;
    }
    
    .btn-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .tabs {
      display: flex;
      gap: 5px;
      margin-bottom: 20px;
      background: rgba(0,0,0,0.2);
      padding: 5px;
      border-radius: 12px;
    }
    
    .tab {
      flex: 1;
      padding: 12px;
      text-align: center;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s;
      color: #a0a8b8;
    }
    
    .tab.active {
      background: linear-gradient(135deg, #ffd700, #ffb347);
      color: #0a0f1a;
    }
    
    .tab:hover:not(.active) {
      background: rgba(255,255,255,0.1);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .prompt-box {
      background: #0a0f1a;
      border: 1px solid rgba(255,215,0,0.3);
      border-radius: 12px;
      padding: 20px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 0.85em;
      line-height: 1.6;
      max-height: 400px;
      overflow-y: auto;
      white-space: pre-wrap;
      position: relative;
    }
    
    .copy-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(255,215,0,0.2);
      border: 1px solid #ffd700;
      color: #ffd700;
      padding: 8px 15px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9em;
    }
    
    .copy-btn:hover {
      background: rgba(255,215,0,0.3);
    }
    
    .preview-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    
    .preview-table th,
    .preview-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .preview-table th {
      background: rgba(0,0,0,0.3);
      font-weight: 600;
      color: #ffd700;
    }
    
    .preview-table tr:hover {
      background: rgba(255,255,255,0.05);
    }
    
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.8em;
      font-weight: 600;
    }
    
    .badge-success { background: rgba(34,197,94,0.2); color: #22c55e; }
    .badge-warning { background: rgba(245,158,11,0.2); color: #f59e0b; }
    .badge-info { background: rgba(59,130,246,0.2); color: #3b82f6; }
    
    .progress-container {
      background: rgba(0,0,0,0.3);
      border-radius: 10px;
      overflow: hidden;
      margin: 20px 0;
    }
    
    .progress-bar {
      height: 35px;
      background: linear-gradient(90deg, #ffd700, #ffb347);
      width: 0%;
      transition: width 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: #0a0f1a;
    }
    
    .log-container {
      background: #0a0f1a;
      border-radius: 12px;
      padding: 15px;
      max-height: 250px;
      overflow-y: auto;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 0.85em;
    }
    
    .log-item {
      padding: 5px 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    
    .log-success { color: #22c55e; }
    .log-error { color: #ef4444; }
    .log-info { color: #3b82f6; }
    .log-warning { color: #f59e0b; }
    
    .times-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 10px;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .time-chip {
      background: rgba(0,0,0,0.3);
      padding: 10px 15px;
      border-radius: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .time-chip .count {
      background: rgba(255,215,0,0.2);
      color: #ffd700;
      padding: 2px 8px;
      border-radius: 10px;
      font-weight: 600;
      font-size: 0.9em;
    }
    
    .hidden { display: none !important; }
    
    @media (max-width: 768px) {
      .header { flex-direction: column; gap: 15px; }
      .tabs { flex-direction: column; }
      .btn-group { flex-direction: column; }
    }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>üéØ Gerar & Importar Perguntas</h1>
    <a href="dashboard.html" class="btn-back">‚Üê Painel Admin</a>
  </div>

  <!-- Estat√≠sticas -->
  <div class="card">
    <div class="card-title">üìä Estat√≠sticas do Banco</div>
    <div class="stats-grid">
      <div class="stat-box">
        <div class="stat-value" id="totalPerguntas">-</div>
        <div class="stat-label">Total Perguntas</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="timesComPerguntas">-</div>
        <div class="stat-label">Times com Perguntas</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="timesSemPerguntas">-</div>
        <div class="stat-label">Times sem Perguntas</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="totalTimes">-</div>
        <div class="stat-label">Total de Times</div>
      </div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <div class="tab active" onclick="switchTab('gerar')">1Ô∏è‚É£ Gerar Prompt</div>
    <div class="tab" onclick="switchTab('importar')">2Ô∏è‚É£ Importar JSON</div>
    <div class="tab" onclick="switchTab('campeonatos')">3Ô∏è‚É£ Campeonatos</div>
  </div>

  <!-- Tab 1: Gerar Prompt -->
  <div class="tab-content active" id="tab-gerar">
    <div class="card">
      <div class="card-title">‚öΩ Selecionar Time</div>
      
      <div class="form-group search-box">
        <input type="text" class="form-control" id="buscarTime" placeholder="Buscar time..." oninput="filtrarTimes()">
      </div>
      
      <div class="form-group">
        <label>Time Selecionado:</label>
        <select class="form-control" id="timeSelect" onchange="atualizarPrompt()">
          <option value="">-- Selecione um time --</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Quantidade de perguntas:</label>
        <select class="form-control" id="qtdPerguntas" onchange="atualizarPrompt()">
          <option value="10">10 perguntas</option>
          <option value="20" selected>20 perguntas</option>
          <option value="30">30 perguntas</option>
          <option value="50">50 perguntas</option>
        </select>
      </div>
    </div>

    <div class="card">
      <div class="card-title">üìã Prompt para IA</div>
      <p style="color: #a0a8b8; margin-bottom: 15px;">Copie este prompt e cole em uma IA (Claude, ChatGPT, etc) para gerar as perguntas:</p>
      
      <div class="prompt-box" id="promptBox">
        <button class="copy-btn" onclick="copiarPrompt()">üìã Copiar</button>
        <span id="promptText">Selecione um time para gerar o prompt...</span>
      </div>
    </div>
  </div>

  <!-- Tab 2: Importar JSON -->
  <div class="tab-content" id="tab-importar">
    <div class="card">
      <div class="card-title">üì• Colar JSON das Perguntas</div>
      
      <div class="form-group">
        <label>JSON gerado pela IA:</label>
        <textarea class="form-control" id="jsonInput" placeholder='Cole aqui o JSON gerado pela IA...'></textarea>
      </div>
      
      <div class="btn-group">
        <button class="btn btn-primary" onclick="validarJSON()">üîç Validar JSON</button>
        <label class="btn btn-secondary" style="cursor: pointer;">
          üìÇ Upload Arquivo
          <input type="file" accept=".json" onchange="carregarArquivo(event)" style="display: none;">
        </label>
      </div>
    </div>

    <!-- Preview -->
    <div class="card hidden" id="previewCard">
      <div class="card-title">üëÄ Preview das Perguntas</div>
      
      <div class="times-grid" id="timesPreview"></div>
      
      <div style="margin-top: 20px; max-height: 400px; overflow-y: auto;">
        <table class="preview-table">
          <thead>
            <tr>
              <th style="width: 40px;">#</th>
              <th>Pergunta</th>
              <th style="width: 100px;">Resposta</th>
              <th style="width: 80px;">Pontos</th>
            </tr>
          </thead>
          <tbody id="perguntasPreview"></tbody>
        </table>
      </div>
      
      <div class="progress-container">
        <div class="progress-bar" id="progressBar">0%</div>
      </div>
      
      <div class="btn-group" style="margin-top: 20px;">
        <button class="btn btn-success" id="btnImportar" onclick="importarPerguntas()">üöÄ Importar Perguntas</button>
        <button class="btn btn-secondary" onclick="limparPreview()">üóëÔ∏è Limpar</button>
      </div>
    </div>

    <!-- Log -->
    <div class="card">
      <div class="card-title">üìù Log de Atividades</div>
      <div class="log-container" id="logContainer">
        <div class="log-item log-info">[Sistema] Aguardando a√ß√£o...</div>
      </div>
    </div>
  </div>

  <!-- Tab 3: Campeonatos -->
  <div class="tab-content" id="tab-campeonatos">
    <div class="card">
      <div class="card-title">üèÜ Gerenciar Campeonatos</div>
      
      <div class="stats-grid" style="margin-bottom: 20px;">
        <div class="stat-box">
          <div class="stat-value" id="totalCampeonatos">-</div>
          <div class="stat-label">Campeonatos</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="campeonatosAtivos">-</div>
          <div class="stat-label">Ativos</div>
        </div>
      </div>
      
      <div class="btn-group">
        <button class="btn btn-primary" onclick="importarCampeonatos()">üì• Importar Campeonatos</button>
        <button class="btn btn-secondary" onclick="carregarCampeonatos()">üîÑ Atualizar Lista</button>
      </div>
    </div>

    <div class="card">
      <div class="card-title">üìã Lista de Campeonatos</div>
      <div id="listaCampeonatos" style="max-height: 500px; overflow-y: auto;">
        <p style="color: #a0a8b8;">Carregando...</p>
      </div>
    </div>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="js/firebase-config.js"></script>

<script>
  let times = [];
  let timesFiltrados = [];
  let perguntasParaImportar = [];
  let campeonatos = [];
  
  // ==================== TABS ====================
  function switchTab(tabName) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    
    event.target.classList.add('active');
    document.getElementById(`tab-${tabName}`).classList.add('active');
  }
  
  // ==================== LOG ====================
  function log(msg, type = 'info') {
    const container = document.getElementById('logContainer');
    const item = document.createElement('div');
    item.className = `log-item log-${type}`;
    item.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
    container.insertBefore(item, container.firstChild);
  }
  
  // ==================== ESTAT√çSTICAS ====================
  async function carregarEstatisticas() {
    try {
      // Carregar times
      const timesSnap = await db.collection('times').get();
      times = timesSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      times.sort((a, b) => (a.nome || '').localeCompare(b.nome || ''));
      timesFiltrados = [...times];
      
      document.getElementById('totalTimes').textContent = times.length;
      
      // Carregar perguntas
      const perguntasSnap = await db.collection('perguntas').get();
      const perguntas = perguntasSnap.docs.map(doc => doc.data());
      
      document.getElementById('totalPerguntas').textContent = perguntas.length;
      
      // Times com perguntas
      const timesComPerguntas = new Set(perguntas.map(p => p.timeId).filter(Boolean));
      document.getElementById('timesComPerguntas').textContent = timesComPerguntas.size;
      document.getElementById('timesSemPerguntas').textContent = times.length - timesComPerguntas.size;
      
      // Popular select de times
      popularSelectTimes();
      
      log(`Carregados ${times.length} times e ${perguntas.length} perguntas`, 'success');
      
    } catch (error) {
      log(`Erro ao carregar: ${error.message}`, 'error');
    }
  }
  
  function popularSelectTimes() {
    const select = document.getElementById('timeSelect');
    select.innerHTML = '<option value="">-- Selecione um time --</option>';
    
    timesFiltrados.forEach(time => {
      const opt = document.createElement('option');
      opt.value = time.id;
      opt.textContent = `${time.nome} (${time.pais || 'Sem pa√≠s'})`;
      opt.dataset.nome = time.nome;
      opt.dataset.pais = time.pais || '';
      select.appendChild(opt);
    });
  }
  
  function filtrarTimes() {
    const busca = document.getElementById('buscarTime').value.toLowerCase();
    
    if (!busca) {
      timesFiltrados = [...times];
    } else {
      timesFiltrados = times.filter(t => 
        (t.nome || '').toLowerCase().includes(busca) ||
        (t.pais || '').toLowerCase().includes(busca)
      );
    }
    
    popularSelectTimes();
  }
  
  // ==================== PROMPT ====================
  function atualizarPrompt() {
    const select = document.getElementById('timeSelect');
    const qtd = document.getElementById('qtdPerguntas').value;
    const promptText = document.getElementById('promptText');
    
    if (!select.value) {
      promptText.textContent = 'Selecione um time para gerar o prompt...';
      return;
    }
    
    const opt = select.options[select.selectedIndex];
    const timeNome = opt.dataset.nome;
    const timePais = opt.dataset.pais;
    const timeId = select.value;
    
    const prompt = `Voc√™ √© um especialista em futebol. Crie ${qtd} perguntas de quiz sobre o time "${timeNome}" (${timePais}).

REGRAS IMPORTANTES:
1. Perguntas sobre: hist√≥ria, t√≠tulos, jogadores hist√≥ricos, est√°dio, rivalidades, curiosidades
2. Cada pergunta deve ter exatamente 4 alternativas (A, B, C, D)
3. Apenas UMA alternativa correta
4. Variar dificuldade: ${Math.round(qtd * 0.25)} f√°ceis (3 pts), ${Math.round(qtd * 0.5)} m√©dias (5 pts), ${Math.round(qtd * 0.25)} dif√≠ceis (8 pts)
5. Informa√ß√µes devem ser VERIFIC√ÅVEIS e atuais (at√© 2024)
6. Incluir fonte de cada informa√ß√£o
7. N√ÉO repetir perguntas similares

RESPONDA APENAS COM O JSON ABAIXO (sem texto adicional):

{
  "timeId": "${timeId}",
  "timeNome": "${timeNome}",
  "perguntas": [
    {
      "pergunta": "Texto da pergunta aqui?",
      "alternativas": {
        "A": "Op√ß√£o A",
        "B": "Op√ß√£o B",
        "C": "Op√ß√£o C",
        "D": "Op√ß√£o D"
      },
      "correta": "B",
      "pontuacao": 5,
      "fonte": "Site oficial / Wikipedia / etc",
      "dificuldade": "media"
    }
  ]
}

CATEGORIAS SUGERIDAS:
- ${Math.ceil(qtd * 0.2)} sobre hist√≥ria e funda√ß√£o
- ${Math.ceil(qtd * 0.2)} sobre t√≠tulos e conquistas
- ${Math.ceil(qtd * 0.2)} sobre jogadores hist√≥ricos/atuais
- ${Math.ceil(qtd * 0.15)} sobre est√°dio e torcida
- ${Math.ceil(qtd * 0.15)} sobre rivalidades e cl√°ssicos
- ${Math.ceil(qtd * 0.1)} sobre curiosidades

Gere EXATAMENTE ${qtd} perguntas diversificadas e interessantes!`;

    promptText.textContent = prompt;
  }
  
  function copiarPrompt() {
    const prompt = document.getElementById('promptText').textContent;
    
    if (prompt.includes('Selecione um time')) {
      alert('Selecione um time primeiro!');
      return;
    }
    
    navigator.clipboard.writeText(prompt).then(() => {
      const btn = document.querySelector('.copy-btn');
      btn.textContent = '‚úÖ Copiado!';
      setTimeout(() => btn.textContent = 'üìã Copiar', 2000);
    });
  }
  
  // ==================== IMPORTAR JSON ====================
  function carregarArquivo(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = e => {
      document.getElementById('jsonInput').value = e.target.result;
      validarJSON();
    };
    reader.readAsText(file);
  }
  
  function validarJSON() {
    const jsonText = document.getElementById('jsonInput').value.trim();
    
    if (!jsonText) {
      log('JSON vazio!', 'error');
      return;
    }
    
    try {
      let data = JSON.parse(jsonText);
      
      // Aceitar v√°rios formatos
      if (data.perguntas && Array.isArray(data.perguntas)) {
        // Formato com timeId no root
        perguntasParaImportar = data.perguntas.map(p => ({
          ...p,
          timeId: p.timeId || data.timeId,
          timeNome: p.timeNome || data.timeNome
        }));
      } else if (Array.isArray(data)) {
        perguntasParaImportar = data;
      } else {
        throw new Error('Formato n√£o reconhecido');
      }
      
      // Validar estrutura m√≠nima
      const validas = perguntasParaImportar.filter(p => 
        p.pergunta && p.alternativas && p.correta
      );
      
      if (validas.length === 0) {
        throw new Error('Nenhuma pergunta v√°lida encontrada');
      }
      
      perguntasParaImportar = validas;
      
      log(`${perguntasParaImportar.length} perguntas v√°lidas encontradas!`, 'success');
      
      mostrarPreview();
      
    } catch (error) {
      log(`Erro no JSON: ${error.message}`, 'error');
      perguntasParaImportar = [];
      document.getElementById('previewCard').classList.add('hidden');
    }
  }
  
  function mostrarPreview() {
    const previewCard = document.getElementById('previewCard');
    const timesPreview = document.getElementById('timesPreview');
    const perguntasPreview = document.getElementById('perguntasPreview');
    
    // Contar por time
    const porTime = {};
    perguntasParaImportar.forEach(p => {
      const nome = p.timeNome || 'Sem time';
      porTime[nome] = (porTime[nome] || 0) + 1;
    });
    
    timesPreview.innerHTML = Object.entries(porTime)
      .sort((a, b) => b[1] - a[1])
      .map(([nome, count]) => `
        <div class="time-chip">
          <span>${nome}</span>
          <span class="count">${count}</span>
        </div>
      `).join('');
    
    // Lista de perguntas
    perguntasPreview.innerHTML = perguntasParaImportar.slice(0, 50).map((p, i) => `
      <tr>
        <td>${i + 1}</td>
        <td>${p.pergunta.substring(0, 80)}${p.pergunta.length > 80 ? '...' : ''}</td>
        <td><span class="badge badge-success">${p.correta}</span></td>
        <td>${p.pontuacao || 5} pts</td>
      </tr>
    `).join('');
    
    if (perguntasParaImportar.length > 50) {
      perguntasPreview.innerHTML += `
        <tr>
          <td colspan="4" style="text-align: center; color: #a0a8b8;">
            ... e mais ${perguntasParaImportar.length - 50} perguntas
          </td>
        </tr>
      `;
    }
    
    previewCard.classList.remove('hidden');
  }
  
  function limparPreview() {
    perguntasParaImportar = [];
    document.getElementById('previewCard').classList.add('hidden');
    document.getElementById('jsonInput').value = '';
    document.getElementById('progressBar').style.width = '0%';
    document.getElementById('progressBar').textContent = '0%';
  }
  
  async function importarPerguntas() {
    if (perguntasParaImportar.length === 0) {
      log('Nenhuma pergunta para importar!', 'error');
      return;
    }
    
    const btn = document.getElementById('btnImportar');
    btn.disabled = true;
    
    log(`Iniciando importa√ß√£o de ${perguntasParaImportar.length} perguntas...`, 'info');
    
    let importadas = 0;
    const total = perguntasParaImportar.length;
    const batchSize = 50;
    
    try {
      for (let i = 0; i < total; i += batchSize) {
        const batch = db.batch();
        const lote = perguntasParaImportar.slice(i, i + batchSize);
        
        lote.forEach(pergunta => {
          const docRef = db.collection('perguntas').doc();
          
          const alternativas = {
            A: String(pergunta.alternativas?.A || pergunta.alternativas?.a || ''),
            B: String(pergunta.alternativas?.B || pergunta.alternativas?.b || ''),
            C: String(pergunta.alternativas?.C || pergunta.alternativas?.c || ''),
            D: String(pergunta.alternativas?.D || pergunta.alternativas?.d || '')
          };
          
          batch.set(docRef, {
            pergunta: String(pergunta.pergunta || ''),
            alternativas: alternativas,
            correta: String(pergunta.correta || 'A').toUpperCase(),
            pontuacao: Number(pergunta.pontuacao) || 5,
            timeId: String(pergunta.timeId || ''),
            timeNome: String(pergunta.timeNome || ''),
            fonte: String(pergunta.fonte || ''),
            dificuldade: String(pergunta.dificuldade || 'media'),
            criadoEm: firebase.firestore.FieldValue.serverTimestamp()
          });
        });
        
        await batch.commit();
        importadas += lote.length;
        
        const percent = Math.round((importadas / total) * 100);
        document.getElementById('progressBar').style.width = percent + '%';
        document.getElementById('progressBar').textContent = percent + '%';
        
        log(`Lote ${Math.ceil((i + batchSize) / batchSize)}: ${lote.length} perguntas`, 'success');
      }
      
      log(`‚úÖ Importa√ß√£o conclu√≠da! ${importadas} perguntas adicionadas.`, 'success');
      
      limparPreview();
      await carregarEstatisticas();
      
    } catch (error) {
      log(`Erro na importa√ß√£o: ${error.message}`, 'error');
    }
    
    btn.disabled = false;
  }
  
  // ==================== CAMPEONATOS ====================
  async function carregarCampeonatos() {
    try {
      const snap = await db.collection('campeonatos').orderBy('ordem').get();
      campeonatos = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      
      document.getElementById('totalCampeonatos').textContent = campeonatos.length;
      document.getElementById('campeonatosAtivos').textContent = campeonatos.filter(c => c.ativo).length;
      
      renderizarCampeonatos();
      
      log(`${campeonatos.length} campeonatos carregados`, 'success');
      
    } catch (error) {
      log(`Erro ao carregar campeonatos: ${error.message}`, 'error');
      document.getElementById('totalCampeonatos').textContent = '0';
    }
  }
  
  function renderizarCampeonatos() {
    const lista = document.getElementById('listaCampeonatos');
    
    if (campeonatos.length === 0) {
      lista.innerHTML = `
        <p style="color: #a0a8b8; text-align: center; padding: 40px;">
          Nenhum campeonato cadastrado.<br>
          Clique em "Importar Campeonatos" para come√ßar.
        </p>
      `;
      return;
    }
    
    // Agrupar por pa√≠s/regi√£o
    const porPais = {};
    campeonatos.forEach(c => {
      const pais = c.pais || 'Outros';
      if (!porPais[pais]) porPais[pais] = [];
      porPais[pais].push(c);
    });
    
    let html = '';
    Object.entries(porPais).sort().forEach(([pais, camps]) => {
      html += `
        <div style="margin-bottom: 20px;">
          <h4 style="color: #ffd700; margin-bottom: 10px;">${pais} (${camps.length})</h4>
          <div class="times-grid">
            ${camps.map(c => `
              <div class="time-chip">
                <span>${c.nomeAbreviado || c.nome}</span>
                <span class="badge ${c.ativo ? 'badge-success' : 'badge-warning'}">${c.tipo}</span>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    });
    
    lista.innerHTML = html;
  }
  
  async function importarCampeonatos() {
    if (!confirm('Isso vai importar todos os campeonatos principais. Continuar?')) return;
    
    log('Importando campeonatos...', 'info');
    
    // Lista de campeonatos (simplificada para importa√ß√£o)
    const listaCampeonatos = [
      // Continentais - Clubes
      { nome: "UEFA Champions League", nomeAbreviado: "UCL", pais: "Europa", tipo: "continental", tipoCompeticao: "clubes", ativo: true, ordem: 1 },
      { nome: "UEFA Europa League", nomeAbreviado: "UEL", pais: "Europa", tipo: "continental", tipoCompeticao: "clubes", ativo: true, ordem: 2 },
      { nome: "Copa Libertadores", nomeAbreviado: "Libertadores", pais: "Am√©rica do Sul", tipo: "continental", tipoCompeticao: "clubes", ativo: true, ordem: 4 },
      { nome: "Copa Sul-Americana", nomeAbreviado: "Sula", pais: "Am√©rica do Sul", tipo: "continental", tipoCompeticao: "clubes", ativo: true, ordem: 5 },
      
      // Mundiais
      { nome: "Copa do Mundo FIFA", nomeAbreviado: "Copa do Mundo", pais: "Mundial", tipo: "mundial", tipoCompeticao: "selecoes", ativo: true, ordem: 10 },
      { nome: "Mundial de Clubes FIFA", nomeAbreviado: "Mundial Clubes", pais: "Mundial", tipo: "mundial", tipoCompeticao: "clubes", ativo: true, ordem: 11 },
      
      // Sele√ß√µes
      { nome: "Eurocopa", nomeAbreviado: "Euro", pais: "Europa", tipo: "continental", tipoCompeticao: "selecoes", ativo: true, ordem: 12 },
      { nome: "Copa Am√©rica", nomeAbreviado: "Copa Am√©rica", pais: "Am√©rica do Sul", tipo: "continental", tipoCompeticao: "selecoes", ativo: true, ordem: 13 },
      
      // Brasil
      { nome: "Brasileir√£o S√©rie A", nomeAbreviado: "Brasileir√£o", pais: "Brasil", tipo: "nacional", tipoCompeticao: "clubes", divisao: 1, ativo: true, ordem: 20 },
      { nome: "Brasileir√£o S√©rie B", nomeAbreviado: "S√©rie B", pais: "Brasil", tipo: "nacional", tipoCompeticao: "clubes", divisao: 2, ativo: true, ordem: 21 },
      { nome: "Copa do Brasil", nomeAbreviado: "Copa do Brasil", pais: "Brasil", tipo: "copa", tipoCompeticao: "clubes", ativo: true, ordem: 23 },
      { nome: "Campeonato Ga√∫cho", nomeAbreviado: "Gauch√£o", pais: "Brasil", tipo: "estadual", tipoCompeticao: "clubes", estado: "RS", ativo: true, ordem: 25 },
      { nome: "Campeonato Paulista", nomeAbreviado: "Paulist√£o", pais: "Brasil", tipo: "estadual", tipoCompeticao: "clubes", estado: "SP", ativo: true, ordem: 26 },
      { nome: "Campeonato Carioca", nomeAbreviado: "Carioca", pais: "Brasil", tipo: "estadual", tipoCompeticao: "clubes", estado: "RJ", ativo: true, ordem: 27 },
      
      // Europa
      { nome: "La Liga", nomeAbreviado: "La Liga", pais: "Espanha", tipo: "nacional", tipoCompeticao: "clubes", divisao: 1, ativo: true, ordem: 30 },
      { nome: "Premier League", nomeAbreviado: "Premier League", pais: "Inglaterra", tipo: "nacional", tipoCompeticao: "clubes", divisao: 1, ativo: true, ordem: 40 },
      { nome: "Bundesliga", nomeAbreviado: "Bundesliga", pais: "Alemanha", tipo: "nacional", tipoCompeticao: "clubes", divisao: 1, ativo: true, ordem: 50 },
      { nome: "Serie A", nomeAbreviado: "Serie A", pais: "It√°lia", tipo: "nacional", tipoCompeticao: "clubes", divisao: 1, ativo: true, ordem: 60 },
      { nome: "Ligue 1", nomeAbreviado: "Ligue 1", pais: "Fran√ßa", tipo: "nacional", tipoCompeticao: "clubes", divisao: 1, ativo: true, ordem: 70 },
      { nome: "Primeira Liga", nomeAbreviado: "Liga Portugal", pais: "Portugal", tipo: "nacional", tipoCompeticao: "clubes", divisao: 1, ativo: true, ordem: 80 },
      { nome: "Eredivisie", nomeAbreviado: "Eredivisie", pais: "Holanda", tipo: "nacional", tipoCompeticao: "clubes", divisao: 1, ativo: true, ordem: 90 },
      
      // Am√©ricas
      { nome: "Liga Profesional Argentina", nomeAbreviado: "Liga Argentina", pais: "Argentina", tipo: "nacional", tipoCompeticao: "clubes", divisao: 1, ativo: true, ordem: 100 },
      { nome: "Liga MX", nomeAbreviado: "Liga MX", pais: "M√©xico", tipo: "nacional", tipoCompeticao: "clubes", divisao: 1, ativo: true, ordem: 110 },
      { nome: "MLS", nomeAbreviado: "MLS", pais: "Estados Unidos", tipo: "nacional", tipoCompeticao: "clubes", divisao: 1, ativo: true, ordem: 120 },
      
      // Outros
      { nome: "Saudi Pro League", nomeAbreviado: "Saudi League", pais: "Ar√°bia Saudita", tipo: "nacional", tipoCompeticao: "clubes", divisao: 1, ativo: true, ordem: 130 },
      { nome: "J1 League", nomeAbreviado: "J-League", pais: "Jap√£o", tipo: "nacional", tipoCompeticao: "clubes", divisao: 1, ativo: true, ordem: 140 },
    ];
    
    try {
      const batch = db.batch();
      
      listaCampeonatos.forEach(camp => {
        const docRef = db.collection('campeonatos').doc();
        batch.set(docRef, {
          ...camp,
          criadoEm: firebase.firestore.FieldValue.serverTimestamp()
        });
      });
      
      await batch.commit();
      
      log(`‚úÖ ${listaCampeonatos.length} campeonatos importados!`, 'success');
      
      await carregarCampeonatos();
      
    } catch (error) {
      log(`Erro: ${error.message}`, 'error');
    }
  }
  
  // ==================== INIT ====================
  document.addEventListener('DOMContentLoaded', () => {
    carregarEstatisticas();
    carregarCampeonatos();
  });
</script>

</body>
</html>
