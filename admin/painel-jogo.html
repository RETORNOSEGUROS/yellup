
<!-- painel-jogo.html (vers√£o completa com dados do jogo, chat e envio manual de pergunta) -->
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Painel do Jogo</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f7f7f7; padding: 20px; }
    .painel { background: white; border-radius: 8px; padding: 20px; max-width: 900px; margin: auto; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    h1 { font-size: 22px; color: #222; }
    .chat-area, .pergunta-area { margin-top: 30px; }
    textarea { width: 100%; height: 120px; }
    input[type="text"] { width: 80%; }
    button { padding: 6px 12px; margin-top: 5px; }
    .info-jogo { font-size: 18px; margin-bottom: 10px; }
  </style>
</head>
<body>
<div class="painel">
  <h1>üéØ Painel do Jogo</h1>
  <div class="info-jogo" id="dadosJogo">Carregando dados do jogo...</div>

  <div class="chat-area">
    <h3>üí¨ Chat da Torcida</h3>
    <textarea id="chatMensagens" readonly></textarea><br>
    <input type="text" id="mensagemInput" placeholder="Digite sua mensagem...">
    <button onclick="enviarMensagem()">Enviar</button>
  </div>

  <div class="pergunta-area">
    <h3>üéØ Envio Manual de Pergunta</h3>
    <button onclick="sortearEEnviarPergunta()">+ Sortear e Enviar Pergunta</button>
  </div>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyC5ZrkEy7KuCFJOtPvI7-P-JcA0MF4im5c",
    authDomain: "painel-yellup.firebaseapp.com",
    projectId: "painel-yellup",
    storageBucket: "painel-yellup.appspot.com",
    messagingSenderId: "608347210297",
    appId: "1:608347210297:web:75092713724e617c7203e8",
    measurementId: "G-SYZ16X31KQ"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const urlParams = new URLSearchParams(window.location.search);
  const jogoId = urlParams.get('id');
  const campoJogo = document.getElementById('dadosJogo');

  const chatTextarea = document.getElementById("chatMensagens");
  const inputMensagem = document.getElementById("mensagemInput");

  async function carregarJogo() {
    const doc = await db.collection("jogos").doc(jogoId).get();
    if (doc.exists) {
      const jogo = doc.data();
      campoJogo.innerHTML = `üèüÔ∏è <strong>${jogo.timeCasa?.nome || 'Time A'} vs ${jogo.timeVisitante?.nome || 'Time B'}</strong><br>‚è∞ In√≠cio: ${jogo.inicio?.toDate().toLocaleString() || '-'}<br>üéüÔ∏è Entrada: ${jogo.entrada || '0 cr√©ditos'}`;
    } else {
      campoJogo.innerHTML = "Jogo n√£o encontrado.";
    }
  }

  function enviarMensagem() {
    const texto = inputMensagem.value.trim();
    if (texto === "") return;
    db.collection("chats_jogo_demo").add({
      data: new Date(),
      texto: texto,
      jogoId: jogoId,
      tipo: "chat"
    });
    inputMensagem.value = "";
  }

  function escutarChat() {
    db.collection("chats_jogo_demo")
      .where("jogoId", "==", jogoId)
      .where("tipo", "==", "chat")
      .orderBy("data", "asc")
      .onSnapshot(snapshot => {
        chatTextarea.value = snapshot.docs.map(doc => doc.data().texto).join("\n");
        chatTextarea.scrollTop = chatTextarea.scrollHeight;
      });
  }

  async function sortearEEnviarPergunta() {
    const perguntasSnap = await db.collection("perguntas")
      .where("timeId", "!=", "")
      .limit(1) // depois pode ser aleat√≥rio
      .get();
    if (!perguntasSnap.empty) {
      const pergunta = perguntasSnap.docs[0].data();
      await db.collection("chats_jogo_demo").add({
        data: new Date(),
        jogoId: jogoId,
        timeId: pergunta.timeId || "",
        perguntaId: perguntasSnap.docs[0].id,
        tipo: "pergunta"
      });
      alert("Pergunta enviada!");
    } else {
      alert("Nenhuma pergunta encontrada.");
    }
  }

  carregarJogo();
  escutarChat();
</script>
</body>
</html>
