<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Perguntas V2 | Yellup</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            display: flex;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }
        .sidebar-header h2 { color: #FFD700; font-size: 28px; }
        .sidebar-header .version { 
            font-size: 11px; 
            background: linear-gradient(135deg, #667eea, #764ba2); 
            color: white; 
            padding: 2px 8px; 
            border-radius: 10px; 
            margin-left: 5px;
        }

        .nav-section { margin-bottom: 20px; }
        .nav-section-title { 
            color: rgba(255, 255, 255, 0.5); 
            font-size: 11px; 
            text-transform: uppercase; 
            letter-spacing: 1px; 
            padding: 0 20px; 
            margin-bottom: 10px; 
        }

        .sidebar a {
            display: flex; 
            align-items: center; 
            gap: 12px; 
            padding: 12px 20px;
            color: rgba(255, 255, 255, 0.7); 
            text-decoration: none; 
            transition: all 0.3s;
            border-left: 3px solid transparent;
        }
        .sidebar a:hover, .sidebar a.active { 
            background: rgba(255, 215, 0, 0.1); 
            color: #FFD700; 
            border-left-color: #FFD700; 
        }
        .sidebar a .icon { font-size: 18px; width: 24px; text-align: center; }

        /* Main Content */
        .main { flex: 1; margin-left: 260px; padding: 30px; }

        .header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .header h1 { color: white; font-size: 28px; }
        .header-actions { display: flex; gap: 10px; flex-wrap: wrap; }

        /* Buttons */
        .btn {
            padding: 10px 20px; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: 600;
            transition: all 0.3s; 
            border: none; 
            display: inline-flex; 
            align-items: center; 
            gap: 8px;
            font-size: 14px;
        }
        .btn-primary { background: linear-gradient(135deg, #FFD700, #FFA500); color: #1a1a2e; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(255, 215, 0, 0.3); }
        .btn-danger { background: rgba(231, 76, 60, 0.2); border: 1px solid #e74c3c; color: #e74c3c; }
        .btn-danger:hover { background: #e74c3c; color: white; }
        .btn-success { background: rgba(46, 204, 113, 0.2); border: 1px solid #2ecc71; color: #2ecc71; }
        .btn-success:hover { background: #2ecc71; color: white; }
        .btn-info { background: rgba(52, 152, 219, 0.2); border: 1px solid #3498db; color: #3498db; }
        .btn-info:hover { background: #3498db; color: white; }
        .btn-sm { padding: 6px 12px; font-size: 12px; }

        /* Stats */
        .stats-row { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); 
            gap: 15px; 
            margin-bottom: 25px; 
        }
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px; 
            padding: 20px; 
            text-align: center;
        }
        .stat-card .icon { font-size: 28px; margin-bottom: 8px; }
        .stat-card .value { font-size: 24px; font-weight: 700; color: white; }
        .stat-card .label { color: rgba(255, 255, 255, 0.6); font-size: 13px; }

        /* Filters */
        .filters-bar {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px; 
            padding: 20px; 
            margin-bottom: 20px;
            display: flex; 
            gap: 15px; 
            flex-wrap: wrap; 
            align-items: flex-end;
        }

        .filter-group { display: flex; flex-direction: column; gap: 5px; }
        .filter-group label { 
            font-size: 11px; 
            color: rgba(255,255,255,0.5); 
            text-transform: uppercase; 
        }

        /* Search Select V2 */
        .search-select-container {
            position: relative;
            min-width: 200px;
        }
        .search-select-input {
            width: 100%;
            padding: 10px 35px 10px 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 14px;
        }
        .search-select-input:focus {
            outline: none;
            border-color: #FFD700;
        }
        .search-select-input::placeholder { color: rgba(255,255,255,0.5); }
        .search-select-icon {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255,255,255,0.5);
            font-size: 18px;
            pointer-events: none;
        }
        .search-select-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #1a1a2e;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            max-height: 250px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            margin-top: 5px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .search-select-dropdown.show { display: block; }
        .search-select-option {
            padding: 10px 15px;
            cursor: pointer;
            transition: background 0.2s;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            color: white;
            font-size: 13px;
        }
        .search-select-option:hover { background: rgba(255, 215, 0, 0.2); }
        .search-select-option:last-child { border-bottom: none; }
        .search-select-option .bandeira { margin-right: 8px; }
        .search-select-count {
            padding: 8px 15px;
            background: rgba(255,255,255,0.05);
            font-size: 11px;
            color: rgba(255,255,255,0.5);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .search-box { 
            flex: 1; 
            min-width: 200px; 
            position: relative; 
        }
        .search-box input {
            width: 100%; 
            padding: 10px 15px 10px 40px; 
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2); 
            background: rgba(255, 255, 255, 0.1);
            color: white; 
            font-size: 14px;
        }
        .search-box input::placeholder { color: rgba(255, 255, 255, 0.5); }
        .search-box input:focus { outline: none; border-color: #FFD700; }
        .search-box .material-icons { 
            position: absolute; 
            left: 12px; 
            top: 50%; 
            transform: translateY(-50%); 
            color: rgba(255, 255, 255, 0.5);
            font-size: 18px;
        }

        .filter-select {
            padding: 10px 15px; 
            border-radius: 8px; 
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1); 
            color: white; 
            font-size: 14px; 
            min-width: 130px;
        }
        .filter-select option { background: #1a1a2e; color: white; }

        /* Table */
        .table-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px; 
            overflow: hidden;
        }
        table { width: 100%; border-collapse: collapse; }
        th {
            background: rgba(0, 0, 0, 0.3); 
            color: #FFD700; 
            padding: 12px 15px; 
            text-align: left;
            font-weight: 600; 
            font-size: 12px; 
            text-transform: uppercase;
            white-space: nowrap;
        }
        td { 
            padding: 12px 15px; 
            border-bottom: 1px solid rgba(255, 255, 255, 0.05); 
            color: white; 
            font-size: 13px; 
            vertical-align: top;
        }
        tr:hover { background: rgba(255, 255, 255, 0.03); }

        .pergunta-text { max-width: 350px; }
        .pergunta-id { 
            font-family: monospace; 
            font-size: 11px; 
            color: #667eea; 
            background: rgba(102, 126, 234, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            display: inline-block;
            margin-bottom: 5px;
        }

        .alternativas {
            display: flex; 
            flex-direction: column; 
            gap: 3px; 
            font-size: 11px;
        }
        .alt-item { 
            display: flex; 
            align-items: center; 
            gap: 6px; 
            padding: 3px 6px; 
            border-radius: 4px; 
        }
        .alt-item.correta { background: rgba(46, 204, 113, 0.2); color: #2ecc71; }
        .alt-item.incorreta { color: rgba(255, 255, 255, 0.5); }

        .badge { 
            padding: 4px 10px; 
            border-radius: 15px; 
            font-size: 11px; 
            font-weight: 600;
            white-space: nowrap;
        }
        .badge-facil { background: rgba(46, 204, 113, 0.2); color: #2ecc71; }
        .badge-medio { background: rgba(241, 196, 15, 0.2); color: #f1c40f; }
        .badge-dificil { background: rgba(231, 76, 60, 0.2); color: #e74c3c; }

        .entidade-badge { 
            display: inline-flex; 
            align-items: center; 
            gap: 6px; 
            padding: 4px 10px; 
            background: rgba(255, 255, 255, 0.1); 
            border-radius: 15px; 
            font-size: 11px;
            white-space: nowrap;
        }
        .entidade-badge.camp { background: rgba(102, 126, 234, 0.2); color: #667eea; }
        .entidade-badge.time { background: rgba(56, 239, 125, 0.2); color: #38ef7d; }

        .actions { display: flex; gap: 6px; }

        /* Pagination */
        .pagination {
            display: flex; 
            justify-content: center; 
            align-items: center; 
            gap: 15px;
            margin-top: 20px; 
            padding: 15px;
        }
        .pagination button {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        .pagination button:hover:not(:disabled) { 
            background: rgba(255, 215, 0, 0.2); 
            border-color: #FFD700; 
        }
        .pagination button:disabled { opacity: 0.5; cursor: not-allowed; }
        .pagination span { color: rgba(255, 255, 255, 0.7); }

        /* Modal */
        .modal {
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: rgba(0, 0, 0, 0.8); 
            z-index: 1000; 
            align-items: center; 
            justify-content: center;
        }
        .modal.show { display: flex; }
        .modal-content {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border-radius: 16px;
            padding: 30px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .modal-header h2 { color: #FFD700; font-size: 20px; }
        .modal-close {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            font-size: 24px;
            cursor: pointer;
        }
        .modal-close:hover { color: #e74c3c; }

        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 13px;
        }
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 14px;
        }
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #FFD700;
        }
        .form-group textarea { min-height: 100px; resize: vertical; }
        .form-group select option { background: #1a1a2e; }

        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }

        .alternativas-form { margin: 20px 0; }
        .alternativas-form h4 { color: #FFD700; margin-bottom: 15px; font-size: 14px; }
        .alt-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .alt-input-group .letra {
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            font-size: 12px;
        }
        .alt-input-group input[type="text"] { flex: 1; }
        .alt-input-group .radio-label {
            display: flex;
            align-items: center;
            gap: 5px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            cursor: pointer;
            white-space: nowrap;
        }
        .alt-input-group input[type="radio"] { accent-color: #2ecc71; }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: #fff;
            font-weight: 500;
            z-index: 2000;
            animation: slideIn 0.3s ease;
        }
        .toast-success { background: linear-gradient(135deg, #2ecc71, #27ae60); }
        .toast-error { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .loading { text-align: center; color: rgba(255,255,255,0.5); padding: 40px; }

        @media (max-width: 1024px) {
            .sidebar { width: 200px; }
            .main { margin-left: 200px; }
        }

        @media (max-width: 768px) {
            .sidebar { display: none; }
            .main { margin-left: 0; }
            .form-row { grid-template-columns: 1fr; }
            .stats-row { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>âš½ Yellup <span class="version">V2</span></h2>
        </div>
        <nav>
            <div class="nav-section">
                <div class="nav-section-title">Principal</div>
                <a href="#"><span class="icon">ğŸ“Š</span> Dashboard</a>
                <a href="#" class="active"><span class="icon">â“</span> Perguntas</a>
                <a href="#"><span class="icon">âš½</span> Times</a>
                <a href="#"><span class="icon">ğŸ†</span> Campeonatos</a>
            </div>
            <div class="nav-section">
                <div class="nav-section-title">Ferramentas</div>
                <a href="gerar-perguntas-v5.html"><span class="icon">âœ¨</span> Gerar Perguntas</a>
                <a href="importar-perguntas-v2.html"><span class="icon">ğŸ“¥</span> Importar</a>
            </div>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main">
        <div class="header">
            <h1>â“ Gerenciar Perguntas</h1>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="abrirModal()">
                    <span class="material-icons">add</span>
                    Nova Pergunta
                </button>
                <button class="btn btn-info" onclick="exportarJSON()">
                    <span class="material-icons">code</span>
                    Exportar JSON
                </button>
                <button class="btn btn-success" onclick="exportarExcel()">
                    <span class="material-icons">table_chart</span>
                    Exportar Excel
                </button>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-row">
            <div class="stat-card">
                <div class="icon">ğŸ“š</div>
                <div class="value" id="statTotal">0</div>
                <div class="label">Total</div>
            </div>
            <div class="stat-card">
                <div class="icon">âš½</div>
                <div class="value" id="statTimes">0</div>
                <div class="label">De Times</div>
            </div>
            <div class="stat-card">
                <div class="icon">ğŸ†</div>
                <div class="value" id="statCamps">0</div>
                <div class="label">De Campeonatos</div>
            </div>
            <div class="stat-card">
                <div class="icon">ğŸŸ¢</div>
                <div class="value" id="statFacil">0</div>
                <div class="label">FÃ¡cil (1-4)</div>
            </div>
            <div class="stat-card">
                <div class="icon">ğŸŸ¡</div>
                <div class="value" id="statMedio">0</div>
                <div class="label">MÃ©dio (5-6)</div>
            </div>
            <div class="stat-card">
                <div class="icon">ğŸ”´</div>
                <div class="value" id="statDificil">0</div>
                <div class="label">DifÃ­cil (7-10)</div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters-bar">
            <div class="search-box">
                <span class="material-icons">search</span>
                <input type="text" id="busca" placeholder="Buscar pergunta..." onkeyup="buscarPerguntas()">
            </div>
            
            <div class="filter-group">
                <label>Tipo</label>
                <select class="filter-select" id="filtroTipo" onchange="filtrarPerguntas()">
                    <option value="">Todos</option>
                    <option value="time">âš½ Times</option>
                    <option value="campeonato">ğŸ† Campeonatos</option>
                </select>
            </div>
            
            <div class="filter-group" id="filtroTimeGroup">
                <label>Time</label>
                <div class="search-select-container">
                    <input type="text" class="search-select-input" id="searchFiltroTime" placeholder="Buscar time..." autocomplete="off">
                    <span class="material-icons search-select-icon">search</span>
                    <input type="hidden" id="filtroTime" value="">
                    <div class="search-select-dropdown" id="dropdownFiltroTime"></div>
                </div>
            </div>
            
            <div class="filter-group" id="filtroCampGroup">
                <label>Campeonato</label>
                <div class="search-select-container">
                    <input type="text" class="search-select-input" id="searchFiltroCamp" placeholder="Buscar campeonato..." autocomplete="off">
                    <span class="material-icons search-select-icon">search</span>
                    <input type="hidden" id="filtroCampeonato" value="">
                    <div class="search-select-dropdown" id="dropdownFiltroCamp"></div>
                </div>
            </div>
            
            <div class="filter-group">
                <label>Dificuldade</label>
                <select class="filter-select" id="filtroDificuldade" onchange="filtrarPerguntas()">
                    <option value="">Todas</option>
                    <option value="facil">ğŸŸ¢ FÃ¡cil</option>
                    <option value="medio">ğŸŸ¡ MÃ©dio</option>
                    <option value="dificil">ğŸ”´ DifÃ­cil</option>
                </select>
            </div>
            
            <button class="btn btn-sm btn-info" onclick="limparFiltros()">
                <span class="material-icons">clear</span>
                Limpar
            </button>
        </div>

        <!-- Table -->
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>ID / Pergunta</th>
                        <th>Alternativas</th>
                        <th>Time/Camp</th>
                        <th>Pts</th>
                        <th>AÃ§Ãµes</th>
                    </tr>
                </thead>
                <tbody id="listaPerguntas">
                    <tr><td colspan="5" class="loading">Carregando perguntas...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="pagination">
            <button onclick="paginaAnterior()" id="btnAnterior" disabled>â† Anterior</button>
            <span id="paginaInfo">PÃ¡gina 1</span>
            <button onclick="proximaPagina()" id="btnProxima">PrÃ³xima â†’</button>
        </div>
    </div>
    <!-- Modal Nova/Editar Pergunta -->
    <div class="modal" id="modalPergunta">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitulo">â• Nova Pergunta</h2>
                <button class="modal-close" onclick="fecharModal()">âœ•</button>
            </div>

            <input type="hidden" id="perguntaDocId">

            <div class="form-group">
                <label>ID Personalizado (opcional)</label>
                <input type="text" id="perguntaId" placeholder="Ex: santos-001, libertadores-050">
            </div>

            <div class="form-group">
                <label>Texto da Pergunta</label>
                <textarea id="pergunta" placeholder="Digite a pergunta aqui..."></textarea>
            </div>

            <div class="alternativas-form">
                <h4>ğŸ“ Alternativas</h4>
                <div class="alt-input-group">
                    <span class="letra">A</span>
                    <input type="text" id="altA" placeholder="Alternativa A">
                    <label class="radio-label"><input type="radio" name="correta" value="A"> Correta</label>
                </div>
                <div class="alt-input-group">
                    <span class="letra">B</span>
                    <input type="text" id="altB" placeholder="Alternativa B">
                    <label class="radio-label"><input type="radio" name="correta" value="B"> Correta</label>
                </div>
                <div class="alt-input-group">
                    <span class="letra">C</span>
                    <input type="text" id="altC" placeholder="Alternativa C">
                    <label class="radio-label"><input type="radio" name="correta" value="C"> Correta</label>
                </div>
                <div class="alt-input-group">
                    <span class="letra">D</span>
                    <input type="text" id="altD" placeholder="Alternativa D">
                    <label class="radio-label"><input type="radio" name="correta" value="D"> Correta</label>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label>Tipo de Pergunta</label>
                    <select id="tipoPergunta" onchange="alternarTipoPergunta()">
                        <option value="time">âš½ Pergunta de Time</option>
                        <option value="campeonato">ğŸ† Pergunta de Campeonato</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>PontuaÃ§Ã£o (1-10)</label>
                    <input type="number" id="pontuacao" value="5" min="1" max="10">
                </div>
            </div>

            <div class="form-group" id="rowTime">
                <label>Time Relacionado</label>
                <div class="search-select-container">
                    <input type="text" class="search-select-input" id="searchTimeModal" placeholder="Buscar time..." autocomplete="off">
                    <span class="material-icons search-select-icon">search</span>
                    <input type="hidden" id="timeId" value="">
                    <div class="search-select-dropdown" id="dropdownTimeModal"></div>
                </div>
            </div>

            <div class="form-group" id="rowCampeonato" style="display: none;">
                <label>Campeonato Relacionado</label>
                <div class="search-select-container">
                    <input type="text" class="search-select-input" id="searchCampModal" placeholder="Buscar campeonato..." autocomplete="off">
                    <span class="material-icons search-select-icon">search</span>
                    <input type="hidden" id="campeonatoId" value="">
                    <div class="search-select-dropdown" id="dropdownCampModal"></div>
                </div>
            </div>

            <div class="form-group">
                <label>Fonte</label>
                <input type="text" id="fonte" placeholder="Wikipedia, CONMEBOL, site oficial, etc">
            </div>

            <div style="display: flex; gap: 15px; margin-top: 20px;">
                <button class="btn btn-primary" onclick="salvarPergunta()" style="flex: 1;">
                    <span class="material-icons">save</span>
                    Salvar
                </button>
                <button class="btn btn-danger" onclick="fecharModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CONSTANTES E BANDEIRAS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        const BANDEIRAS = {
            'brasil': 'ğŸ‡§ğŸ‡·', 'argentina': 'ğŸ‡¦ğŸ‡·', 'uruguai': 'ğŸ‡ºğŸ‡¾', 'paraguai': 'ğŸ‡µğŸ‡¾',
            'chile': 'ğŸ‡¨ğŸ‡±', 'colÃ´mbia': 'ğŸ‡¨ğŸ‡´', 'colombia': 'ğŸ‡¨ğŸ‡´', 'peru': 'ğŸ‡µğŸ‡ª',
            'equador': 'ğŸ‡ªğŸ‡¨', 'venezuela': 'ğŸ‡»ğŸ‡ª', 'bolÃ­via': 'ğŸ‡§ğŸ‡´', 'bolivia': 'ğŸ‡§ğŸ‡´',
            'espanha': 'ğŸ‡ªğŸ‡¸', 'itÃ¡lia': 'ğŸ‡®ğŸ‡¹', 'italia': 'ğŸ‡®ğŸ‡¹', 'alemanha': 'ğŸ‡©ğŸ‡ª',
            'franÃ§a': 'ğŸ‡«ğŸ‡·', 'franca': 'ğŸ‡«ğŸ‡·', 'inglaterra': 'ğŸ´ó §ó ¢ó ¥ó ®ó §ó ¿', 'portugal': 'ğŸ‡µğŸ‡¹',
            'holanda': 'ğŸ‡³ğŸ‡±', 'paÃ­ses baixos': 'ğŸ‡³ğŸ‡±', 'bÃ©lgica': 'ğŸ‡§ğŸ‡ª', 'belgica': 'ğŸ‡§ğŸ‡ª',
            'mÃ©xico': 'ğŸ‡²ğŸ‡½', 'mexico': 'ğŸ‡²ğŸ‡½', 'estados unidos': 'ğŸ‡ºğŸ‡¸', 'eua': 'ğŸ‡ºğŸ‡¸',
            'japÃ£o': 'ğŸ‡¯ğŸ‡µ', 'japao': 'ğŸ‡¯ğŸ‡µ', 'arÃ¡bia saudita': 'ğŸ‡¸ğŸ‡¦', 'arabia saudita': 'ğŸ‡¸ğŸ‡¦'
        };

        function getBandeira(pais) {
            if (!pais) return '';
            return BANDEIRAS[pais.toLowerCase().trim()] || '';
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // FIREBASE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        const firebaseConfig = {
            apiKey: "AIzaSyC5ZrkEy7KuCFJOtPvI7-P-JcA0MF4im5c",
            authDomain: "painel-yellup.firebaseapp.com",
            projectId: "painel-yellup",
            storageBucket: "painel-yellup.appspot.com",
            messagingSenderId: "608347210297",
            appId: "1:608347210297:web:75092713724e617c7203e8"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // VARIÃVEIS GLOBAIS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        let todasPerguntas = [];
        let perguntasFiltradas = [];
        let todosTimes = [];
        let todosCampeonatos = [];
        let timesMap = {};
        let campeonatosMap = {};
        let paginaAtual = 1;
        const porPagina = 20;

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // INICIALIZAÃ‡ÃƒO
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                console.log('Logado:', user.email);
                init();
            } else {
                firebase.auth().signInAnonymously();
            }
        });

        async function init() {
            await carregarTimes();
            await carregarPerguntas();
            setupSearchSelects();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SEARCH SELECT (BUSCA POR DIGITAÃ‡ÃƒO)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function setupSearchSelects() {
            // Filtro Time
            setupSearchSelect('searchFiltroTime', 'dropdownFiltroTime', 'filtroTime', 'time', function() {
                filtrarPerguntas();
            });
            
            // Filtro Campeonato
            setupSearchSelect('searchFiltroCamp', 'dropdownFiltroCamp', 'filtroCampeonato', 'camp', function() {
                filtrarPerguntas();
            });
            
            // Modal Time
            setupSearchSelect('searchTimeModal', 'dropdownTimeModal', 'timeId', 'time');
            
            // Modal Campeonato
            setupSearchSelect('searchCampModal', 'dropdownCampModal', 'campeonatoId', 'camp');
            
            // Fechar dropdowns ao clicar fora
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.search-select-container')) {
                    document.querySelectorAll('.search-select-dropdown').forEach(function(d) {
                        d.classList.remove('show');
                    });
                }
            });
        }

        function setupSearchSelect(inputId, dropdownId, hiddenId, tipo, onSelect) {
            var input = document.getElementById(inputId);
            var dropdown = document.getElementById(dropdownId);
            
            input.addEventListener('input', function() {
                filtrarOpcoes(dropdownId, hiddenId, tipo, input.value, onSelect);
            });
            
            input.addEventListener('focus', function() {
                filtrarOpcoes(dropdownId, hiddenId, tipo, input.value, onSelect);
                dropdown.classList.add('show');
            });
        }

        function filtrarOpcoes(dropdownId, hiddenId, tipo, busca, onSelect) {
            var dropdown = document.getElementById(dropdownId);
            var lista = tipo === 'time' ? todosTimes : todosCampeonatos;
            var buscaLower = busca.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
            
            var filtrados = lista.filter(function(item) {
                var nome = item.nome.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
                return nome.includes(buscaLower);
            });
            
            var html = '';
            
            // OpÃ§Ã£o para limpar
            html += '<div class="search-select-option" onclick="selecionarOpcao(\'' + dropdownId + '\', \'' + hiddenId + '\', \'\', \'Todos\', ' + (onSelect ? 'true' : 'false') + ')">ğŸ”„ Limpar seleÃ§Ã£o</div>';
            
            if (filtrados.length === 0) {
                html += '<div class="search-select-count">Nenhum resultado</div>';
            } else {
                html += '<div class="search-select-count">' + filtrados.length + ' resultados</div>';
                
                filtrados.slice(0, 30).forEach(function(item) {
                    var display = item.nome;
                    if (tipo === 'time') {
                        var bandeira = getBandeira(item.pais);
                        display = (bandeira ? bandeira + ' ' : '') + item.nome;
                    } else {
                        display = 'ğŸ† ' + item.nome;
                    }
                    
                    html += '<div class="search-select-option" onclick="selecionarOpcao(\'' + dropdownId + '\', \'' + hiddenId + '\', \'' + item.id + '\', \'' + item.nome.replace(/'/g, "\\'") + '\', ' + (onSelect ? 'true' : 'false') + ')">' + display + '</div>';
                });
            }
            
            dropdown.innerHTML = html;
            dropdown.classList.add('show');
        }

        function selecionarOpcao(dropdownId, hiddenId, id, nome, triggerCallback) {
            document.getElementById(hiddenId).value = id;
            
            // Encontrar o input correspondente
            var dropdown = document.getElementById(dropdownId);
            var container = dropdown.closest('.search-select-container');
            var input = container.querySelector('.search-select-input');
            
            input.value = id ? nome : '';
            dropdown.classList.remove('show');
            
            if (triggerCallback) {
                filtrarPerguntas();
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CARREGAR DADOS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        async function carregarTimes() {
            try {
                var snap = await db.collection('times').orderBy('nome').get();
                todosTimes = [];
                snap.forEach(function(doc) {
                    var t = { id: doc.id, ...doc.data() };
                    todosTimes.push(t);
                    timesMap[doc.id] = t;
                });

                var snapCamp = await db.collection('campeonatos').orderBy('nome').get();
                todosCampeonatos = [];
                snapCamp.forEach(function(doc) {
                    var c = { id: doc.id, ...doc.data() };
                    todosCampeonatos.push(c);
                    campeonatosMap[doc.id] = c;
                });

                console.log('Carregados:', todosTimes.length, 'times,', todosCampeonatos.length, 'campeonatos');
            } catch (error) {
                console.error('Erro:', error);
            }
        }

        async function carregarPerguntas() {
            try {
                var snap = await db.collection('perguntas').get();

                todasPerguntas = [];
                var times = 0, camps = 0, facil = 0, medio = 0, dificil = 0;

                snap.forEach(function(doc) {
                    var p = { docId: doc.id, ...doc.data() };
                    todasPerguntas.push(p);

                    if (p.timeId && p.timeId !== '') times++;
                    if (p.campeonatoId && p.campeonatoId !== '') camps++;

                    var pts = p.pontuacao || 5;
                    if (pts <= 4) facil++;
                    else if (pts <= 6) medio++;
                    else dificil++;
                });

                document.getElementById('statTotal').textContent = todasPerguntas.length;
                document.getElementById('statTimes').textContent = times;
                document.getElementById('statCamps').textContent = camps;
                document.getElementById('statFacil').textContent = facil;
                document.getElementById('statMedio').textContent = medio;
                document.getElementById('statDificil').textContent = dificil;

                perguntasFiltradas = todasPerguntas.slice();
                renderizarPerguntas();
            } catch (error) {
                console.error('Erro:', error);
                document.getElementById('listaPerguntas').innerHTML = 
                    '<tr><td colspan="5" class="loading" style="color: #e74c3c;">Erro ao carregar</td></tr>';
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // HELPER: EXTRAIR ALTERNATIVAS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function getAlternativa(p, letra) {
            if (p.alternativas && typeof p.alternativas === 'object') {
                return p.alternativas[letra] || p.alternativas[letra.toLowerCase()] || '';
            }
            return p['alt' + letra] || p['alternativa' + letra] || '';
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // RENDERIZAÃ‡ÃƒO
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function renderizarPerguntas() {
            var inicio = (paginaAtual - 1) * porPagina;
            var fim = inicio + porPagina;
            var perguntasPagina = perguntasFiltradas.slice(inicio, fim);

            var tbody = document.getElementById('listaPerguntas');

            if (perguntasPagina.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="loading">Nenhuma pergunta encontrada</td></tr>';
                return;
            }

            var html = '';
            perguntasPagina.forEach(function(p) {
                // Entidade (time ou campeonato)
                var entidade = { tipo: 'geral', nome: 'Geral', classe: '' };
                
                if (p.timeId && timesMap[p.timeId]) {
                    var t = timesMap[p.timeId];
                    entidade = { tipo: 'time', nome: getBandeira(t.pais) + ' ' + t.nome, classe: 'time' };
                } else if (p.timeNome) {
                    entidade = { tipo: 'time', nome: 'âš½ ' + p.timeNome, classe: 'time' };
                } else if (p.campeonatoId && campeonatosMap[p.campeonatoId]) {
                    entidade = { tipo: 'camp', nome: 'ğŸ† ' + campeonatosMap[p.campeonatoId].nome, classe: 'camp' };
                } else if (p.campeonatoNome) {
                    entidade = { tipo: 'camp', nome: 'ğŸ† ' + p.campeonatoNome, classe: 'camp' };
                }

                // Dificuldade baseada em pontuaÃ§Ã£o
                var pts = p.pontuacao || 5;
                var dif = pts <= 4 ? 'facil' : (pts <= 6 ? 'medio' : 'dificil');
                var difBadge = 'badge-' + dif;
                var difIcon = dif === 'facil' ? 'ğŸŸ¢' : (dif === 'medio' ? 'ğŸŸ¡' : 'ğŸ”´');

                var correta = p.correta || 'A';
                
                var alternativas = ['A', 'B', 'C', 'D'].map(function(letra) {
                    var texto = getAlternativa(p, letra) || '-';
                    var isCorreta = letra === correta;
                    return '<div class="alt-item ' + (isCorreta ? 'correta' : 'incorreta') + '">' +
                        '<strong>' + letra + ':</strong> ' + texto.substring(0, 25) + (texto.length > 25 ? '...' : '') +
                        (isCorreta ? ' âœ“' : '') +
                    '</div>';
                }).join('');

                // ID personalizado (V2!)
                var idDisplay = p.id || '';

                html += '<tr>' +
                    '<td class="pergunta-text">' +
                        (idDisplay ? '<span class="pergunta-id">' + idDisplay + '</span><br>' : '') +
                        (p.pergunta || '').substring(0, 100) + ((p.pergunta || '').length > 100 ? '...' : '') +
                    '</td>' +
                    '<td><div class="alternativas">' + alternativas + '</div></td>' +
                    '<td><span class="entidade-badge ' + entidade.classe + '">' + entidade.nome + '</span></td>' +
                    '<td><span class="badge ' + difBadge + '">' + difIcon + ' ' + pts + '</span></td>' +
                    '<td>' +
                        '<div class="actions">' +
                            '<button class="btn btn-success btn-sm" onclick="editarPergunta(\'' + p.docId + '\')"><span class="material-icons">edit</span></button>' +
                            '<button class="btn btn-danger btn-sm" onclick="excluirPergunta(\'' + p.docId + '\')"><span class="material-icons">delete</span></button>' +
                        '</div>' +
                    '</td>' +
                '</tr>';
            });

            tbody.innerHTML = html;
            atualizarPaginacao();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // FILTROS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function buscarPerguntas() {
            var termo = document.getElementById('busca').value.toLowerCase();
            filtrarPerguntas();
        }

        function filtrarPerguntas() {
            var busca = document.getElementById('busca').value.toLowerCase();
            var tipo = document.getElementById('filtroTipo').value;
            var timeId = document.getElementById('filtroTime').value;
            var campId = document.getElementById('filtroCampeonato').value;
            var dificuldade = document.getElementById('filtroDificuldade').value;

            perguntasFiltradas = todasPerguntas.filter(function(p) {
                // Busca texto
                if (busca && !(p.pergunta || '').toLowerCase().includes(busca)) {
                    return false;
                }

                // Tipo
                if (tipo === 'time' && (!p.timeId || p.timeId === '')) return false;
                if (tipo === 'campeonato' && (!p.campeonatoId || p.campeonatoId === '')) return false;

                // Time especÃ­fico
                if (timeId && p.timeId !== timeId) return false;

                // Campeonato especÃ­fico
                if (campId && p.campeonatoId !== campId) return false;

                // Dificuldade (baseada em pontuaÃ§Ã£o)
                var pts = p.pontuacao || 5;
                if (dificuldade === 'facil' && pts > 4) return false;
                if (dificuldade === 'medio' && (pts < 5 || pts > 6)) return false;
                if (dificuldade === 'dificil' && pts < 7) return false;

                return true;
            });

            paginaAtual = 1;
            renderizarPerguntas();
        }

        function limparFiltros() {
            document.getElementById('busca').value = '';
            document.getElementById('filtroTipo').value = '';
            document.getElementById('filtroTime').value = '';
            document.getElementById('filtroCampeonato').value = '';
            document.getElementById('filtroDificuldade').value = '';
            document.getElementById('searchFiltroTime').value = '';
            document.getElementById('searchFiltroCamp').value = '';
            
            perguntasFiltradas = todasPerguntas.slice();
            paginaAtual = 1;
            renderizarPerguntas();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PAGINAÃ‡ÃƒO
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function atualizarPaginacao() {
            var totalPaginas = Math.ceil(perguntasFiltradas.length / porPagina);
            document.getElementById('paginaInfo').textContent = 
                'PÃ¡gina ' + paginaAtual + ' de ' + totalPaginas + ' (' + perguntasFiltradas.length + ' perguntas)';
            document.getElementById('btnAnterior').disabled = paginaAtual <= 1;
            document.getElementById('btnProxima').disabled = paginaAtual >= totalPaginas;
        }

        function paginaAnterior() {
            if (paginaAtual > 1) {
                paginaAtual--;
                renderizarPerguntas();
            }
        }

        function proximaPagina() {
            var totalPaginas = Math.ceil(perguntasFiltradas.length / porPagina);
            if (paginaAtual < totalPaginas) {
                paginaAtual++;
                renderizarPerguntas();
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MODAL
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function abrirModal() {
            document.getElementById('modalTitulo').textContent = 'â• Nova Pergunta';
            document.getElementById('perguntaDocId').value = '';
            document.getElementById('perguntaId').value = '';
            document.getElementById('pergunta').value = '';
            document.getElementById('altA').value = '';
            document.getElementById('altB').value = '';
            document.getElementById('altC').value = '';
            document.getElementById('altD').value = '';
            document.getElementById('pontuacao').value = '5';
            document.getElementById('fonte').value = '';
            document.getElementById('timeId').value = '';
            document.getElementById('campeonatoId').value = '';
            document.getElementById('searchTimeModal').value = '';
            document.getElementById('searchCampModal').value = '';
            document.getElementById('tipoPergunta').value = 'time';
            document.querySelector('input[name="correta"][value="A"]').checked = true;
            alternarTipoPergunta();
            document.getElementById('modalPergunta').classList.add('show');
        }

        function fecharModal() {
            document.getElementById('modalPergunta').classList.remove('show');
        }

        function alternarTipoPergunta() {
            var tipo = document.getElementById('tipoPergunta').value;
            document.getElementById('rowTime').style.display = tipo === 'time' ? 'block' : 'none';
            document.getElementById('rowCampeonato').style.display = tipo === 'campeonato' ? 'block' : 'none';
        }

        async function editarPergunta(docId) {
            var p = todasPerguntas.find(function(x) { return x.docId === docId; });
            if (!p) return;

            document.getElementById('modalTitulo').textContent = 'âœï¸ Editar Pergunta';
            document.getElementById('perguntaDocId').value = docId;
            document.getElementById('perguntaId').value = p.id || '';
            document.getElementById('pergunta').value = p.pergunta || '';
            document.getElementById('altA').value = getAlternativa(p, 'A');
            document.getElementById('altB').value = getAlternativa(p, 'B');
            document.getElementById('altC').value = getAlternativa(p, 'C');
            document.getElementById('altD').value = getAlternativa(p, 'D');
            document.getElementById('pontuacao').value = p.pontuacao || 5;
            document.getElementById('fonte').value = p.fonte || '';

            var correta = p.correta || 'A';
            var radio = document.querySelector('input[name="correta"][value="' + correta + '"]');
            if (radio) radio.checked = true;

            // Tipo e entidade
            if (p.campeonatoId && p.campeonatoId !== '') {
                document.getElementById('tipoPergunta').value = 'campeonato';
                document.getElementById('campeonatoId').value = p.campeonatoId;
                document.getElementById('searchCampModal').value = p.campeonatoNome || campeonatosMap[p.campeonatoId]?.nome || '';
            } else {
                document.getElementById('tipoPergunta').value = 'time';
                document.getElementById('timeId').value = p.timeId || '';
                document.getElementById('searchTimeModal').value = p.timeNome || timesMap[p.timeId]?.nome || '';
            }

            alternarTipoPergunta();
            document.getElementById('modalPergunta').classList.add('show');
        }

        async function salvarPergunta() {
            var docId = document.getElementById('perguntaDocId').value;
            var perguntaId = document.getElementById('perguntaId').value.trim();
            var perguntaTexto = document.getElementById('pergunta').value.trim();
            var correta = document.querySelector('input[name="correta"]:checked');

            if (!perguntaTexto) {
                showToast('Digite a pergunta!', 'error');
                return;
            }

            if (!correta) {
                showToast('Selecione a resposta correta!', 'error');
                return;
            }

            var tipo = document.getElementById('tipoPergunta').value;
            var timeId = document.getElementById('timeId').value;
            var campeonatoId = document.getElementById('campeonatoId').value;

            var dados = {
                id: perguntaId,
                pergunta: perguntaTexto,
                alternativas: {
                    A: document.getElementById('altA').value.trim(),
                    B: document.getElementById('altB').value.trim(),
                    C: document.getElementById('altC').value.trim(),
                    D: document.getElementById('altD').value.trim()
                },
                correta: correta.value,
                pontuacao: parseInt(document.getElementById('pontuacao').value) || 5,
                fonte: document.getElementById('fonte').value.trim(),
                timeId: tipo === 'time' ? timeId : '',
                timeNome: tipo === 'time' && timesMap[timeId] ? timesMap[timeId].nome : '',
                campeonatoId: tipo === 'campeonato' ? campeonatoId : '',
                campeonatoNome: tipo === 'campeonato' && campeonatosMap[campeonatoId] ? campeonatosMap[campeonatoId].nome : ''
            };

            try {
                if (docId) {
                    await db.collection('perguntas').doc(docId).update(dados);
                    showToast('Pergunta atualizada!', 'success');
                } else {
                    dados.criadoEm = firebase.firestore.FieldValue.serverTimestamp();
                    await db.collection('perguntas').add(dados);
                    showToast('Pergunta criada!', 'success');
                }

                fecharModal();
                await carregarPerguntas();
            } catch (error) {
                showToast('Erro: ' + error.message, 'error');
            }
        }

        async function excluirPergunta(docId) {
            if (!confirm('Tem certeza que deseja excluir esta pergunta?')) return;

            try {
                await db.collection('perguntas').doc(docId).delete();
                showToast('Pergunta excluÃ­da!', 'success');
                await carregarPerguntas();
            } catch (error) {
                showToast('Erro: ' + error.message, 'error');
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // EXPORTAR
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function exportarJSON() {
            var dados = perguntasFiltradas.map(function(p) {
                return {
                    id: p.id || '',
                    pergunta: p.pergunta,
                    alternativas: p.alternativas || {
                        A: getAlternativa(p, 'A'),
                        B: getAlternativa(p, 'B'),
                        C: getAlternativa(p, 'C'),
                        D: getAlternativa(p, 'D')
                    },
                    correta: p.correta,
                    pontuacao: p.pontuacao || 5,
                    timeId: p.timeId || '',
                    timeNome: p.timeNome || '',
                    campeonatoId: p.campeonatoId || '',
                    campeonatoNome: p.campeonatoNome || '',
                    fonte: p.fonte || ''
                };
            });

            var blob = new Blob([JSON.stringify(dados, null, 2)], { type: 'application/json' });
            var a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'perguntas_' + new Date().toISOString().slice(0, 10) + '.json';
            a.click();
            showToast(dados.length + ' perguntas exportadas!', 'success');
        }

        function exportarExcel() {
            var dados = perguntasFiltradas.map(function(p, i) {
                return {
                    'ID': p.id || (i + 1),
                    'Pergunta': p.pergunta,
                    'A': getAlternativa(p, 'A'),
                    'B': getAlternativa(p, 'B'),
                    'C': getAlternativa(p, 'C'),
                    'D': getAlternativa(p, 'D'),
                    'Correta': p.correta,
                    'Pontos': p.pontuacao || 5,
                    'Time': p.timeNome || '',
                    'Campeonato': p.campeonatoNome || '',
                    'Fonte': p.fonte || ''
                };
            });

            var ws = XLSX.utils.json_to_sheet(dados);
            var wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Perguntas');
            XLSX.writeFile(wb, 'perguntas_' + new Date().toISOString().slice(0, 10) + '.xlsx');
            showToast(dados.length + ' perguntas exportadas!', 'success');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // UTILS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function showToast(message, type) {
            type = type || 'success';
            var toast = document.createElement('div');
            toast.className = 'toast toast-' + type;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(function() { toast.remove(); }, 3000);
        }
    </script>
</body>
</html>
