<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perguntas - Yellup Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        :root {
            --bg-primary: #0c0e14; --bg-secondary: #12141c; --bg-card: #181a24;
            --bg-card-hover: #1e2030; --bg-sidebar: #10121a;
            --border: #1e2030; --border-light: #282a3a;
            --text-primary: #e8e9ed; --text-secondary: #8b8d9a; --text-muted: #5c5e6e;
            --accent: #f0b429; --accent-dim: rgba(240, 180, 41, 0.12);
            --green: #34d399; --green-dim: rgba(52, 211, 153, 0.12);
            --red: #f87171; --red-dim: rgba(248, 113, 113, 0.12);
            --blue: #60a5fa; --blue-dim: rgba(96, 165, 250, 0.12);
            --purple: #a78bfa; --purple-dim: rgba(167, 139, 250, 0.12);
            --orange: #fb923c; --orange-dim: rgba(251, 146, 60, 0.12);
            --sidebar-w: 250px; --header-h: 64px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'DM Sans', -apple-system, sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }

        /* SIDEBAR */
        .sidebar { position: fixed; left: 0; top: 0; width: var(--sidebar-w); height: 100vh; background: var(--bg-sidebar); border-right: 1px solid var(--border); display: flex; flex-direction: column; z-index: 100; transition: transform 0.3s ease; }
        .sidebar-brand { height: var(--header-h); display: flex; align-items: center; gap: 10px; padding: 0 20px; border-bottom: 1px solid var(--border); flex-shrink: 0; }
        .sidebar-brand .logo { width: 32px; height: 32px; background: var(--accent); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 16px; font-weight: 700; color: #000; }
        .sidebar-brand h1 { font-size: 17px; font-weight: 700; }
        .sidebar-brand h1 span { color: var(--text-muted); font-weight: 500; font-size: 12px; margin-left: 6px; }
        .sidebar-nav { flex: 1; overflow-y: auto; padding: 12px 0; }
        .sidebar-nav::-webkit-scrollbar { width: 0; }
        .nav-group { margin-bottom: 8px; }
        .nav-group-title { font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 1.2px; color: var(--text-muted); padding: 12px 20px 6px; }
        .nav-item { display: flex; align-items: center; gap: 10px; padding: 8px 16px; margin: 1px 8px; border-radius: 8px; color: var(--text-secondary); text-decoration: none; font-size: 13px; font-weight: 500; transition: all 0.15s; }
        .nav-item:hover { background: var(--bg-card); color: var(--text-primary); }
        .nav-item.active { background: var(--accent-dim); color: var(--accent); }
        .nav-item .icon { width: 20px; text-align: center; font-size: 14px; flex-shrink: 0; }
        .sidebar-footer { padding: 12px 16px; border-top: 1px solid var(--border); flex-shrink: 0; }
        .sidebar-footer .admin-box { display: flex; align-items: center; gap: 10px; padding: 8px; }
        .admin-avatar { width: 32px; height: 32px; background: linear-gradient(135deg, var(--accent), #e09800); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 13px; color: #000; }
        .admin-info-text { flex: 1; }
        .admin-info-text .name { font-size: 13px; font-weight: 600; }
        .admin-info-text .role { font-size: 11px; color: var(--text-muted); }
        .btn-logout { background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 16px; padding: 4px; border-radius: 6px; }
        .btn-logout:hover { color: var(--red); background: var(--red-dim); }

        /* MAIN */
        .main { margin-left: var(--sidebar-w); min-height: 100vh; }
        .topbar { height: var(--header-h); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 32px; background: var(--bg-primary); position: sticky; top: 0; z-index: 50; }
        .topbar-left { display: flex; align-items: center; gap: 16px; }
        .topbar-left h2 { font-size: 16px; font-weight: 600; }
        .topbar-actions { display: flex; gap: 8px; }
        .content { padding: 24px 32px 40px; }

        /* TABS */
        .tabs { display: flex; gap: 2px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 10px; padding: 3px; margin-bottom: 20px; }
        .tab { padding: 8px 16px; border-radius: 8px; font-size: 13px; font-weight: 500; color: var(--text-muted); cursor: pointer; transition: all 0.15s; display: flex; align-items: center; gap: 6px; }
        .tab:hover { color: var(--text-primary); }
        .tab.active { background: var(--accent-dim); color: var(--accent); }
        .tab .cnt { background: var(--bg-card); padding: 1px 7px; border-radius: 6px; font-size: 11px; font-family: 'JetBrains Mono', monospace; }

        /* VIEW SYSTEM */
        .view { display: none; }
        .view.active { display: block; }

        /* STATS */
        .stats-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; margin-bottom: 20px; }
        .stat-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 10px; padding: 14px; }
        .stat-card .sv { font-size: 22px; font-weight: 700; font-family: 'JetBrains Mono', monospace; }
        .stat-card .sl { font-size: 10px; color: var(--text-muted); margin-top: 2px; }

        /* CARDS GRID */
        .cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 12px; }
        .entity-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 10px; padding: 16px; cursor: pointer; transition: all 0.15s; }
        .entity-card:hover { border-color: var(--accent); background: var(--bg-card-hover); }
        .ec-head { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
        .ec-icon { width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; }
        .ec-icon.time { background: var(--green-dim); }
        .ec-icon.camp { background: var(--blue-dim); }
        .ec-name { font-size: 14px; font-weight: 600; flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .ec-stats { display: flex; gap: 12px; }
        .ec-stat { text-align: center; flex: 1; }
        .ec-stat .v { font-size: 16px; font-weight: 700; font-family: 'JetBrains Mono', monospace; }
        .ec-stat .l { font-size: 10px; color: var(--text-muted); }

        /* DETAIL VIEW */
        .detail-banner { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; margin-bottom: 16px; display: flex; align-items: center; gap: 16px; }
        .detail-icon { width: 56px; height: 56px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 28px; }
        .detail-info h3 { font-size: 18px; font-weight: 700; }
        .detail-info p { font-size: 12px; color: var(--text-muted); }
        .detail-nums { margin-left: auto; display: flex; gap: 20px; }
        .detail-num { text-align: center; }
        .detail-num .v { font-size: 22px; font-weight: 700; font-family: 'JetBrains Mono', monospace; }
        .detail-num .l { font-size: 10px; color: var(--text-muted); }
        .back-btn { background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 13px; font-family: inherit; }
        .back-btn:hover { color: var(--accent); }

        /* TABLE */
        .table-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
        table { width: 100%; border-collapse: collapse; }
        thead th { padding: 10px 14px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-muted); border-bottom: 1px solid var(--border); text-align: left; background: var(--bg-secondary); }
        tbody td { padding: 10px 14px; border-bottom: 1px solid var(--border); font-size: 13px; vertical-align: top; }
        tbody tr:hover { background: var(--bg-card-hover); }
        tbody tr:last-child td { border-bottom: none; }

        .id-mono { font-family: 'JetBrains Mono', monospace; font-size: 10px; color: var(--text-muted); background: var(--bg-secondary); padding: 2px 6px; border-radius: 4px; }
        .q-text { max-width: 300px; line-height: 1.5; font-size: 12px; }
        .alt-list { font-size: 11px; }
        .alt-ok { color: var(--green); font-weight: 600; }
        .alt-no { color: var(--text-muted); }
        .pts-badge { display: inline-flex; align-items: center; justify-content: center; width: 28px; height: 28px; border-radius: 6px; font-weight: 700; font-size: 12px; font-family: 'JetBrains Mono', monospace; }
        .pts-easy { background: var(--green-dim); color: var(--green); }
        .pts-med { background: var(--orange-dim); color: var(--orange); }
        .pts-hard { background: var(--red-dim); color: var(--red); }
        .entity-tag { display: inline-flex; padding: 2px 8px; border-radius: 6px; font-size: 11px; font-weight: 500; }
        .entity-tag.time { background: var(--green-dim); color: var(--green); }
        .entity-tag.camp { background: var(--blue-dim); color: var(--blue); }

        .actions { display: flex; gap: 4px; }
        .btn-icon { width: 28px; height: 28px; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-secondary); color: var(--text-secondary); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 12px; transition: all 0.15s; }
        .btn-icon:hover { border-color: var(--accent); color: var(--accent); }
        .btn-icon.danger:hover { border-color: var(--red); color: var(--red); background: var(--red-dim); }

        /* PAGINATION */
        .pagination { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-top: 1px solid var(--border); }
        .pagination .info { font-size: 12px; color: var(--text-muted); }
        .pg-btn { padding: 6px 14px; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-secondary); color: var(--text-primary); font-size: 12px; cursor: pointer; font-family: inherit; }
        .pg-btn:hover { border-color: var(--accent); }
        .pg-btn:disabled { opacity: 0.3; cursor: not-allowed; }

        /* FILTERS */
        .filter-bar { display: flex; gap: 10px; margin-bottom: 16px; flex-wrap: wrap; align-items: center; }
        .search-box { flex: 1; min-width: 200px; position: relative; }
        .search-box input { width: 100%; padding: 9px 14px 9px 36px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-card); color: var(--text-primary); font-size: 13px; font-family: inherit; }
        .search-box input:focus { outline: none; border-color: var(--accent); }
        .search-box input::placeholder { color: var(--text-muted); }
        .search-box .si { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); font-size: 13px; color: var(--text-muted); pointer-events: none; }
        .filter-select { padding: 9px 14px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-card); color: var(--text-primary); font-size: 13px; font-family: inherit; }
        .filter-select:focus { outline: none; border-color: var(--accent); }
        .filter-select option { background: var(--bg-card); }

        /* DROPDOWN (search-select) */
        .ss { position: relative; min-width: 180px; }
        .ss input { width: 100%; padding: 9px 14px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-card); color: var(--text-primary); font-size: 13px; font-family: inherit; }
        .ss input:focus { outline: none; border-color: var(--accent); }
        .ss input::placeholder { color: var(--text-muted); }
        .ss-drop { position: absolute; top: calc(100% + 4px); left: 0; right: 0; background: var(--bg-card); border: 1px solid var(--border); border-radius: 10px; max-height: 240px; overflow-y: auto; z-index: 60; display: none; box-shadow: 0 8px 30px rgba(0,0,0,0.4); }
        .ss-drop.show { display: block; }
        .ss-item { padding: 9px 14px; cursor: pointer; font-size: 12px; border-bottom: 1px solid var(--border); transition: background 0.1s; display: flex; justify-content: space-between; }
        .ss-item:hover { background: var(--accent-dim); }
        .ss-item:last-child { border-bottom: none; }
        .ss-item .ss-cnt { color: var(--text-muted); font-size: 11px; }
        .ss-info { padding: 6px 14px; font-size: 10px; color: var(--text-muted); background: var(--bg-secondary); }

        /* BUTTONS */
        .btn-primary { padding: 8px 16px; border-radius: 8px; border: none; background: var(--accent); color: #000; font-size: 13px; font-weight: 600; cursor: pointer; font-family: inherit; display: inline-flex; align-items: center; gap: 6px; }
        .btn-primary:hover { opacity: 0.9; }
        .btn-outline { padding: 8px 16px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-primary); font-size: 13px; font-weight: 500; cursor: pointer; font-family: inherit; display: inline-flex; align-items: center; gap: 6px; }
        .btn-outline:hover { border-color: var(--accent); }
        .btn-sm { padding: 5px 10px; font-size: 11px; }
        .btn-clear { padding: 6px 12px; border-radius: 6px; border: 1px solid var(--border); background: var(--bg-secondary); color: var(--text-muted); font-size: 11px; cursor: pointer; font-family: inherit; }
        .btn-clear:hover { color: var(--text-primary); }

        /* MODAL */
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 200; align-items: flex-start; justify-content: center; padding: 40px 20px; overflow-y: auto; }
        .modal-overlay.active { display: flex; }
        .modal { background: var(--bg-card); border: 1px solid var(--border); border-radius: 14px; width: 100%; max-width: 560px; }
        .modal-header { padding: 16px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .modal-header h3 { font-size: 15px; font-weight: 600; }
        .modal-close { background: none; border: none; color: var(--text-muted); font-size: 18px; cursor: pointer; padding: 4px; border-radius: 6px; }
        .modal-close:hover { color: var(--red); background: var(--red-dim); }
        .modal-body { padding: 20px; }
        .form-group { margin-bottom: 14px; }
        .form-group label { display: block; font-size: 12px; font-weight: 600; color: var(--text-secondary); margin-bottom: 5px; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 9px 12px; border: 1px solid var(--border); border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary); font-size: 13px; font-family: inherit; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--accent); }
        .form-group textarea { min-height: 70px; resize: vertical; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

        .alt-row { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; padding: 8px 10px; background: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border); }
        .alt-row .letra { width: 26px; height: 26px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 12px; background: var(--bg-card); color: var(--text-secondary); flex-shrink: 0; }
        .alt-row input[type="text"] { flex: 1; background: transparent; border: none; color: var(--text-primary); font-size: 13px; font-family: inherit; padding: 4px; }
        .alt-row input[type="text"]:focus { outline: none; }
        .alt-row label { display: flex; align-items: center; gap: 3px; font-size: 11px; color: var(--green); cursor: pointer; white-space: nowrap; flex-shrink: 0; }

        .modal-footer { padding: 0 20px 20px; display: flex; gap: 10px; }
        .modal-footer .btn-primary { flex: 1; justify-content: center; padding: 10px; }
        .modal-footer .btn-cancel { padding: 10px 20px; border-radius: 8px; border: 1px solid var(--border); background: var(--bg-secondary); color: var(--text-primary); font-size: 13px; cursor: pointer; font-family: inherit; }

        .empty-state { text-align: center; padding: 40px; color: var(--text-muted); font-size: 13px; }

        /* TOAST */
        .toast { position: fixed; bottom: 20px; right: 20px; padding: 12px 20px; border-radius: 10px; background: var(--bg-card); border: 1px solid var(--border); color: var(--text-primary); font-size: 13px; font-weight: 500; z-index: 999; transform: translateY(100px); opacity: 0; transition: all 0.3s; }
        .toast.show { transform: translateY(0); opacity: 1; }

        /* MOBILE */
        .mobile-toggle { display: none; position: fixed; top: 16px; left: 16px; z-index: 200; width: 40px; height: 40px; border-radius: 10px; background: var(--bg-card); border: 1px solid var(--border); color: var(--text-primary); font-size: 18px; cursor: pointer; align-items: center; justify-content: center; }
        .overlay-bg { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 90; }
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.open { transform: translateX(0); }
            .overlay-bg.open { display: block; }
            .mobile-toggle { display: flex; }
            .main { margin-left: 0; }
            .topbar { padding: 0 16px 0 64px; }
            .content { padding: 16px; }
            .stats-grid { grid-template-columns: repeat(3, 1fr); }
            .tabs { overflow-x: auto; }
            .form-row { grid-template-columns: 1fr; }
            .detail-banner { flex-direction: column; text-align: center; }
            .detail-nums { margin-left: 0; }
        }
    </style>
</head>
<body>

    <button class="mobile-toggle" onclick="toggleSidebar()">‚ò∞</button>
    <div class="overlay-bg" id="overlay" onclick="toggleSidebar()"></div>

    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-brand"><div class="logo">Y</div><h1>Yellup <span>Admin</span></h1></div>
        <nav class="sidebar-nav">
            <div class="nav-group"><div class="nav-group-title">Vis√£o Geral</div><a href="dashboard.html" class="nav-item"><span class="icon">üìä</span> Dashboard</a></div>
            <div class="nav-group"><div class="nav-group-title">Conte√∫do</div><a href="jogos.html" class="nav-item"><span class="icon">üéÆ</span> Jogos</a><a href="perguntas.html" class="nav-item active"><span class="icon">‚ùì</span> Perguntas</a><a href="gerar-perguntas.html" class="nav-item"><span class="icon">ü§ñ</span> Gerar com IA</a><a href="times.html" class="nav-item"><span class="icon">‚öΩ</span> Times</a></div>
            <div class="nav-group"><div class="nav-group-title">Jogadores</div><a href="usuarios.html" class="nav-item"><span class="icon">üë•</span> Usu√°rios</a><a href="ranking.html" class="nav-item"><span class="icon">üèÜ</span> Rankings</a><a href="admin-noticias.html" class="nav-item"><span class="icon">üì∞</span> Not√≠cias</a></div>
            <div class="nav-group"><div class="nav-group-title">Competi√ß√µes</div><a href="torneios.html" class="nav-item"><span class="icon">üèÖ</span> Torneios</a><a href="inicializar-pvp.html" class="nav-item"><span class="icon">‚öîÔ∏è</span> Embates PvP</a></div>
            <div class="nav-group"><div class="nav-group-title">Financeiro</div><a href="financeiro.html" class="nav-item"><span class="icon">üí∞</span> Resumo</a><a href="creditar-manual.html" class="nav-item"><span class="icon">‚ûï</span> Creditar Manual</a><a href="transacoes.html" class="nav-item"><span class="icon">üí≥</span> Transa√ß√µes</a><a href="premiacao.html" class="nav-item"><span class="icon">üéÅ</span> Premia√ß√£o</a><a href="indicacoes.html" class="nav-item"><span class="icon">üîó</span> Indica√ß√µes</a></div>
            <div class="nav-group"><div class="nav-group-title">Bolsa</div><a href="bolsa-admin.html" class="nav-item"><span class="icon">üìà</span> Gest√£o da Bolsa</a></div>
            <div class="nav-group"><div class="nav-group-title">Sistema</div><a href="configuracoes.html" class="nav-item"><span class="icon">‚öôÔ∏è</span> Configura√ß√µes</a><a href="checkup.html" class="nav-item"><span class="icon">üîç</span> Checkup</a><a href="simulador_avancado.html" class="nav-item"><span class="icon">üß™</span> Simulador</a><a href="teste-regras.html" class="nav-item"><span class="icon">üìú</span> Regras</a></div>
        </nav>
        <div class="sidebar-footer"><div class="admin-box"><div class="admin-avatar">A</div><div class="admin-info-text"><div class="name">Admin</div><div class="role">Administrador</div></div><button class="btn-logout" onclick="sair()" title="Sair">‚èª</button></div></div>
    </aside>

    <!-- MAIN -->
    <div class="main">
        <div class="topbar">
            <div class="topbar-left">
                <button class="back-btn" id="backBtn" onclick="voltarLista()" style="display:none">‚Üê Voltar</button>
                <h2 id="topTitle">‚ùì Perguntas</h2>
            </div>
            <div class="topbar-actions">
                <button class="btn-outline" onclick="exportarJSON()">üì• JSON</button>
                <button class="btn-outline" onclick="exportarExcel()">üìä Excel</button>
                <button class="btn-primary" onclick="abrirModalNova()">+ Nova Pergunta</button>
            </div>
        </div>

        <div class="content">
            <!-- TABS -->
            <div class="tabs" id="tabsBar">
                <div class="tab active" data-view="dashboard" onclick="showView('dashboard')">üìä Vis√£o Geral</div>
                <div class="tab" data-view="times" onclick="showView('times')">‚öΩ Por Time <span class="cnt" id="cntTimes">0</span></div>
                <div class="tab" data-view="campeonatos" onclick="showView('campeonatos')">üèÜ Por Campeonato <span class="cnt" id="cntCamps">0</span></div>
                <div class="tab" data-view="todas" onclick="showView('todas')">üìù Todas <span class="cnt" id="cntTotal">0</span></div>
            </div>

            <!-- VIEW: DASHBOARD -->
            <div class="view active" id="view-dashboard">
                <div class="stats-grid">
                    <div class="stat-card"><div class="sv" id="statTotal">0</div><div class="sl">üìã Total</div></div>
                    <div class="stat-card"><div class="sv" id="statTimes">0</div><div class="sl">‚öΩ Times</div></div>
                    <div class="stat-card"><div class="sv" id="statCamps">0</div><div class="sl">üèÜ Campeonatos</div></div>
                    <div class="stat-card"><div class="sv" id="statMedia">0</div><div class="sl">üìä M√©dia/Entidade</div></div>
                    <div class="stat-card"><div class="sv" style="color:var(--green)" id="statFacil">0</div><div class="sl">üü¢ F√°cil (1-4)</div></div>
                    <div class="stat-card"><div class="sv" style="color:var(--orange)" id="statMedio">0</div><div class="sl">üü° M√©dio (5-6)</div></div>
                </div>
                <div class="stat-card" style="margin-bottom:16px;padding:14px"><div class="sv" style="color:var(--red);display:inline" id="statDificil">0</div> <span class="sl">üî¥ Dif√≠cil (7-10)</span></div>

                <h4 style="font-size:13px;margin-bottom:12px;color:var(--text-secondary)">üî• Times com Mais Perguntas</h4>
                <div class="cards-grid" id="topTimes" style="margin-bottom:20px"></div>
                <h4 style="font-size:13px;margin-bottom:12px;color:var(--text-secondary)">üèÜ Campeonatos com Mais Perguntas</h4>
                <div class="cards-grid" id="topCamps"></div>
            </div>

            <!-- VIEW: TIMES -->
            <div class="view" id="view-times">
                <div class="filter-bar">
                    <div class="search-box" style="max-width:300px"><span class="si">üîç</span><input type="text" id="buscaTime" placeholder="Buscar time..." oninput="renderTimesGrid()"></div>
                </div>
                <div class="cards-grid" id="timesGrid"></div>
            </div>

            <!-- VIEW: CAMPEONATOS -->
            <div class="view" id="view-campeonatos">
                <div class="filter-bar">
                    <div class="search-box" style="max-width:300px"><span class="si">üîç</span><input type="text" id="buscaCamp" placeholder="Buscar campeonato..." oninput="renderCampsGrid()"></div>
                </div>
                <div class="cards-grid" id="campsGrid"></div>
            </div>

            <!-- VIEW: DETALHE -->
            <div class="view" id="view-detalhe">
                <div class="detail-banner" id="detalheBanner"></div>
                <div class="filter-bar">
                    <div class="search-box"><span class="si">üîç</span><input type="text" id="buscaDetalhe" placeholder="Buscar pergunta..." oninput="filtrarDetalhe()"></div>
                    <select class="filter-select" id="filtroDetalhe" onchange="filtrarDetalhe()">
                        <option value="">Todas</option>
                        <option value="facil">üü¢ F√°cil</option>
                        <option value="medio">üü° M√©dio</option>
                        <option value="dificil">üî¥ Dif√≠cil</option>
                    </select>
                    <button class="btn-primary btn-sm" onclick="novaParaEntidade()">+ Nova</button>
                </div>
                <div class="table-card">
                    <table><thead><tr><th>ID</th><th>Pergunta</th><th>Alternativas</th><th>Pts</th><th>A√ß√µes</th></tr></thead><tbody id="tbDetalhe"></tbody></table>
                    <div class="pagination"><span class="info" id="pgDetInfo">‚Äî</span><div style="display:flex;gap:6px"><button class="pg-btn" id="pgDetPrev" onclick="pgDet(-1)">‚Üê</button><button class="pg-btn" id="pgDetNext" onclick="pgDet(1)">‚Üí</button></div></div>
                </div>
            </div>

            <!-- VIEW: TODAS -->
            <div class="view" id="view-todas">
                <div class="filter-bar">
                    <div class="search-box"><span class="si">üîç</span><input type="text" id="buscaTodas" placeholder="Buscar pergunta..." oninput="filtrarTodas()"></div>
                    <div class="ss"><input type="text" id="filtroTimeInput" placeholder="‚öΩ Filtrar time..." autocomplete="off"><div class="ss-drop" id="dropTime"></div></div>
                    <div class="ss"><input type="text" id="filtroCampInput" placeholder="üèÜ Filtrar camp..." autocomplete="off"><div class="ss-drop" id="dropCamp"></div></div>
                    <select class="filter-select" id="filtroPontuacao" onchange="filtrarTodas()">
                        <option value="">Pts</option>
                        <option value="facil">F√°cil</option>
                        <option value="medio">M√©dio</option>
                        <option value="dificil">Dif√≠cil</option>
                    </select>
                    <button class="btn-clear" onclick="limparFiltros()">‚úï Limpar</button>
                </div>
                <div class="table-card">
                    <table><thead><tr><th>ID</th><th>Pergunta</th><th>Alternativas</th><th>Entidade</th><th>Pts</th><th>A√ß√µes</th></tr></thead><tbody id="tbTodas"></tbody></table>
                    <div class="pagination"><span class="info" id="pgAllInfo">‚Äî</span><div style="display:flex;gap:6px"><button class="pg-btn" id="pgAllPrev" onclick="pgAll(-1)">‚Üê</button><button class="pg-btn" id="pgAllNext" onclick="pgAll(1)">‚Üí</button></div></div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-header"><h3 id="modalTitulo">Nova Pergunta</h3><button class="modal-close" onclick="fecharModal()">‚úï</button></div>
            <div class="modal-body">
                <input type="hidden" id="modalDocId">
                <div class="form-group"><label>ID Personalizado</label><input type="text" id="modalId" placeholder="Ex: santos-001"></div>
                <div class="form-group"><label>Pergunta</label><textarea id="modalPergunta" placeholder="Digite a pergunta..."></textarea></div>
                <div class="form-group"><label>Alternativas</label>
                    <div class="alt-row"><span class="letra">A</span><input type="text" id="mAltA"><label><input type="radio" name="mCorreta" value="A"> ‚úì</label></div>
                    <div class="alt-row"><span class="letra">B</span><input type="text" id="mAltB"><label><input type="radio" name="mCorreta" value="B"> ‚úì</label></div>
                    <div class="alt-row"><span class="letra">C</span><input type="text" id="mAltC"><label><input type="radio" name="mCorreta" value="C"> ‚úì</label></div>
                    <div class="alt-row"><span class="letra">D</span><input type="text" id="mAltD"><label><input type="radio" name="mCorreta" value="D"> ‚úì</label></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Tipo</label><select id="modalTipo" onchange="toggleTipo()"><option value="time">‚öΩ Time</option><option value="campeonato">üèÜ Campeonato</option></select></div>
                    <div class="form-group"><label>Pontua√ß√£o (1-10)</label><input type="number" id="modalPts" value="5" min="1" max="10"></div>
                </div>
                <div class="form-group" id="grpTime"><label>Time</label><select id="modalTime"></select></div>
                <div class="form-group" id="grpCamp" style="display:none"><label>Campeonato</label><select id="modalCamp"></select></div>
                <div class="form-group"><label>Fonte</label><input type="text" id="modalFonte" placeholder="Wikipedia, site oficial..."></div>
            </div>
            <div class="modal-footer"><button class="btn-primary" onclick="salvarPergunta()">üíæ Salvar</button><button class="btn-cancel" onclick="fecharModal()">Cancelar</button></div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        // ===== FIREBASE =====
        firebase.initializeApp({
            apiKey: "AIzaSyC5ZrkEy7KuCFJOtPvI7-P-JcA0MF4im5c", authDomain: "painel-yellup.firebaseapp.com",
            projectId: "painel-yellup", storageBucket: "painel-yellup.appspot.com",
            messagingSenderId: "608347210297", appId: "1:608347210297:web:75092713724e617c7203e8"
        });
        const db = firebase.firestore(), auth = firebase.auth();

        let todasPerguntas=[], times=[], campeonatos=[], timesMap={}, campsMap={};
        let pergPorTime={}, pergPorCamp={};
        let filtroTimeId='', filtroCampId='', pergFiltradas=[], pagTodas=1;
        let detalheAtual={tipo:'',id:'',nome:''}, pergDetalhe=[], pergDetFilt=[], pagDet=1;
        const PP = 15;

        auth.onAuthStateChanged(u => {
            if (!u || u.email !== 'admin@yellup.com') { window.location.href = 'login.html'; return; }
            carregarDados();
            setupDropdowns();
        });
        function sair() { auth.signOut().then(() => window.location.href = 'login.html'); }
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); document.getElementById('overlay').classList.toggle('open'); }

        // ===== LOAD =====
        async function carregarDados() {
            try {
                const [sT, sC, sP] = await Promise.all([
                    db.collection('times').orderBy('nome').get(),
                    db.collection('campeonatos').orderBy('nome').get(),
                    db.collection('perguntas').get()
                ]);
                times=[]; timesMap={}; campeonatos=[]; campsMap={};
                sT.forEach(d => { const t={id:d.id,...d.data()}; times.push(t); timesMap[d.id]=t; });
                sC.forEach(d => { const c={id:d.id,...d.data()}; campeonatos.push(c); campsMap[d.id]=c; });

                todasPerguntas=[]; pergPorTime={}; pergPorCamp={};
                let f=0,m=0,di=0;
                sP.forEach(d => {
                    const p={docId:d.id,...d.data()}; todasPerguntas.push(p);
                    const pts=p.pontuacao||5;
                    if(pts<=4) f++; else if(pts<=6) m++; else di++;
                    if(p.timeId){ if(!pergPorTime[p.timeId]) pergPorTime[p.timeId]=[]; pergPorTime[p.timeId].push(p); }
                    if(p.campeonatoId){ if(!pergPorCamp[p.campeonatoId]) pergPorCamp[p.campeonatoId]=[]; pergPorCamp[p.campeonatoId].push(p); }
                });

                // Modal selects
                document.getElementById('modalTime').innerHTML = '<option value="">Selecione...</option>' + times.map(t=>`<option value="${t.id}">${esc(t.nome)}</option>`).join('');
                document.getElementById('modalCamp').innerHTML = '<option value="">Selecione...</option>' + campeonatos.map(c=>`<option value="${c.id}">${esc(c.nome)}</option>`).join('');

                const tCP = Object.keys(pergPorTime).length, cCP = Object.keys(pergPorCamp).length;
                const total = tCP + cCP, media = total > 0 ? Math.round(todasPerguntas.length / total) : 0;
                document.getElementById('statTotal').textContent = todasPerguntas.length;
                document.getElementById('statTimes').textContent = tCP;
                document.getElementById('statCamps').textContent = cCP;
                document.getElementById('statMedia').textContent = media;
                document.getElementById('statFacil').textContent = f;
                document.getElementById('statMedio').textContent = m;
                document.getElementById('statDificil').textContent = di;
                document.getElementById('cntTimes').textContent = tCP;
                document.getElementById('cntCamps').textContent = cCP;
                document.getElementById('cntTotal').textContent = todasPerguntas.length;

                renderDashboard();
                renderTimesGrid();
                renderCampsGrid();
                pergFiltradas = [...todasPerguntas];
                renderTodas();
            } catch(e) { showToast('‚ùå '+e.message); console.error(e); }
        }

        // ===== NAVIGATION =====
        function showView(v) {
            document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
            document.getElementById('view-'+v).classList.add('active');
            const tab = document.querySelector(`.tab[data-view="${v}"]`);
            if(tab) tab.classList.add('active');
            document.getElementById('backBtn').style.display = v==='detalhe' ? 'inline' : 'none';
            document.getElementById('tabsBar').style.display = v==='detalhe' ? 'none' : 'flex';
            document.getElementById('topTitle').textContent = v==='detalhe' ? detalheAtual.nome : '‚ùì Perguntas';
        }

        function voltarLista() { showView(detalheAtual.tipo === 'time' ? 'times' : 'campeonatos'); }

        // ===== DASHBOARD =====
        function calcStats(pergs) { let f=0,m=0,d=0; pergs.forEach(p=>{const pt=p.pontuacao||5; if(pt<=4)f++;else if(pt<=6)m++;else d++;}); return {f,m,d}; }

        function cardHtml(ent, tipo, total, s) {
            return `<div class="entity-card" onclick="abrirDetalhe('${tipo}','${ent.id}')">
                <div class="ec-head"><div class="ec-icon ${tipo}">${tipo==='time'?'‚öΩ':'üèÜ'}</div><div class="ec-name">${esc(ent.nome)}</div></div>
                <div class="ec-stats">
                    <div class="ec-stat"><div class="v">${total}</div><div class="l">Total</div></div>
                    <div class="ec-stat"><div class="v" style="color:var(--green)">${s.f}</div><div class="l">F√°cil</div></div>
                    <div class="ec-stat"><div class="v" style="color:var(--orange)">${s.m}</div><div class="l">M√©dia</div></div>
                    <div class="ec-stat"><div class="v" style="color:var(--red)">${s.d}</div><div class="l">Dif√≠cil</div></div>
                </div></div>`;
        }

        function renderDashboard() {
            const topT = times.filter(t=>pergPorTime[t.id]?.length).sort((a,b)=>(pergPorTime[b.id]||[]).length-(pergPorTime[a.id]||[]).length).slice(0,6);
            document.getElementById('topTimes').innerHTML = topT.map(t=>{const p=pergPorTime[t.id]||[];return cardHtml(t,'time',p.length,calcStats(p));}).join('') || '<div class="empty-state">Nenhum time com perguntas</div>';
            const topC = campeonatos.filter(c=>pergPorCamp[c.id]?.length).sort((a,b)=>(pergPorCamp[b.id]||[]).length-(pergPorCamp[a.id]||[]).length).slice(0,6);
            document.getElementById('topCamps').innerHTML = topC.map(c=>{const p=pergPorCamp[c.id]||[];return cardHtml(c,'camp',p.length,calcStats(p));}).join('') || '<div class="empty-state">Nenhum campeonato</div>';
        }

        // ===== TIMES / CAMPS GRID =====
        function renderTimesGrid() {
            const b = (document.getElementById('buscaTime').value||'').toLowerCase();
            const list = times.filter(t=>pergPorTime[t.id]?.length && (!b||t.nome.toLowerCase().includes(b))).sort((a,b_)=>(pergPorTime[b_.id]||[]).length-(pergPorTime[a.id]||[]).length);
            document.getElementById('timesGrid').innerHTML = list.map(t=>{const p=pergPorTime[t.id]||[];return cardHtml(t,'time',p.length,calcStats(p));}).join('') || '<div class="empty-state">Nenhum time encontrado</div>';
        }
        function renderCampsGrid() {
            const b = (document.getElementById('buscaCamp').value||'').toLowerCase();
            const list = campeonatos.filter(c=>pergPorCamp[c.id]?.length && (!b||c.nome.toLowerCase().includes(b))).sort((a,b_)=>(pergPorCamp[b_.id]||[]).length-(pergPorCamp[a.id]||[]).length);
            document.getElementById('campsGrid').innerHTML = list.map(c=>{const p=pergPorCamp[c.id]||[];return cardHtml(c,'camp',p.length,calcStats(p));}).join('') || '<div class="empty-state">Nenhum campeonato</div>';
        }

        // ===== DETALHE =====
        function abrirDetalhe(tipo, id) {
            const ent = tipo==='time' ? timesMap[id] : campsMap[id];
            if(!ent) return;
            detalheAtual = {tipo, id, nome: ent.nome};
            pergDetalhe = tipo==='time' ? (pergPorTime[id]||[]) : (pergPorCamp[id]||[]);
            pergDetFilt = [...pergDetalhe];
            pagDet = 1;
            const s = calcStats(pergDetalhe);
            document.getElementById('detalheBanner').innerHTML = `
                <div class="detail-icon ${tipo==='time'?'ec-icon time':'ec-icon camp'}" style="width:56px;height:56px;font-size:28px">${tipo==='time'?'‚öΩ':'üèÜ'}</div>
                <div class="detail-info"><h3>${esc(ent.nome)}</h3><p>${tipo==='time'?'Time':'Campeonato'} ¬∑ ${ent.pais||''}</p></div>
                <div class="detail-nums">
                    <div class="detail-num"><div class="v">${pergDetalhe.length}</div><div class="l">Total</div></div>
                    <div class="detail-num"><div class="v" style="color:var(--green)">${s.f}</div><div class="l">F√°cil</div></div>
                    <div class="detail-num"><div class="v" style="color:var(--orange)">${s.m}</div><div class="l">M√©dia</div></div>
                    <div class="detail-num"><div class="v" style="color:var(--red)">${s.d}</div><div class="l">Dif√≠cil</div></div>
                </div>`;
            document.getElementById('buscaDetalhe').value = '';
            document.getElementById('filtroDetalhe').value = '';
            renderDetalhe();
            showView('detalhe');
        }

        function filtrarDetalhe() {
            const b = (document.getElementById('buscaDetalhe').value||'').toLowerCase();
            const pts = document.getElementById('filtroDetalhe').value;
            pergDetFilt = pergDetalhe.filter(p => {
                if(b && !(p.pergunta||'').toLowerCase().includes(b)) return false;
                return ptsFilter(p, pts);
            });
            pagDet = 1; renderDetalhe();
        }

        function renderDetalhe() {
            const ini = (pagDet-1)*PP, list = pergDetFilt.slice(ini, ini+PP);
            const tb = document.getElementById('tbDetalhe');
            tb.innerHTML = list.length ? list.map(p => linhaHtml(p, false)).join('') : '<tr><td colspan="5" class="empty-state">Nenhuma pergunta</td></tr>';
            pgUpdate('Det', pagDet, pergDetFilt.length);
        }
        function pgDet(d) { pagDet+=d; renderDetalhe(); }

        function novaParaEntidade() {
            abrirModalNova();
            if(detalheAtual.tipo==='time'){ document.getElementById('modalTipo').value='time'; document.getElementById('modalTime').value=detalheAtual.id; }
            else { document.getElementById('modalTipo').value='campeonato'; document.getElementById('modalCamp').value=detalheAtual.id; }
            toggleTipo();
        }

        // ===== TODAS =====
        function setupDropdowns() {
            const iT=document.getElementById('filtroTimeInput'), dT=document.getElementById('dropTime');
            const iC=document.getElementById('filtroCampInput'), dC=document.getElementById('dropCamp');
            iT.onfocus=iT.oninput=()=>showDrop('time');
            iC.onfocus=iC.oninput=()=>showDrop('camp');
            document.addEventListener('click', e => { if(!e.target.closest('.ss')){ dT.classList.remove('show'); dC.classList.remove('show'); }});
        }

        function showDrop(tipo) {
            const inp = document.getElementById(tipo==='time'?'filtroTimeInput':'filtroCampInput');
            const drop = document.getElementById(tipo==='time'?'dropTime':'dropCamp');
            const list = tipo==='time' ? times : campeonatos;
            const b = (inp.value||'').toLowerCase();
            const f = list.filter(x=>x.nome.toLowerCase().includes(b));
            let h = `<div class="ss-info">${f.length} resultados</div>`;
            h += `<div class="ss-item" onclick="selFiltro('${tipo}','','')">üìã Todos</div>`;
            f.slice(0,30).forEach(x => {
                const q = tipo==='time' ? (pergPorTime[x.id]||[]).length : (pergPorCamp[x.id]||[]).length;
                h += `<div class="ss-item" onclick="selFiltro('${tipo}','${x.id}','${esc(x.nome)}')">${tipo==='time'?'‚öΩ':'üèÜ'} ${esc(x.nome)} <span class="ss-cnt">(${q})</span></div>`;
            });
            drop.innerHTML = h; drop.classList.add('show');
        }

        function selFiltro(tipo, id, nome) {
            if(tipo==='time'){ filtroTimeId=id; document.getElementById('filtroTimeInput').value=nome; document.getElementById('dropTime').classList.remove('show'); }
            else { filtroCampId=id; document.getElementById('filtroCampInput').value=nome; document.getElementById('dropCamp').classList.remove('show'); }
            filtrarTodas();
        }

        function filtrarTodas() {
            const b = (document.getElementById('buscaTodas').value||'').toLowerCase();
            const pts = document.getElementById('filtroPontuacao').value;
            pergFiltradas = todasPerguntas.filter(p => {
                if(b && !(p.pergunta||'').toLowerCase().includes(b)) return false;
                if(filtroTimeId && p.timeId !== filtroTimeId) return false;
                if(filtroCampId && p.campeonatoId !== filtroCampId) return false;
                return ptsFilter(p, pts);
            });
            pagTodas = 1; renderTodas();
        }

        function limparFiltros() {
            document.getElementById('buscaTodas').value=''; document.getElementById('filtroTimeInput').value='';
            document.getElementById('filtroCampInput').value=''; document.getElementById('filtroPontuacao').value='';
            filtroTimeId=''; filtroCampId=''; pergFiltradas=[...todasPerguntas]; pagTodas=1; renderTodas();
        }

        function renderTodas() {
            const ini=(pagTodas-1)*PP, list=pergFiltradas.slice(ini,ini+PP);
            const tb = document.getElementById('tbTodas');
            tb.innerHTML = list.length ? list.map(p=>linhaHtml(p,true)).join('') : '<tr><td colspan="6" class="empty-state">Nenhuma pergunta</td></tr>';
            pgUpdate('All', pagTodas, pergFiltradas.length);
        }
        function pgAll(d) { pagTodas+=d; renderTodas(); }

        // ===== SHARED HELPERS =====
        function ptsFilter(p, pts) {
            if(!pts) return true;
            const pt = p.pontuacao||5;
            if(pts==='facil' && pt>4) return false;
            if(pts==='medio' && (pt<5||pt>6)) return false;
            if(pts==='dificil' && pt<7) return false;
            return true;
        }

        function pgUpdate(prefix, page, total) {
            const tp = Math.ceil(total/PP)||1;
            document.getElementById(`pg${prefix}Info`).textContent = `P√°gina ${page} de ${tp} ¬∑ ${total} perguntas`;
            document.getElementById(`pg${prefix}Prev`).disabled = page<=1;
            document.getElementById(`pg${prefix}Next`).disabled = page>=tp;
        }

        function linhaHtml(p, showEnt) {
            const cor = p.correta||'A', alt = p.alternativas||{};
            const altH = ['A','B','C','D'].map(l => {
                const t = (alt[l]||'-').substring(0,22) + ((alt[l]||'').length>22?'‚Ä¶':'');
                return `<div class="${l===cor?'alt-ok':'alt-no'}">${l}) ${esc(t)}${l===cor?' ‚úì':''}</div>`;
            }).join('');
            const pts = p.pontuacao||5;
            const pc = pts<=4?'pts-easy':pts<=6?'pts-med':'pts-hard';
            let entH = '';
            if(showEnt) {
                if(p.campeonatoId && campsMap[p.campeonatoId]) entH=`<span class="entity-tag camp">üèÜ ${esc(campsMap[p.campeonatoId].nome)}</span>`;
                else if(p.timeId && timesMap[p.timeId]) entH=`<span class="entity-tag time">‚öΩ ${esc(timesMap[p.timeId].nome)}</span>`;
                else if(p.campeonatoNome) entH=`<span class="entity-tag camp">üèÜ ${esc(p.campeonatoNome)}</span>`;
                else if(p.timeNome) entH=`<span class="entity-tag time">‚öΩ ${esc(p.timeNome)}</span>`;
            }
            return `<tr>
                <td><span class="id-mono" title="${p.id||p.docId}">${(p.id||p.docId.substring(0,10))}</span></td>
                <td class="q-text">${esc((p.pergunta||'').substring(0,80))}${(p.pergunta||'').length>80?'‚Ä¶':''}</td>
                <td><div class="alt-list">${altH}</div></td>
                ${showEnt?'<td>'+entH+'</td>':''}
                <td><span class="pts-badge ${pc}">${pts}</span></td>
                <td><div class="actions">
                    <button class="btn-icon" onclick="editarPergunta('${p.docId}')" title="Editar">‚úèÔ∏è</button>
                    <button class="btn-icon danger" onclick="excluirPergunta('${p.docId}')" title="Excluir">üóëÔ∏è</button>
                </div></td></tr>`;
        }

        function esc(t) { const d=document.createElement('div'); d.textContent=t; return d.innerHTML; }

        // ===== MODAL =====
        function abrirModalNova() {
            document.getElementById('modalTitulo').textContent='Nova Pergunta';
            document.getElementById('modalDocId').value='';
            document.getElementById('modalId').value='';
            document.getElementById('modalPergunta').value='';
            document.getElementById('mAltA').value=''; document.getElementById('mAltB').value='';
            document.getElementById('mAltC').value=''; document.getElementById('mAltD').value='';
            document.querySelector('input[name="mCorreta"][value="A"]').checked=true;
            document.getElementById('modalTipo').value='time';
            document.getElementById('modalPts').value='5';
            document.getElementById('modalTime').value='';
            document.getElementById('modalCamp').value='';
            document.getElementById('modalFonte').value='';
            toggleTipo();
            document.getElementById('modalOverlay').classList.add('active');
        }

        function fecharModal() { document.getElementById('modalOverlay').classList.remove('active'); }

        function toggleTipo() {
            const t = document.getElementById('modalTipo').value;
            document.getElementById('grpTime').style.display = t==='time'?'block':'none';
            document.getElementById('grpCamp').style.display = t==='campeonato'?'block':'none';
        }

        function editarPergunta(docId) {
            const p = todasPerguntas.find(x=>x.docId===docId);
            if(!p) return;
            document.getElementById('modalTitulo').textContent='Editar Pergunta';
            document.getElementById('modalDocId').value=docId;
            document.getElementById('modalId').value=p.id||'';
            document.getElementById('modalPergunta').value=p.pergunta||'';
            document.getElementById('mAltA').value=(p.alternativas||{}).A||'';
            document.getElementById('mAltB').value=(p.alternativas||{}).B||'';
            document.getElementById('mAltC').value=(p.alternativas||{}).C||'';
            document.getElementById('mAltD').value=(p.alternativas||{}).D||'';
            const r = document.querySelector(`input[name="mCorreta"][value="${p.correta||'A'}"]`);
            if(r) r.checked=true;
            document.getElementById('modalTipo').value = p.campeonatoId ? 'campeonato' : 'time';
            document.getElementById('modalPts').value = p.pontuacao||5;
            document.getElementById('modalTime').value = p.timeId||'';
            document.getElementById('modalCamp').value = p.campeonatoId||'';
            document.getElementById('modalFonte').value = p.fonte||'';
            toggleTipo();
            document.getElementById('modalOverlay').classList.add('active');
        }

        async function salvarPergunta() {
            const docId = document.getElementById('modalDocId').value;
            const correta = document.querySelector('input[name="mCorreta"]:checked');
            const dados = {
                id: document.getElementById('modalId').value.trim(),
                pergunta: document.getElementById('modalPergunta').value.trim(),
                alternativas: { A: document.getElementById('mAltA').value.trim(), B: document.getElementById('mAltB').value.trim(), C: document.getElementById('mAltC').value.trim(), D: document.getElementById('mAltD').value.trim() },
                correta: correta ? correta.value : 'A',
                pontuacao: parseInt(document.getElementById('modalPts').value)||5,
                fonte: document.getElementById('modalFonte').value.trim()
            };
            if(!dados.pergunta) { showToast('‚ö†Ô∏è Preencha a pergunta!'); return; }
            const tipo = document.getElementById('modalTipo').value;
            if(tipo==='time'){ dados.timeId=document.getElementById('modalTime').value; dados.timeNome=dados.timeId&&timesMap[dados.timeId]?timesMap[dados.timeId].nome:''; dados.campeonatoId=''; dados.campeonatoNome=''; }
            else { dados.campeonatoId=document.getElementById('modalCamp').value; dados.campeonatoNome=dados.campeonatoId&&campsMap[dados.campeonatoId]?campsMap[dados.campeonatoId].nome:''; dados.timeId=''; dados.timeNome=''; }
            try {
                if(docId) { await db.collection('perguntas').doc(docId).update(dados); showToast('‚úÖ Atualizada!'); }
                else { dados.criadoEm=firebase.firestore.FieldValue.serverTimestamp(); await db.collection('perguntas').add(dados); showToast('‚úÖ Criada!'); }
                fecharModal(); carregarDados();
            } catch(e) { showToast('‚ùå '+e.message); }
        }

        async function excluirPergunta(docId) {
            if(!confirm('Excluir esta pergunta?')) return;
            try { await db.collection('perguntas').doc(docId).delete(); showToast('üóëÔ∏è Exclu√≠da!'); carregarDados(); }
            catch(e) { showToast('‚ùå '+e.message); }
        }

        // ===== EXPORT =====
        function exportarJSON() {
            const d = pergFiltradas.map(p=>({id:p.id||'',pergunta:p.pergunta,alternativas:p.alternativas,correta:p.correta,pontuacao:p.pontuacao,timeId:p.timeId||'',timeNome:p.timeNome||'',campeonatoId:p.campeonatoId||'',campeonatoNome:p.campeonatoNome||'',fonte:p.fonte||''}));
            const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([JSON.stringify(d,null,2)],{type:'application/json'}));
            a.download=`perguntas-${new Date().toISOString().slice(0,10)}.json`; a.click();
            showToast(`üì• ${d.length} perguntas exportadas!`);
        }

        function exportarExcel() {
            const d = pergFiltradas.map(p=>({ID:p.id||p.docId,Pergunta:p.pergunta,A:(p.alternativas||{}).A,B:(p.alternativas||{}).B,C:(p.alternativas||{}).C,D:(p.alternativas||{}).D,Correta:p.correta,Pontos:p.pontuacao,Time:p.timeNome||'',Campeonato:p.campeonatoNome||'',Fonte:p.fonte||''}));
            const ws=XLSX.utils.json_to_sheet(d), wb=XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb,ws,'Perguntas');
            XLSX.writeFile(wb,`perguntas-${new Date().toISOString().slice(0,10)}.xlsx`);
            showToast(`üìä ${d.length} perguntas exportadas!`);
        }

        // ===== TOAST =====
        function showToast(m) { const t=document.getElementById('toast'); t.textContent=m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),3000); }

        // ===== SHORTCUTS =====
        document.getElementById('modalOverlay').addEventListener('click', e => { if(e.target===e.currentTarget) fecharModal(); });
        document.addEventListener('keydown', e => { if(e.key==='Escape') fecharModal(); });
    </script>
</body>
</html>
