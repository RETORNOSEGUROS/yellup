<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yellup Admin</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --bg-primary: #0c0e14;
            --bg-secondary: #12141c;
            --bg-card: #181a24;
            --bg-card-hover: #1e2030;
            --bg-sidebar: #10121a;
            --border: #1e2030;
            --border-light: #282a3a;
            --text-primary: #e8e9ed;
            --text-secondary: #8b8d9a;
            --text-muted: #5c5e6e;
            --accent: #f0b429;
            --accent-dim: rgba(240, 180, 41, 0.12);
            --green: #34d399;
            --green-dim: rgba(52, 211, 153, 0.12);
            --red: #f87171;
            --red-dim: rgba(248, 113, 113, 0.12);
            --blue: #60a5fa;
            --blue-dim: rgba(96, 165, 250, 0.12);
            --purple: #a78bfa;
            --purple-dim: rgba(167, 139, 250, 0.12);
            --orange: #fb923c;
            --orange-dim: rgba(251, 146, 60, 0.12);
            --pink: #f472b6;
            --pink-dim: rgba(244, 114, 182, 0.12);
            --sidebar-w: 250px;
            --header-h: 64px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'DM Sans', -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ================================
           SIDEBAR
        ================================ */
        .sidebar {
            position: fixed;
            left: 0; top: 0;
            width: var(--sidebar-w);
            height: 100vh;
            background: var(--bg-sidebar);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            z-index: 100;
            transition: transform 0.3s ease;
        }

        .sidebar-brand {
            height: var(--header-h);
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 0 20px;
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }

        .sidebar-brand .logo {
            width: 32px; height: 32px;
            background: var(--accent);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 700;
            color: #000;
        }

        .sidebar-brand h1 {
            font-size: 17px;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -0.3px;
        }

        .sidebar-brand h1 span {
            color: var(--text-muted);
            font-weight: 500;
            font-size: 12px;
            margin-left: 6px;
        }

        .sidebar-nav {
            flex: 1;
            overflow-y: auto;
            padding: 12px 0;
        }

        .sidebar-nav::-webkit-scrollbar { width: 0; }

        .nav-group { margin-bottom: 8px; }

        .nav-group-title {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            color: var(--text-muted);
            padding: 12px 20px 6px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 16px;
            margin: 1px 8px;
            border-radius: 8px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.15s ease;
            cursor: pointer;
        }

        .nav-item:hover {
            background: var(--bg-card);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: var(--accent-dim);
            color: var(--accent);
        }

        .nav-item .icon {
            width: 20px;
            text-align: center;
            font-size: 14px;
            flex-shrink: 0;
        }

        .nav-item .badge {
            margin-left: auto;
            background: var(--red);
            color: #fff;
            font-size: 10px;
            font-weight: 600;
            padding: 1px 7px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }

        .sidebar-footer {
            padding: 12px 16px;
            border-top: 1px solid var(--border);
            flex-shrink: 0;
        }

        .sidebar-footer .admin-box {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.15s;
        }

        .sidebar-footer .admin-box:hover { background: var(--bg-card); }

        .admin-avatar {
            width: 32px; height: 32px;
            background: linear-gradient(135deg, var(--accent), #e09800);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 13px;
            color: #000;
        }

        .admin-info-text { flex: 1; }
        .admin-info-text .name { font-size: 13px; font-weight: 600; color: var(--text-primary); }
        .admin-info-text .role { font-size: 11px; color: var(--text-muted); }

        .btn-logout {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 16px;
            padding: 4px;
            border-radius: 6px;
            transition: all 0.15s;
        }

        .btn-logout:hover { color: var(--red); background: var(--red-dim); }

        /* ================================
           MAIN CONTENT
        ================================ */
        .main {
            margin-left: var(--sidebar-w);
            min-height: 100vh;
        }

        .header {
            height: var(--header-h);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 32px;
            background: var(--bg-primary);
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .header-left h2 {
            font-size: 16px;
            font-weight: 600;
            letter-spacing: -0.3px;
        }

        .header-left p {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 1px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-header {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 7px 14px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.15s;
            text-decoration: none;
        }

        .btn-header:hover { border-color: var(--border-light); background: var(--bg-card-hover); }

        .btn-header.primary {
            background: var(--accent);
            color: #000;
            border-color: var(--accent);
            font-weight: 600;
        }

        .btn-header.primary:hover { opacity: 0.9; }

        .content { padding: 24px 32px 40px; }

        /* ================================
           STAT CARDS
        ================================ */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            transition: border-color 0.2s;
        }

        .stat-card:hover { border-color: var(--border-light); }

        .stat-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .stat-icon-box {
            width: 38px; height: 38px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .stat-icon-box.blue { background: var(--blue-dim); }
        .stat-icon-box.green { background: var(--green-dim); }
        .stat-icon-box.accent { background: var(--accent-dim); }
        .stat-icon-box.red { background: var(--red-dim); }
        .stat-icon-box.purple { background: var(--purple-dim); }
        .stat-icon-box.orange { background: var(--orange-dim); }
        .stat-icon-box.pink { background: var(--pink-dim); }

        .stat-trend {
            font-size: 11px;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 6px;
        }

        .stat-trend.up { color: var(--green); background: var(--green-dim); }
        .stat-trend.down { color: var(--red); background: var(--red-dim); }
        .stat-trend.neutral { color: var(--text-muted); background: var(--bg-card-hover); }

        .stat-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1;
            margin-bottom: 4px;
        }

        .stat-value .loading-dots::after {
            content: '...';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-muted);
            font-weight: 500;
        }

        /* ================================
           GRID LAYOUT
        ================================ */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }

        .grid-3-1 {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }

        /* ================================
           CARDS
        ================================ */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
        }

        .card-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-title .count {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            background: var(--bg-card-hover);
            color: var(--text-secondary);
            padding: 1px 8px;
            border-radius: 6px;
        }

        .card-link {
            font-size: 12px;
            color: var(--text-muted);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.15s;
        }

        .card-link:hover { color: var(--accent); }

        .card-body { padding: 0; }
        .card-body.padded { padding: 20px; }

        /* ================================
           LIST ITEMS
        ================================ */
        .list-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            border-bottom: 1px solid var(--border);
            transition: background 0.1s;
        }

        .list-item:last-child { border-bottom: none; }
        .list-item:hover { background: var(--bg-card-hover); }

        .list-avatar {
            width: 36px; height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .list-content { flex: 1; min-width: 0; }

        .list-content h4 {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .list-content p {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 1px;
        }

        .list-badge {
            font-size: 10px;
            font-weight: 600;
            padding: 3px 10px;
            border-radius: 6px;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .badge-online { color: var(--green); background: var(--green-dim); }
        .badge-live { color: var(--red); background: var(--red-dim); animation: pulse-badge 2s infinite; }
        .badge-pending { color: var(--orange); background: var(--orange-dim); }
        .badge-active { color: var(--blue); background: var(--blue-dim); }
        .badge-closed { color: var(--text-muted); background: var(--bg-card-hover); }

        @keyframes pulse-badge {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .empty-state {
            text-align: center;
            padding: 32px 20px;
            color: var(--text-muted);
            font-size: 13px;
        }

        .empty-state .empty-icon { font-size: 24px; margin-bottom: 8px; }

        /* ================================
           QUICK ACTIONS
        ================================ */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }

        .quick-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 14px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            text-decoration: none;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.15s;
        }

        .quick-btn:hover {
            border-color: var(--accent);
            background: var(--accent-dim);
            transform: translateY(-1px);
        }

        .quick-btn .qicon {
            width: 32px; height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        /* ================================
           CHART (CSS-only bars)
        ================================ */
        .chart-bars {
            display: flex;
            align-items: flex-end;
            gap: 8px;
            height: 140px;
            padding: 20px 20px 0;
        }

        .chart-col {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }

        .chart-bar {
            width: 100%;
            border-radius: 6px 6px 2px 2px;
            background: linear-gradient(180deg, var(--accent) 0%, rgba(240, 180, 41, 0.4) 100%);
            transition: height 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            min-height: 4px;
            position: relative;
        }

        .chart-bar:hover { opacity: 0.85; }

        .chart-bar .tooltip {
            position: absolute;
            top: -24px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-card-hover);
            color: var(--text-primary);
            font-size: 10px;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 4px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.15s;
            font-family: 'JetBrains Mono', monospace;
        }

        .chart-bar:hover .tooltip { opacity: 1; }

        .chart-labels {
            display: flex;
            gap: 8px;
            padding: 8px 20px 16px;
        }

        .chart-labels span {
            flex: 1;
            text-align: center;
            font-size: 10px;
            color: var(--text-muted);
            font-weight: 500;
        }

        /* ================================
           ACTIVITY TIMELINE
        ================================ */
        .activity-item {
            display: flex;
            gap: 12px;
            padding: 10px 20px;
            border-bottom: 1px solid var(--border);
            align-items: flex-start;
        }

        .activity-item:last-child { border-bottom: none; }

        .activity-dot {
            width: 8px; height: 8px;
            border-radius: 50%;
            margin-top: 5px;
            flex-shrink: 0;
        }

        .activity-text {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .activity-text strong { color: var(--text-primary); font-weight: 600; }

        .activity-time {
            font-size: 10px;
            color: var(--text-muted);
            margin-top: 2px;
        }

        /* ================================
           MOBILE TOGGLE
        ================================ */
        .mobile-toggle {
            display: none;
            position: fixed;
            top: 16px; left: 16px;
            z-index: 200;
            width: 40px; height: 40px;
            border-radius: 10px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
            font-size: 18px;
            cursor: pointer;
            align-items: center;
            justify-content: center;
        }

        .overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            z-index: 90;
        }

        /* ================================
           RESPONSIVE
        ================================ */
        @media (max-width: 1200px) {
            .stats-row { grid-template-columns: repeat(2, 1fr); }
            .quick-actions { grid-template-columns: repeat(3, 1fr); }
        }

        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.open { transform: translateX(0); }
            .overlay.open { display: block; }
            .mobile-toggle { display: flex; }
            .main { margin-left: 0; }
            .header { padding: 0 16px 0 64px; }
            .content { padding: 16px; }
            .stats-row { grid-template-columns: 1fr 1fr; }
            .grid-2, .grid-3-1 { grid-template-columns: 1fr; }
            .quick-actions { grid-template-columns: 1fr 1fr; }
            .stat-value { font-size: 22px; }
        }

        /* ================================
           LOADING SKELETON
        ================================ */
        .skeleton {
            background: linear-gradient(90deg, var(--bg-card-hover) 25%, var(--border) 50%, var(--bg-card-hover) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 6px;
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .skeleton-line { height: 14px; margin-bottom: 8px; }
        .skeleton-line.short { width: 60%; }
    </style>
</head>
<body>

    <!-- Mobile Toggle -->
    <button class="mobile-toggle" onclick="toggleSidebar()">‚ò∞</button>
    <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-brand">
            <div class="logo">Y</div>
            <h1>Yellup <span>Admin</span></h1>
        </div>

        <nav class="sidebar-nav">
            <div class="nav-group">
                <div class="nav-group-title">Vis√£o Geral</div>
                <a href="dashboard.html" class="nav-item active">
                    <span class="icon">üìä</span> Dashboard
                </a>
            </div>

            <div class="nav-group">
                <div class="nav-group-title">Conte√∫do</div>
                <a href="jogos.html" class="nav-item">
                    <span class="icon">üéÆ</span> Jogos
                </a>
                <a href="perguntas.html" class="nav-item">
                    <span class="icon">‚ùì</span> Perguntas
                </a>
                <a href="importar-perguntas.html" class="nav-item">
                    <span class="icon">üì•</span> Importar Perguntas
                </a>
                <a href="gerar-perguntas.html" class="nav-item">
                    <span class="icon">ü§ñ</span> Gerar com IA
                </a>
                <a href="times.html" class="nav-item">
                    <span class="icon">‚öΩ</span> Times
                </a>
            </div>

            <div class="nav-group">
                <div class="nav-group-title">Jogadores</div>
                <a href="usuarios.html" class="nav-item">
                    <span class="icon">üë•</span> Usu√°rios
                    <span class="badge" id="badgeUsuarios" style="display:none"></span>
                </a>
                <a href="ranking.html" class="nav-item">
                    <span class="icon">üèÜ</span> Rankings
                </a>
                <a href="admin-noticias.html" class="nav-item">
                    <span class="icon">üì∞</span> Not√≠cias
                </a>
            </div>

            <div class="nav-group">
                <div class="nav-group-title">Competi√ß√µes</div>
                <a href="torneios.html" class="nav-item">
                    <span class="icon">üèÖ</span> Torneios
                    <span class="badge" id="badgeTorneios" style="display:none"></span>
                </a>
                <a href="inicializar-pvp.html" class="nav-item">
                    <span class="icon">‚öîÔ∏è</span> Embates PvP
                </a>
            </div>

            <div class="nav-group">
                <div class="nav-group-title">Financeiro</div>
                <a href="financeiro.html" class="nav-item">
                    <span class="icon">üí∞</span> Resumo
                </a>
                <a href="creditar-manual.html" class="nav-item">
                    <span class="icon">‚ûï</span> Creditar Manual
                </a>
                <a href="transacoes.html" class="nav-item">
                    <span class="icon">üí≥</span> Transa√ß√µes
                </a>
                <a href="premiacao.html" class="nav-item">
                    <span class="icon">üéÅ</span> Premia√ß√£o
                </a>
                <a href="indicacoes.html" class="nav-item">
                    <span class="icon">üîó</span> Indica√ß√µes
                </a>
            </div>

            <div class="nav-group">
                <div class="nav-group-title">Bolsa</div>
                <a href="bolsa-admin.html" class="nav-item">
                    <span class="icon">üìà</span> Gest√£o da Bolsa
                </a>
            </div>

            <div class="nav-group">
                <div class="nav-group-title">Sistema</div>
                <a href="configuracoes.html" class="nav-item">
                    <span class="icon">‚öôÔ∏è</span> Configura√ß√µes
                </a>
                <a href="checkup.html" class="nav-item">
                    <span class="icon">üîç</span> Checkup
                </a>
                <a href="simulador_avancado.html" class="nav-item">
                    <span class="icon">üß™</span> Simulador
                </a>
                <a href="teste-regras.html" class="nav-item">
                    <span class="icon">üìú</span> Regras
                </a>
            </div>
        </nav>

        <div class="sidebar-footer">
            <div class="admin-box">
                <div class="admin-avatar">A</div>
                <div class="admin-info-text">
                    <div class="name" id="adminName">Admin</div>
                    <div class="role">Administrador</div>
                </div>
                <button class="btn-logout" onclick="sair()" title="Sair">‚èª</button>
            </div>
        </div>
    </aside>

    <!-- Main -->
    <div class="main">
        <header class="header">
            <div class="header-left">
                <h2>Dashboard</h2>
                <p id="headerDate"></p>
            </div>
            <div class="header-actions">
                <a href="jogos.html?action=novo" class="btn-header primary">Ôºã Novo Jogo</a>
                <button class="btn-header" onclick="location.reload()">‚Üª Atualizar</button>
            </div>
        </header>

        <div class="content">
            <!-- Stats Row 1 -->
            <div class="stats-row">
                <div class="stat-card">
                    <div class="stat-top">
                        <div class="stat-icon-box blue">üë•</div>
                        <span class="stat-trend neutral" id="trendUsuarios">‚Äî</span>
                    </div>
                    <div class="stat-value" id="statUsuarios"><span class="loading-dots"></span></div>
                    <div class="stat-label">Usu√°rios</div>
                </div>

                <div class="stat-card">
                    <div class="stat-top">
                        <div class="stat-icon-box green">‚óè</div>
                    </div>
                    <div class="stat-value" id="statOnline"><span class="loading-dots"></span></div>
                    <div class="stat-label">Online agora</div>
                </div>

                <div class="stat-card">
                    <div class="stat-top">
                        <div class="stat-icon-box accent">üí∞</div>
                    </div>
                    <div class="stat-value" id="statCreditos"><span class="loading-dots"></span></div>
                    <div class="stat-label">Cr√©ditos em circula√ß√£o</div>
                </div>

                <div class="stat-card">
                    <div class="stat-top">
                        <div class="stat-icon-box red">üî¥</div>
                    </div>
                    <div class="stat-value" id="statAoVivo"><span class="loading-dots"></span></div>
                    <div class="stat-label">Jogos ao vivo</div>
                </div>
            </div>

            <!-- Stats Row 2 -->
            <div class="stats-row">
                <div class="stat-card">
                    <div class="stat-top">
                        <div class="stat-icon-box purple">üèÖ</div>
                    </div>
                    <div class="stat-value" id="statTorneios"><span class="loading-dots"></span></div>
                    <div class="stat-label">Torneios ativos</div>
                </div>

                <div class="stat-card">
                    <div class="stat-top">
                        <div class="stat-icon-box orange">‚öîÔ∏è</div>
                    </div>
                    <div class="stat-value" id="statEmbates"><span class="loading-dots"></span></div>
                    <div class="stat-label">Embates pendentes</div>
                </div>

                <div class="stat-card">
                    <div class="stat-top">
                        <div class="stat-icon-box pink">üí¨</div>
                    </div>
                    <div class="stat-value" id="statMensagens"><span class="loading-dots"></span></div>
                    <div class="stat-label">Mensagens hoje</div>
                </div>

            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
                <a href="jogos.html?action=novo" class="quick-btn">
                    <div class="qicon" style="background:var(--blue-dim)">üéÆ</div>
                    Novo Jogo
                </a>
                <a href="torneios.html?action=novo" class="quick-btn">
                    <div class="qicon" style="background:var(--accent-dim)">üèÜ</div>
                    Criar Torneio
                </a>
                <a href="creditar-manual.html" class="quick-btn">
                    <div class="qicon" style="background:var(--green-dim)">üíé</div>
                    Creditar
                </a>
                <a href="perguntas.html?action=nova" class="quick-btn">
                    <div class="qicon" style="background:var(--purple-dim)">‚ùì</div>
                    Nova Pergunta
                </a>
                <a href="transacoes.html" class="quick-btn">
                    <div class="qicon" style="background:var(--red-dim)">üí≥</div>
                    Transa√ß√µes
                </a>
            </div>

            <!-- Main Grid -->
            <div class="grid-2">
                <!-- √öltimos Usu√°rios -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üë• √öltimos Usu√°rios <span class="count" id="countUsuarios">‚Äî</span></div>
                        <a href="usuarios.html" class="card-link">Ver todos ‚Üí</a>
                    </div>
                    <div class="card-body" id="listaUsuarios">
                        <div class="empty-state"><div class="skeleton skeleton-line"></div><div class="skeleton skeleton-line short"></div></div>
                    </div>
                </div>

                <!-- Jogos Recentes -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üéÆ Jogos Recentes <span class="count" id="countJogos">‚Äî</span></div>
                        <a href="jogos.html" class="card-link">Ver todos ‚Üí</a>
                    </div>
                    <div class="card-body" id="listaJogos">
                        <div class="empty-state"><div class="skeleton skeleton-line"></div><div class="skeleton skeleton-line short"></div></div>
                    </div>
                </div>
            </div>

            <div class="grid-2">
                <!-- Compras Recentes -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üõí Compras Recentes <span class="count" id="countCompras">‚Äî</span></div>
                        <a href="financeiro.html" class="card-link">Financeiro ‚Üí</a>
                    </div>
                    <div class="card-body" id="listaCompras">
                        <div class="empty-state"><div class="skeleton skeleton-line"></div><div class="skeleton skeleton-line short"></div></div>
                    </div>
                </div>

                <!-- Torneios -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üèÖ Torneios Ativos <span class="count" id="countTorneios">‚Äî</span></div>
                        <a href="torneios.html" class="card-link">Ver todos ‚Üí</a>
                    </div>
                    <div class="card-body" id="listaTorneios">
                        <div class="empty-state"><div class="skeleton skeleton-line"></div><div class="skeleton skeleton-line short"></div></div>
                    </div>
                </div>
            </div>

            <div class="grid-3-1">
                <!-- Gr√°fico Jogos por Dia -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üìà Jogos criados (√∫ltimos 7 dias)</div>
                    </div>
                    <div class="card-body">
                        <div class="chart-bars" id="chartBars"></div>
                        <div class="chart-labels" id="chartLabels"></div>
                    </div>
                </div>

                <!-- Atividade Recente -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">‚ö° Atividade</div>
                    </div>
                    <div class="card-body" id="listaAtividade">
                        <div class="empty-state"><div class="skeleton skeleton-line"></div><div class="skeleton skeleton-line short"></div></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===================================
        // üîß FIREBASE CONFIG
        // ===================================
        const firebaseConfig = {
            apiKey: "AIzaSyC5ZrkEy7KuCFJOtPvI7-P-JcA0MF4im5c",
            authDomain: "painel-yellup.firebaseapp.com",
            projectId: "painel-yellup",
            storageBucket: "painel-yellup.appspot.com",
            messagingSenderId: "608347210297",
            appId: "1:608347210297:web:75092713724e617c7203e8"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // ===================================
        // üîê AUTH
        // ===================================
        auth.onAuthStateChanged(user => {
            if (!user || user.email !== "admin@yellup.com") {
                window.location.href = "login.html";
                return;
            }
            document.getElementById('adminName').textContent = user.email.split('@')[0];
            carregarDashboard();
        });

        function sair() {
            auth.signOut().then(() => window.location.href = "login.html");
        }

        // ===================================
        // üìÖ HEADER DATE
        // ===================================
        const hoje = new Date();
        const diasSemana = ['Domingo', 'Segunda', 'Ter√ßa', 'Quarta', 'Quinta', 'Sexta', 'S√°bado'];
        const meses = ['jan', 'fev', 'mar', 'abr', 'mai', 'jun', 'jul', 'ago', 'set', 'out', 'nov', 'dez'];
        document.getElementById('headerDate').textContent =
            `${diasSemana[hoje.getDay()]}, ${hoje.getDate()} ${meses[hoje.getMonth()]} ${hoje.getFullYear()}`;

        // ===================================
        // üöÄ CARREGAR DASHBOARD
        // ===================================
        async function carregarDashboard() {
            // Tudo em paralelo
            await Promise.allSettled([
                carregarStats(),
                carregarUltimosUsuarios(),
                carregarJogosRecentes(),
                carregarComprasRecentes(),
                carregarTorneiosAtivos(),
                carregarGraficoJogos(),
                carregarAtividade()
            ]);
        }

        // ===================================
        // üìä STATS (otimizado)
        // ===================================
        async function carregarStats() {
            try {
                // Carregar usu√°rios (necess√°rio para contar cr√©ditos)
                const usuariosSnap = await db.collection('usuarios').get();
                const totalUsuarios = usuariosSnap.size;
                let totalCreditos = 0;
                let novosHoje = 0;
                const inicioHoje = new Date(); inicioHoje.setHours(0,0,0,0);

                usuariosSnap.forEach(doc => {
                    const d = doc.data();
                    totalCreditos += d.creditos || 0;
                    const dataCad = d.dataCadastro?.toDate ? d.dataCadastro.toDate() : null;
                    if (dataCad && dataCad >= inicioHoje) novosHoje++;
                });

                setStat('statUsuarios', totalUsuarios.toLocaleString('pt-BR'));
                setStat('statCreditos', formatNumber(totalCreditos));
                document.getElementById('countUsuarios').textContent = totalUsuarios;

                // Trend de novos usu√°rios hoje
                const trendEl = document.getElementById('trendUsuarios');
                if (novosHoje > 0) {
                    trendEl.className = 'stat-trend up';
                    trendEl.textContent = `+${novosHoje} hoje`;
                } else {
                    trendEl.textContent = '0 hoje';
                }

                // Online (√∫ltimos 5 min)
                const cincoMin = new Date(Date.now() - 5 * 60000);
                const onlineSnap = await db.collection('usuarios')
                    .where('ultimaAtividade', '>=', cincoMin).get();
                setStat('statOnline', onlineSnap.size);

                // Jogos ao vivo
                const aoVivoSnap = await db.collection('jogos')
                    .where('status', '==', 'ao_vivo').get();
                setStat('statAoVivo', aoVivoSnap.size);

                // Torneios ativos
                const torneiosSnap = await db.collection('torneios')
                    .where('status', 'in', ['aberto', 'em_andamento']).get();
                setStat('statTorneios', torneiosSnap.size);
                showBadge('badgeTorneios', torneiosSnap.size);

                // Embates pendentes
                const embatesSnap = await db.collection('embates')
                    .where('status', '==', 'pendente').get();
                setStat('statEmbates', embatesSnap.size);

                // Mensagens hoje
                try {
                    const chatSnap = await db.collection('chat')
                        .where('data', '>=', inicioHoje).get();
                    setStat('statMensagens', chatSnap.size);
                } catch (e) {
                    setStat('statMensagens', '‚Äî');
                }

            } catch (error) {
                console.error('Erro stats:', error);
            }
        }

        // ===================================
        // üë• √öLTIMOS USU√ÅRIOS
        // ===================================
        async function carregarUltimosUsuarios() {
            const el = document.getElementById('listaUsuarios');
            try {
                const snap = await db.collection('usuarios')
                    .orderBy('dataCadastro', 'desc')
                    .limit(5).get();

                if (snap.empty) { el.innerHTML = emptyHTML('Nenhum usu√°rio'); return; }

                const cincoMinMs = Date.now() - 5 * 60000;
                let html = '';
                snap.forEach(doc => {
                    const u = doc.data();
                    const ini = (u.nome || u.usuarioUnico || 'U')[0].toUpperCase();
                    const online = u.ultimaAtividade &&
                        (u.ultimaAtividade.toMillis ? u.ultimaAtividade.toMillis() : new Date(u.ultimaAtividade).getTime()) > cincoMinMs;
                    const nivel = calcNivel(u.xp || 0);
                    const cred = (u.creditos || 0).toLocaleString('pt-BR');

                    html += `
                        <div class="list-item">
                            <div class="list-avatar" style="background:var(--blue-dim);color:var(--blue)">${ini}</div>
                            <div class="list-content">
                                <h4>${u.nome || u.usuarioUnico || 'Sem nome'}</h4>
                                <p>@${u.usuarioUnico || '‚Äî'} ¬∑ ${nivel} ¬∑ ${cred} cr</p>
                            </div>
                            ${online ? '<span class="list-badge badge-online">Online</span>' : ''}
                        </div>`;
                });
                el.innerHTML = html;
            } catch (e) {
                console.error('Erro usu√°rios:', e);
                el.innerHTML = emptyHTML('Erro ao carregar');
            }
        }

        // ===================================
        // üéÆ JOGOS RECENTES
        // ===================================
        async function carregarJogosRecentes() {
            const el = document.getElementById('listaJogos');
            try {
                const snap = await db.collection('jogos')
                    .orderBy('dataCriacao', 'desc')
                    .limit(5).get();

                if (snap.empty) { el.innerHTML = emptyHTML('Nenhum jogo'); return; }
                document.getElementById('countJogos').textContent = snap.size + '+';

                let html = '';
                for (const doc of snap.docs) {
                    const j = doc.data();
                    const status = j.status || 'agendado';
                    const badgeClass = status === 'ao_vivo' ? 'badge-live' :
                                       status === 'finalizado' || status === 'encerrado' ? 'badge-closed' :
                                       'badge-active';
                    const statusLabel = status === 'ao_vivo' ? 'üî¥ AO VIVO' :
                                        status === 'finalizado' || status === 'encerrado' ? 'Encerrado' :
                                        status === 'agendado' ? 'Agendado' : status;

                    // Nomes dos times
                    let nomes = 'Jogo';
                    if (j.timeCasaNome && j.timeForaNome) {
                        nomes = `${j.timeCasaNome} vs ${j.timeForaNome}`;
                    } else if (j.timeCasaId) {
                        try {
                            const [tc, tf] = await Promise.all([
                                db.collection('times').doc(j.timeCasaId).get(),
                                j.timeForaId ? db.collection('times').doc(j.timeForaId).get() : null
                            ]);
                            nomes = `${tc.exists ? tc.data().nome : '?'} vs ${tf?.exists ? tf.data().nome : '?'}`;
                        } catch (e) { nomes = 'Jogo #' + doc.id.slice(0, 6); }
                    }

                    const data = j.dataCriacao?.toDate ? j.dataCriacao.toDate().toLocaleDateString('pt-BR') : '';
                    const participantes = j.participantes || j.totalParticipantes || 0;

                    html += `
                        <div class="list-item">
                            <div class="list-avatar" style="background:${status === 'ao_vivo' ? 'var(--red-dim);color:var(--red)' : 'var(--accent-dim);color:var(--accent)'}">‚öΩ</div>
                            <div class="list-content">
                                <h4>${nomes}</h4>
                                <p>${participantes} jogadores ¬∑ ${data}</p>
                            </div>
                            <span class="list-badge ${badgeClass}">${statusLabel}</span>
                        </div>`;
                }
                el.innerHTML = html;
            } catch (e) {
                console.error('Erro jogos:', e);
                el.innerHTML = emptyHTML('Erro ao carregar');
            }
        }

        // ===================================
        // üõí COMPRAS RECENTES
        // ===================================
        async function carregarComprasRecentes() {
            const el = document.getElementById('listaCompras');
            try {
                const snap = await db.collection('compras')
                    .orderBy('data', 'desc')
                    .limit(5).get();

                if (snap.empty) {
                    el.innerHTML = emptyHTML('Nenhuma compra');
                    document.getElementById('countCompras').textContent = '0';
                    return;
                }
                document.getElementById('countCompras').textContent = snap.size;

                let html = '';
                snap.forEach(doc => {
                    const c = doc.data();
                    const data = c.data?.toDate ? c.data.toDate().toLocaleDateString('pt-BR') : '‚Äî';
                    const sClass = c.status === 'aprovado' ? 'badge-live' : 'badge-pending';
                    const sText = c.status === 'aprovado' ? '‚úì' : '‚è≥';

                    html += `
                        <div class="list-item">
                            <div class="list-avatar" style="background:var(--green-dim);color:var(--green)">üõí</div>
                            <div class="list-content">
                                <h4>${c.userName || c.userEmail || 'Usu√°rio'}</h4>
                                <p>${c.creditos || 0} cr ‚Äî R$ ${(c.valor || 0).toFixed(2)}</p>
                            </div>
                            <span class="list-badge ${sClass}">${sText} ${data}</span>
                        </div>`;
                });
                el.innerHTML = html;
            } catch (e) {
                console.error('Erro compras:', e);
                el.innerHTML = emptyHTML('Erro ao carregar');
            }
        }

        // ===================================
        // üèÖ TORNEIOS ATIVOS
        // ===================================
        async function carregarTorneiosAtivos() {
            const el = document.getElementById('listaTorneios');
            try {
                const snap = await db.collection('torneios')
                    .where('status', 'in', ['aberto', 'em_andamento'])
                    .limit(5).get();

                if (snap.empty) {
                    el.innerHTML = emptyHTML('Nenhum torneio ativo');
                    document.getElementById('countTorneios').textContent = '0';
                    return;
                }
                document.getElementById('countTorneios').textContent = snap.size;

                const icons = { diario: 'üìÖ', semanal: 'üìÜ', mensal: 'üóìÔ∏è', relampago: '‚ö°', especial: 'üåü' };
                let html = '';
                snap.forEach(doc => {
                    const t = doc.data();
                    const icon = icons[t.tipo] || 'üèÜ';
                    const badge = t.status === 'aberto' ? 'badge-active' : 'badge-live';
                    const label = t.status === 'aberto' ? 'Inscri√ß√µes' : 'Em andamento';

                    html += `
                        <div class="list-item">
                            <div class="list-avatar" style="background:var(--accent-dim);color:var(--accent)">${icon}</div>
                            <div class="list-content">
                                <h4>${t.nome || 'Torneio'}</h4>
                                <p>${t.inscritos?.length || 0} inscritos ¬∑ ${t.premio || 0} cr</p>
                            </div>
                            <span class="list-badge ${badge}">${label}</span>
                        </div>`;
                });
                el.innerHTML = html;
            } catch (e) {
                console.error('Erro torneios:', e);
                el.innerHTML = emptyHTML('Erro ao carregar');
            }
        }

        // ===================================
        // üìà GR√ÅFICO JOGOS (√∫ltimos 7 dias REAL)
        // ===================================
        async function carregarGraficoJogos() {
            const barsEl = document.getElementById('chartBars');
            const labelsEl = document.getElementById('chartLabels');
            const dias = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];

            try {
                // Buscar jogos dos √∫ltimos 7 dias
                const seteDias = new Date();
                seteDias.setDate(seteDias.getDate() - 7);
                seteDias.setHours(0, 0, 0, 0);

                const snap = await db.collection('jogos')
                    .where('dataCriacao', '>=', seteDias)
                    .get();

                // Agrupar por dia
                const contagem = {};
                for (let i = 6; i >= 0; i--) {
                    const d = new Date();
                    d.setDate(d.getDate() - i);
                    const key = d.toISOString().split('T')[0];
                    contagem[key] = { count: 0, label: dias[d.getDay()], isToday: i === 0 };
                }

                snap.forEach(doc => {
                    const d = doc.data().dataCriacao?.toDate ? doc.data().dataCriacao.toDate() : null;
                    if (d) {
                        const key = d.toISOString().split('T')[0];
                        if (contagem[key] !== undefined) contagem[key].count++;
                    }
                });

                const valores = Object.values(contagem);
                const max = Math.max(...valores.map(v => v.count), 1);

                let barsHTML = '', labelsHTML = '';
                valores.forEach(v => {
                    const h = Math.max((v.count / max) * 120, 4);
                    const opacity = v.isToday ? '1' : '0.7';
                    barsHTML += `
                        <div class="chart-col">
                            <div class="chart-bar" style="height:${h}px;opacity:${opacity}">
                                <span class="tooltip">${v.count} jogos</span>
                            </div>
                        </div>`;
                    labelsHTML += `<span style="${v.isToday ? 'color:var(--accent);font-weight:600' : ''}">${v.label}</span>`;
                });

                barsEl.innerHTML = barsHTML;
                labelsEl.innerHTML = labelsHTML;
            } catch (e) {
                console.error('Erro gr√°fico:', e);
                barsEl.innerHTML = '<div class="empty-state">Erro ao carregar gr√°fico</div>';
            }
        }

        // ===================================
        // ‚ö° ATIVIDADE RECENTE (dados reais)
        // ===================================
        async function carregarAtividade() {
            const el = document.getElementById('listaAtividade');
            const atividades = [];

            try {
                // √öltimas transa√ß√µes/premia√ß√µes
                const premSnap = await db.collection('jogos')
                    .where('premiado', '==', true)
                    .orderBy('dataCriacao', 'desc')
                    .limit(3).get();

                premSnap.forEach(doc => {
                    const j = doc.data();
                    const d = j.dataCriacao?.toDate ? j.dataCriacao.toDate() : new Date();
                    atividades.push({
                        color: 'var(--green)',
                        text: `Jogo <strong>premiado</strong> ‚Äî pool de ${j.premiacaoDetalhes?.totalPool || '?'} cr`,
                        time: d
                    });
                });

                // √öltimas compras
                const compSnap = await db.collection('compras')
                    .orderBy('data', 'desc')
                    .limit(2).get();

                compSnap.forEach(doc => {
                    const c = doc.data();
                    const d = c.data?.toDate ? c.data.toDate() : new Date();
                    atividades.push({
                        color: 'var(--green)',
                        text: `<strong>${c.userName || 'Usu√°rio'}</strong> comprou ${c.creditos || 0} cr√©ditos`,
                        time: d
                    });
                });

                // √öltimos cadastros
                const userSnap = await db.collection('usuarios')
                    .orderBy('dataCadastro', 'desc')
                    .limit(2).get();

                userSnap.forEach(doc => {
                    const u = doc.data();
                    const d = u.dataCadastro?.toDate ? u.dataCadastro.toDate() : new Date();
                    atividades.push({
                        color: 'var(--blue)',
                        text: `<strong>@${u.usuarioUnico || 'novo'}</strong> se cadastrou`,
                        time: d
                    });
                });

                // Ordenar por data
                atividades.sort((a, b) => b.time - a.time);

                if (atividades.length === 0) {
                    el.innerHTML = emptyHTML('Sem atividade recente');
                    return;
                }

                let html = '';
                atividades.slice(0, 6).forEach(a => {
                    html += `
                        <div class="activity-item">
                            <div class="activity-dot" style="background:${a.color}"></div>
                            <div>
                                <div class="activity-text">${a.text}</div>
                                <div class="activity-time">${tempoRelativo(a.time)}</div>
                            </div>
                        </div>`;
                });
                el.innerHTML = html;
            } catch (e) {
                console.error('Erro atividade:', e);
                el.innerHTML = emptyHTML('Erro ao carregar');
            }
        }

        // ===================================
        // üõ†Ô∏è UTILS
        // ===================================
        function setStat(id, val) {
            document.getElementById(id).textContent = val;
        }

        function showBadge(id, count) {
            const el = document.getElementById(id);
            if (el && count > 0) {
                el.textContent = count;
                el.style.display = 'inline';
            }
        }

        function formatNumber(n) {
            if (n >= 1000000) return (n / 1000000).toFixed(1) + 'M';
            if (n >= 1000) return (n / 1000).toFixed(1) + 'K';
            return n.toLocaleString('pt-BR');
        }

        function calcNivel(xp) {
            if (xp >= 5000) return 'üíé Diamante';
            if (xp >= 2500) return 'ü•á Ouro';
            if (xp >= 1000) return 'ü•à Prata';
            if (xp >= 250) return 'ü•â Bronze';
            return 'üÜï Iniciante';
        }

        function tempoRelativo(date) {
            const seg = Math.floor((Date.now() - date.getTime()) / 1000);
            if (seg < 60) return 'Agora';
            if (seg < 3600) return `${Math.floor(seg / 60)}min atr√°s`;
            if (seg < 86400) return `${Math.floor(seg / 3600)}h atr√°s`;
            return `${Math.floor(seg / 86400)}d atr√°s`;
        }

        function emptyHTML(msg) {
            return `<div class="empty-state"><div class="empty-icon">üì≠</div>${msg}</div>`;
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
            document.getElementById('overlay').classList.toggle('open');
        }
    </script>
</body>
</html>
