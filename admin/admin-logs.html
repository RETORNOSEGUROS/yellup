<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logs â€” Yellup Admin</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
    <style>
        :root{--bg-primary:#0c0e14;--bg-secondary:#12141c;--bg-card:#181a24;--bg-card-hover:#1e2030;--bg-sidebar:#10121a;--border:#1e2030;--border-light:#282a3a;--text-primary:#e8e9ed;--text-secondary:#8b8d9a;--text-muted:#5c5e6e;--accent:#f0b429;--accent-dim:rgba(240,180,41,.12);--green:#34d399;--green-dim:rgba(52,211,153,.12);--red:#f87171;--red-dim:rgba(248,113,113,.12);--blue:#60a5fa;--blue-dim:rgba(96,165,250,.12);--purple:#a78bfa;--purple-dim:rgba(167,139,250,.12);--orange:#fb923c;--orange-dim:rgba(251,146,60,.12);--sidebar-w:250px;--header-h:64px;}
        *{margin:0;padding:0;box-sizing:border-box;}
        body{font-family:'DM Sans',-apple-system,sans-serif;background:var(--bg-primary);color:var(--text-primary);min-height:100vh;overflow-x:hidden;}
        .sidebar{position:fixed;left:0;top:0;width:var(--sidebar-w);height:100vh;background:var(--bg-sidebar);border-right:1px solid var(--border);display:flex;flex-direction:column;z-index:100;transition:transform .3s ease;}
        .sidebar-brand{height:var(--header-h);display:flex;align-items:center;gap:10px;padding:0 20px;border-bottom:1px solid var(--border);flex-shrink:0;}
        .sidebar-brand .logo{width:32px;height:32px;background:var(--accent);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:700;color:#000;}
        .sidebar-brand h1{font-size:17px;font-weight:700;letter-spacing:-.3px;} .sidebar-brand h1 span{color:var(--text-muted);font-weight:500;font-size:12px;margin-left:6px;}
        .sidebar-nav{flex:1;overflow-y:auto;padding:12px 0;} .sidebar-nav::-webkit-scrollbar{width:0;}
        .nav-group{margin-bottom:8px;} .nav-group-title{font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:1.2px;color:var(--text-muted);padding:12px 20px 6px;}
        .nav-item{display:flex;align-items:center;gap:10px;padding:8px 16px;margin:1px 8px;border-radius:8px;color:var(--text-secondary);text-decoration:none;font-size:13px;font-weight:500;transition:all .15s;cursor:pointer;}
        .nav-item:hover{background:var(--bg-card);color:var(--text-primary);} .nav-item.active{background:var(--accent-dim);color:var(--accent);}
        .nav-item .icon{width:20px;text-align:center;font-size:14px;flex-shrink:0;}
        .sidebar-footer{padding:12px 16px;border-top:1px solid var(--border);flex-shrink:0;}
        .sidebar-footer .admin-box{display:flex;align-items:center;gap:10px;padding:8px;border-radius:8px;} .admin-avatar{width:32px;height:32px;background:linear-gradient(135deg,var(--accent),#e09800);border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:13px;color:#000;}
        .admin-info-text{flex:1;} .admin-info-text .name{font-size:13px;font-weight:600;} .admin-info-text .role{font-size:11px;color:var(--text-muted);}
        .btn-logout{background:none;border:none;color:var(--text-muted);cursor:pointer;font-size:16px;padding:4px;border-radius:6px;} .btn-logout:hover{color:var(--red);background:var(--red-dim);}
        .main{margin-left:var(--sidebar-w);min-height:100vh;}
        .header{height:var(--header-h);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 32px;background:var(--bg-primary);position:sticky;top:0;z-index:50;}
        .header-left h2{font-size:16px;font-weight:600;} .header-left p{font-size:12px;color:var(--text-muted);margin-top:1px;}
        .content{padding:24px 32px 40px;}

        .filters{display:flex;gap:10px;margin-bottom:16px;flex-wrap:wrap;align-items:center;}
        .fsel{padding:8px 12px;border:1px solid var(--border);border-radius:8px;background:var(--bg-card);color:var(--text-primary);font-size:12px;font-family:inherit;cursor:pointer;} .fsel:focus{outline:none;border-color:var(--accent);}
        .search-box{flex:1;min-width:200px;position:relative;}
        .search-box input{width:100%;padding:8px 12px 8px 32px;border:1px solid var(--border);border-radius:8px;background:var(--bg-card);color:var(--text-primary);font-size:12px;font-family:inherit;} .search-box input:focus{outline:none;border-color:var(--accent);}
        .search-box .si{position:absolute;left:10px;top:50%;transform:translateY(-50%);font-size:12px;}
        .btn{padding:8px 16px;border-radius:8px;border:1px solid var(--border);background:var(--bg-card);color:var(--text-primary);font-size:12px;font-weight:500;cursor:pointer;font-family:inherit;display:inline-flex;align-items:center;gap:6px;} .btn:hover{border-color:var(--accent);}

        /* Log timeline */
        .log-feed{display:flex;flex-direction:column;}
        .log-item{display:flex;gap:12px;padding:12px 16px;border-bottom:1px solid var(--border);transition:background .1s;align-items:flex-start;}
        .log-item:hover{background:var(--bg-card-hover);}
        .log-icon{width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0;}
        .log-body{flex:1;min-width:0;}
        .log-main{font-size:13px;color:var(--text-secondary);line-height:1.5;}
        .log-main strong{color:var(--text-primary);font-weight:600;}
        .log-main .val-pos{color:var(--green);font-weight:600;font-family:'JetBrains Mono',monospace;}
        .log-main .val-neg{color:var(--red);font-weight:600;font-family:'JetBrains Mono',monospace;}
        .log-main .val-neutral{color:var(--accent);font-weight:600;font-family:'JetBrains Mono',monospace;}
        .log-meta{display:flex;gap:10px;margin-top:3px;}
        .log-meta span{font-size:10px;color:var(--text-muted);font-family:'JetBrains Mono',monospace;}
        .log-badge{font-size:9px;font-weight:600;padding:2px 8px;border-radius:4px;margin-left:auto;flex-shrink:0;align-self:center;}

        .card{background:var(--bg-card);border:1px solid var(--border);border-radius:12px;overflow:hidden;}
        .card-header{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-bottom:1px solid var(--border);}
        .card-title{font-size:13px;font-weight:600;display:flex;align-items:center;gap:8px;}
        .card-title .count{font-family:'JetBrains Mono',monospace;font-size:11px;background:var(--bg-card-hover);color:var(--text-secondary);padding:1px 8px;border-radius:6px;}
        .pag{display:flex;justify-content:center;gap:8px;margin-top:16px;}
        .pag button{padding:7px 16px;border:1px solid var(--border);border-radius:6px;background:var(--bg-card);color:var(--text-primary);font-size:12px;cursor:pointer;font-family:inherit;} .pag button:hover:not(:disabled){border-color:var(--accent);} .pag button:disabled{opacity:.4;cursor:not-allowed;}
        .pag span{padding:7px 12px;font-size:12px;color:var(--text-muted);}
        .empty-state{text-align:center;padding:40px;color:var(--text-muted);font-size:13px;}

        /* Stats bar */
        .stats-bar{display:flex;gap:12px;margin-bottom:16px;}
        .mini-stat{background:var(--bg-card);border:1px solid var(--border);border-radius:10px;padding:10px 14px;display:flex;align-items:center;gap:8px;flex:1;}
        .mini-stat .ms-val{font-family:'JetBrains Mono',monospace;font-size:16px;font-weight:700;} .mini-stat .ms-label{font-size:10px;color:var(--text-muted);}

        .refresh-dot{width:8px;height:8px;border-radius:50%;background:var(--green);display:inline-block;margin-right:6px;animation:pulse-dot 2s infinite;}
        @keyframes pulse-dot{0%,100%{opacity:1;}50%{opacity:.3;}}
        .mobile-toggle{display:none;position:fixed;top:16px;left:16px;z-index:200;width:40px;height:40px;border-radius:10px;background:var(--bg-card);border:1px solid var(--border);color:var(--text-primary);font-size:18px;cursor:pointer;align-items:center;justify-content:center;}
        .overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:90;} .overlay.open{display:block;}
        @media(max-width:768px){.sidebar{transform:translateX(-100%);} .sidebar.open{transform:translateX(0);} .overlay.open{display:block;} .mobile-toggle{display:flex;} .main{margin-left:0;} .header{padding:0 16px 0 64px;} .content{padding:16px;} .filters{flex-direction:column;} .stats-bar{flex-wrap:wrap;} .mini-stat{flex:none;width:calc(50% - 6px);}}
    </style>
</head>
<body>
    <button class="mobile-toggle" onclick="toggleSidebar()">â˜°</button>
    <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-brand"><div class="logo">Y</div><h1>Yellup <span>Admin</span></h1></div>
        <nav class="sidebar-nav">
            <div class="nav-group"><div class="nav-group-title">VisÃ£o Geral</div><a href="dashboard.html" class="nav-item"><span class="icon">ğŸ“Š</span> Dashboard</a></div>
            <div class="nav-group"><div class="nav-group-title">ConteÃºdo</div><a href="jogos.html" class="nav-item"><span class="icon">ğŸ®</span> Jogos</a><a href="perguntas.html" class="nav-item"><span class="icon">â“</span> Perguntas</a><a href="importar-perguntas.html" class="nav-item"><span class="icon">ğŸ“¥</span> Importar</a><a href="gerar-perguntas.html" class="nav-item"><span class="icon">ğŸ¤–</span> Gerar com IA</a><a href="times.html" class="nav-item"><span class="icon">âš½</span> Times</a></div>
            <div class="nav-group"><div class="nav-group-title">Jogadores</div><a href="usuarios.html" class="nav-item"><span class="icon">ğŸ‘¥</span> UsuÃ¡rios</a><a href="ranking.html" class="nav-item"><span class="icon">ğŸ†</span> Rankings</a><a href="admin-noticias.html" class="nav-item"><span class="icon">ğŸ“°</span> NotÃ­cias</a></div>
            <div class="nav-group"><div class="nav-group-title">CompetiÃ§Ãµes</div><a href="torneios.html" class="nav-item"><span class="icon">ğŸ…</span> Torneios</a><a href="admin-pvp.html" class="nav-item"><span class="icon">âš”ï¸</span> PvP Center</a></div>
            <div class="nav-group"><div class="nav-group-title">Financeiro</div><a href="financeiro.html" class="nav-item"><span class="icon">ğŸ’°</span> Resumo</a><a href="creditar-manual.html" class="nav-item"><span class="icon">â•</span> Creditar Manual</a><a href="transacoes.html" class="nav-item"><span class="icon">ğŸ’³</span> TransaÃ§Ãµes</a><a href="premiacao.html" class="nav-item"><span class="icon">ğŸ</span> PremiaÃ§Ã£o</a><a href="admin-passes.html" class="nav-item"><span class="icon">ğŸ«</span> Passes</a><a href="indicacoes.html" class="nav-item"><span class="icon">ğŸ”—</span> IndicaÃ§Ãµes</a></div>
            <div class="nav-group"><div class="nav-group-title">Comunidade</div><a href="admin-chat.html" class="nav-item"><span class="icon">ğŸ’¬</span> Chat</a><a href="admin-logs.html" class="nav-item active"><span class="icon">ğŸ“‹</span> Logs</a></div>
            <div class="nav-group"><div class="nav-group-title">Sistema</div><a href="bolsa-admin.html" class="nav-item"><span class="icon">ğŸ“ˆ</span> Bolsa</a><a href="configuracoes.html" class="nav-item"><span class="icon">âš™ï¸</span> Config</a><a href="suporte-admin.html" class="nav-item"><span class="icon">ğŸ§</span> Suporte</a></div>
        </nav>
        <div class="sidebar-footer"><div class="admin-box"><div class="admin-avatar">A</div><div class="admin-info-text"><div class="name" id="adminName">Admin</div><div class="role">Administrador</div></div><button class="btn-logout" onclick="sair()" title="Sair">â»</button></div></div>
    </aside>

    <div class="main">
        <header class="header">
            <div class="header-left"><h2>ğŸ“‹ Logs de Atividade</h2><p>Toda movimentaÃ§Ã£o de crÃ©ditos e aÃ§Ãµes na plataforma</p></div>
            <div><button class="btn" onclick="carregar()">ğŸ”„ Atualizar</button></div>
        </header>

        <div class="content">
            <div class="stats-bar">
                <div class="mini-stat"><span>ğŸ“Š</span><div><div class="ms-val" id="sTotal">â€”</div><div class="ms-label">Logs hoje</div></div></div>
                <div class="mini-stat"><span>ğŸ’°</span><div><div class="ms-val" id="sCredGanhos">â€”</div><div class="ms-label">CrÃ©ditos ganhos</div></div></div>
                <div class="mini-stat"><span>ğŸ”¥</span><div><div class="ms-val" id="sCredGastos">â€”</div><div class="ms-label">CrÃ©ditos gastos</div></div></div>
                <div class="mini-stat"><span>âš–ï¸</span><div><div class="ms-val" id="sBalance">â€”</div><div class="ms-label">BalanÃ§o (inflaÃ§Ã£o)</div></div></div>
            </div>

            <div class="filters">
                <div class="search-box"><span class="si">ğŸ”</span><input type="text" id="busca" placeholder="Buscar por nome ou ID..." oninput="filtrar()"></div>
                <select class="fsel" id="filtroTipo" onchange="filtrar()">
                    <option value="">Todos os tipos</option>
                    <option value="premio">ğŸ† PremiaÃ§Ã£o</option>
                    <option value="embate">âš”ï¸ Embate</option>
                    <option value="penalti">âš½ PÃªnalti</option>
                    <option value="torneio">ğŸ… Torneio</option>
                    <option value="bau">ğŸ“¦ BaÃº</option>
                    <option value="missao">ğŸ“‹ MissÃ£o</option>
                    <option value="compra">ğŸ›’ Compra</option>
                    <option value="indicacao">ğŸ”— IndicaÃ§Ã£o</option>
                    <option value="cadastro">ğŸ†• Cadastro</option>
                    <option value="skip">â© Skip</option>
                    <option value="bolsa">ğŸ“ˆ Bolsa</option>
                </select>
                <select class="fsel" id="filtroPeriodo" onchange="carregar()">
                    <option value="hoje">Hoje</option>
                    <option value="7d">Ãšltimos 7 dias</option>
                    <option value="30d">Ãšltimos 30 dias</option>
                </select>
            </div>

            <div class="card">
                <div class="card-header">
                    <div class="card-title">ğŸ“‹ Atividades <span class="count" id="logCount">0</span></div>
                </div>
                <div class="log-feed" id="logFeed">
                    <div class="empty-state">Carregando logs...</div>
                </div>
                <div class="pag">
                    <button onclick="pagAnt()" id="btnPrev" disabled>â† Anterior</button>
                    <span id="pagInfo">1/1</span>
                    <button onclick="pagProx()" id="btnNext">PrÃ³xima â†’</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig={apiKey:"AIzaSyC5ZrkEy7KuCFJOtPvI7-P-JcA0MF4im5c",authDomain:"painel-yellup.firebaseapp.com",projectId:"painel-yellup",storageBucket:"painel-yellup.appspot.com",messagingSenderId:"608347210297",appId:"1:608347210297:web:75092713724e617c7203e8"};
        firebase.initializeApp(firebaseConfig);
        const db=firebase.firestore(), auth=firebase.auth();

        let logs=[], filtrados=[], pag=1;
        const porPag=30;

        const ICONS={premio:'ğŸ†',embate:'âš”ï¸',penalti:'âš½',torneio:'ğŸ…',bau:'ğŸ“¦',missao:'ğŸ“‹',compra:'ğŸ›’',indicacao:'ğŸ”—',cadastro:'ğŸ†•',skip:'â©',bolsa:'ğŸ“ˆ',passe:'ğŸ«',creditar:'ğŸ’°',entrada_pvp:'âš”ï¸',premio_pvp:'âš”ï¸',premio_torneio:'ğŸ…',bau_diario:'ğŸ“¦',bonus_cadastro:'ğŸ',escalacao:'â­'};
        const COLORS={premio:'var(--accent)',embate:'var(--blue)',penalti:'var(--green)',torneio:'var(--purple)',bau:'var(--orange)',missao:'var(--accent)',compra:'var(--green)',indicacao:'var(--blue)',cadastro:'var(--green)',skip:'var(--red)',bolsa:'var(--purple)',passe:'var(--accent)',creditar:'var(--green)'};

        auth.onAuthStateChanged(u=>{
            if(!u){window.location.href='login.html';return;}
            document.getElementById('adminName').textContent=u.email.split('@')[0];
            carregar();
        });

        async function carregar(){
            try{
                const periodo=document.getElementById('filtroPeriodo').value;
                let desde=new Date();desde.setHours(0,0,0,0);
                if(periodo==='7d') desde=new Date(Date.now()-7*86400000);
                else if(periodo==='30d') desde=new Date(Date.now()-30*86400000);

                const snap=await db.collection('logs_atividade').where('data','>=',desde).orderBy('data','desc').limit(500).get();
                logs=snap.docs.map(d=>({id:d.id,...d.data()}));

                // Stats
                let ganhos=0,gastos=0;
                logs.forEach(l=>{
                    const v=l.valor||l.creditos||0;
                    if(v>0)ganhos+=v; else gastos+=Math.abs(v);
                });
                document.getElementById('sTotal').textContent=logs.length;
                document.getElementById('sCredGanhos').textContent='+'+ganhos;
                document.getElementById('sCredGastos').textContent='-'+gastos;
                const bal=ganhos-gastos;
                const sBalance=document.getElementById('sBalance');
                sBalance.textContent=(bal>=0?'+':'')+bal;
                sBalance.style.color=bal>0?'var(--green)':bal<0?'var(--red)':'var(--text-muted)';

                filtrar();
            }catch(e){
                console.error('Logs:',e);
                document.getElementById('logFeed').innerHTML='<div class="empty-state">âŒ Erro ao carregar: '+esc(e.message)+'</div>';
            }
        }

        function filtrar(){
            const busca=document.getElementById('busca').value.toLowerCase();
            const tipo=document.getElementById('filtroTipo').value;
            filtrados=logs.filter(l=>{
                if(tipo&&!(l.tipo||'').toLowerCase().includes(tipo))return false;
                if(busca){
                    const txt=[l.nome||'',l.usuario||'',l.odId||'',l.descricao||'',l.tipo||''].join(' ').toLowerCase();
                    if(!txt.includes(busca))return false;
                }
                return true;
            });
            pag=1;
            render();
        }

        function render(){
            const feed=document.getElementById('logFeed');
            document.getElementById('logCount').textContent=filtrados.length;
            const inicio=(pag-1)*porPag;
            const pagina=filtrados.slice(inicio,inicio+porPag);
            const totalPag=Math.max(1,Math.ceil(filtrados.length/porPag));

            if(!pagina.length){
                feed.innerHTML='<div class="empty-state">Nenhum log encontrado</div>';
            }else{
                feed.innerHTML=pagina.map(l=>{
                    const dt=l.data?.toDate?l.data.toDate():new Date();
                    const hora=dt.toLocaleString('pt-BR',{day:'2-digit',month:'2-digit',hour:'2-digit',minute:'2-digit',second:'2-digit'});
                    const tipo=(l.tipo||'outro').toLowerCase().replace(/\s/g,'_');
                    const icon=ICONS[tipo]||ICONS[tipo.split('_')[0]]||'ğŸ“';
                    const cor=COLORS[tipo]||COLORS[tipo.split('_')[0]]||'var(--text-muted)';
                    const nome=esc(l.nome||l.usuario||l.odId?.slice(0,12)||'Sistema');
                    const desc=esc(l.descricao||l.tipo||'');
                    const val=l.valor||l.creditos||0;
                    const valClass=val>0?'val-pos':val<0?'val-neg':'val-neutral';
                    const valText=val>0?'+'+val:val<0?String(val):val===0?'':''+val;

                    return `<div class="log-item">
                        <div class="log-icon" style="background:${cor}20;color:${cor}">${icon}</div>
                        <div class="log-body">
                            <div class="log-main"><strong>${nome}</strong> â€” ${desc} ${valText?`<span class="${valClass}">${valText} cr</span>`:''}</div>
                            <div class="log-meta"><span>${hora}</span><span>${tipo}</span>${l.saldoApos!==undefined?`<span>Saldo: ${l.saldoApos} cr</span>`:''}</div>
                        </div>
                    </div>`;
                }).join('');
            }
            document.getElementById('pagInfo').textContent=`${pag}/${totalPag}`;
            document.getElementById('btnPrev').disabled=pag<=1;
            document.getElementById('btnNext').disabled=pag>=totalPag;
        }

        function pagAnt(){if(pag>1){pag--;render();}}
        function pagProx(){const tp=Math.ceil(filtrados.length/porPag);if(pag<tp){pag++;render();}}
        function esc(t){const d=document.createElement('div');d.textContent=t;return d.innerHTML;}
        function sair(){auth.signOut().then(()=>window.location.href='login.html');}
        function toggleSidebar(){document.getElementById('sidebar').classList.toggle('open');document.getElementById('overlay').classList.toggle('open');}
    </script>
</body>
</html>
