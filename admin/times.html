document.addEventListener("DOMContentLoaded", () => {
  const tabela = document.getElementById("tabelaTimes");
  const filtro = document.getElementById("filtro");

  function desenharCamiseta(cor1, cor2, cor3, estilo) {
    return `
      <svg width="40" height="40" viewBox="0 0 100 100">
        <rect x="20" y="20" width="60" height="60" rx="10" ry="10" fill="${cor1}" stroke="${cor2}" stroke-width="4"/>
        ${estilo === 'listrada' ? `<line x1="40" y1="20" x2="40" y2="80" stroke="${cor3}" stroke-width="6"/>
        <line x1="60" y1="20" x2="60" y2="80" stroke="${cor3}" stroke-width="6"/>` : ''}
      </svg>
    `;
  }

  function carregarTimes() {
    db.collection("times").get().then(snapshot => {
      tabela.innerHTML = "";
      snapshot.forEach(doc => {
        const time = doc.data();
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${time.nome}</td>
          <td>${time.pais}</td>
          <td>${desenharCamiseta(time.primaria, time.secundaria, time.terciaria, time.estilo)}</td>
          <td><button>Editar</button></td>
        `;
        tabela.appendChild(row);
      });
    });
  }

  document.getElementById("btnCadastrar").addEventListener("click", () => {
    const nome = document.getElementById("nome").value;
    const pais = document.getElementById("pais").value;
    const primaria = document.getElementById("corPrimaria").value;
    const secundaria = document.getElementById("corSecundaria").value;
    const terciaria = document.getElementById("corTerciaria").value;
    const estilo = document.getElementById("estilo").value;

    db.collection("times").add({ nome, pais, primaria, secundaria, terciaria, estilo }).then(() => {
      carregarTimes();
    });
  });

  filtro.addEventListener("input", () => {
    const termo = filtro.value.toLowerCase();
    const linhas = tabela.querySelectorAll("tr");
    linhas.forEach(linha => {
      const texto = linha.textContent.toLowerCase();
      linha.style.display = texto.includes(termo) ? "" : "none";
    });
  });

  carregarTimes();
});
