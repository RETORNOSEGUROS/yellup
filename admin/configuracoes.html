<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Configura√ß√µes - Yellup Admin</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <script src="/admin/js/firebase-config.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
      color: #fff;
      padding: 20px;
    }
    .container { max-width: 900px; margin: 0 auto; }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding: 20px;
      background: rgba(0,0,0,0.3);
      border-radius: 15px;
      backdrop-filter: blur(10px);
    }
    .header h1 { font-size: 1.8em; display: flex; align-items: center; gap: 10px; }
    .btn-voltar {
      background: rgba(255,255,255,0.1);
      color: #fff;
      padding: 10px 20px;
      border-radius: 8px;
      text-decoration: none;
      transition: all 0.3s;
    }
    .btn-voltar:hover { background: rgba(255,255,255,0.2); }
    .config-section {
      background: rgba(0,0,0,0.3);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 20px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.1);
    }
    .config-section h2 {
      font-size: 1.2em;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .form-group { margin-bottom: 20px; }
    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: rgba(255,255,255,0.7);
      font-size: 0.9em;
    }
    .form-group input, .form-group textarea, .form-group select {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px;
      background: rgba(0,0,0,0.3);
      color: #fff;
      font-size: 1em;
      transition: all 0.3s;
    }
    .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
      outline: none;
      border-color: #FFD700;
      box-shadow: 0 0 10px rgba(255,215,0,0.3);
    }
    .form-group textarea { min-height: 120px; resize: vertical; }
    .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
    .btn-salvar {
      background: linear-gradient(135deg, #FFD700, #FFA500);
      color: #1a1a2e;
      padding: 15px 30px;
      border: none;
      border-radius: 8px;
      font-size: 1em;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .btn-salvar:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(255,215,0,0.4); }
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 15px 25px;
      border-radius: 10px;
      color: #fff;
      font-weight: 500;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s;
      z-index: 1000;
    }
    .toast.show { transform: translateY(0); opacity: 1; }
    .toast.success { background: linear-gradient(135deg, #2ecc71, #27ae60); }
    .toast.error { background: linear-gradient(135deg, #e74c3c, #c0392b); }
    .hint { font-size: 0.8em; color: rgba(255,255,255,0.5); margin-top: 5px; }
    .toggle-container { display: flex; align-items: center; gap: 15px; }
    .toggle {
      position: relative;
      width: 50px;
      height: 26px;
      background: rgba(255,255,255,0.2);
      border-radius: 13px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .toggle.active { background: #2ecc71; }
    .toggle::after {
      content: '';
      position: absolute;
      width: 22px;
      height: 22px;
      background: #fff;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: all 0.3s;
    }
    .toggle.active::after { left: 26px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>‚öôÔ∏è Configura√ß√µes do Sistema</h1>
      <a href="dashboard.html" class="btn-voltar">‚Üê Painel Admin</a>
    </div>

    <div class="config-section">
      <h2>üí∞ Configura√ß√µes Financeiras</h2>
      <div class="form-row">
        <div class="form-group">
          <label>Percentual para Premia√ß√£o (%)</label>
          <input type="number" id="percentualPremio" placeholder="Ex: 70" min="0" max="100">
          <div class="hint">% dos cr√©ditos pagos que vai para o pool de premia√ß√£o</div>
        </div>
        <div class="form-group">
          <label>Valor M√≠nimo de Entrada (cr√©ditos)</label>
          <input type="number" id="valorMinimoAposta" placeholder="Ex: 1" min="0">
        </div>
        <div class="form-group">
          <label>Taxa de Saque (R$ por cr√©dito)</label>
          <input type="number" id="taxaSaque" placeholder="Ex: 0.40" step="0.01" min="0">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Cr√©dito M√°ximo por Usu√°rio</label>
          <input type="number" id="limiteCredito" placeholder="Ex: 10000" min="0">
        </div>
        <div class="form-group">
          <label>Saque M√≠nimo (cr√©ditos)</label>
          <input type="number" id="saqueMinimo" placeholder="Ex: 50" min="0">
        </div>
        <div class="form-group">
          <label>B√¥nus de Indica√ß√£o (cr√©ditos)</label>
          <input type="number" id="bonusIndicacao" placeholder="Ex: 5" min="0">
        </div>
      </div>
    </div>

    <div class="config-section">
      <h2>üéÆ Configura√ß√µes de Jogo</h2>
      <div class="form-row">
        <div class="form-group">
          <label>Tempo por Pergunta (segundos)</label>
          <input type="number" id="tempoPergunta" placeholder="Ex: 30" min="5">
        </div>
        <div class="form-group">
          <label>Perguntas por Jogo</label>
          <input type="number" id="perguntasPorJogo" placeholder="Ex: 10" min="1">
        </div>
        <div class="form-group">
          <label>Pontos por Acerto</label>
          <input type="number" id="pontosPorAcerto" placeholder="Ex: 10" min="1">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Multiplicador de Streak</label>
          <input type="number" id="multiplicadorStreak" placeholder="Ex: 1.5" step="0.1" min="1">
          <div class="hint">Multiplicador aplicado em sequ√™ncias de acertos</div>
        </div>
        <div class="form-group">
          <label>XP por Jogo Completo</label>
          <input type="number" id="xpPorJogo" placeholder="Ex: 50" min="0">
        </div>
      </div>
    </div>

    <div class="config-section">
      <h2>üîî Funcionalidades</h2>
      <div class="form-row">
        <div class="form-group">
          <label>Chat Global</label>
          <div class="toggle-container">
            <div class="toggle" id="toggleChat" onclick="toggleConfig('chatAtivo')"></div>
            <span id="labelChat">Desativado</span>
          </div>
        </div>
        <div class="form-group">
          <label>Bolsa de Valores</label>
          <div class="toggle-container">
            <div class="toggle" id="toggleBolsa" onclick="toggleConfig('bolsaAtiva')"></div>
            <span id="labelBolsa">Desativado</span>
          </div>
        </div>
        <div class="form-group">
          <label>Sistema PVP</label>
          <div class="toggle-container">
            <div class="toggle" id="togglePvp" onclick="toggleConfig('pvpAtivo')"></div>
            <span id="labelPvp">Desativado</span>
          </div>
        </div>
        <div class="form-group">
          <label>Manuten√ß√£o</label>
          <div class="toggle-container">
            <div class="toggle" id="toggleManutencao" onclick="toggleConfig('manutencao')"></div>
            <span id="labelManutencao">Desativado</span>
          </div>
        </div>
      </div>
    </div>

    <div class="config-section">
      <h2>üìú Textos e Regras</h2>
      <div class="form-group">
        <label>Mensagem de Boas-vindas</label>
        <textarea id="mensagemBoasVindas" placeholder="Mensagem exibida para novos usu√°rios..."></textarea>
      </div>
      <div class="form-group">
        <label>Regras do Jogo</label>
        <textarea id="regras" placeholder="Descreva as regras do jogo aqui..."></textarea>
      </div>
    </div>

    <button class="btn-salvar" onclick="salvarConfiguracoes()">
      üíæ Salvar Todas as Configura√ß√µes
    </button>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    const db = firebase.firestore();
    let configAtual = {};

    document.addEventListener('DOMContentLoaded', carregarConfiguracoes);

    async function carregarConfiguracoes() {
      try {
        const doc = await db.collection('configuracoes').doc('geral').get();
        if (doc.exists) {
          configAtual = doc.data();
          preencherFormulario(configAtual);
        }
      } catch (e) {
        console.error('Erro ao carregar:', e);
      }
    }

    function preencherFormulario(config) {
      document.getElementById('percentualPremio').value = config.percentualPremio || '';
      document.getElementById('valorMinimoAposta').value = config.valorMinimoAposta || '';
      document.getElementById('taxaSaque').value = config.taxaSaque || '';
      document.getElementById('limiteCredito').value = config.limiteCredito || '';
      document.getElementById('saqueMinimo').value = config.saqueMinimo || '';
      document.getElementById('bonusIndicacao').value = config.bonusIndicacao || '';
      document.getElementById('tempoPergunta').value = config.tempoPergunta || '';
      document.getElementById('perguntasPorJogo').value = config.perguntasPorJogo || '';
      document.getElementById('pontosPorAcerto').value = config.pontosPorAcerto || '';
      document.getElementById('multiplicadorStreak').value = config.multiplicadorStreak || '';
      document.getElementById('xpPorJogo').value = config.xpPorJogo || '';
      document.getElementById('mensagemBoasVindas').value = config.mensagemBoasVindas || '';
      document.getElementById('regras').value = config.regras || '';
      
      atualizarToggle('Chat', config.chatAtivo);
      atualizarToggle('Bolsa', config.bolsaAtiva);
      atualizarToggle('Pvp', config.pvpAtivo);
      atualizarToggle('Manutencao', config.manutencao);
    }

    function atualizarToggle(nome, ativo) {
      const toggle = document.getElementById('toggle' + nome);
      const label = document.getElementById('label' + nome);
      if (ativo) {
        toggle.classList.add('active');
        label.textContent = 'Ativado';
      } else {
        toggle.classList.remove('active');
        label.textContent = 'Desativado';
      }
    }

    function toggleConfig(campo) {
      configAtual[campo] = !configAtual[campo];
      const mapa = { chatAtivo: 'Chat', bolsaAtiva: 'Bolsa', pvpAtivo: 'Pvp', manutencao: 'Manutencao' };
      atualizarToggle(mapa[campo], configAtual[campo]);
    }

    async function salvarConfiguracoes() {
      try {
        const config = {
          percentualPremio: parseFloat(document.getElementById('percentualPremio').value) || 70,
          valorMinimoAposta: parseInt(document.getElementById('valorMinimoAposta').value) || 1,
          taxaSaque: parseFloat(document.getElementById('taxaSaque').value) || 0.40,
          limiteCredito: parseInt(document.getElementById('limiteCredito').value) || 10000,
          saqueMinimo: parseInt(document.getElementById('saqueMinimo').value) || 50,
          bonusIndicacao: parseInt(document.getElementById('bonusIndicacao').value) || 5,
          tempoPergunta: parseInt(document.getElementById('tempoPergunta').value) || 30,
          perguntasPorJogo: parseInt(document.getElementById('perguntasPorJogo').value) || 10,
          pontosPorAcerto: parseInt(document.getElementById('pontosPorAcerto').value) || 10,
          multiplicadorStreak: parseFloat(document.getElementById('multiplicadorStreak').value) || 1.5,
          xpPorJogo: parseInt(document.getElementById('xpPorJogo').value) || 50,
          mensagemBoasVindas: document.getElementById('mensagemBoasVindas').value,
          regras: document.getElementById('regras').value,
          chatAtivo: configAtual.chatAtivo || false,
          bolsaAtiva: configAtual.bolsaAtiva || false,
          pvpAtivo: configAtual.pvpAtivo || false,
          manutencao: configAtual.manutencao || false,
          atualizadoEm: firebase.firestore.FieldValue.serverTimestamp()
        };

        await db.collection('configuracoes').doc('geral').set(config, { merge: true });
        configAtual = config;
        showToast('‚úÖ Configura√ß√µes salvas!', 'success');
      } catch (e) {
        console.error('Erro:', e);
        showToast('‚ùå Erro: ' + e.message, 'error');
      }
    }

    function showToast(msg, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.className = 'toast ' + type + ' show';
      setTimeout(() => toast.classList.remove('show'), 3000);
    }
  </script>
</body>
</html>
